
/* /web/static/src/views/graph/graph_arch_parser.js */
odoo.define('@web/views/graph/graph_arch_parser',['@web/core/utils/strings','@web/core/utils/xml','@web/search/utils/misc'],function(require){'use strict';let __exports={};const{exprToBoolean}=require("@web/core/utils/strings");const{visitXML}=require("@web/core/utils/xml");const{GROUPABLE_TYPES}=require("@web/search/utils/misc");const MODES=["bar","line","pie"];const ORDERS=["ASC","DESC","asc","desc",null];const GraphArchParser=__exports.GraphArchParser=class GraphArchParser{parse(arch,fields={}){const archInfo={fields,fieldAttrs:{},groupBy:[],measures:[]};visitXML(arch,(node)=>{switch(node.tagName){case"graph":{if(node.hasAttribute("disable_linking")){archInfo.disableLinking=exprToBoolean(node.getAttribute("disable_linking"));}
if(node.hasAttribute("stacked")){archInfo.stacked=exprToBoolean(node.getAttribute("stacked"));}
if(node.hasAttribute("cumulated")){archInfo.cumulated=exprToBoolean(node.getAttribute("cumulated"));}
if(node.hasAttribute("cumulated_start")){archInfo.cumulatedStart=exprToBoolean(node.getAttribute("cumulated_start"));}
const mode=node.getAttribute("type");if(mode&&MODES.includes(mode)){archInfo.mode=mode;}
const order=node.getAttribute("order");if(order&&ORDERS.includes(order)){archInfo.order=order.toUpperCase();}
const title=node.getAttribute("string");if(title){archInfo.title=title;}
break;}
case"field":{const fieldName=node.getAttribute("name");if(fieldName==="id"){break;}
const string=node.getAttribute("string");if(string){if(!archInfo.fieldAttrs[fieldName]){archInfo.fieldAttrs[fieldName]={};}
archInfo.fieldAttrs[fieldName].string=string;}
const widget=node.getAttribute("widget");if(widget){if(!archInfo.fieldAttrs[fieldName]){archInfo.fieldAttrs[fieldName]={};}
archInfo.fieldAttrs[fieldName].widget=widget;}
if(node.getAttribute("invisible")==="True"||node.getAttribute("invisible")==="1"){if(!archInfo.fieldAttrs[fieldName]){archInfo.fieldAttrs[fieldName]={};}
archInfo.fieldAttrs[fieldName].isInvisible=true;break;}
const isMeasure=node.getAttribute("type")==="measure";if(isMeasure){archInfo.measures.push(fieldName);archInfo.measure=fieldName;}else{const{type}=archInfo.fields[fieldName];if(GROUPABLE_TYPES.includes(type)){let groupBy=fieldName;const interval=node.getAttribute("interval");if(interval){groupBy+=`:${interval}`;}
archInfo.groupBy.push(groupBy);}}
break;}}});return archInfo;}}
return __exports;});;

/* /web/static/src/views/graph/graph_controller.js */
odoo.define('@web/views/graph/graph_controller',['@web/search/layout','@web/model/model','@web/views/standard_view_props','@web/search/action_hook','@web/search/search_bar/search_bar','@web/search/search_bar/search_bar_toggler','@web/search/cog_menu/cog_menu','@web/views/widgets/widget','@web/views/action_helper','@odoo/owl'],function(require){'use strict';let __exports={};const{Layout}=require("@web/search/layout");const{useModelWithSampleData}=require("@web/model/model");const{standardViewProps}=require("@web/views/standard_view_props");const{useSetupAction}=require("@web/search/action_hook");const{SearchBar}=require("@web/search/search_bar/search_bar");const{useSearchBarToggler}=require("@web/search/search_bar/search_bar_toggler");const{CogMenu}=require("@web/search/cog_menu/cog_menu");const{Widget}=require("@web/views/widgets/widget");const{ActionHelper}=require("@web/views/action_helper");const{Component,useRef}=require("@odoo/owl");const GraphController=__exports.GraphController=class GraphController extends Component{static template="web.GraphView";static components={Layout,SearchBar,CogMenu,Widget,ActionHelper};static props={...standardViewProps,Model:Function,modelParams:Object,Renderer:Function,buttonTemplate:String,};setup(){this.model=useModelWithSampleData(this.props.Model,this.props.modelParams,this.modelOptions);useSetupAction({rootRef:useRef("root"),getLocalState:()=>({metaData:this.model.metaData}),getContext:()=>this.getContext(),});this.searchBarToggler=useSearchBarToggler();}
get modelOptions(){return{lazy:!this.env.config.isReloadingController&&!this.env.inDialog&&!!this.props.display.controlPanel,};}
getContext(){const{measure,groupBy,mode}=this.model.metaData;const context={graph_measure:measure,graph_mode:mode,graph_groupbys:groupBy.map((gb)=>gb.spec),};if(mode!=="pie"){context.graph_order=this.model.metaData.order;context.graph_stacked=this.model.metaData.stacked;if(mode==="line"){context.graph_cumulated=this.model.metaData.cumulated;}}
return context;}}
return __exports;});;

/* /web/static/src/views/graph/graph_model.js */
odoo.define('@web/views/graph/graph_model',['@web/core/domain','@web/core/l10n/translation','@web/core/user','@web/core/utils/arrays','@web/core/utils/concurrency','@web/model/model','@web/search/utils/dates','@web/search/utils/group_by','@web/search/utils/misc','@web/views/utils'],function(require){'use strict';let __exports={};const{Domain}=require("@web/core/domain");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{user}=require("@web/core/user");const{sortBy}=require("@web/core/utils/arrays");const{KeepLast,Race}=require("@web/core/utils/concurrency");const{addPropertyFieldDefs,Model}=require("@web/model/model");const{rankInterval}=require("@web/search/utils/dates");const{getGroupBy}=require("@web/search/utils/group_by");const{GROUPABLE_TYPES}=require("@web/search/utils/misc");const{computeReportMeasures,processMeasure}=require("@web/views/utils");const SEP=__exports.SEP=" / ";const DATA_LIMIT=80;const SEQUENTIAL_TYPES=__exports.SEQUENTIAL_TYPES=["date","datetime"];const GraphModel=__exports.GraphModel=class GraphModel extends Model{setup(params){this.keepLast=new KeepLast();this.race=new Race();const _fetchDataPoints=this._fetchDataPoints.bind(this);this._fetchDataPoints=(...args)=>this.race.add(_fetchDataPoints(...args));this.initialGroupBy=null;this.metaData=params;this.data=null;this.searchParams=null;this.lineOverlayDataset=null;}
async load(searchParams){this.searchParams=searchParams;if(!this.initialGroupBy){this.initialGroupBy=searchParams.context.graph_groupbys||this.metaData.groupBy;}
const metaData=this._buildMetaData();await addPropertyFieldDefs(this.orm,metaData.resModel,searchParams.context,metaData.fields,metaData.groupBy.map((gb)=>gb.fieldName));await this._fetchDataPoints(metaData);}
async forceLoadAll(){const metaData=this._buildMetaData();await this._fetchDataPoints(metaData,true);this.notify();}
hasData(){return this.dataPoints?.length>0;}
async updateMetaData(params){if("measure"in params){const metaData=this._buildMetaData(params);await this._fetchDataPoints(metaData);this.useSampleModel=false;}else{await this.race.getCurrentProm();this.metaData=Object.assign({},this.metaData,params);this._prepareData();}
this.notify();}
_buildMetaData(params){const{domain,context,groupBy}=this.searchParams;const metaData=Object.assign({},this.metaData,{context});metaData.domain=domain;metaData.measure=context.graph_measure||metaData.measure;metaData.mode=context.graph_mode||metaData.mode;metaData.groupBy=groupBy.length?groupBy:this.initialGroupBy;if(metaData.mode!=="pie"){metaData.order="graph_order"in context?context.graph_order:metaData.order;if("graph_stacked"in context){metaData.stacked=context.graph_stacked;}
if(metaData.mode==="line"){metaData.cumulated="graph_cumulated"in context?context.graph_cumulated:metaData.cumulated;}}
this._normalize(metaData);metaData.measures=computeReportMeasures(metaData.fields,metaData.fieldAttrs,[...(metaData.viewMeasures||[]),metaData.measure,]);return Object.assign(metaData,params);}
async _fetchDataPoints(metaData,forceUseAllDataPoints=false){[this.dataPoints]=await this.keepLast.add(this._loadDataPoints(metaData));this.metaData=metaData;this._prepareData(forceUseAllDataPoints);}
_getData(dataPoints,forceUseAllDataPoints){const{mode}=this.metaData;const dataPtMapping=new WeakMap();const datasetsTmp={};let exceeds=false;const labels=[];const labelMap={};for(const dataPt of dataPoints){const datasetLabel=this._getDatasetLabel(dataPt);if(!(datasetLabel in datasetsTmp)){if(!forceUseAllDataPoints&&Object.keys(datasetsTmp).length>=DATA_LIMIT){exceeds=true;continue;}
datasetsTmp[datasetLabel]={label:datasetLabel};}
dataPtMapping.set(dataPt,datasetsTmp[datasetLabel]);const x=dataPt.labels.slice(0,mode==="pie"?undefined:1);const trueLabel=x.length?x.join(SEP):_t("Total");const key=JSON.stringify(x);if(labelMap[key]===undefined){labelMap[key]=labels.length;const label=x.length?x.join(SEP):_t("Total");labels.push(label);}
dataPt.labelIndex=labelMap[key];dataPt.trueLabel=trueLabel;}
for(const dataPt of dataPoints){if(!dataPtMapping.has(dataPt)){continue;}
const{domain,labelIndex,trueLabel,value,identifier,cumulatedStart,currencyId}=dataPt;const dataset=dataPtMapping.get(dataPt);if(!dataset.data){const dataLength=labels.length;Object.assign(dataset,{data:new Array(dataLength).fill(0),cumulatedStart,trueLabels:labels.slice(0,dataLength),domains:new Array(dataLength).fill([]),identifiers:new Set(),currencyIds:new Array(dataLength).fill(),});}
dataset.data[labelIndex]=value;dataset.domains[labelIndex]=domain;dataset.trueLabels[labelIndex]=trueLabel;dataset.identifiers.add(identifier);dataset.currencyIds[labelIndex]=currencyId;}
const datasets=Object.values(datasetsTmp);return{datasets,labels,exceeds};}
_getLineOverlayDataset(){const{stacked}=this.metaData;const datasets=this.data.datasets;let lineOverlayDataset=null;if(stacked&&datasets.length>1){const label=_t("Sum");const data=[];const currencyIds=[];for(const dataset of datasets){for(let i=0;i<dataset.data.length;i++){data[i]=(data[i]||0)+dataset.data[i];currencyIds[i]=dataset.currencyIds[i]||currencyIds[i];}}
lineOverlayDataset={label,data,currencyIds,trueLabels:datasets[0].trueLabels,};}
return lineOverlayDataset;}
_getDatasetLabel(dataPoint){const{measure,measures,mode}=this.metaData;const{labels}=dataPoint;if(mode==="pie"){return"";}
return labels.slice(1).join(SEP)||measures[measure].string;}
_getDefaultFilterLabel(gb){return this.metaData.fields[gb?.fieldName]?.falsy_value_label||_t("None");}
_getProcessedDataPoints(){const{groupBy,mode,order}=this.metaData;let processedDataPoints=[];if(mode==="line"){processedDataPoints=this.dataPoints.filter((dataPoint)=>dataPoint.labels[0]!==this._getDefaultFilterLabel(groupBy[0]));}else if(mode==="pie"){processedDataPoints=this.dataPoints.filter((dataPoint)=>dataPoint.value>0&&dataPoint.count!==0);}else{processedDataPoints=this.dataPoints.filter((dataPoint)=>dataPoint.count!==0);}
if(order!==null&&mode!=="pie"&&groupBy.length>0){const groupedDataPoints={};for(const dataPt of processedDataPoints){const key=dataPt.labels[0];if(!groupedDataPoints[key]){groupedDataPoints[key]=[];}
groupedDataPoints[key].push(dataPt);}
const groups=Object.values(groupedDataPoints);const groupTotal=(group)=>group.reduce((sum,dataPt)=>sum+dataPt.value,0);processedDataPoints=sortBy(groups,groupTotal,order.toLowerCase()).flat();}
return processedDataPoints;}
async _loadDataPoints(metaData){const{measure,domain,fields,groupBy,resModel,cumulatedStart}=metaData;const fieldName=groupBy[0]?.fieldName;const sequentialField=cumulatedStart&&SEQUENTIAL_TYPES.includes(fields[fieldName]?.type)?fieldName:null;const sequentialSpec=sequentialField&&groupBy[0].spec;const measures=["__count"];let fieldAggregate="__count",monetaryAggregates;if(measure!=="__count"){let{aggregator,currency_field,name,type}=fields[measure];if(type==="many2one"){aggregator="count_distinct";}
if(aggregator===undefined){throw new Error(`No aggregate function has been provided for the measure '${measure}'`);}
if(type==="monetary"&&currency_field){monetaryAggregates=[`${currency_field}:array_agg_distinct`,`${name}:sum_currency`,];measures.push(...monetaryAggregates);}
fieldAggregate=`${measure}:${aggregator}`;measures.push(fieldAggregate);}
const numbering={};const groups=await this.orm.formattedReadGroup(resModel,domain,groupBy.map((gb)=>gb.spec),measures,{context:{fill_temporal:true,...this.searchParams.context},});let startGroups=false;if(cumulatedStart&&sequentialField&&groups.length&&domain.some((leaf)=>leaf.length===3&&leaf[0]==sequentialField)){const firstDate=groups[0][sequentialSpec][0];const newDomain=Domain.combine([new Domain([[sequentialField,"<",firstDate]]),Domain.removeDomainLeaves(domain,[sequentialField]),],"AND").toList();startGroups=await this.orm.formattedReadGroup(resModel,newDomain,groupBy.filter((gb)=>gb.fieldName!=sequentialField).map((gb)=>gb.spec),measures,{context:{...this.searchParams.context},});}
const dataPoints=[];const cumulatedStartValue={};if(startGroups){for(const group of startGroups){const rawValues=[];for(const gb of groupBy.filter((gb)=>gb.fieldName!=sequentialField)){rawValues.push({[gb.spec]:group[gb.spec]});}
cumulatedStartValue[JSON.stringify(rawValues)]=group[measures.slice(-1)];}}
const graphCurrencies=new Set();const defaultCurrency=user.activeCompany.currency_id;for(const group of groups){const{__domain,__count}=group;const labels=[];const rawValues=[];for(const gb of groupBy){let label;const val=group[gb.spec];rawValues.push({[gb.spec]:val});const fieldName=gb.fieldName;const{type}=fields[fieldName];if(type==="boolean"){label=`${val}`;}else if(type==="integer"){label=val===false?"0":`${val}`;}else if(val===false){label=this._getDefaultFilterLabel(gb);}else if(["many2many","many2one"].includes(type)){const[id,name]=val;const key=JSON.stringify([fieldName,name]);if(!numbering[key]){numbering[key]={};}
const numbers=numbering[key];if(!numbers[id]){numbers[id]=Object.keys(numbers).length+1;}
const num=numbers[id];label=num===1?name:`${name} (${num})`;}else if(type==="selection"){const selected=fields[fieldName].selection.find((s)=>s[0]===val);label=selected[1];}else if(["date","datetime"].includes(type)){label=val[1];}else{label=val;}
labels.push(label);}
const value=group[fieldAggregate];if(!Number.isInteger(value)){metaData.allIntegers=false;}
const groupId=JSON.stringify(rawValues.slice(1));const dataPoint={count:__count,domain:__domain,value,labels,identifier:JSON.stringify(rawValues),cumulatedStart:cumulatedStartValue[groupId]||0,};if(monetaryAggregates){const currencies=group[monetaryAggregates[0]];dataPoint.currencyId=currencies[0];dataPoint.convertedValue=group[monetaryAggregates[1]];if(currencies.length>1){dataPoint.currencyId=defaultCurrency;dataPoint.value=dataPoint.convertedValue;}
graphCurrencies.add(dataPoint.currencyId);}
dataPoints.push(dataPoint);}
for(const dataPoint of dataPoints){if(graphCurrencies.size>1){dataPoint.currencyId=defaultCurrency;dataPoint.value=dataPoint.convertedValue;}
delete dataPoint.convertedValue;}
return[dataPoints,graphCurrencies];}
_normalize(metaData){const{fields}=metaData;const groupBy=[];for(const gb of metaData.groupBy){let ngb=gb;if(typeof gb==="string"){ngb=getGroupBy(gb,fields);}
groupBy.push(ngb);}
const processedGroupBy=[];for(const gb of groupBy){const{fieldName,interval}=gb;if(!fieldName.includes(".")){const{groupable,type}=fields[fieldName];if(!groupable||["id","__count"].includes(fieldName)||!GROUPABLE_TYPES.includes(type)){continue;}}
const index=processedGroupBy.findIndex((gb)=>gb.fieldName===fieldName);if(index===-1){processedGroupBy.push(gb);}else if(interval){const registeredInterval=processedGroupBy[index].interval;if(rankInterval(registeredInterval)<rankInterval(interval)){processedGroupBy.splice(index,1,gb);}}}
metaData.groupBy=processedGroupBy;metaData.measure=processMeasure(metaData.measure);}
_prepareData(forceUseAllDataPoints=false){const processedDataPoints=this._getProcessedDataPoints();this.data=this._getData(processedDataPoints,forceUseAllDataPoints);this.lineOverlayDataset=null;if(this.metaData.mode==="bar"){this.lineOverlayDataset=this._getLineOverlayDataset();}}}
return __exports;});;

/* /web/static/src/views/graph/graph_renderer.js */
odoo.define('@web/views/graph/graph_renderer',['@web/core/l10n/translation','@web/core/colors/colors','@web/core/registry','@web/views/fields/formatters','@web/views/graph/graph_model','@web/core/utils/arrays','@web/core/assets','@web/core/utils/render','@web/core/utils/hooks','@odoo/owl','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@web/core/browser/cookie','@web/core/utils/html','@web/views/view_components/report_view_measures','@web/views/widgets/widget'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{getBorderWhite,DEFAULT_BG,getColor,getCustomColor,lightenColor,darkenColor,}=require("@web/core/colors/colors");const{registry}=require("@web/core/registry");const{formatFloat,formatMonetary}=require("@web/views/fields/formatters");const{SEP}=require("@web/views/graph/graph_model");const{sortBy}=require("@web/core/utils/arrays");const{loadBundle}=require("@web/core/assets");const{renderToMarkup}=require("@web/core/utils/render");const{useService}=require("@web/core/utils/hooks");const{Component,onWillUnmount,useEffect,useRef,onWillStart,markup}=require("@odoo/owl");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{cookie}=require("@web/core/browser/cookie");const{createElementWithContent}=require("@web/core/utils/html");const{ReportViewMeasures}=require("@web/views/view_components/report_view_measures");const{Widget}=require("@web/views/widgets/widget");const NO_DATA=_t("No data");const formatters=registry.category("formatters");const colorScheme=cookie.get("color_scheme");const GRAPH_LEGEND_COLOR=getCustomColor(colorScheme,"#111827","#ffffff");const GRAPH_GRID_COLOR=getCustomColor(colorScheme,"rgba(0,0,0,.1)","rgba(255,255,255,.15");const GRAPH_LABEL_COLOR=getCustomColor(colorScheme,"#111827","#E4E4E4");const NO_DATA_COLOR=getCustomColor(colorScheme,DEFAULT_BG,"#3C3E4B");const gridOnTop={id:"gridOnTop",afterDraw:(chart)=>{const elements=chart.getDatasetMeta(0).data||[];const ctx=chart.ctx;const chartArea=chart.chartArea;const yAxis=chart.scales.y;const xAxis=chart.scales.x;ctx.lineWidth=1;ctx.strokeStyle=GRAPH_GRID_COLOR;yAxis.ticks.forEach((value,index)=>{const y=yAxis.getPixelForTick(index);ctx.beginPath();ctx.moveTo(chartArea.left,y);ctx.lineTo(chartArea.right,y);ctx.moveTo(chartArea.left-8,y);ctx.lineTo(chartArea.left,y);ctx.setLineDash([]);ctx.stroke();});xAxis.ticks.forEach((value,tickIndex)=>{const x=xAxis.getPixelForTick(tickIndex);ctx.beginPath();ctx.moveTo(x,chartArea.bottom);ctx.lineTo(x,chartArea.bottom+8);ctx.stroke();});elements.forEach((point,eltIndex)=>{xAxis.ticks.forEach((value,tickIndex)=>{if(point.active&&eltIndex===tickIndex){const x=xAxis.getPixelForTick(tickIndex);ctx.beginPath();ctx.moveTo(x,chartArea.top);ctx.lineTo(x,chartArea.bottom);ctx.strokeStyle=GRAPH_GRID_COLOR;ctx.stroke();}});});},};function getMaxWidth(chartArea){const{left,right}=chartArea;return Math.floor((right-left)/1.618)+"px";}
function shortenLabel(label){const groups=label.toString().split(SEP);let shortLabel=groups.slice(0,3).join(SEP);if(shortLabel.length>30){shortLabel=`${shortLabel.slice(0, 30)}...`;}else if(groups.length>3){shortLabel=`${shortLabel}${SEP}...`;}
return shortLabel;}
const GraphRenderer=__exports.GraphRenderer=class GraphRenderer extends Component{static template="web.GraphRenderer";static components={Dropdown,DropdownItem,ReportViewMeasures,Widget};static props=["class?","model","buttonTemplate"];setup(){this.model=this.props.model;this.rootRef=useRef("root");this.canvasRef=useRef("canvas");this.containerRef=useRef("container");this.actionService=useService("action");this.chart=null;this.tooltip=null;this.legendTooltip=null;onWillStart(async()=>{await loadBundle("web.chartjs_lib");});useEffect(()=>this.renderChart());onWillUnmount(this.onWillUnmount);}
onWillUnmount(){if(this.chart){this.chart.destroy();}}
adjustTooltipHeight(tooltip,maxTooltipHeight){const sizeOneLine=tooltip.querySelector("tbody tr").clientHeight;const tbodySize=tooltip.querySelector("tbody").clientHeight;const toKeep=Math.max(0,Math.floor((maxTooltipHeight-(tooltip.clientHeight-tbodySize))/sizeOneLine)-1);const lines=tooltip.querySelectorAll("tbody tr");const toRemove=lines.length-toKeep;if(toRemove>0){for(let index=toKeep;index<lines.length;++index){lines[index].remove();}
const tr=document.createElement("tr");const td=document.createElement("td");tr.classList.add("o_show_more","text-center","fw-bold");td.setAttribute("colspan","2");td.innerText=_t("...");tr.appendChild(td);tooltip.querySelector("tbody").appendChild(tr);}}
customTooltip(data,metaData,context){const tooltipModel=context.tooltip;const{measure,measures,disableLinking,mode}=metaData;this.containerRef.el.style.cursor="";this.removeTooltips();if(tooltipModel.opacity===0||tooltipModel.dataPoints.length===0){return;}
if(!disableLinking&&mode!=="line"){this.containerRef.el.style.cursor="pointer";}
const chartAreaTop=this.chart.chartArea.top;const viewContentTop=this.containerRef.el.getBoundingClientRect().top;const content=renderToMarkup("web.GraphRenderer.CustomTooltip",{maxWidth:getMaxWidth(this.chart.chartArea),measure:measures[measure].string,mode:this.model.metaData.mode,tooltipItems:this.getTooltipItems(data,metaData,tooltipModel),});const template=createElementWithContent("template",content);const tooltip=template.content.firstChild;this.containerRef.el.prepend(tooltip);let top;const tooltipHeight=tooltip.clientHeight;const minTopAllowed=Math.floor(chartAreaTop);const maxTopAllowed=Math.floor(window.innerHeight-(viewContentTop+tooltipHeight))-2;const y=Math.floor(tooltipModel.y);if(minTopAllowed<=maxTopAllowed){if(y<=maxTopAllowed){if(y>=minTopAllowed){top=y;}else{top=minTopAllowed;}}else{top=maxTopAllowed;}}else{top=minTopAllowed;const maxTooltipHeight=window.innerHeight-(viewContentTop+chartAreaTop)-2;this.adjustTooltipHeight(tooltip,maxTooltipHeight);}
this.fixTooltipLeftPosition(tooltip,tooltipModel.x);tooltip.style.top=Math.floor(top)+"px";this.tooltip=tooltip;}
fixTooltipLeftPosition(tooltip,x){let left;const tooltipWidth=tooltip.clientWidth;const minLeftAllowed=Math.floor(this.chart.chartArea.left+2);const maxLeftAllowed=Math.floor(this.chart.chartArea.right-tooltipWidth-2);x=Math.floor(x);if(x<minLeftAllowed){left=minLeftAllowed;}else if(x>maxLeftAllowed){left=maxLeftAllowed;}else{left=x;}
tooltip.style.left=`${left}px`;}
formatValue(value,allIntegers=true,formatType=""){const largeNumber=Math.abs(value)>=1000;if(formatType){return formatters.get(formatType)(value);}
if(allIntegers&&!largeNumber){return String(value);}
if(largeNumber){return formatFloat(value,{humanReadable:true,decimals:2,minDigits:1});}
return formatFloat(value);}
getBarChartData(){const{stacked}=this.model.metaData;const{data,lineOverlayDataset}=this.model;for(let index=0;index<data.datasets.length;++index){const dataset=data.datasets[index];const itemColor=getColor(index,colorScheme,data.datasets.length);if(stacked){dataset.stack="";}
dataset.backgroundColor=itemColor;dataset.borderRadius=4;}
if(lineOverlayDataset){Object.assign(lineOverlayDataset,{type:"line",order:-1,tension:0,fill:false,pointHitRadius:20,pointRadius:5,pointHoverRadius:10,backgroundColor:getCustomColor(colorScheme,"#343a40","#e9ecef"),borderColor:getCustomColor(colorScheme,"rgba(0,0,0,.3)","rgba(255,255,255,.5)"),borderWidth:2,lineWidth:3,});return{...data,datasets:[...data.datasets,lineOverlayDataset],};}
return data;}
getChartConfig(){const{mode}=this.model.metaData;let data;switch(mode){case"bar":data=this.getBarChartData();break;case"line":data=this.getLineChartData();break;case"pie":data=this.getPieChartData();}
const options=this.prepareOptions();const config={data,options,type:mode};if(mode==="line"){config.plugins=[gridOnTop];}
return config;}
getAnimationOptions(){let delayed;const{mode}=this.model.metaData;const labelsCount=this.model.data.labels.length;const gap=350;const animationOptions={};if(mode==="pie"){animationOptions.offset={duration:200};}else{animationOptions.duration=600;animationOptions.onComplete=()=>{delayed=true;};animationOptions.delay=(context)=>{let delay=0;if((mode==="bar"||mode==="line")&&!delayed){delay=context.dataIndex*(gap/labelsCount);}
return delay;};}
return animationOptions;}
getElementOptions(){const{mode,stacked}=this.model.metaData;const elementOptions={};if(mode==="bar"){elementOptions.bar={borderWidth:1};}else if(mode==="line"){elementOptions.line={fill:stacked,tension:0};}
return elementOptions;}
getLegendOptions(){const{mode}=this.model.metaData;const legendOptions={onHover:this.onLegendHover.bind(this),onLeave:this.onLegendLeave.bind(this),};if(mode==="line"){legendOptions.onClick=this.onLegendClick.bind(this);}
if(mode==="pie"){legendOptions.labels={generateLabels:(chart)=>chart.data.labels.map((label,index)=>{const hidden=!chart.getDataVisibility(index);const fullText=label;const text=shortenLabel(fullText);const fillStyle=label===NO_DATA?NO_DATA_COLOR:getColor(index,colorScheme,chart.data.labels.length);return{text,fullText,fillStyle,hidden,index,fontColor:GRAPH_LEGEND_COLOR,lineWidth:0,};}),};}else{legendOptions.position="top";legendOptions.align="end";const referenceColor=mode==="bar"?"backgroundColor":"borderColor";legendOptions.labels={generateLabels:(chart)=>{const{data}=chart;const labels=data.datasets.map((dataset,index)=>({text:shortenLabel(dataset.label),fullText:dataset.label,fillStyle:dataset[referenceColor],hidden:!chart.isDatasetVisible(index),lineCap:dataset.borderCapStyle,lineDash:dataset.borderDash,lineDashOffset:dataset.borderDashOffset,lineJoin:dataset.borderJoinStyle,lineWidth:dataset.borderWidth,strokeStyle:dataset[referenceColor],pointStyle:dataset.pointStyle,datasetIndex:index,fontColor:GRAPH_LEGEND_COLOR,}));return labels;},};}
return legendOptions;}
getLineChartData(){const{cumulated}=this.model.metaData;const data=this.model.data;for(let index=0;index<data.datasets.length;++index){const dataset=data.datasets[index];const itemColor=getColor(index,colorScheme,data.datasets.length);dataset.backgroundColor=getCustomColor(colorScheme,lightenColor(itemColor,0.5),darkenColor(itemColor,0.5));dataset.cubicInterpolationMode="monotone";dataset.borderColor=itemColor;dataset.borderWidth=2;dataset.hoverBackgroundColor=dataset.borderColor;dataset.pointRadius=3;dataset.pointHoverRadius=6;if(cumulated){let accumulator=dataset.cumulatedStart;dataset.data=dataset.data.map((value)=>{accumulator+=value;return accumulator;});}
if(data.labels.length===1){dataset.data.unshift(undefined);dataset.trueLabels.unshift(undefined);dataset.domains.unshift(undefined);}
dataset.pointBackgroundColor=dataset.borderColor;}
data.labels=data.labels.length>1?data.labels:["",...data.labels,""];return data;}
getPieChartData(){const data=this.model.data;const colors=data.labels.map((_,index)=>getColor(index,colorScheme,data.labels.length));const borderColor=getBorderWhite(colorScheme);for(const dataset of data.datasets){dataset.backgroundColor=colors;dataset.hoverBackgroundColor=colors;dataset.borderColor=borderColor;dataset.hoverOffset=60;}
let addNoDataToLegend=false;if(data.datasets.length===0){const fakeData=new Array(data.labels.length+1);fakeData[data.labels.length]=1;const fakeTrueLabels=new Array(data.labels.length+1);fakeTrueLabels[data.labels.length]=NO_DATA;data.datasets.push({label:"",data:fakeData,trueLabels:fakeTrueLabels,backgroundColor:[...colors,NO_DATA_COLOR],borderColor,});addNoDataToLegend=true;}
if(addNoDataToLegend){data.labels.push(NO_DATA);}
return data;}
getScaleOptions(){const{labels}=this.model.data;const{fieldAttrs,measure,measures,mode,stacked}=this.model.metaData;if(mode==="pie"){return{};}
const xAxe={type:"category",ticks:{callback:(val,index)=>{const value=labels[index];return shortenLabel(value);},color:GRAPH_LABEL_COLOR,},grid:{color:"transparent",},border:{display:false,},};const yAxe={beginAtZero:true,type:"linear",title:{text:measures[measure].string,color:cookie.get("color_scheme")==="dark"?getColor(15,cookie.get("color_scheme")):null,},ticks:{callback:(value)=>this.formatValue(value,false,fieldAttrs[measure]?.widget),color:GRAPH_LABEL_COLOR,},stacked:mode==="line"&&stacked?stacked:undefined,grid:{display:mode==="line"?false:true,color:GRAPH_GRID_COLOR,},border:{display:false,},suggestedMax:0,suggestedMin:0,};return{x:xAxe,y:yAxe};}
loadAll(){return this.model.forceLoadAll();}
getTooltipItems(data,metaData,tooltipModel){const{allIntegers,mode,groupBy,measure}=metaData;const sortedDataPoints=sortBy(tooltipModel.dataPoints,"raw","desc");const items=[];for(const item of sortedDataPoints){const index=item.dataIndex;const dataset=data.datasets[item.datasetIndex]||this.model.lineOverlayDataset;let label=dataset.trueLabels[index];let value=dataset.data[index];const measureWidget=metaData.fieldAttrs[measure]?.widget;if(dataset.currencyIds?.[index]){value=formatMonetary(value,{currencyId:dataset.currencyIds[index]});}else if(dataset.currencyIds?.[index]===false){value=markup`${formatMonetary(value)}<sup class="ms-1 fw-bolder">?</sup>`;}else{value=this.formatValue(value,allIntegers,measureWidget);}
let boxColor;let percentage;if(mode==="pie"){if(label===NO_DATA){value=this.formatValue(0,allIntegers,measureWidget);}
boxColor=dataset.backgroundColor[index];const totalData=dataset.data.reduce((a,b)=>a+b,0);percentage=totalData&&((dataset.data[index]*100)/totalData).toFixed(2);}else{if(groupBy.length>1){label=`${label} / ${dataset.label}`;}
boxColor=mode==="bar"?dataset.backgroundColor:dataset.borderColor;}
items.push({label,value,boxColor,percentage});}
return items;}
getTooltipOptions(){const{data,metaData}=this.model;const{mode}=metaData;const tooltipOptions={enabled:false,external:this.customTooltip.bind(this,data,metaData),};if(mode==="line"){tooltipOptions.mode="index";tooltipOptions.intersect=false;tooltipOptions.position="average";}
if(mode==="bar"){tooltipOptions.xAlign="center";tooltipOptions.yAlign="bottom";}
if(mode==="pie"){tooltipOptions.xAlign="center";tooltipOptions.yAlign="center";}
return tooltipOptions;}
onGraphClicked(ev,isMiddleClick){const{disableLinking,mode}=this.model.metaData;if(disableLinking||mode==="line"){return;}
const[activeElement]=this.chart.getElementsAtEventForMode(ev,"nearest",{intersect:true},false);if(!activeElement){return;}
const{datasetIndex,index}=activeElement;const{domains}=this.chart.data.datasets[datasetIndex];if(domains){this.onGraphClickedFinal(domains[index],isMiddleClick);}}
onLegendClick(ev,legendItem){this.removeTooltips();const index=legendItem.datasetIndex;const meta=this.chart.getDatasetMeta(index);meta.hidden=meta.hidden===null?!this.chart.data.datasets[index].hidden:null;this.chart.update();}
onLegendHover(ev,legendItem){ev=ev.native;this.canvasRef.el.style.cursor="pointer";const{fullText,text}=legendItem;if(this.legendTooltip||text===fullText){return;}
const viewContentTop=this.canvasRef.el.getBoundingClientRect().top;const legendTooltip=Object.assign(document.createElement("div"),{className:"o_tooltip_legend popover p-3 pe-none position-absolute",innerText:fullText,});legendTooltip.style.top=`${ev.clientY - viewContentTop}px`;legendTooltip.style.maxWidth=getMaxWidth(this.chart.chartArea);this.containerRef.el.appendChild(legendTooltip);this.fixTooltipLeftPosition(legendTooltip,ev.clientX);this.legendTooltip=legendTooltip;}
onLegendLeave(){this.canvasRef.el.style.cursor="";this.removeLegendTooltip();}
prepareOptions(){const{mode}=this.model.metaData;const options={maintainAspectRatio:false,scales:this.getScaleOptions(),plugins:{legend:this.getLegendOptions(),tooltip:this.getTooltipOptions(),},elements:this.getElementOptions(),onResize:()=>{this.resizeChart(options);},animation:this.getAnimationOptions(),};if(mode==="line"){options.interaction={mode:"index",intersect:false,};}
if(mode==="pie"){options.radius="90%";}
return options;}
resizeChart(context){const{mode}=this.model.metaData;if(mode==="pie"){if(this.env.isSmall){context.plugins.legend.position="bottom";context.plugins.legend.align="center";}else{context.plugins.legend.position="right";context.plugins.legend.align="start";}}}
removeLegendTooltip(){if(this.legendTooltip){this.legendTooltip.remove();this.legendTooltip=null;}}
removeTooltips(){if(this.tooltip){this.tooltip.remove();this.tooltip=null;}
this.removeLegendTooltip();}
renderChart(){if(this.chart){this.chart.destroy();}
if(this.canvasRef.el){const config=this.getChartConfig();this.chart=new Chart(this.canvasRef.el,config);}}
openView(domain,views,context,newWindow){this.actionService.doAction({context,domain,name:this.model.metaData.title,res_model:this.model.metaData.resModel,target:"current",type:"ir.actions.act_window",views,},{newWindow,viewType:"list",});}
onGraphClickedFinal(domain,isMiddleClick=false){const{context}=this.model.metaData;Object.keys(context).forEach((x)=>{if(x==="group_by"||x.startsWith("search_default_")){delete context[x];}});const views={};for(const[viewId,viewType]of this.env.config.views||[]){views[viewType]=viewId;}
function getView(viewType){return[views[viewType]||false,viewType];}
const actionViews=[getView("list"),getView("form")];this.openView(domain,actionViews,context,isMiddleClick);}
onMeasureSelected({measure}){this.model.updateMetaData({measure});}
onModeSelected(mode){if(this.model.metaData.mode!=mode){this.model.updateMetaData({mode});}}
toggleOrder(order){const{order:currentOrder}=this.model.metaData;const nextOrder=currentOrder===order?null:order;this.model.updateMetaData({order:nextOrder});}
toggleStacked(){const{stacked}=this.model.metaData;this.model.updateMetaData({stacked:!stacked});}
toggleCumulated(){const{cumulated}=this.model.metaData;this.model.updateMetaData({cumulated:!cumulated});}}
return __exports;});;

/* /web/static/src/views/graph/graph_search_model.js */
odoo.define('@web/views/graph/graph_search_model',['@web/search/search_model'],function(require){'use strict';let __exports={};const{SearchModel}=require("@web/search/search_model");const GraphSearchModel=__exports.GraphSearchModel=class GraphSearchModel extends SearchModel{_getIrFilterDescription(){this.preparingIrFilterDescription=true;const result=super._getIrFilterDescription(...arguments);this.preparingIrFilterDescription=false;return result;}
_getSearchItemGroupBys(activeItem){const{searchItemId}=activeItem;const{context,type}=this.searchItems[searchItemId];if(!this.preparingIrFilterDescription&&type==="favorite"&&context.graph_groupbys){return context.graph_groupbys;}
return super._getSearchItemGroupBys(...arguments);}}
return __exports;});;

/* /web/static/src/views/graph/graph_view.js */
odoo.define('@web/views/graph/graph_view',['@web/core/l10n/translation','@web/core/registry','@web/views/graph/graph_arch_parser','@web/views/graph/graph_model','@web/views/graph/graph_controller','@web/views/graph/graph_renderer','@web/views/graph/graph_search_model'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{GraphArchParser}=require("@web/views/graph/graph_arch_parser");const{GraphModel}=require("@web/views/graph/graph_model");const{GraphController}=require("@web/views/graph/graph_controller");const{GraphRenderer}=require("@web/views/graph/graph_renderer");const{GraphSearchModel}=require("@web/views/graph/graph_search_model");const viewRegistry=registry.category("views");const graphView=__exports.graphView={type:"graph",Controller:GraphController,Renderer:GraphRenderer,Model:GraphModel,ArchParser:GraphArchParser,SearchModel:GraphSearchModel,searchMenuTypes:["filter","groupBy","favorite"],buttonTemplate:"web.GraphView.Buttons",props:(genericProps,view)=>{let modelParams;if(genericProps.state){modelParams=genericProps.state.metaData;}else{const{arch,fields,resModel}=genericProps;const parser=new view.ArchParser();const archInfo=parser.parse(arch,fields);modelParams={disableLinking:Boolean(archInfo.disableLinking),fieldAttrs:archInfo.fieldAttrs,fields:fields,groupBy:archInfo.groupBy,measure:archInfo.measure||"__count",viewMeasures:archInfo.measures,mode:archInfo.mode||"bar",order:archInfo.order||null,resModel:resModel,stacked:"stacked"in archInfo?archInfo.stacked:true,cumulated:archInfo.cumulated||false,cumulatedStart:archInfo.cumulatedStart||false,title:archInfo.title||_t("Untitled"),};}
return{...genericProps,modelParams,Model:view.Model,Renderer:view.Renderer,buttonTemplate:view.buttonTemplate,};},};viewRegistry.add("graph",graphView);return __exports;});;

/* /web/static/src/views/pivot/pivot_arch_parser.js */
odoo.define('@web/views/pivot/pivot_arch_parser',['@web/core/utils/strings','@web/core/utils/xml','@web/core/py_js/py'],function(require){'use strict';let __exports={};const{exprToBoolean}=require("@web/core/utils/strings");const{visitXML}=require("@web/core/utils/xml");const{evaluateExpr}=require("@web/core/py_js/py");const PivotArchParser=__exports.PivotArchParser=class PivotArchParser{parse(arch){const archInfo={activeMeasures:[],colGroupBys:[],defaultOrder:null,fieldAttrs:{},rowGroupBys:[],widgets:{},};visitXML(arch,(node)=>{switch(node.tagName){case"pivot":{if(node.hasAttribute("disable_linking")){archInfo.disableLinking=exprToBoolean(node.getAttribute("disable_linking"));}
if(node.hasAttribute("default_order")){archInfo.defaultOrder=node.getAttribute("default_order");}
if(node.hasAttribute("string")){archInfo.title=node.getAttribute("string");}
if(node.hasAttribute("display_quantity")){archInfo.displayQuantity=exprToBoolean(node.getAttribute("display_quantity"));}
break;}
case"field":{let fieldName=node.getAttribute("name");archInfo.fieldAttrs[fieldName]={};if(node.hasAttribute("string")){archInfo.fieldAttrs[fieldName].string=node.getAttribute("string");}
if(node.getAttribute("invisible")==="True"||node.getAttribute("invisible")==="1"){archInfo.fieldAttrs[fieldName].isInvisible=true;break;}
for(const{name,value}of node.attributes){if(["name","type","operator","interval","string","widget"].includes(name)){continue;}
if(name==="options"){archInfo.fieldAttrs[fieldName].options=evaluateExpr(value);}else{archInfo.fieldAttrs[fieldName][name]=value;}}
if(node.hasAttribute("interval")){fieldName+=":"+node.getAttribute("interval");}
if(node.hasAttribute("widget")){archInfo.widgets[fieldName]=node.getAttribute("widget");}
if(node.getAttribute("type")==="measure"||node.hasAttribute("operator")){archInfo.activeMeasures.push(fieldName);}
if(node.getAttribute("type")==="col"){archInfo.colGroupBys.push(fieldName);}
if(node.getAttribute("type")==="row"){archInfo.rowGroupBys.push(fieldName);}
break;}}});return archInfo;}}
return __exports;});;

/* /web/static/src/views/pivot/pivot_controller.js */
odoo.define('@web/views/pivot/pivot_controller',['@web/search/layout','@web/model/model','@web/views/standard_view_props','@web/search/action_hook','@web/search/search_bar/search_bar','@web/search/search_bar/search_bar_toggler','@web/search/cog_menu/cog_menu','@web/views/widgets/widget','@web/views/action_helper','@odoo/owl'],function(require){'use strict';let __exports={};const{Layout}=require("@web/search/layout");const{useModelWithSampleData}=require("@web/model/model");const{standardViewProps}=require("@web/views/standard_view_props");const{useSetupAction}=require("@web/search/action_hook");const{SearchBar}=require("@web/search/search_bar/search_bar");const{useSearchBarToggler}=require("@web/search/search_bar/search_bar_toggler");const{CogMenu}=require("@web/search/cog_menu/cog_menu");const{Widget}=require("@web/views/widgets/widget");const{ActionHelper}=require("@web/views/action_helper");const{Component,useEffect,useRef}=require("@odoo/owl");const PivotController=__exports.PivotController=class PivotController extends Component{static template="web.PivotView";static components={Layout,SearchBar,CogMenu,Widget,ActionHelper};static props={...standardViewProps,Model:Function,modelParams:Object,Renderer:Function,buttonTemplate:String,};setup(){this.model=useModelWithSampleData(this.props.Model,this.props.modelParams,this.modelOptions);const{setScrollFromState}=useSetupAction({rootRef:useRef("root"),getLocalState:()=>{const{data,metaData}=this.model;return{data,metaData};},getContext:()=>this.getContext(),});useEffect((isReady)=>{if(isReady){setScrollFromState();}},()=>[this.model.isReady]);this.searchBarToggler=useSearchBarToggler();}
get displayNoContent(){if(this.props.info.noContentHelp===false){return false;}
const{metaData,useSampleModel}=this.model;return useSampleModel||!this.model.hasData()||!metaData.activeMeasures.length;}
get modelOptions(){return{lazy:!this.env.config.isReloadingController&&!this.env.inDialog&&!!this.props.display.controlPanel,};}
getContext(){return{pivot_measures:this.model.metaData.activeMeasures,pivot_column_groupby:this.model.metaData.fullColGroupBys,pivot_row_groupby:this.model.metaData.fullRowGroupBys,};}}
return __exports;});;

/* /web/static/src/views/pivot/pivot_model.js */
odoo.define('@web/views/pivot/pivot_model',['@web/core/l10n/translation','@web/core/domain','@web/core/utils/arrays','@web/core/utils/concurrency','@web/search/utils/dates','@web/model/model','@web/views/utils'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{Domain}=require("@web/core/domain");const{cartesian,sections,sortBy,symmetricalDifference}=require("@web/core/utils/arrays");const{KeepLast,Race}=require("@web/core/utils/concurrency");const{DEFAULT_INTERVAL}=require("@web/search/utils/dates");const{addPropertyFieldDefs,Model}=require("@web/model/model");const{computeReportMeasures,processMeasure}=require("@web/views/utils");const PivotModel=__exports.PivotModel=class PivotModel extends Model{setup(params){this.keepLast=new KeepLast();this.race=new Race();const _loadData=this._loadData.bind(this);this._loadData=(...args)=>this.race.add(_loadData(...args));let sortedColumn=params.metaData.sortedColumn||null;if(!sortedColumn&&params.metaData.defaultOrder){const defaultOrder=params.metaData.defaultOrder.split(" ");sortedColumn={groupId:[[],[]],measure:defaultOrder[0],order:defaultOrder[1]?defaultOrder[1]:"asc",};}
this.searchParams={context:{},domain:[],groupBy:[],};this.data=params.data||{colGroupTree:null,rowGroupTree:null,groupDomains:{},measurements:{},currencyIds:{},counts:{},numbering:{},};const metaData=Object.assign({},params.metaData,{customGroupBys:params.metaData.customGroupBys||new Map(),expandedRowGroupBys:params.metaData.expandedRowGroupBys||[],expandedColGroupBys:params.metaData.expandedColGroupBys||[],sortedColumn,});this.metaData=this._buildMetaData(metaData);this.reload=false;this.nextActiveMeasures=null;}
async addGroupBy(params){if(this.race.getCurrentProm()){return;}
const{groupId,fieldName,type,custom}=params;let{interval}=params;const metaData=this._buildMetaData();if(custom&&!metaData.customGroupBys.has(fieldName)){const field=metaData.fields[fieldName];if(!interval&&["date","datetime"].includes(field.type)){interval=DEFAULT_INTERVAL;}
metaData.customGroupBys.set(fieldName,{...field,id:fieldName,});}
let groupBy=fieldName;if(interval){groupBy=`${groupBy}:${interval}`;}
if(type==="row"){metaData.expandedRowGroupBys.push(groupBy);}else{metaData.expandedColGroupBys.push(groupBy);}
const config={metaData,data:this.data};await this._expandGroup(groupId,type,config);this.metaData=metaData;this.notify();}
closeGroup(groupId,type){if(this.race.getCurrentProm()){return;}
let groupBys;let expandedGroupBys;let keyPart;let group;let tree;if(type==="row"){groupBys=this.metaData.rowGroupBys;expandedGroupBys=this.metaData.expandedRowGroupBys;tree=this.data.rowGroupTree;group=this._findGroup(this.data.rowGroupTree,groupId[0]);keyPart=0;}else{groupBys=this.metaData.colGroupBys;expandedGroupBys=this.metaData.expandedColGroupBys;tree=this.data.colGroupTree;group=this._findGroup(this.data.colGroupTree,groupId[1]);keyPart=1;}
const groupIdPart=groupId[keyPart];const range=groupIdPart.map((_,index)=>index);function keep(key){const idPart=JSON.parse(key)[keyPart];return(range.some((index)=>groupIdPart[index]!==idPart[index])||idPart.length===groupIdPart.length);}
function omitKeys(object){const newObject={};for(const key in object){if(keep(key)){newObject[key]=object[key];}}
return newObject;}
this.data.measurements=omitKeys(this.data.measurements);this.data.currencyIds=omitKeys(this.data.currencyIds);this.data.counts=omitKeys(this.data.counts);this.data.groupDomains=omitKeys(this.data.groupDomains);group.directSubTrees.clear();delete group.sortedKeys;var newGroupBysLength=this._getTreeHeight(tree)-1;if(newGroupBysLength<=groupBys.length){expandedGroupBys.splice(0);groupBys.splice(newGroupBysLength);}else{expandedGroupBys.splice(newGroupBysLength-groupBys.length);}
this.notify();}
async expandAll(){const config={metaData:this.metaData,data:this.data};await this._loadData(config,false);this.notify();}
async expandGroup(groupId,type){if(this.race.getCurrentProm()){return;}
const config={metaData:this.metaData,data:this.data};await this._expandGroup(groupId,type,config);this.notify();}
exportData(){const measureCount=this.metaData.activeMeasures.length;const table=this.getTable();const headers=table.headers;let colGroupHeaderRows;let measureRow=[];function processHeader(header){const inTotalColumn=header.groupId[1].length===0;return{title:header.title,width:header.width,height:header.height,is_bold:!!header.measure&&inTotalColumn,};}
colGroupHeaderRows=headers.slice(0,headers.length-1);measureRow=headers[headers.length-1].map(processHeader);colGroupHeaderRows[0].splice(0,1);colGroupHeaderRows=colGroupHeaderRows.map((headerRow)=>headerRow.map(processHeader));const tableRows=table.rows.map((row)=>({title:row.title,indent:row.indent,values:row.subGroupMeasurements.map((measurement)=>{let value=measurement.value;if(value===undefined){value="";}
return{is_bold:measurement.isBold,value:value,};}),}));return{model:this.metaData.resModel,title:this.metaData.title,col_group_headers:colGroupHeaderRows,measure_headers:measureRow,rows:tableRows,measure_count:measureCount,};}
async flip(){await this.race.getCurrentProm();let temp=this.data.rowGroupTree;this.data.rowGroupTree=this.data.colGroupTree;this.data.colGroupTree=temp;temp=this.metaData.rowGroupBys;this.metaData.rowGroupBys=this.metaData.colGroupBys;this.metaData.colGroupBys=temp;temp=this.metaData.expandedColGroupBys;this.metaData.expandedColGroupBys=this.metaData.expandedRowGroupBys;this.metaData.expandedRowGroupBys=temp;function twistKey(key){return JSON.stringify(JSON.parse(key).reverse());}
function twist(object){const newObject={};Object.keys(object).forEach((key)=>{const value=object[key];newObject[twistKey(key)]=value;});return newObject;}
this.data.measurements=twist(this.data.measurements);this.data.currencyIds=twist(this.data.currencyIds);this.data.counts=twist(this.data.counts);this.data.groupDomains=twist(this.data.groupDomains);this.notify();}
getGroupDomain(group){const config={metaData:this.metaData,data:this.data};return this._getGroupDomain(group,config);}
getTable(){const headers=this._getTableHeaders();return{headers:headers,rows:this._getTableRows(this.data.rowGroupTree,headers[headers.length-1]),};}
getTableWidth(){var leafCounts=this._getLeafCounts(this.data.colGroupTree);return leafCounts[JSON.stringify(this.data.colGroupTree.root.values)]+2;}
hasData(){return this._hasData(this.data);}
async load(searchParams){this.searchParams=searchParams;const processedMeasures=processMeasure(searchParams.context.pivot_measures);const activeMeasures=processedMeasures||this.metaData.activeMeasures;const metaData=this._buildMetaData({activeMeasures});if(!this.reload){metaData.rowGroupBys=searchParams.context.pivot_row_groupby||(searchParams.groupBy.length?searchParams.groupBy:metaData.rowGroupBys);this.reload=true;}else{metaData.rowGroupBys=searchParams.groupBy.length?searchParams.groupBy:searchParams.context.pivot_row_groupby||metaData.rowGroupBys;}
metaData.colGroupBys=searchParams.context.pivot_column_groupby||this.metaData.colGroupBys;if(JSON.stringify(metaData.rowGroupBys)!==JSON.stringify(this.metaData.rowGroupBys)){metaData.expandedRowGroupBys=[];}
if(JSON.stringify(metaData.colGroupBys)!==JSON.stringify(this.metaData.colGroupBys)){metaData.expandedColGroupBys=[];}
const allActivesMeasures=new Set(this.metaData.activeMeasures);if(processedMeasures){processedMeasures.forEach((e)=>allActivesMeasures.add(e));}
metaData.measures=computeReportMeasures(metaData.fields,metaData.fieldAttrs,[...allActivesMeasures,]);const config={metaData,data:this.data};await addPropertyFieldDefs(this.orm,metaData.resModel,searchParams.context,metaData.fields,new Set([...metaData.rowGroupBys,...metaData.colGroupBys]));return this._loadData(config);}
sortRows(sortedColumn){if(this.race.getCurrentProm()){return;}
const config={metaData:this.metaData,data:this.data};this._sortRows(sortedColumn,config);this.notify();}
async toggleMeasure(fieldName){const metaData=this._buildMetaData();this.nextActiveMeasures=this.nextActiveMeasures||metaData.activeMeasures;metaData.activeMeasures=this.nextActiveMeasures;const index=metaData.activeMeasures.indexOf(fieldName);if(index!==-1){metaData.activeMeasures.splice(index,1);await Promise.resolve(this.race.getCurrentProm());this.metaData=metaData;}else{metaData.activeMeasures.push(fieldName);const config={metaData,data:this.data};await this._loadData(config);this.useSampleModel=false;}
this.nextActiveMeasures=null;this.notify();}
_addGroup(groupTree,labels,values){let tree=groupTree;values.slice(0,values.length-1).forEach(function(value){tree=tree.directSubTrees.get(value);});const value=values[values.length-1];if(tree.directSubTrees.has(value)){return;}
tree.directSubTrees.set(value,{root:{labels:labels,values:values,},directSubTrees:new Map(),});}
_buildMetaData(params){const metaData=Object.assign({},this.metaData,params);metaData.activeMeasures=[...metaData.activeMeasures];metaData.colGroupBys=[...metaData.colGroupBys];metaData.rowGroupBys=[...metaData.rowGroupBys];metaData.expandedColGroupBys=[...metaData.expandedColGroupBys];metaData.expandedRowGroupBys=[...metaData.expandedRowGroupBys];metaData.customGroupBys=new Map([...metaData.customGroupBys]);metaData.sortedColumn=metaData.sortedColumn?{...metaData.sortedColumn}:null;metaData.domain=this.searchParams.domain;Object.defineProperty(metaData,"fullColGroupBys",{get(){return metaData.colGroupBys.concat(metaData.expandedColGroupBys);},});Object.defineProperty(metaData,"fullRowGroupBys",{get(){return metaData.rowGroupBys.concat(metaData.expandedRowGroupBys);},});return metaData;}
async _expandGroup(groupId,type,config){const{metaData}=config;const group={rowValues:groupId[0],colValues:groupId[1],type:type,};const groupValues=type==="row"?groupId[0]:groupId[1];const groupBys=type==="row"?metaData.fullRowGroupBys:metaData.fullColGroupBys;if(groupValues.length>=groupBys.length){throw new Error("Cannot expand group");}
const groupBy=groupBys[groupValues.length];let leftDivisors;let rightDivisors;if(group.type==="row"){leftDivisors=[[groupBy]];rightDivisors=sections(metaData.fullColGroupBys);}else{leftDivisors=sections(metaData.fullRowGroupBys);rightDivisors=[[groupBy]];}
const divisors=cartesian(leftDivisors,rightDivisors);delete group.type;await this._subdivideGroup(group,divisors,config);}
_findGroup(groupTree,values){let tree=groupTree;values.slice(0,values.length).forEach((value)=>{tree=tree.directSubTrees.get(value);});return tree;}
_getCellValue(groupId,measure,config){var key=JSON.stringify(groupId);if(!config.data.measurements[key]){return;}
return config.data.measurements[key][measure];}
_getCellCurrency(groupId,measure,config){var key=JSON.stringify(groupId);if(!config.data.currencyIds[key]){return;}
return config.data.currencyIds[key][measure];}
_getGroupBySpecs(rowGroupBy,colGroupBy){const set=rowGroupBy.concat(colGroupBy).reduce((acc,gb)=>{acc.add(this._normalize(gb));return acc;},new Set());return[...set];}
_getGroupDomain(group,config){const{data}=config;var key=JSON.stringify([group.rowValues,group.colValues]);return data.groupDomains[key];}
_getGroupLabels(group,groupBys,config){return groupBys.map((gb)=>{const groupBy=this._normalize(gb);return this._sanitizeLabel(group[groupBy],groupBy,config);});}
async _getGroupsSubdivision(params,groupInfo){const{resModel,groupDomain,groupingSets,measureSpecs,kwargs}=params;const result=await this.orm.formattedReadGroupingSets(resModel,groupDomain,groupingSets,measureSpecs,kwargs);return groupInfo.map((info)=>({...info,subGroups:result[info.subGroupIndex]}));}
_getGroupValues(group,groupBys){return groupBys.map((gb)=>{const groupBy=this._normalize(gb);return this._sanitizeValue(group[groupBy]);});}
_getLeafCounts(tree){const leafCounts={};let leafCount;if(!tree.directSubTrees.size){leafCount=1;}else{leafCount=[...tree.directSubTrees.values()].reduce((acc,subTree)=>{const subLeafCounts=this._getLeafCounts(subTree);Object.assign(leafCounts,subLeafCounts);return acc+leafCounts[JSON.stringify(subTree.root.values)];},0);}
leafCounts[JSON.stringify(tree.root.values)]=leafCount;return leafCounts;}
_getMeasurements(group,config){const{metaData}=config;return this._getMeasureSpecs(config).reduce((measurements,measureName)=>{var measurement=group[measureName];const[fieldName,aggregator]=measureName.split(":");if(aggregator==="array_agg_distinct"){return measurements;}
if(aggregator==="sum_currency"){const currencies=group[metaData.fields[fieldName].currency_field+":array_agg_distinct"];if(currencies.length===1){return measurements;}}
if(metaData.measures[fieldName].type==="boolean"&&measurement instanceof Boolean){measurement=measurement?1:0;}
measurements[fieldName]=measurement;return measurements;},{});}
_getCurrencyIds(group,config){const{metaData}=config;return this._getMeasureSpecs(config).reduce((currencyIds,measureName)=>{const[fieldName,aggregator]=measureName.split(":");if(aggregator==="array_agg_distinct"){return currencyIds;}
const measureField=metaData.measures[fieldName];if(measureField.type==="monetary"&&measureField.currency_field){currencyIds[fieldName]=group[measureField.currency_field+":array_agg_distinct"];}
return currencyIds;},{});}
_getMeasuresRow(columns){const sortedColumn=this.metaData.sortedColumn||{};const measureRow=[];columns.forEach((column)=>{this.metaData.activeMeasures.forEach((measureName)=>{const measureCell={groupId:column.groupId,height:1,measure:measureName,title:this.metaData.measures[measureName].string,width:1,};if(sortedColumn.measure===measureName&&JSON.stringify(sortedColumn.groupId)===JSON.stringify(column.groupId)){measureCell.order=sortedColumn.order;}
measureRow.push(measureCell);});});return measureRow;}
_getMeasureSpecs(config){const{metaData}=config;return metaData.activeMeasures.reduce((acc,measure)=>{if(measure==="__count"){acc.push(measure);return acc;}
const field=this.metaData.fields[measure];if(field.type==="many2one"){field.aggregator="count_distinct";}
if(field.aggregator===undefined){throw new Error("No aggregate function has been provided for the measure '"+measure+"'");}
acc.push(measure+":"+field.aggregator);if(field.currency_field){acc.push(field.currency_field+":array_agg_distinct");acc.push(field.name+":sum_currency");}
return acc;},[]);}
_getNumberedLabel(label,fieldName,config){const{data}=config;const id=label[0];const name=label[1];data.numbering[fieldName]=data.numbering[fieldName]||{};data.numbering[fieldName][name]=data.numbering[fieldName][name]||{};const numbers=data.numbering[fieldName][name];numbers[id]=numbers[id]||Object.keys(numbers).length+1;return name+(numbers[id]>1?"  ("+numbers[id]+")":"");}
_getTableHeaders(){const colGroupBys=this.metaData.fullColGroupBys;const height=colGroupBys.length+1;const measureCount=this.metaData.activeMeasures.length;const leafCounts=this._getLeafCounts(this.data.colGroupTree);let headers=[];const measureColumns=[];const colGroupRows=new Array(height).fill(0).map(()=>[]);colGroupRows[0].push({height:height+1,title:"",width:1,});function generateTreeHeaders(tree,fields){const group=tree.root;const rowIndex=group.values.length;const row=colGroupRows[rowIndex];const groupId=[[],group.values];const isLeaf=!tree.directSubTrees.size;const leafCount=leafCounts[JSON.stringify(tree.root.values)];const cell={groupId:groupId,height:isLeaf?colGroupBys.length+1-rowIndex:1,isLeaf:isLeaf,isFolded:isLeaf&&colGroupBys.length>group.values.length,label:rowIndex===0?undefined:fields[colGroupBys[rowIndex-1].split(":")[0]].string,title:group.labels.length?group.labels[group.labels.length-1]:_t("Total"),width:leafCount*measureCount,};row.push(cell);if(isLeaf){measureColumns.push(cell);}
[...tree.directSubTrees.values()].forEach((subTree)=>{generateTreeHeaders(subTree,fields);});}
generateTreeHeaders(this.data.colGroupTree,this.metaData.fields);if(leafCounts[JSON.stringify(this.data.colGroupTree.root.values)]>1){var groupId=[[],[]];var totalTopRightCell={groupId:groupId,height:height,title:"",width:measureCount,};colGroupRows[0].push(totalTopRightCell);measureColumns.push(totalTopRightCell);}
headers=headers.concat(colGroupRows);var measuresRow=this._getMeasuresRow(measureColumns);headers.push(measuresRow);return headers;}
_getTableRows(tree,columns){let rows=[];const group=tree.root;const rowGroupId=[group.values,[]];const title=group.labels.length?group.labels[group.labels.length-1]:_t("Total");const indent=group.labels.length;const isLeaf=!tree.directSubTrees.size;const rowGroupBys=this.metaData.fullRowGroupBys;const subGroupMeasurements=columns.map((column)=>{const colGroupId=column.groupId;const groupIntersectionId=[rowGroupId[0],colGroupId[1]];const measure=column.measure;const value=this._getCellValue(groupIntersectionId,measure,{data:this.data,});const currencyIds=this._getCellCurrency(groupIntersectionId,measure,{data:this.data,});const measurement={groupId:groupIntersectionId,measure:measure,value:value,currencyIds,isBold:!groupIntersectionId[0].length||!groupIntersectionId[1].length,};return measurement;});rows.push({title:title,label:indent===0?undefined:this.metaData.fields[rowGroupBys[indent-1].split(":")[0]].string,groupId:rowGroupId,indent:indent,isLeaf:isLeaf,isFolded:isLeaf&&rowGroupBys.length>group.values.length,subGroupMeasurements:subGroupMeasurements,});const subTreeKeys=tree.sortedKeys||[...tree.directSubTrees.keys()];subTreeKeys.forEach((subTreeKey)=>{const subTree=tree.directSubTrees.get(subTreeKey);rows=rows.concat(this._getTableRows(subTree,columns));});return rows;}
_getTreeHeight(tree){const subTreeHeights=[...tree.directSubTrees.values()].map(this._getTreeHeight.bind(this));return Math.max(0,Math.max.apply(null,subTreeHeights))+1;}
_hasData(data){const key=JSON.stringify([[],[]]);return data.counts[key]>0;}
async _loadData(config,prune=true){config.data={};const{data,metaData}=config;data.rowGroupTree={root:{labels:[],values:[]},directSubTrees:new Map()};data.colGroupTree={root:{labels:[],values:[]},directSubTrees:new Map()};data.measurements={};data.currencyIds={};data.counts={};data.groupDomains={};data.numbering={};const key=JSON.stringify([[],[]]);data.groupDomains[key]=metaData.domain;const group={rowValues:[],colValues:[]};const leftDivisors=sections(metaData.fullRowGroupBys);const rightDivisors=sections(metaData.fullColGroupBys);const divisors=cartesian(leftDivisors,rightDivisors);await this._subdivideGroup(group,divisors,config);if(prune&&this._hasData(data)&&this._hasData(this.data)){if(symmetricalDifference(metaData.rowGroupBys,this.metaData.rowGroupBys).length===0){this._pruneTree(data.rowGroupTree,this.data.rowGroupTree);}
if(symmetricalDifference(metaData.colGroupBys,this.metaData.colGroupBys).length===0){this._pruneTree(data.colGroupTree,this.data.colGroupTree);}}
this.data=config.data;this.metaData=config.metaData;}
_normalize(gb){const[fieldName,interval]=gb.split(":");const field=this.metaData.fields[fieldName];if(["date","datetime"].includes(field.type)){return`${fieldName}:${interval || "month"}`;}else{return fieldName;}}
_prepareData(group,groupSubdivisions,config){const{data,metaData}=config;const groupRowValues=group.rowValues;let groupRowLabels=[];let rowSubTree=data.rowGroupTree;let root;if(groupRowValues.length){rowSubTree=this._findGroup(data.rowGroupTree,groupRowValues);root=rowSubTree.root;groupRowLabels=root.labels;}
const groupColValues=group.colValues;let groupColLabels=[];if(groupColValues.length){root=this._findGroup(data.colGroupTree,groupColValues).root;groupColLabels=root.labels;}
groupSubdivisions.forEach((groupSubdivision)=>{groupSubdivision.subGroups.forEach((subGroup)=>{const rowValues=groupRowValues.concat(this._getGroupValues(subGroup,groupSubdivision.rowGroupBy));const rowLabels=groupRowLabels.concat(this._getGroupLabels(subGroup,groupSubdivision.rowGroupBy,config));const colValues=groupColValues.concat(this._getGroupValues(subGroup,groupSubdivision.colGroupBy));const colLabels=groupColLabels.concat(this._getGroupLabels(subGroup,groupSubdivision.colGroupBy,config));if(!colValues.length&&rowValues.length){this._addGroup(data.rowGroupTree,rowLabels,rowValues);}
if(colValues.length&&!rowValues.length){this._addGroup(data.colGroupTree,colLabels,colValues);}
const key=JSON.stringify([rowValues,colValues]);data.measurements[key]=this._getMeasurements(subGroup,config);data.currencyIds[key]=this._getCurrencyIds(subGroup,config);data.counts[key]=subGroup.__count;if(subGroup.__domain){data.groupDomains[key]=subGroup.__domain;}else{data.groupDomains[key]=Domain.FALSE.toList();}});});if(metaData.sortedColumn){this._sortRows(metaData.sortedColumn,config);}}
_pruneTree(tree,oldTree){if(!oldTree.directSubTrees.size){tree.directSubTrees.clear();delete tree.sortedKeys;return;}
[...tree.directSubTrees.keys()].forEach((subTreeKey)=>{const subTree=tree.directSubTrees.get(subTreeKey);if(!oldTree.directSubTrees.has(subTreeKey)){subTree.directSubTrees.clear();delete subTree.sortedKeys;}else{const oldSubTree=oldTree.directSubTrees.get(subTreeKey);this._pruneTree(subTree,oldSubTree);}});}
_sanitizeLabel(value,groupBy,config){const{metaData}=config;const fieldName=groupBy.split(":")[0];if(fieldName&&metaData.fields[fieldName]){const field=metaData.fields[fieldName];if(field.type==="boolean"){return value===undefined?_t("None"):value?_t("Yes"):_t("No");}else if(field.type==="integer"){if(fieldName==="id"&&Array.isArray(value)){return value[1];}
return value||"0";}}
if(value===false){return metaData.fields[fieldName].falsy_value_label||_t("None");}
if(value instanceof Array){return this._getNumberedLabel(value,fieldName,config);}
if(fieldName&&metaData.fields[fieldName]&&metaData.fields[fieldName].type==="selection"){const selected=metaData.fields[fieldName].selection.find((o)=>o[0]===value);return selected?selected[1]:value;}
return value;}
_sanitizeValue(value){if(value instanceof Array){return value[0];}
return value;}
async _subdivideGroup(group,divisors,config){const{data}=config;const key=JSON.stringify([group.rowValues,group.colValues]);if(!data.counts[key]||data.counts[key]>0){const subGroup={rowValues:group.rowValues,colValues:group.colValues,};const groupDomain=this._getGroupDomain(subGroup,config);const measureSpecs=this._getMeasureSpecs(config);if(!measureSpecs.includes("__count")){measureSpecs.push("__count");}
const resModel=config.metaData.resModel;const kwargs={context:this.searchParams.context};const groupingSets=[];const groupInfo=[];divisors.forEach((divisor)=>{const groupBy=this._getGroupBySpecs(divisor[0],divisor[1]);const key=JSON.stringify(groupBy.toSorted());let index=groupingSets.findIndex((value)=>JSON.stringify(value.toSorted())===key);if(index===-1){index=groupingSets.length;groupingSets.push(groupBy);}
groupInfo.push({group:subGroup,rowGroupBy:divisor[0],colGroupBy:divisor[1],subGroupIndex:index,});});const params={resModel,groupDomain,measureSpecs,kwargs,groupingSets,};const groupSubdivisions=await this.keepLast.add(this._getGroupsSubdivision(params,groupInfo));if(groupSubdivisions.length){this._prepareData(group,groupSubdivisions,config);}}}
_sortRows(sortedColumn,config){const metaData=config.metaData||this.metaData;const data=config.data||this.data;const colGroupValues=sortedColumn.groupId[1];metaData.sortedColumn=sortedColumn;const sortFunction=(tree)=>(subTreeKey)=>{const subTree=tree.directSubTrees.get(subTreeKey);const groupIntersectionId=[subTree.root.values,colGroupValues];const value=this._getCellValue(groupIntersectionId,sortedColumn.measure,{data})||0;return sortedColumn.order==="asc"?value:-value;};this._sortTree(sortFunction,data.rowGroupTree);}
_sortTree(sortFunction,tree){tree.sortedKeys=sortBy([...tree.directSubTrees.keys()],sortFunction(tree));[...tree.directSubTrees.values()].forEach((subTree)=>{this._sortTree(sortFunction,subTree);});}}
return __exports;});;

/* /web/static/src/views/pivot/pivot_renderer.js */
odoo.define('@web/views/pivot/pivot_renderer',['@odoo/owl','@web/core/checkbox/checkbox','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_hooks','@web/core/dropdown/dropdown_item','@web/core/l10n/localization','@web/core/l10n/translation','@web/core/network/download','@web/core/popover/popover_hook','@web/core/registry','@web/core/user','@web/core/utils/arrays','@web/core/utils/hooks','@web/search/custom_group_by_item/custom_group_by_item','@web/search/properties_group_by_item/properties_group_by_item','@web/search/utils/dates','@web/search/utils/misc','@web/views/view_components/multi_currency_popover','@web/views/view_components/report_view_measures'],function(require){'use strict';let __exports={};const{Component,onWillUpdateProps,useRef}=require("@odoo/owl");const{CheckBox}=require("@web/core/checkbox/checkbox");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownState}=require("@web/core/dropdown/dropdown_hooks");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{localization}=require("@web/core/l10n/localization");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{download}=require("@web/core/network/download");const{usePopover}=require("@web/core/popover/popover_hook");const{registry}=require("@web/core/registry");const{user}=require("@web/core/user");const{sortBy}=require("@web/core/utils/arrays");const{useService}=require("@web/core/utils/hooks");const{CustomGroupByItem}=require("@web/search/custom_group_by_item/custom_group_by_item");const{PropertiesGroupByItem}=require("@web/search/properties_group_by_item/properties_group_by_item");const{getIntervalOptions}=require("@web/search/utils/dates");const{GROUPABLE_TYPES}=require("@web/search/utils/misc");const{MultiCurrencyPopover}=require("@web/views/view_components/multi_currency_popover");const{ReportViewMeasures}=require("@web/views/view_components/report_view_measures");const formatters=registry.category("formatters");class PivotDropdown extends Dropdown{get position(){return this.props.state.position||"bottom-start";}
get target(){return this.props.state.target;}}
const PivotRenderer=__exports.PivotRenderer=class PivotRenderer extends Component{static template="web.PivotRenderer";static components={CheckBox,CustomGroupByItem,Dropdown,DropdownItem,PivotDropdown,PropertiesGroupByItem,ReportViewMeasures,};static props=["model","buttonTemplate"];setup(){this.actionService=useService("action");this.model=this.props.model;this.table=this.model.getTable();this.l10n=localization;this.tableRef=useRef("table");this.dropdown={state:new DropdownState({onClose:()=>{delete this.dropdown.cellInfo;delete this.dropdown.state.target;delete this.dropdown.state.position;},}),};this.multiCurrencyPopover=usePopover(MultiCurrencyPopover,{position:"right",});const fields=[];for(const[fieldName,field]of Object.entries(this.env.searchModel.searchViewFields)){if(this.validateField(fieldName,field)){fields.push(Object.assign({name:fieldName},field));}}
this.fields=sortBy(fields,"string");onWillUpdateProps(this.onWillUpdateProps);}
onWillUpdateProps(){this.table=this.model.getTable();}
getFormattedValue(cell){const field=this.model.metaData.measures[cell.measure];const fieldAttrs=this.model.metaData.fieldAttrs[cell.measure]??{};const fieldInfo={options:fieldAttrs.options??{},attrs:fieldAttrs,};let formatType=this.model.metaData.widgets[cell.measure];if(!formatType){const fieldType=field.type;formatType=["many2one","reference"].includes(fieldType)?"integer":fieldType;}
const formatter=formatters.get(formatType);const formatOptions={field};if(formatter.extractOptions){Object.assign(formatOptions,formatter.extractOptions(fieldInfo));}
if(formatType==="monetary"){if(cell.currencyIds.length>1){formatOptions.currencyId=user.activeCompany.currency_id;return{rawValue:cell.value,value:formatter(cell.value,formatOptions),currencies:cell.currencyIds,};}
formatOptions.currencyId=cell.currencyIds[0];}
return{value:formatter(cell.value,formatOptions)};}
get groupByItems(){let items=this.env.searchModel.getSearchItems((searchItem)=>["groupBy","dateGroupBy"].includes(searchItem.type)&&!searchItem.custom);if(items.length===0){items=this.fields;}
let groupNumber=1+Math.max(0,...items.map(({groupNumber:n})=>n||0));for(const[fieldName,customGroupBy]of this.model.metaData.customGroupBys.entries()){items.push({...customGroupBy,name:fieldName,groupNumber:groupNumber++});}
return items.map((item)=>({...item,id:item.id||item.name,fieldName:item.fieldName||item.name,description:item.description||item.string,options:item.options||(["date","datetime"].includes(item.type)?getIntervalOptions():undefined),}));}
get hideCustomGroupBy(){return this.env.searchModel.hideCustomGroupBy||false;}
validateField(fieldName,field){const{groupable,type}=field;return groupable&&fieldName!=="id"&&GROUPABLE_TYPES.includes(type);}
onAddCustomGroupBy(fieldName){this.model.addGroupBy({...this.dropdown.cellInfo,fieldName,custom:true});this.dropdown.state.close();}
onGroupBySelected({itemId,optionId}){const{fieldName}=this.groupByItems.find(({id})=>id===itemId);this.model.addGroupBy({...this.dropdown.cellInfo,fieldName,interval:optionId});}
onHeaderClick(ev,cell,isXAxis){const type=isXAxis?"col":"row";if(cell.isLeaf&&!cell.isFolded){if(this.dropdown.state.isOpen){this.dropdown.state.close();}else{this.dropdown.cellInfo={type,groupId:cell.groupId};Object.assign(this.dropdown.state,{target:ev.target.closest(".o_pivot_header_cell_closed"),position:isXAxis?"bottom-start":"bottom-end",isOpen:true,});}}else if(cell.isLeaf&&cell.isFolded){this.model.expandGroup(cell.groupId,type);}else if(!cell.isLeaf){this.model.closeGroup(cell.groupId,type);}}
onMeasureClick(cell){this.model.sortRows({groupId:cell.groupId,measure:cell.measure,order:(cell.order||"desc")==="asc"?"desc":"asc",});}
onMouseEnter(ev){var index=[...ev.currentTarget.parentNode.children].indexOf(ev.currentTarget);if(ev.currentTarget.tagName==="TH"){index+=1;}
this.tableRef.el.querySelectorAll("td:nth-child("+(index+1)+")").forEach((elt)=>elt.classList.add("o_cell_hover"));}
onMouseLeave(){this.tableRef.el.querySelectorAll(".o_cell_hover").forEach((elt)=>elt.classList.remove("o_cell_hover"));}
onDownloadButtonClicked(){if(this.model.getTableWidth()>16384){throw new Error(_t("For Excel compatibility, data cannot be exported if there are more than 16384 columns.\n\nTip: try to flip axis, filter further or reduce the number of measures."));}
const table=this.model.exportData();download({url:"/web/pivot/export_xlsx",data:{data:new Blob([JSON.stringify(table)],{type:"application/json"})},});}
onExpandButtonClicked(){this.model.expandAll();}
onFlipButtonClicked(){this.model.flip();}
onMeasureSelected({measure}){this.model.toggleMeasure(measure);}
openMultiCurrencyPopover(ev,value,currencyIds){if(!this.multiCurrencyPopover.isOpen){this.multiCurrencyPopover.open(ev.target,{currencyIds,target:ev.target,value,});}}
openView(domain,views,context,newWindow){this.actionService.doAction({type:"ir.actions.act_window",name:this.model.metaData.title,res_model:this.model.metaData.resModel,views:views,view_mode:"list",target:"current",context,domain,},{newWindow,});}
onOpenView(cell,newWindow){if(cell.value===undefined||this.model.metaData.disableLinking){return;}
const context=Object.assign({},this.model.searchParams.context);Object.keys(context).forEach((x)=>{if(x==="group_by"||x.startsWith("search_default_")){delete context[x];}});const{views=[]}=this.env.config;this.views=["list","form"].map((viewType)=>{const view=views.find((view)=>view[1]===viewType);return[view?view[0]:false,viewType];});const group={rowValues:cell.groupId[0],colValues:cell.groupId[1]};this.openView(this.model.getGroupDomain(group),this.views,context,newWindow);}}
return __exports;});;

/* /web/static/src/views/pivot/pivot_search_model.js */
odoo.define('@web/views/pivot/pivot_search_model',['@web/search/search_model'],function(require){'use strict';let __exports={};const{SearchModel}=require("@web/search/search_model");const PivotSearchModel=__exports.PivotSearchModel=class PivotSearchModel extends SearchModel{_getIrFilterDescription(){this.preparingIrFilterDescription=true;const result=super._getIrFilterDescription(...arguments);this.preparingIrFilterDescription=false;return result;}
_getSearchItemGroupBys(activeItem){const{searchItemId}=activeItem;const{context,type}=this.searchItems[searchItemId];if(!this.preparingIrFilterDescription&&type==="favorite"&&context.pivot_row_groupby){return context.pivot_row_groupby;}
return super._getSearchItemGroupBys(...arguments);}}
return __exports;});;

/* /web/static/src/views/pivot/pivot_view.js */
odoo.define('@web/views/pivot/pivot_view',['@web/core/l10n/translation','@web/core/registry','@web/views/pivot/pivot_arch_parser','@web/views/pivot/pivot_controller','@web/views/pivot/pivot_model','@web/views/pivot/pivot_renderer','@web/views/pivot/pivot_search_model'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{PivotArchParser}=require("@web/views/pivot/pivot_arch_parser");const{PivotController}=require("@web/views/pivot/pivot_controller");const{PivotModel}=require("@web/views/pivot/pivot_model");const{PivotRenderer}=require("@web/views/pivot/pivot_renderer");const{PivotSearchModel}=require("@web/views/pivot/pivot_search_model");const viewRegistry=registry.category("views");const pivotView=__exports.pivotView={type:"pivot",Controller:PivotController,Renderer:PivotRenderer,Model:PivotModel,ArchParser:PivotArchParser,SearchModel:PivotSearchModel,searchMenuTypes:["filter","groupBy","favorite"],buttonTemplate:"web.PivotView.Buttons",props:(genericProps,view)=>{const modelParams={};if(genericProps.state){modelParams.data=genericProps.state.data;modelParams.metaData=genericProps.state.metaData;}else{const{arch,fields,resModel}=genericProps;const archInfo=new view.ArchParser().parse(arch);if(!archInfo.activeMeasures.length||archInfo.displayQuantity){archInfo.activeMeasures.unshift("__count");}
modelParams.metaData={activeMeasures:archInfo.activeMeasures,colGroupBys:archInfo.colGroupBys,defaultOrder:archInfo.defaultOrder,disableLinking:Boolean(archInfo.disableLinking),fields:fields,fieldAttrs:archInfo.fieldAttrs,resModel:resModel,rowGroupBys:archInfo.rowGroupBys,title:archInfo.title||_t("Untitled"),widgets:archInfo.widgets,};}
return{...genericProps,Model:view.Model,modelParams,Renderer:view.Renderer,buttonTemplate:view.buttonTemplate,};},};viewRegistry.add("pivot",pivotView);return __exports;});;

/* /mail/static/src/views/web/activity/activity_arch_parser.js */
odoo.define('@mail/views/web/activity/activity_arch_parser',['@web/core/utils/xml','@web/views/fields/field'],function(require){'use strict';let __exports={};const{visitXML}=require("@web/core/utils/xml");const{Field}=require("@web/views/fields/field");const ActivityArchParser=__exports.ActivityArchParser=class ActivityArchParser{parse(xmlDoc,models,modelName){const jsClass=xmlDoc.getAttribute("js_class");const title=xmlDoc.getAttribute("string");const fieldNodes={};const templateDocs={};const fieldNextIds={};visitXML(xmlDoc,(node)=>{if(node.hasAttribute("t-name")){templateDocs[node.getAttribute("t-name")]=node;return;}
if(node.tagName==="field"){const fieldInfo=Field.parseFieldNode(node,models,modelName,"activity",jsClass);if(!(fieldInfo.name in fieldNextIds)){fieldNextIds[fieldInfo.name]=0;}
const fieldId=`${fieldInfo.name}_${fieldNextIds[fieldInfo.name]++}`;fieldNodes[fieldId]=fieldInfo;node.setAttribute("field_id",fieldId);}
if(node.tagName==="img"){const attSrc=node.getAttribute("t-att-src");if(attSrc&&/\bactivity_image\b/.test(attSrc)&&!Object.values(fieldNodes).some((f)=>f.name==="write_date")){fieldNodes.write_date_0={name:"write_date",type:"datetime"};}}});return{fieldNodes,templateDocs,title,};}}
return __exports;});;

/* /mail/static/src/views/web/activity/activity_cell.js */
odoo.define('@mail/views/web/activity/activity_cell',['@mail/core/web/activity_list_popover','@mail/views/web/fields/avatar/avatar','@odoo/owl','@web/core/popover/popover_hook','@web/core/l10n/dates','@web/core/l10n/translation','@web/core/l10n/utils'],function(require){'use strict';let __exports={};const{ActivityListPopover}=require("@mail/core/web/activity_list_popover");const{Avatar}=require("@mail/views/web/fields/avatar/avatar");const{Component,useRef}=require("@odoo/owl");const{usePopover}=require("@web/core/popover/popover_hook");const{formatDate}=require("@web/core/l10n/dates");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"mail",...args);const{formatList}=require("@web/core/l10n/utils");const ActivityCell=__exports.ActivityCell=class ActivityCell extends Component{static components={Avatar,};static props={activityIds:{type:Array,elements:Number,},attachmentsInfo:{optional:true,type:Object,},activityTypeId:Number,reportingDate:String,countByState:Object,reloadFunc:Function,resId:Number,resModel:String,summaries:Array,userAssignedIds:Array,};static template="mail.ActivityCell";setup(){this.popover=usePopover(ActivityListPopover,{position:"bottom-start"});this.contentRef=useRef("content");}
get reportingDateFormatted(){return formatDate(luxon.DateTime.fromISO(this.props.reportingDate));}
get displayedSummaries(){const summariesWithContent=this.props.summaries.filter((textContent)=>!!textContent);const extras=this.props.summaries.length-summariesWithContent.length
if(summariesWithContent.length>0&&extras>0){summariesWithContent.push(_t("%(extraCount)s more",{extraCount:extras}));}
return formatList(summariesWithContent);}
get ongoingActivityCount(){return((this.props.countByState?.planned??0)+
(this.props.countByState?.today??0)+
(this.props.countByState?.overdue??0));}
get totalActivityCount(){return this.ongoingActivityCount+(this.props.countByState?.done??0);}
onClick(){if(this.popover.isOpen){this.popover.close();}else{this.popover.open(this.contentRef.el,{activityIds:this.props.activityIds,defaultActivityTypeId:this.props.activityTypeId,onActivityChanged:()=>{this.props.reloadFunc();this.popover.close();},resId:this.props.resId,resModel:this.props.resModel,});}}}
return __exports;});;

/* /mail/static/src/views/web/activity/activity_compiler.js */
odoo.define('@mail/views/web/activity/activity_compiler',['@web/core/utils/xml','@web/views/view_compiler','@web/views/utils'],function(require){'use strict';let __exports={};const{createElement,extractAttributes}=require("@web/core/utils/xml");const{toInterpolatedStringExpression,ViewCompiler}=require("@web/views/view_compiler");const{toStringExpression}=require("@web/views/utils");const ActivityCompiler=__exports.ActivityCompiler=class ActivityCompiler extends ViewCompiler{compileField(el,params){let compiled;if(el.hasAttribute("widget")){compiled=super.compileField(el,params);}else{compiled=createElement("div",{"t-out":`record["${el.getAttribute("name")}"].value`,});}
const classNames=[];const{bold,display,muted}=extractAttributes(el,["bold","display","muted"]);if(display==="right"){classNames.push("float-end");}
if(display==="full"){classNames.push("d-block","text-truncate");}else{classNames.push("d-inline-block");}
if(bold){classNames.push("fw-bold");}
if(muted){classNames.push("text-muted");}
if(classNames.length>0){const clsFormatted=el.hasAttribute("widget")?toStringExpression(classNames.join(" ")):classNames.join(" ");compiled.setAttribute("class",clsFormatted);}
const attrs={};for(const attr of el.attributes){attrs[attr.name]=attr.value;}
if(el.hasAttribute("widget")){const attrsParts=Object.entries(attrs).map(([key,value])=>{if(key.startsWith("t-attf-")){key=key.slice(7);value=toInterpolatedStringExpression(value);}else if(key.startsWith("t-att-")){key=key.slice(6);value=`"" + (${value})`;}else if(key.startsWith("t-att")){throw new Error("t-att on <field> nodes is not supported");}else if(!key.startsWith("t-")){value=toStringExpression(value);}
return`'${key}':${value}`;});compiled.setAttribute("attrs",`{${attrsParts.join(",")}}`);}
for(const attr in attrs){if(attr.startsWith("t-")&&!attr.startsWith("t-att")){compiled.setAttribute(attr,attrs[attr]);}}
return compiled;}}
ActivityCompiler.OWL_DIRECTIVE_WHITELIST=[...ViewCompiler.OWL_DIRECTIVE_WHITELIST,"t-name","t-esc","t-out","t-set","t-value","t-if","t-else","t-elif","t-foreach","t-as","t-key","t-att.*","t-call","t-translation",];return __exports;});;

/* /mail/static/src/views/web/activity/activity_controller.js */
odoo.define('@mail/views/web/activity/activity_controller',['@web/core/l10n/translation','@odoo/owl','@web/core/utils/hooks','@web/model/model','@web/model/relational_model/utils','@web/search/cog_menu/cog_menu','@web/search/layout','@web/search/search_bar/search_bar','@web/search/pager_hook','@web/views/standard_view_props','@web/views/view_dialogs/select_create_dialog'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"mail",...args);const{Component,useState}=require("@odoo/owl");const{useService}=require("@web/core/utils/hooks");const{useModel}=require("@web/model/model");const{extractFieldsFromArchInfo}=require("@web/model/relational_model/utils");const{CogMenu}=require("@web/search/cog_menu/cog_menu");const{Layout}=require("@web/search/layout");const{SearchBar}=require("@web/search/search_bar/search_bar");const{usePager}=require("@web/search/pager_hook");const{standardViewProps}=require("@web/views/standard_view_props");const{SelectCreateDialog}=require("@web/views/view_dialogs/select_create_dialog");const ActivityController=__exports.ActivityController=class ActivityController extends Component{static components={Layout,SearchBar,CogMenu};static props={...standardViewProps,Model:Function,Renderer:Function,archInfo:Object,};static template="mail.ActivityController";setup(){this.model=useState(useModel(this.props.Model,this.modelParams));this.dialog=useService("dialog");this.action=useService("action");this.store=useService("mail.store");this.ui=useService("ui");usePager(()=>{const{count,hasLimitedCount,limit,offset}=this.model.root;return{offset:offset,limit:limit,total:count,onUpdate:async(params)=>{params.domain=[...(this.model.originalDomain||[]),["activity_ids.active","in",[true,false]],];await Promise.all([this.model.root.load(params),this.model.fetchActivityData(params),]);},updateTotal:hasLimitedCount?()=>this.model.root.fetchCount():undefined,};});}
get modelParams(){const{archInfo,resModel}=this.props;const{activeFields,fields}=extractFieldsFromArchInfo(archInfo,this.props.fields);return{config:{activeFields,resModel,fields,},};}
getSearchProps(){const{comparision,context,domain,groupBy,orderBy}=this.env.searchModel;return{comparision,context,domain,groupBy,orderBy};}
get getSelectCreateDialogProps(){return{resModel:this.props.resModel,searchViewId:this.env.searchModel.searchViewId,domain:this.model.originalDomain,title:_t("Search: %s",this.props.archInfo.title),multiSelect:false,context:this.props.context,noCreate:this.props.context?.create===false,onSelected:async(resIds)=>{await this.store.scheduleActivity(this.props.resModel,resIds);},};}
scheduleActivity(){this.dialog.add(SelectCreateDialog,this.getSelectCreateDialogProps,{onClose:()=>this.model.load(this.getSearchProps()),});}
openActivityFormView(resId,activityTypeId){this.action.doAction({type:"ir.actions.act_window",res_model:"mail.activity",views:[[false,"form"]],view_mode:"form",view_type:"form",res_id:false,target:"new",context:{default_res_id:resId,default_res_model:this.props.resModel,default_activity_type_id:activityTypeId,dialog_size:"large",},},{onClose:()=>this.model.load(this.getSearchProps()),});}
sendMailTemplate(templateID,activityTypeID){const groupedActivities=this.model.activityData.grouped_activities;const resIds=[];for(const resId in groupedActivities){const activityByType=groupedActivities[resId];const activity=activityByType[activityTypeID];if(activity){resIds.push(parseInt(resId));}}
this.model.orm.call(this.props.resModel,"activity_send_mail",[resIds,templateID],{});}
async openRecord(record,{newWindow}={}){const activeIds=this.model.root.records.map((datapoint)=>datapoint.resId);this.props.selectRecord(record.resId,{activeIds,newWindow});}
get rendererProps(){return{activityTypes:this.model.activityData.activity_types,activityResIds:this.model.activityData.activity_res_ids,fields:this.model.root.fields,records:this.model.root.records,resModel:this.props.resModel,archInfo:this.props.archInfo,groupedActivities:this.model.activityData.grouped_activities,scheduleActivity:this.scheduleActivity.bind(this),onReloadData:()=>this.model.load(this.getSearchProps()),onEmptyCell:this.openActivityFormView.bind(this),onSendMailTemplate:this.sendMailTemplate.bind(this),openRecord:this.openRecord.bind(this),};}}
return __exports;});;

/* /mail/static/src/views/web/activity/activity_model.js */
odoo.define('@mail/views/web/activity/activity_model',['@web/model/relational_model/relational_model'],function(require){'use strict';let __exports={};const{RelationalModel}=require("@web/model/relational_model/relational_model");const ActivityModel=__exports.ActivityModel=class ActivityModel extends RelationalModel{static DEFAULT_LIMIT=100;async load(params={}){this.originalDomain=params.domain?[...params.domain]:[];params.domain=[...(params.domain||[]),["activity_ids.active","in",[true,false]]];if(params&&"groupBy"in params){params.groupBy=[];}
await Promise.all([this.fetchActivityData(params),super.load(params)]);}
async fetchActivityData(params){this.activityData=await this.orm.call("mail.activity","get_activity_data",[],{res_model:this.config.resModel,context:params.context,domain:params.domain||this.env.searchModel._domain,limit:params.limit||this.initialLimit,offset:params.offset||0,fetch_done:false,});}}
return __exports;});;

/* /mail/static/src/views/web/activity/activity_record.js */
odoo.define('@mail/views/web/activity/activity_record',['@mail/views/web/activity/activity_compiler','@odoo/owl','@web/core/py_js/py','@web/core/user','@web/core/utils/html','@web/views/fields/field','@web/views/kanban/kanban_record','@web/views/view_compiler'],function(require){'use strict';let __exports={};const{ActivityCompiler}=require("@mail/views/web/activity/activity_compiler");const{Component}=require("@odoo/owl");const{evaluateBooleanExpr}=require("@web/core/py_js/py");const{user}=require("@web/core/user");const{isHtmlEmpty}=require("@web/core/utils/html");const{Field}=require("@web/views/fields/field");const{getFormattedRecord,getImageSrcFromRecordInfo}=require("@web/views/kanban/kanban_record");const{useViewCompiler}=require("@web/views/view_compiler");const ActivityRecord=__exports.ActivityRecord=class ActivityRecord extends Component{static components={Field,};static props={archInfo:{type:Object},openRecord:{type:Function},record:{type:Object},};static template="mail.ActivityRecord";setup(){this.evaluateBooleanExpr=evaluateBooleanExpr;this.widget={deletable:false,editable:false,isHtmlEmpty,};const{templateDocs}=this.props.archInfo;const templates=useViewCompiler(ActivityCompiler,templateDocs);this.recordTemplate=templates["activity-box"];}
getRenderingContext(){const{record}=this.props;return{record:getFormattedRecord(record),activity_image:(...args)=>getImageSrcFromRecordInfo(record,...args),user_context:user.context,widget:this.widget,luxon,__comp__:Object.assign(Object.create(this),{this:this}),};}}
return __exports;});;

/* /mail/static/src/views/web/activity/activity_renderer.js */
odoo.define('@mail/views/web/activity/activity_renderer',['@mail/core/web/mail_column_progress','@mail/views/web/activity/activity_cell','@mail/views/web/activity/activity_record','@odoo/owl','@web/core/browser/browser','@web/core/checkbox/checkbox','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{MailColumnProgress}=require("@mail/core/web/mail_column_progress");const{ActivityCell}=require("@mail/views/web/activity/activity_cell");const{ActivityRecord}=require("@mail/views/web/activity/activity_record");const{Component,useState}=require("@odoo/owl");const{browser}=require("@web/core/browser/browser");const{CheckBox}=require("@web/core/checkbox/checkbox");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"mail",...args);const ActivityRenderer=__exports.ActivityRenderer=class ActivityRenderer extends Component{static components={ActivityCell,ActivityRecord,ColumnProgress:MailColumnProgress,Dropdown,DropdownItem,CheckBox,};static props={activityTypes:{type:Object},activityResIds:{type:Array},fields:{type:Object},resModel:{type:String},records:{type:Array},archInfo:{type:Object},groupedActivities:{type:Object},scheduleActivity:{type:Function},onReloadData:{type:Function},onEmptyCell:{type:Function},onSendMailTemplate:{type:Function},openRecord:{type:Function},};static template="mail.ActivityRenderer";setup(){this.activeFilter=useState({progressValue:{active:null,},activityTypeId:null,resIds:new Set(Object.keys(this.props.groupedActivities)),});this.storageKey=["activity_columns",this.props.resModel,this.env.config.viewId];this.setupStorageActiveColumns();}
getGroupInfo(activityType){const types={done:{color:"secondary",inProgressBar:false,label:_t("done"),value:0,},planned:{color:"success",inProgressBar:true,value:0,},today:{color:"warning",inProgressBar:true,value:0,},overdue:{color:"danger",inProgressBar:true,value:0,},};for(const[type,label]of this.props.fields.activity_state.selection){types[type].label=label;}
const typeId=activityType.id;const isColumnFiltered=this.activeFilter.activityTypeId===activityType.id;const progressValue=isColumnFiltered?this.activeFilter.progressValue:{active:null};let totalCountWithoutDone=0;for(const activities of Object.values(this.props.groupedActivities)){if(typeId in activities){for(const[state,stateCount]of Object.entries(activities[typeId].count_by_state)){types[state].value+=stateCount;if(state!=="done"){totalCountWithoutDone+=stateCount;}}}}
const progressBar={bars:[],activeBar:isColumnFiltered?this.activeFilter.progressValue.active:null,isReady:true,};for(const[value,count]of Object.entries(types)){if(count.inProgressBar){progressBar.bars.push({count:count.value,value,string:types[value].label,color:count.color,});}}
const ongoingActivityCount=types.overdue.value+types.today.value+types.planned.value;const ongoingAndDoneCount=ongoingActivityCount+types.done.value;const labelAggregate=`${types.overdue.label} + ${types.today.label} + ${types.planned.label}`;const aggregateOn=ongoingAndDoneCount?{title:`${types.done.label} + ${labelAggregate}`,value:ongoingAndDoneCount,}:undefined;return{aggregate:{title:labelAggregate,value:isColumnFiltered?types[progressValue.active].value:ongoingActivityCount,},aggregateOn:aggregateOn,data:{count:totalCountWithoutDone,filterProgressValue:(name)=>this.onSetProgressBarState(typeId,name),progressBar,progressValue,},};}
getRecord(resId){return this.props.records.find((r)=>r.resId===resId);}
onSetProgressBarState(typeId,bar){const name=bar.value;if(this.activeFilter.progressValue.active===name){this.activeFilter.progressValue.active=null;this.activeFilter.activityTypeId=null;this.activeFilter.resIds=new Set(Object.keys(this.props.groupedActivities));}else{this.activeFilter.progressValue.active=name;this.activeFilter.activityTypeId=typeId;this.activeFilter.resIds=new Set(Object.entries(this.props.groupedActivities).filter(([,resIds])=>typeId in resIds&&name in resIds[typeId].count_by_state).map(([key])=>parseInt(key)));}}
get activeColumns(){return this.props.activityTypes.filter((activityType)=>this.storageActiveColumns[activityType.id]);}
setupStorageActiveColumns(){const storageActiveColumnsList=browser.localStorage.getItem(this.storageKey)?.split(",");this.storageActiveColumns=useState({});for(const activityType of this.props.activityTypes){if(storageActiveColumnsList){this.storageActiveColumns[activityType.id]=storageActiveColumnsList.includes(activityType.id.toString());}else{this.storageActiveColumns[activityType.id]=true;}}}
toggleDisplayColumn(typeId){this.storageActiveColumns[typeId]=!this.storageActiveColumns[typeId];browser.localStorage.setItem(this.storageKey.join(","),Object.keys(this.storageActiveColumns).filter((activityType)=>this.storageActiveColumns[activityType]));}}
return __exports;});;

/* /mail/static/src/views/web/activity/activity_view.js */
odoo.define('@mail/views/web/activity/activity_view',['@mail/views/web/activity/activity_arch_parser','@mail/views/web/activity/activity_controller','@mail/views/web/activity/activity_model','@mail/views/web/activity/activity_renderer','@web/core/registry'],function(require){'use strict';let __exports={};const{ActivityArchParser}=require("@mail/views/web/activity/activity_arch_parser");const{ActivityController}=require("@mail/views/web/activity/activity_controller");const{ActivityModel}=require("@mail/views/web/activity/activity_model");const{ActivityRenderer}=require("@mail/views/web/activity/activity_renderer");const{registry}=require("@web/core/registry");const activityView=__exports.activityView={type:"activity",searchMenuTypes:["filter","favorite"],Controller:ActivityController,Renderer:ActivityRenderer,ArchParser:ActivityArchParser,Model:ActivityModel,props:(genericProps,view)=>{const{arch,relatedModels,resModel}=genericProps;const archInfo=new view.ArchParser().parse(arch,relatedModels,resModel);return{...genericProps,archInfo,Model:view.Model,Renderer:view.Renderer,};},};registry.category("views").add("activity",activityView);return __exports;});;

/* /analytic/static/src/views/graph/graph_view.js */
odoo.define('@analytic/views/graph/graph_view',['@web/core/registry','@web/views/graph/graph_view','@analytic/views/analytic_search_model'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{graphView}=require("@web/views/graph/graph_view");const{AnalyticSearchModel}=require("@analytic/views/analytic_search_model");const analyticGraphView=__exports.analyticGraphView={...graphView,SearchModel:AnalyticSearchModel,};registry.category("views").add("analytic_graph",analyticGraphView);return __exports;});;

/* /analytic/static/src/views/pivot/pivot_renderer.js */
odoo.define('@analytic/views/pivot/pivot_renderer',['@web/views/pivot/pivot_renderer'],function(require){'use strict';let __exports={};const{PivotRenderer}=require("@web/views/pivot/pivot_renderer");const AnalyticPivotRenderer=__exports.AnalyticPivotRenderer=class AnalyticPivotRenderer extends PivotRenderer{onGroupBySelected({itemId,optionId}){if(typeof(optionId)==="number"){itemId=optionId;}
let searchItems=this.env.searchModel.getSearchItems((searchItem)=>["groupBy","dateGroupBy"].includes(searchItem.type)&&!searchItem.custom)
searchItems=[...searchItems,...searchItems.flatMap((f)=>f.options).filter((f)=>typeof(f?.id)==="number")]
const{fieldName}=searchItems.find(({id})=>id===itemId);this.model.addGroupBy({...this.dropdown.cellInfo,fieldName,interval:optionId});}}
return __exports;});;

/* /analytic/static/src/views/pivot/pivot_view.js */
odoo.define('@analytic/views/pivot/pivot_view',['@web/core/registry','@web/views/pivot/pivot_view','@analytic/views/analytic_search_model','@analytic/views/pivot/pivot_renderer'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{pivotView}=require("@web/views/pivot/pivot_view");const{AnalyticSearchModel}=require("@analytic/views/analytic_search_model");const{AnalyticPivotRenderer}=require("@analytic/views/pivot/pivot_renderer");const analyticPivotView=__exports.analyticPivotView={...pivotView,Renderer:AnalyticPivotRenderer,SearchModel:AnalyticSearchModel,};registry.category("views").add("analytic_pivot",analyticPivotView);return __exports;});;

/* /crm/static/src/views/forecast_graph/forecast_graph_view.js */
odoo.define('@crm/views/forecast_graph/forecast_graph_view',['@web/core/registry','@web/views/graph/graph_view','@crm/views/forecast_search_model'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{graphView}=require("@web/views/graph/graph_view");const{ForecastSearchModel}=require("@crm/views/forecast_search_model");const forecastGraphView=__exports.forecastGraphView={...graphView,SearchModel:ForecastSearchModel,};registry.category("views").add("forecast_graph",forecastGraphView);return __exports;});;

/* /crm/static/src/views/forecast_pivot/forecast_pivot_view.js */
odoo.define('@crm/views/forecast_pivot/forecast_pivot_view',['@web/core/registry','@web/views/pivot/pivot_view','@crm/views/forecast_search_model'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{pivotView}=require("@web/views/pivot/pivot_view");const{ForecastSearchModel}=require("@crm/views/forecast_search_model");const forecastPivotView=__exports.forecastPivotView={...pivotView,SearchModel:ForecastSearchModel,};registry.category("views").add("forecast_pivot",forecastPivotView);return __exports;});;

/* /stock/static/src/stock_forecasted/forecasted_graph.js */
odoo.define('@stock/stock_forecasted/forecasted_graph',['@web/core/registry','@web/views/graph/graph_renderer','@web/views/graph/graph_view'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{GraphRenderer}=require("@web/views/graph/graph_renderer");const{graphView}=require("@web/views/graph/graph_view");const StockForecastedGraphRenderer=__exports.StockForecastedGraphRenderer=class StockForecastedGraphRenderer extends GraphRenderer{static template="stock.ForecastedGraphRenderer";getLineChartData(){const data=super.getLineChartData();data.datasets.forEach((dataset)=>{dataset.stepped=true;dataset.spanGaps=true;});if(data.datasets.length){const dataset_length=data.datasets[0].data.length;for(let i=dataset_length-2;i>0;i--){let skipData=data.datasets.every(d=>d.data[i]==d.data[i-1]);if(skipData){data.datasets.forEach((dataset)=>{dataset.data[i]=null;});}}}
return data;}};const StockForecastedGraphView=__exports.StockForecastedGraphView={...graphView,Renderer:StockForecastedGraphRenderer,};registry.category("views").add("stock_forecasted_graph",StockForecastedGraphView);return __exports;});;

/* /project/static/src/views/project_task_activity/project_task_activity_model.js */
odoo.define('@project/views/project_task_activity/project_task_activity_model',['@mail/views/web/activity/activity_model','@project/views/project_task_model_mixin'],function(require){'use strict';let __exports={};const{ActivityModel}=require("@mail/views/web/activity/activity_model");const{ProjectTaskModelMixin}=require("@project/views/project_task_model_mixin");const ProjectTaskActivityModel=__exports.ProjectTaskActivityModel=class ProjectTaskActivityModel extends ProjectTaskModelMixin(ActivityModel){async load(params={}){const domain=params.domain||this.config.domain;params.domain=this._processSearchDomain(domain);return super.load(params);}}
return __exports;});;

/* /project/static/src/views/project_task_activity/project_task_activity_view.js */
odoo.define('@project/views/project_task_activity/project_task_activity_view',['@mail/views/web/activity/activity_view','@project/views/project_task_control_panel/project_task_control_panel','@project/views/project_task_activity/project_task_activity_model','@web/core/registry'],function(require){'use strict';let __exports={};const{activityView}=require("@mail/views/web/activity/activity_view");const{ProjectTaskControlPanel}=require("@project/views/project_task_control_panel/project_task_control_panel");const{ProjectTaskActivityModel}=require("@project/views/project_task_activity/project_task_activity_model");const{registry}=require("@web/core/registry");const projectTaskActivityView=__exports.projectTaskActivityView={...activityView,ControlPanel:ProjectTaskControlPanel,Model:ProjectTaskActivityModel,}
registry.category("views").add("project_task_activity",projectTaskActivityView);return __exports;});;

/* /project/static/src/views/project_task_graph/project_task_graph_model.js */
odoo.define('@project/views/project_task_graph/project_task_graph_model',['@web/views/graph/graph_model','@project/views/project_task_model_mixin'],function(require){'use strict';let __exports={};const{GraphModel}=require("@web/views/graph/graph_model");const{ProjectTaskModelMixin}=require("@project/views/project_task_model_mixin");const ProjectTaskGraphModel=__exports.ProjectTaskGraphModel=class ProjectTaskGraphModel extends ProjectTaskModelMixin(GraphModel){async load(searchParams){const domain=searchParams.domain||[];searchParams.domain=this._processSearchDomain(domain);return super.load(searchParams);}}
return __exports;});;

/* /project/static/src/views/project_task_graph/project_task_graph_view.js */
odoo.define('@project/views/project_task_graph/project_task_graph_view',['@web/views/graph/graph_view','@project/views/project_task_control_panel/project_task_control_panel','@project/views/project_task_graph/project_task_graph_model','@web/core/registry'],function(require){'use strict';let __exports={};const{graphView}=require("@web/views/graph/graph_view");const{ProjectTaskControlPanel}=require("@project/views/project_task_control_panel/project_task_control_panel");const{ProjectTaskGraphModel}=require("@project/views/project_task_graph/project_task_graph_model");const{registry}=require("@web/core/registry");const projectTaskGraphView=__exports.projectTaskGraphView={...graphView,ControlPanel:ProjectTaskControlPanel,Model:ProjectTaskGraphModel,}
registry.category("views").add("project_task_graph",projectTaskGraphView);return __exports;});;

/* /project/static/src/views/project_task_pivot/project_task_pivot_model.js */
odoo.define('@project/views/project_task_pivot/project_task_pivot_model',['@web/views/pivot/pivot_model','@project/views/project_task_model_mixin'],function(require){'use strict';let __exports={};const{PivotModel}=require("@web/views/pivot/pivot_model");const{ProjectTaskModelMixin}=require("@project/views/project_task_model_mixin");const ProjectTaskPivotModel=__exports.ProjectTaskPivotModel=class ProjectTaskPivotModel extends ProjectTaskModelMixin(PivotModel){async load(searchParams){const domain=searchParams.domain||[];searchParams.domain=this._processSearchDomain(domain);return super.load(searchParams);}}
return __exports;});;

/* /project/static/src/views/project_task_pivot/project_task_pivot_view.js */
odoo.define('@project/views/project_task_pivot/project_task_pivot_view',['@project/views/project_task_control_panel/project_task_control_panel','@web/core/registry','@project/views/project_task_pivot/project_task_pivot_model','@web/views/pivot/pivot_view'],function(require){'use strict';let __exports={};const{ProjectTaskControlPanel}=require("@project/views/project_task_control_panel/project_task_control_panel");const{registry}=require("@web/core/registry");const{ProjectTaskPivotModel}=require("@project/views/project_task_pivot/project_task_pivot_model");const{pivotView}=require("@web/views/pivot/pivot_view");const projectTaskPivotView=__exports.projectTaskPivotView={...pivotView,ControlPanel:ProjectTaskControlPanel,Model:ProjectTaskPivotModel,}
registry.category("views").add("project_task_pivot",projectTaskPivotView);return __exports;});;

/* /project/static/src/views/project_task_analysis_renderer_mixin.js */
odoo.define('@project/views/project_task_analysis_renderer_mixin',['@web/core/browser/browser','@web/core/domain'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{Domain}=require("@web/core/domain");const ProjectTaskAnalysisRendererMixin=__exports.ProjectTaskAnalysisRendererMixin=(T)=>class ProjectTaskAnalysisRendererMixin extends T{openView(domain,views,context){const showSubtasks=JSON.parse(browser.localStorage.getItem("showSubtasks")||"false");if(!showSubtasks){context.show_task_options=false;}
for(const leaf of domain){if(Array.isArray(leaf)&&leaf[0]==="task_id"){leaf[0]="id";}}
const fieldsNotInBaseModel=["nbr","rating_last_value","rating_avg","delay_endings_days"];const newDomain=Domain.removeDomainLeaves(domain,fieldsNotInBaseModel).toList();this.actionService.doAction({context,domain:newDomain,name:"Tasks",res_model:"project.task",target:"current",type:"ir.actions.act_window",views,},{viewType:"list",});}}
return __exports;});;

/* /project/static/src/views/project_task_analysis_graph/project_task_analysis_graph_model.js */
odoo.define('@project/views/project_task_analysis_graph/project_task_analysis_graph_model',['@web/views/graph/graph_model','@project/views/project_task_model_mixin'],function(require){'use strict';let __exports={};const{GraphModel}=require("@web/views/graph/graph_model");const{ProjectTaskModelMixin}=require("@project/views/project_task_model_mixin");const ProjectTaskAnalysisGraphModel=__exports.ProjectTaskAnalysisGraphModel=class ProjectTaskAnalysisGraphModel extends ProjectTaskModelMixin(GraphModel){async load(searchParams){const domain=searchParams.domain||[];searchParams.domain=this._processSearchDomain(domain);return super.load(searchParams);}}
return __exports;});;

/* /project/static/src/views/project_task_analysis_graph/project_task_analysis_graph_renderer.js */
odoo.define('@project/views/project_task_analysis_graph/project_task_analysis_graph_renderer',['@web/views/graph/graph_renderer','@project/views/project_task_analysis_renderer_mixin'],function(require){'use strict';let __exports={};const{GraphRenderer}=require("@web/views/graph/graph_renderer");const{ProjectTaskAnalysisRendererMixin}=require("@project/views/project_task_analysis_renderer_mixin");const ProjectTaskAnalysisGraphRenderer=__exports.ProjectTaskAnalysisGraphRenderer=class ProjectTaskAnalysisGraphRenderer extends ProjectTaskAnalysisRendererMixin(GraphRenderer){}
return __exports;});;

/* /project/static/src/views/project_task_analysis_graph/project_task_analysis_graph_view.js */
odoo.define('@project/views/project_task_analysis_graph/project_task_analysis_graph_view',['@web/core/registry','@web/views/graph/graph_view','@project/views/project_task_analysis_graph/project_task_analysis_graph_renderer','@project/views/project_task_analysis_graph/project_task_analysis_graph_model','@project/views/project_task_control_panel/project_task_control_panel'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{graphView}=require("@web/views/graph/graph_view");const{ProjectTaskAnalysisGraphRenderer}=require("@project/views/project_task_analysis_graph/project_task_analysis_graph_renderer");const{ProjectTaskAnalysisGraphModel}=require("@project/views/project_task_analysis_graph/project_task_analysis_graph_model");const{ProjectTaskControlPanel}=require("@project/views/project_task_control_panel/project_task_control_panel");registry.category("views").add("project_task_analysis_graph",{...graphView,ControlPanel:ProjectTaskControlPanel,Model:ProjectTaskAnalysisGraphModel,Renderer:ProjectTaskAnalysisGraphRenderer,});return __exports;});;

/* /project/static/src/views/project_task_analysis_pivot/project_task_analysis_pivot_model.js */
odoo.define('@project/views/project_task_analysis_pivot/project_task_analysis_pivot_model',['@web/views/pivot/pivot_model','@project/views/project_task_model_mixin'],function(require){'use strict';let __exports={};const{PivotModel}=require("@web/views/pivot/pivot_model");const{ProjectTaskModelMixin}=require("@project/views/project_task_model_mixin");const ProjectTaskAnalysisPivotModel=__exports.ProjectTaskAnalysisPivotModel=class ProjectTaskAnalysisPivotModel extends ProjectTaskModelMixin(PivotModel){async load(searchParams){const domain=searchParams.domain||[];searchParams.domain=this._processSearchDomain(domain);return super.load(searchParams);}}
return __exports;});;

/* /project/static/src/views/project_task_analysis_pivot/project_task_analysis_pivot_renderer.js */
odoo.define('@project/views/project_task_analysis_pivot/project_task_analysis_pivot_renderer',['@web/views/pivot/pivot_renderer','@project/views/project_task_analysis_renderer_mixin'],function(require){'use strict';let __exports={};const{PivotRenderer}=require("@web/views/pivot/pivot_renderer");const{ProjectTaskAnalysisRendererMixin}=require("@project/views/project_task_analysis_renderer_mixin");const ProjectTaskAnalysisPivotRenderer=__exports.ProjectTaskAnalysisPivotRenderer=class ProjectTaskAnalysisPivotRenderer extends ProjectTaskAnalysisRendererMixin(PivotRenderer){}
return __exports;});;

/* /project/static/src/views/project_task_analysis_pivot/project_task_analysis_pivot_view.js */
odoo.define('@project/views/project_task_analysis_pivot/project_task_analysis_pivot_view',['@web/core/registry','@web/views/pivot/pivot_view','@project/views/project_task_analysis_pivot/project_task_analysis_pivot_renderer','@project/views/project_task_control_panel/project_task_control_panel','@project/views/project_task_analysis_pivot/project_task_analysis_pivot_model'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{pivotView}=require("@web/views/pivot/pivot_view");const{ProjectTaskAnalysisPivotRenderer}=require("@project/views/project_task_analysis_pivot/project_task_analysis_pivot_renderer");const{ProjectTaskControlPanel}=require("@project/views/project_task_control_panel/project_task_control_panel");const{ProjectTaskAnalysisPivotModel}=require("@project/views/project_task_analysis_pivot/project_task_analysis_pivot_model");registry.category("views").add("project_task_analysis_pivot",{...pivotView,ControlPanel:ProjectTaskControlPanel,Model:ProjectTaskAnalysisPivotModel,Renderer:ProjectTaskAnalysisPivotRenderer,});return __exports;});;

/* /project/static/src/views/burndown_chart/burndown_chart_model.js */
odoo.define('@project/views/burndown_chart/burndown_chart_model',['@web/core/l10n/translation','@web/views/graph/graph_model','@web/core/utils/arrays'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"project",...args);const{GraphModel}=require("@web/views/graph/graph_model");const{sortBy}=require("@web/core/utils/arrays");const BurndownChartModel=__exports.BurndownChartModel=class BurndownChartModel extends GraphModel{setup(params){super.setup(params);this.stageSeqAndNamePerId={};}
async _fetchStageInfo(context){const searchDomain=!context.active_id||!context.default_project_id?[]:[["project_ids","in",context.active_id]];const data=await this.orm.webSearchRead("project.task.type",searchDomain,{specification:{name:{},sequence:{},},});const stageSeqAndNamePerId={};for(const{id,name,sequence}of data.records){stageSeqAndNamePerId[id]={name,sequence};}
return stageSeqAndNamePerId;}
async load(searchParams){const{context,groupBy}=searchParams;if(groupBy.includes("stage_id")){if(context.stage_name_and_sequence_per_id&&context.default_project_id){this.stageSeqAndNamePerId=context.stage_name_and_sequence_per_id;}else{this.stageSeqAndNamePerId=await this._fetchStageInfo(context);}}else{this.stageSeqAndNamePerId={};}
await super.load(searchParams);}
_prepareData(){super._prepareData();const{groupBy}=this.searchParams;const{mode}=this.metaData;if(mode==="line"&&groupBy.includes("stage_id")){this.data.datasets=sortBy(this.data.datasets,(dataSet)=>{const firstIdentifier=[...dataSet.identifiers][0];const group=Object.assign(...JSON.parse(firstIdentifier));const val=group.stage_id;if(Array.isArray(val)){return this.stageSeqAndNamePerId[val[0]]?.sequence||-1;}
return-1;});}}
async _loadDataPoints(metaData){metaData.measures.__count.string=_t("# of Tasks");return super._loadDataPoints(metaData);}}
return __exports;});;

/* /project/static/src/views/burndown_chart/burndown_chart_search_model.js */
odoo.define('@project/views/burndown_chart/burndown_chart_search_model',['@web/core/l10n/translation','@web/core/utils/hooks','@web/search/search_model'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"project",...args);const{useService}=require("@web/core/utils/hooks");const{SearchModel}=require("@web/search/search_model");const BurndownChartSearchModel=__exports.BurndownChartSearchModel=class BurndownChartSearchModel extends SearchModel{setup(services){this.notificationService=useService("notification");super.setup(...arguments);}
async load(config){await super.load(...arguments);for(const searchItem of Object.values(this.searchItems)){if(['dateGroupBy','groupBy'].includes(searchItem.type)){if(this.stageIdSearchItemId&&this.dateSearchItemId&&this.isClosedSearchItemId){return;}
switch(searchItem.fieldName){case'date':this.dateSearchItemId=searchItem.id;break;case'stage_id':this.stageIdSearchItemId=searchItem.id;break;case'is_closed':this.isClosedSearchItemId=searchItem.id;break;}}}}
deactivateGroup(groupId){if(this.searchItems[this.dateSearchItemId].groupId==groupId){if(this.query.some(queryElem=>[this.stageIdSearchItemId,this.isClosedSearchItemId].includes(queryElem.searchItemId))){this._addGroupByNotification(_t("The report should be grouped either by \"Stage\" to represent a Burndown Chart or by \"Is Closed\" to represent a Burn-up chart. Without one of these groupings applied, the report will not provide relevant information."));}
return;}
super.deactivateGroup(groupId);}
toggleDateGroupBy(searchItemId,intervalId){if(searchItemId===this.dateSearchItemId){let filtered_query=[];let triggerNotification=false;for(const queryElem of this.query){if(queryElem.searchItemId!==searchItemId){filtered_query.push(queryElem);}else if(queryElem.intervalId===intervalId){triggerNotification=true;}}
if(filtered_query.length!==this.query.length){this.query=filtered_query;if(triggerNotification){this._addGroupByNotification(_t("The Burndown Chart must be grouped by Date"));}}}
super.toggleDateGroupBy(...arguments);}
toggleSearchItem(searchItemId){if(searchItemId===this.isClosedSearchItemId){super.toggleSearchItem(this.stageIdSearchItemId);}else if(searchItemId===this.stageIdSearchItemId){super.toggleSearchItem(this.isClosedSearchItemId);}
super.toggleSearchItem(...arguments);}
_addGroupByNotification(body){this.notificationService.add(body,{type:"danger"});}
async _notify(){let stageIdIndex=-1;let dateIndex=-1;let isClosedIndex=-1;for(const[index,queryElem]of this.query.entries()){if(dateIndex!==-1&&(stageIdIndex!==-1||isClosedIndex!==-1)){break;}
switch(queryElem.searchItemId){case this.dateSearchItemId:dateIndex=index;break;case this.stageIdSearchItemId:stageIdIndex=index;break;case this.isClosedSearchItemId:isClosedIndex=index;break;}}
if(isClosedIndex>0){if(isClosedIndex>dateIndex){dateIndex+=1;}
this.query.splice(0,0,this.query.splice(stageIdIndex,1)[0]);}else if(stageIdIndex>0){if(stageIdIndex>dateIndex){dateIndex+=1;}
this.query.splice(0,0,this.query.splice(stageIdIndex,1)[0]);}
if(dateIndex>0){this.query.splice(0,0,this.query.splice(dateIndex,1)[0]);}
await super._notify(...arguments);}}
return __exports;});;

/* /project/static/src/views/burndown_chart/burndown_chart_view.js */
odoo.define('@project/views/burndown_chart/burndown_chart_view',['@project/views/burndown_chart/burndown_chart_model','@web/views/graph/graph_view','@web/core/registry','@project/views/burndown_chart/burndown_chart_search_model'],function(require){'use strict';let __exports={};const{BurndownChartModel}=require("@project/views/burndown_chart/burndown_chart_model");const{graphView}=require("@web/views/graph/graph_view");const{registry}=require("@web/core/registry");const{BurndownChartSearchModel}=require("@project/views/burndown_chart/burndown_chart_search_model");const viewRegistry=registry.category("views");const burndownChartGraphView={...graphView,buttonTemplate:"project.BurndownChartView.Buttons",hideCustomGroupBy:true,Model:BurndownChartModel,SearchModel:BurndownChartSearchModel,};viewRegistry.add("burndown_chart",burndownChartGraphView);return __exports;});;

/* /project/static/src/views/project_project_activity/project_project_activity_model.js */
odoo.define('@project/views/project_project_activity/project_project_activity_model',['@mail/views/web/activity/activity_model','@project/views/project_model_mixin'],function(require){'use strict';let __exports={};const{ActivityModel}=require("@mail/views/web/activity/activity_model");const{ProjectModelMixin}=require("@project/views/project_model_mixin");const ProjectActivityModel=__exports.ProjectActivityModel=class ProjectActivityModel extends ProjectModelMixin(ActivityModel){async load(params={}){const domain=params.domain||this.config.domain;params.domain=this._processSearchDomain(domain);return super.load(params);}}
return __exports;});;

/* /project/static/src/views/project_project_activity/project_project_activity_view.js */
odoo.define('@project/views/project_project_activity/project_project_activity_view',['@mail/views/web/activity/activity_view','@project/views/project_project_activity/project_project_activity_model','@web/core/registry'],function(require){'use strict';let __exports={};const{activityView}=require("@mail/views/web/activity/activity_view");const{ProjectActivityModel}=require("@project/views/project_project_activity/project_project_activity_model");const{registry}=require("@web/core/registry");const projectProjectActivityView=__exports.projectProjectActivityView={...activityView,Model:ProjectActivityModel,}
registry.category("views").add("project_project_activity",projectProjectActivityView);return __exports;});;

/* /web_enterprise/static/src/views/pivot/pivot_renderer.js */
odoo.define('@web_enterprise/views/pivot/pivot_renderer',['@web/core/utils/patch','@web/views/pivot/pivot_renderer','@odoo/owl'],function(require){'use strict';let __exports={};const{patch}=require("@web/core/utils/patch");const{PivotRenderer}=require("@web/views/pivot/pivot_renderer");const{useEffect,useRef}=require("@odoo/owl");patch(PivotRenderer.prototype,{setup(){super.setup();this.root=useRef("root");if(this.env.isSmall){useEffect(()=>{if(this.root.el){const tooltipElems=this.root.el.querySelectorAll("*[data-tooltip]");for(const el of tooltipElems){el.removeAttribute("data-tooltip");el.removeAttribute("data-tooltip-position");}}});}},getPadding(cell){if(this.env.isSmall){return 5+cell.indent*5;}
return super.getPadding(...arguments);},});return __exports;});;

/* /web_map/static/src/map_view/map_arch_parser.js */
odoo.define('@web_map/map_view/map_arch_parser',['@web/core/utils/arrays','@web/core/utils/strings','@web/core/utils/xml','@web/search/utils/order_by'],function(require){'use strict';let __exports={};const{unique}=require("@web/core/utils/arrays");const{exprToBoolean}=require("@web/core/utils/strings");const{visitXML}=require("@web/core/utils/xml");const{stringToOrderBy}=require("@web/search/utils/order_by");const MapArchParser=__exports.MapArchParser=class MapArchParser{parse(arch){const archInfo={fieldNames:[],fieldNamesMarkerPopup:[],};visitXML(arch,(node)=>{switch(node.tagName){case"map":this.visitMap(node,archInfo);break;case"field":this.visitField(node,archInfo);break;}});archInfo.fieldNames=unique(archInfo.fieldNames);archInfo.fieldNamesMarkerPopup=unique(archInfo.fieldNamesMarkerPopup);return archInfo;}
visitMap(node,archInfo){archInfo.resPartnerField=node.getAttribute("res_partner");archInfo.fieldNames.push(archInfo.resPartnerField);if(node.hasAttribute("limit")){archInfo.limit=parseInt(node.getAttribute("limit"),10);}
if(node.hasAttribute("panel_title")){archInfo.panelTitle=node.getAttribute("panel_title");}
if(node.hasAttribute("routing")){archInfo.routing=exprToBoolean(node.getAttribute("routing"));}
if(node.hasAttribute("hide_title")){archInfo.hideTitle=exprToBoolean(node.getAttribute("hide_title"));}
if(node.hasAttribute("hide_address")){archInfo.hideAddress=exprToBoolean(node.getAttribute("hide_address"));}
if(node.hasAttribute("hide_name")){archInfo.hideName=exprToBoolean(node.getAttribute("hide_name"));}
if(!archInfo.hideName){archInfo.fieldNames.push("display_name");}
if(node.hasAttribute("default_order")){archInfo.defaultOrder=stringToOrderBy(node.getAttribute("default_order")||null);}
if(node.hasAttribute("allow_resequence")){archInfo.allowResequence=exprToBoolean(node.getAttribute("allow_resequence"));}}
visitField(node,params){params.fieldNames.push(node.getAttribute("name"));params.fieldNamesMarkerPopup.push({fieldName:node.getAttribute("name"),string:node.getAttribute("string"),});}}
return __exports;});;

/* /web_map/static/src/map_view/map_controller.js */
odoo.define('@web_map/map_view/map_controller',['@web/core/l10n/translation','@web/core/assets','@web/core/utils/hooks','@web/model/model','@web/views/standard_view_props','@web/search/action_hook','@web/search/layout','@web/search/pager_hook','@web/search/search_bar/search_bar','@web/search/search_bar/search_bar_toggler','@web/search/cog_menu/cog_menu','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_map",...args);const{loadJS,loadCSS}=require("@web/core/assets");const{useService}=require("@web/core/utils/hooks");const{useModelWithSampleData}=require("@web/model/model");const{standardViewProps}=require("@web/views/standard_view_props");const{useSetupAction}=require("@web/search/action_hook");const{Layout}=require("@web/search/layout");const{usePager}=require("@web/search/pager_hook");const{SearchBar}=require("@web/search/search_bar/search_bar");const{useSearchBarToggler}=require("@web/search/search_bar/search_bar_toggler");const{CogMenu}=require("@web/search/cog_menu/cog_menu");const{Component,onWillUnmount,onWillStart}=require("@odoo/owl");const MapController=__exports.MapController=class MapController extends Component{static template="web_map.MapView";static components={Layout,SearchBar,CogMenu,};static props={...standardViewProps,Model:Function,modelParams:Object,Renderer:Function,buttonTemplate:String,};setup(){this.action=useService("action");const Model=this.props.Model;const model=useModelWithSampleData(Model,this.props.modelParams);this.model=model;onWillUnmount(()=>{this.model.stopFetchingCoordinates();});useSetupAction({getLocalState:()=>{return this.model.metaData;},});onWillStart(()=>Promise.all([loadJS("/web_map/static/lib/leaflet/leaflet.js"),loadCSS("/web_map/static/lib/leaflet/leaflet.css"),]));usePager(()=>{return{offset:this.model.metaData.offset,limit:this.model.metaData.limit,total:this.model.data.count,onUpdate:({offset,limit})=>this.model.load({offset,limit}),};});this.searchBarToggler=useSearchBarToggler();}
get rendererProps(){return{model:this.model,onMarkerClick:this.openRecords.bind(this),};}
openRecords(ids,newWindow){if(ids.length>1){this.action.doAction({type:"ir.actions.act_window",name:this.env.config.getDisplayName()||_t("Untitled"),views:[[false,"list"],[false,"form"],],res_model:this.props.resModel,domain:[["id","in",ids]],},{newWindow,});}else{this.action.switchView("form",{resId:ids[0]},{newWindow});}}}
return __exports;});;

/* /web_map/static/src/map_view/map_model.js */
odoo.define('@web_map/map_view/map_model',['@web/core/l10n/translation','@web/model/model','@web/session','@web/model/relational_model/utils','@web/core/browser/browser','@web/core/l10n/dates','@web/core/utils/concurrency','@web/search/utils/order_by'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_map",...args);const{Model}=require("@web/model/model");const{session}=require("@web/session");const{resequence}=require("@web/model/relational_model/utils");const{browser}=require("@web/core/browser/browser");const{formatDateTime,parseDate,parseDateTime}=require("@web/core/l10n/dates");const{KeepLast}=require("@web/core/utils/concurrency");const{orderByToString}=require("@web/search/utils/order_by");const DATE_GROUP_FORMATS={year:"yyyy",quarter:"'Q'q yyyy",month:"MMMM yyyy",week:"'W'WW yyyy",day:"dd MMM yyyy",};const MapModel=__exports.MapModel=class MapModel extends Model{setup(params,{notification,http}){this.notification=notification;this.http=http;this.metaData={...params,mapBoxToken:session.map_box_token||"",};this.data={count:0,fetchingCoordinates:false,groupByKey:false,isGrouped:false,numberOfLocatedRecords:0,partners:{},partnerToCache:[],recordGroups:[],records:[],routes:[],routingError:null,shouldUpdatePosition:true,useMapBoxAPI:!!this.metaData.mapBoxToken,};this.coordinateFetchingTimeoutHandle=undefined;this.shouldFetchCoordinates=false;this.keepLast=new KeepLast();}
async load(params){if(this.coordinateFetchingTimeoutHandle!==undefined){this.stopFetchingCoordinates();}
const metaData={...this.metaData,...params,};metaData.groupBy=(metaData.groupBy||[]).filter((groupBy)=>{const[fieldName]=groupBy.split(".");const field=metaData.fields[fieldName];return field?.type!=="properties";});this.data=await this._fetchData(metaData);this.metaData=metaData;this.notify();}
stopFetchingCoordinates(){browser.clearTimeout(this.coordinateFetchingTimeoutHandle);this.coordinateFetchingTimeoutHandle=undefined;this.shouldFetchCoordinates=false;}
get canResequence(){return(this.metaData.defaultOrder&&!this.metaData.fields[this.metaData.defaultOrder[0].name].readonly&&this.metaData.fields[this.metaData.defaultOrder[0].name].type==="integer"&&this.metaData.allowResequence&&!this.metaData.groupBy?.length);}
async resequence(movedId,targetId){const fieldName=this.metaData.defaultOrder[0].name;const asc=this.metaData.defaultOrder[0].asc;const resequenceProm=resequence({records:this.data.records,resModel:this.metaData.resModel,movedId,targetId,fieldName,asc,context:this.metaData.context,orm:this.orm,});this.notify();const resequencedRecords=await resequenceProm;if(resequencedRecords.length){for(const resequencedRecord of resequencedRecords){const record=this.data.records.find((r)=>r.id===resequencedRecord.id);record[fieldName]=resequencedRecord[fieldName];}
await this._updatePartnerCoordinate(this.metaData,this.data);this.notify();}}
_addPartnerToRecord(metaData,data){for(const record of data.records){if(metaData.resModel==="res.partner"&&metaData.resPartnerField==="id"){record.partner=data.partners[record.id];}else{record.partner=data.partners[record[metaData.resPartnerField].id];}
data.numberOfLocatedRecords++;}}
_checkCoordinatesValidity(partner){if(partner.partner_latitude&&partner.partner_longitude&&partner.partner_latitude>=-90&&partner.partner_latitude<=90&&partner.partner_longitude>=-180&&partner.partner_longitude<=180){return true;}
return false;}
async _fetchData(metaData){const data={count:0,fetchingCoordinates:false,groupByKey:metaData.groupBy.length?metaData.groupBy[0]:false,isGrouped:metaData.groupBy.length>0,numberOfLocatedRecords:0,partners:{},partnerToCache:[],recordGroups:[],records:[],routes:[],routingError:null,shouldUpdatePosition:true,useMapBoxAPI:!!metaData.mapBoxToken,};if(!metaData.resPartnerField){data.recordGroups=[];data.records=[];data.routes=[];return this.keepLast.add(Promise.resolve(data));}
const results=await this.keepLast.add(this._fetchRecordData(metaData,data));const datetimeFields=metaData.fieldNames.filter((name)=>metaData.fields[name].type=="datetime");for(const record of results.records){for(const field of datetimeFields){if(record[field]){const dateUTC=luxon.DateTime.fromFormat(record[field],"yyyy-MM-dd HH:mm:ss",{zone:"UTC"});record[field]=formatDateTime(dateUTC,{format:"yyyy-MM-dd HH:mm:ss"});}}}
data.records=results.records;data.count=results.length;if(data.isGrouped){data.recordGroups=await this._getRecordGroups(metaData,data);}else{data.recordGroups=[];}
if(metaData.resModel==="res.partner"&&metaData.resPartnerField==="id"){for(const record of data.records){if(!data.partners[record.id]){data.partners[record.id]={...record};}}}else{for(const record of data.records){const partner=record[metaData.resPartnerField];if(partner&&!data.partners[partner.id]){data.partners[partner.id]=partner;}}}
this._addPartnerToRecord(metaData,data);await this._updatePartnerCoordinate(metaData,data);return data;}
_getRecordSpecification(metaData,data){const fieldNames=data.groupByKey?metaData.fieldNames.concat(data.groupByKey.split(":")[0]):metaData.fieldNames;const specification={};const fieldsToAdd={contact_address_complete:{},partner_latitude:{},partner_longitude:{},};for(const fieldName of fieldNames){specification[fieldName]={};if(fieldName==="id"&&metaData.resPartnerField==="id"){Object.assign(specification,fieldsToAdd);}else if(["many2one","one2many","many2many"].includes(metaData.fields[fieldName].type)){specification[fieldName].fields={display_name:{}};if(fieldName===metaData.resPartnerField){Object.assign(specification[fieldName].fields,fieldsToAdd);}}}
return specification;}
_fetchRecordData(metaData,data){const specification=this._getRecordSpecification(metaData,data);return this.orm.webSearchRead(metaData.resModel,metaData.domain,{specification,limit:metaData.limit,offset:metaData.offset,order:orderByToString(metaData.defaultOrder||[]),context:metaData.context,});}
_fetchCoordinatesFromAddressMB(metaData,data,record){const address=encodeURIComponent(record.contact_address_complete);const token=metaData.mapBoxToken;const encodedUrl=`https://api.mapbox.com/geocoding/v5/mapbox.places/${address}.json?access_token=${token}&cachebuster=1552314159970&autocomplete=true`;return this.http.get(encodedUrl);}
_fetchCoordinatesFromAddressOSM(metaData,data,record){const address=encodeURIComponent(record.contact_address_complete.replace("/"," "));const encodedUrl=`https://nominatim.openstreetmap.org/search?q=${address}&format=jsonv2`;return this.http.get(encodedUrl);}
_fetchRoute(metaData,data){const coordinatesParam=data.records.filter((record)=>record.partner&&record.partner.partner_latitude&&record.partner.partner_longitude).map(({partner})=>`${partner.partner_longitude},${partner.partner_latitude}`);const address=encodeURIComponent(coordinatesParam.join(";"));const token=metaData.mapBoxToken;const encodedUrl=`https://api.mapbox.com/directions/v5/mapbox/driving/${address}?access_token=${token}&steps=true&geometries=geojson`;return this.http.get(encodedUrl);}
_getErrorMessage(message){const ERROR_MESSAGES={"Too many coordinates; maximum number of coordinates is 25":_t("Too many routing points (maximum 25)"),"Route exceeds maximum distance limitation":_t("Some routing points are too far apart"),"Too Many Requests":_t("Too many requests, try again in a few minutes"),};return ERROR_MESSAGES[message];}
async _getRecordGroups(metaData,data){const[fieldName,subGroup]=data.groupByKey.split(":");const fieldType=metaData.fields[fieldName].type;const unsetName=metaData.fields[fieldName].falsy_value_label||_t("None");const groups={};function addToGroup(id,name,record){if(!groups[id]){groups[id]={name,records:[],};}
groups[id].records.push(record);}
for(const record of data.records){const value=record[fieldName];let id,name;if(["one2many","many2many"].includes(fieldType)){if(value.length){for(const r of value){addToGroup(r.id,r.display_name,record);}}else{id=name=unsetName;addToGroup(id,name,record);}}else{if(["date","datetime"].includes(fieldType)&&value){const date=fieldType==="date"?parseDate(value):parseDateTime(value);id=name=date.toFormat(DATE_GROUP_FORMATS[subGroup||"month"]);}else if(fieldType==="boolean"){id=name=value?_t("Yes"):_t("No");}else if(fieldType==="integer"){id=name=value||"0";}else if(fieldType==="selection"){const selected=metaData.fields[fieldName].selection.find((o)=>o[0]===value);id=name=selected?selected[1]:value;}else if(fieldType==="many2one"&&value){id=value.id;name=value.display_name;}else{id=value;name=value;}
if(!id&&!name){id=name=unsetName;}
addToGroup(id,name,record);}}
return groups;}
_maxBoxAPI(metaData,data){const promises=[];for(const partner of Object.values(data.partners)){if(partner.contact_address_complete&&(!partner.partner_latitude||!partner.partner_longitude)){promises.push(this._fetchCoordinatesFromAddressMB(metaData,data,partner).then((coordinates)=>{if(coordinates.features.length){partner.partner_longitude=parseFloat(coordinates.features[0].geometry.coordinates[0]);partner.partner_latitude=parseFloat(coordinates.features[0].geometry.coordinates[1]);data.partnerToCache.push(partner);}}));}else if(!this._checkCoordinatesValidity(partner)){partner.partner_latitude=undefined;partner.partner_longitude=undefined;}}
return Promise.all(promises).then(()=>{data.routes=[];if(data.numberOfLocatedRecords>1&&metaData.routing&&!data.groupByKey){return this._fetchRoute(metaData,data).then((routeResult)=>{if(routeResult.routes){data.routes=routeResult.routes;}else{data.routingError=this._getErrorMessage(routeResult.message);}});}else{return Promise.resolve();}});}
_mapBoxErrorHandling(metaData,data,err){switch(err.status){case 401:this.notification.add(_t("The view has switched to another provider but functionalities will be limited"),{title:_t("Token invalid"),type:"danger",});break;case 403:this.notification.add(_t("The view has switched to another provider but functionalities will be limited"),{title:_t("Unauthorized connection"),type:"danger",});break;case 422:case 429:data.routingError=this._getErrorMessage(err.responseJSON.message);break;case 500:this.notification.add(_t("The view has switched to another provider but functionalities will be limited"),{title:_t("MapBox servers unreachable"),type:"danger",});}}
_notifyFetchedCoordinate(metaData,data){this._writeCoordinatesUsers(metaData,data);data.shouldUpdatePosition=false;this.notify();}
_openStreetMapAPI(metaData,data){this._openStreetMapAPIAsync(metaData,data);return Promise.resolve();}
_openStreetMapAPIAsync(metaData,data){const addressPartnerMap=new Map();for(const partner of Object.values(data.partners)){if(partner.contact_address_complete&&(!partner.partner_latitude||!partner.partner_longitude)){if(!addressPartnerMap.has(partner.contact_address_complete)){addressPartnerMap.set(partner.contact_address_complete,[]);}
addressPartnerMap.get(partner.contact_address_complete).push(partner);partner.fetchingCoordinate=true;}else if(!this._checkCoordinatesValidity(partner)){partner.partner_latitude=undefined;partner.partner_longitude=undefined;}}
data.fetchingCoordinates=addressPartnerMap.size>0;this.shouldFetchCoordinates=true;const fetch=async()=>{const partnersList=Array.from(addressPartnerMap.values());for(let i=0;i<partnersList.length;i++){await new Promise((resolve)=>{this.coordinateFetchingTimeoutHandle=browser.setTimeout(resolve,this.constructor.COORDINATE_FETCH_DELAY);});if(!this.shouldFetchCoordinates){return;}
const partners=partnersList[i];try{const coordinates=await this._fetchCoordinatesFromAddressOSM(metaData,data,partners[0]);if(!this.shouldFetchCoordinates){return;}
if(coordinates.length){for(const partner of partners){partner.partner_longitude=parseFloat(coordinates[0].lon);partner.partner_latitude=parseFloat(coordinates[0].lat);data.partnerToCache.push(partner);}}
for(const partner of partners){partner.fetchingCoordinate=false;}
data.fetchingCoordinates=i<partnersList.length-1;this._notifyFetchedCoordinate(metaData,data);}catch{for(const partner of Object.values(data.partners)){partner.fetchingCoordinate=false;}
data.fetchingCoordinates=false;this.shouldFetchCoordinates=false;this.notification.add(_t("OpenStreetMap's request limit exceeded, try again later."),{type:"danger"});this.notify();}}};return fetch();}
async _updatePartnerCoordinate(metaData,data){if(data.useMapBoxAPI){return this.keepLast.add(this._maxBoxAPI(metaData,data)).then(()=>{this._writeCoordinatesUsers(metaData,data);}).catch((err)=>{this._mapBoxErrorHandling(metaData,data,err);data.useMapBoxAPI=false;return this._openStreetMapAPI(metaData,data);});}else{return this._openStreetMapAPI(metaData,data).then(()=>{this._writeCoordinatesUsers(metaData,data);});}}
async _writeCoordinatesUsers(metaData,data){const partners=data.partnerToCache;data.partnerToCache=[];if(partners.length){await this.orm.call("res.partner","update_latitude_longitude",[partners],{context:metaData.context,});}}}
MapModel.services=["notification","http"];MapModel.COORDINATE_FETCH_DELAY=1000;return __exports;});;

/* /web_map/static/src/map_view/map_renderer.js */
odoo.define('@web_map/map_view/map_renderer',['@web/core/l10n/translation','@web/core/utils/render','@web/core/utils/concurrency','@web/core/browser/feature_detection','@odoo/owl','@web/core/utils/sortable_owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_map",...args);const{renderToString}=require("@web/core/utils/render");const{delay}=require("@web/core/utils/concurrency");const{isMacOS}=require("@web/core/browser/feature_detection");const{Component,onWillUnmount,onWillUpdateProps,useEffect,useRef,useState,}=require("@odoo/owl");const{useSortable}=require("@web/core/utils/sortable_owl");const apiTilesRouteWithToken="https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}";const apiTilesRouteWithoutToken="https://a.tile.openstreetmap.org/{z}/{x}/{y}.png";const colors=["#F06050","#6CC1ED","#F7CD1F","#814968","#30C381","#D6145F","#475577","#F4A460","#EB7E7F","#2C8397",];const mapTileAttribution=`
     <a href="https://www.mapbox.com/about/maps/">Mapbox</a>
     <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>
    <strong>
        <a href="https://www.mapbox.com/map-feedback/" target="_blank">
            Improve this map
        </a>
    </strong>`;const MapRenderer=__exports.MapRenderer=class MapRenderer extends Component{static template="web_map.MapRenderer";static markerPopupTemplate="web_map.markerPopup";static props={model:Object,onMarkerClick:Function,};static subTemplates={PinListContainer:"web_map.MapRenderer.PinListContainer",PinList:"web_map.MapRenderer.PinList",PinListItems:"web_map.MapRenderer.PinListItems",RountingUnavailable:"web_map.MapRenderer.RountingUnavailable",FetchingCoordinates:"web_map.MapRenderer.FetchingCoordinates",NoMapToken:"web_map.MapRenderer.NoMapToken",};get subTemplates(){return this.constructor.subTemplates;}
setup(){this.leafletMap=null;this.markers=[];this.polylines=[];this.mapContainerRef=useRef("mapContainer");this.state=useState({closedGroupIds:[],expendedPinList:false,});this.nextId=1;useEffect(()=>{this.leafletMap=L.map(this.mapContainerRef.el,{maxBounds:[L.latLng(180,-180),L.latLng(-180,180)],});this.leafletMap.attributionControl.setPrefix('<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">Leaflet</a>');L.tileLayer(this.apiTilesRoute,{attribution:mapTileAttribution,tileSize:512,zoomOffset:-1,minZoom:2,maxZoom:19,id:"mapbox/streets-v11",accessToken:this.props.model.metaData.mapBoxToken,}).addTo(this.leafletMap);},()=>[]);useEffect(()=>{this.updateMap();});this.pinListRef=useRef("pinList");useSortable({enable:()=>this.props.model.canResequence,ref:this.pinListRef,elements:".o-map-renderer--pin-located",handle:".o_row_handle",onDrop:async(params)=>{const rowId=parseInt(params.element.dataset.id);const previousRowId=parseInt(params.previous?.dataset?.id)||null;await this.props.model.resequence(rowId,previousRowId);},});onWillUpdateProps(this.onWillUpdateProps);onWillUnmount(this.onWillUnmount);}
async onWillUpdateProps(nextProps){if(this.props.model.data.groupByKey!==nextProps.model.data.groupByKey){this.state.closedGroupIds=[];}}
onWillUnmount(){this.removeMarkers();this.removeRoutes();if(this.leafletMap){this.leafletMap.remove();}}
get apiTilesRoute(){return this.props.model.data.useMapBoxAPI?apiTilesRouteWithToken:apiTilesRouteWithoutToken;}
addMarkers(){this.removeMarkers();const markersInfo={};let records=this.props.model.data.records;if(this.props.model.data.isGrouped){records=Object.entries(this.props.model.data.recordGroups).filter(([key])=>!this.state.closedGroupIds.includes(key)).flatMap(([groupId,value])=>value.records.map((elem)=>({...elem,groupId})));}
const pinInSamePlace={};for(const record of records){const partner=record.partner;if(partner&&partner.partner_latitude&&partner.partner_longitude){const lat_long=`${partner.partner_latitude}-${partner.partner_longitude}`;const group=this.props.model.data.recordGroups?`-${record.groupId}`:"";const key=`${lat_long}${group}`;if(key in markersInfo){markersInfo[key].record=record;markersInfo[key].relatedRecords.push(record);markersInfo[key].ids.push(record.id);}else{pinInSamePlace[lat_long]=++pinInSamePlace[lat_long]||0;markersInfo[key]={record:record,ids:[record.id],pinInSamePlace:pinInSamePlace[lat_long],relatedRecords:[],};}}}
for(const markerInfo of Object.values(markersInfo)){const params={count:markerInfo.ids.length,isMulti:markerInfo.ids.length>1,number:this.props.model.data.records.indexOf(markerInfo.record)+1,numbering:this.props.model.metaData.numbering,};if(this.props.model.data.isGrouped){const groupId=markerInfo.record.groupId;params.color=this.getGroupColor(groupId);params.number=this.props.model.data.recordGroups[groupId].records.findIndex((record)=>record.id===markerInfo.record.id)+1;}
const iconInfo={className:"o-map-renderer--marker",html:renderToString("web_map.marker",params),};const offset=markerInfo.pinInSamePlace*0.000025;const marker=L.marker([markerInfo.record.partner.partner_latitude+offset,markerInfo.record.partner.partner_longitude-offset,],{icon:L.divIcon(iconInfo)});marker.addTo(this.leafletMap);marker.on("click",()=>{this.createMarkerPopup(markerInfo,offset);});this.markers.push(marker);}}
addRoutes(){this.removeRoutes();if(!this.props.model.data.useMapBoxAPI||!this.props.model.data.routes.length){return;}
for(const leg of this.props.model.data.routes[0].legs){const latLngs=[];for(const step of leg.steps){for(const coordinate of step.geometry.coordinates){latLngs.push(L.latLng(coordinate[1],coordinate[0]));}}
const polyline=L.polyline(latLngs,{color:"blue",weight:5,opacity:0.3,}).addTo(this.leafletMap);const polylines=this.polylines;polyline.on("click",function(){for(const polyline of polylines){polyline.setStyle({color:"blue",opacity:0.3});}
this.setStyle({color:"darkblue",opacity:1.0});});this.polylines.push(polyline);}}
createMarkerPopup(markerInfo,latLongOffset=0){const popupData=this.getMarkerPopupData(markerInfo);const partner=markerInfo.record.partner;const encodedAddress=encodeURIComponent(partner.contact_address_complete);const popupHtml=renderToString(this.constructor.markerPopupTemplate,{data:popupData,hasFormView:this.props.model.metaData.hasFormView,url:`https://www.google.com/maps/dir/?api=1&destination=${encodedAddress}`,});const popup=L.popup({offset:[0,-30]}).setLatLng([partner.partner_latitude+latLongOffset,partner.partner_longitude-latLongOffset,]).setContent(popupHtml).openOn(this.leafletMap);const openBtn=popup.getElement().querySelector("button.o-map-renderer--popup-buttons-open");if(openBtn){openBtn.onclick=(ev)=>{if(ev.button===0||ev.button===1){const ctrlKey=isMacOS()?ev.metaKey:ev.ctrlKey;const isMiddleClick=(ctrlKey&&ev.button===0)||ev.button===1;this.props.onMarkerClick(markerInfo.ids,isMiddleClick);}};openBtn.onauxclick=(ev)=>{if(ev.button===0||ev.button===1){const ctrlKey=isMacOS()?ev.metaKey:ev.ctrlKey;const isMiddleClick=(ctrlKey&&ev.button===0)||ev.button===1;this.props.onMarkerClick(markerInfo.ids,isMiddleClick);}};}
return popup;}
getGroupColor(groupId){const index=Object.keys(this.props.model.data.recordGroups).indexOf(groupId);return colors[index%colors.length];}
getLatLng(){const tabLatLng=[];for(const record of this.props.model.data.records){const partner=record.partner;if(partner&&partner.partner_latitude&&partner.partner_longitude){tabLatLng.push(L.latLng(partner.partner_latitude,partner.partner_longitude));}}
if(!tabLatLng.length){return false;}
return L.latLngBounds(tabLatLng);}
getMarkerPopupRecordData(record){const fieldsView=[];if(!this.props.model.metaData.hideName){fieldsView.push({id:this.nextId++,value:record.display_name,string:_t("Name"),});}
if(!this.props.model.metaData.hideAddress){fieldsView.push({id:this.nextId++,value:record.partner.contact_address_complete,string:_t("Address"),});}
const fields=this.props.model.metaData.fields;for(const field of this.props.model.metaData.fieldNamesMarkerPopup){if(record[field.fieldName]){let value=record[field.fieldName];if(fields[field.fieldName].type==="many2one"){value=record[field.fieldName].display_name;}else if(["one2many","many2many"].includes(fields[field.fieldName].type)){value=record[field.fieldName]?record[field.fieldName].map((r)=>r.display_name).join(", "):"";}
fieldsView.push({id:this.nextId++,value,string:field.string,});}}
return fieldsView;}
getMarkerPopupData(markerInfo){const record=markerInfo.record;if(markerInfo.ids.length>1){const fieldsView=[];if(!this.props.model.metaData.hideAddress){fieldsView.push({id:this.nextId++,value:record.partner.contact_address_complete,string:_t("Address"),});}
return fieldsView;}
const fieldsView=this.getMarkerPopupRecordData(record);return fieldsView;}
get googleMapUrl(){let url="https://www.google.com/maps/dir/?api=1";if(this.props.model.data.records.length){const allAddresses=this.props.model.data.records.filter(({partner})=>partner&&partner.contact_address_complete);const uniqueAddresses=allAddresses.reduce((addrs,{partner})=>{const addr=encodeURIComponent(partner.contact_address_complete);if(!addrs.includes(addr)){addrs.push(addr);}
return addrs;},[]);if(uniqueAddresses.length&&this.props.model.metaData.routing){url+=`&destination=${uniqueAddresses.pop()}`;}
if(uniqueAddresses.length){url+=`&waypoints=${uniqueAddresses.join("|")}`;}}
return url;}
removeMarkers(){for(const marker of this.markers){marker.off("click");this.leafletMap.removeLayer(marker);}
this.markers=[];}
removeRoutes(){for(const polyline of this.polylines){polyline.off("click");this.leafletMap.removeLayer(polyline);}
this.polylines=[];}
updateMap(){if(this.props.model.data.shouldUpdatePosition){const initialCoord=this.getLatLng();if(initialCoord){this.leafletMap.flyToBounds(initialCoord,{animate:false});}else{this.leafletMap.fitWorld();}
this.leafletMap.closePopup();}
this.addMarkers();this.addRoutes();}
async centerAndOpenPin(record){this.state.expendedPinList=false;await delay(0);const popup=this.createMarkerPopup({record:record,ids:[record.id],relatedRecords:[],});const px=this.leafletMap.project([record.partner.partner_latitude,record.partner.partner_longitude,]);const popupHeight=popup.getElement().offsetHeight;px.y-=popupHeight/2;const latlng=this.leafletMap.unproject(px);this.leafletMap.panTo(latlng,{animate:true});}
toggleGroup(id){if(this.state.closedGroupIds.includes(id)){const index=this.state.closedGroupIds.indexOf(id);this.state.closedGroupIds.splice(index,1);}else{this.state.closedGroupIds.push(id);}}
togglePinList(){this.state.expendedPinList=!this.state.expendedPinList;}
get expendedPinList(){return this.env.isSmall?this.state.expendedPinList:false;}
get canDisplayPinList(){return!this.env.isSmall||this.expendedPinList;}}
return __exports;});;

/* /web_map/static/src/map_view/map_view.js */
odoo.define('@web_map/map_view/map_view',['@web/core/l10n/translation','@web/core/registry','@web_map/map_view/map_arch_parser','@web_map/map_view/map_model','@web_map/map_view/map_controller','@web_map/map_view/map_renderer'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_map",...args);const{registry}=require("@web/core/registry");const{MapArchParser}=require("@web_map/map_view/map_arch_parser");const{MapModel}=require("@web_map/map_view/map_model");const{MapController}=require("@web_map/map_view/map_controller");const{MapRenderer}=require("@web_map/map_view/map_renderer");const mapView=__exports.mapView={type:"map",Controller:MapController,Renderer:MapRenderer,Model:MapModel,ArchParser:MapArchParser,buttonTemplate:"web_map.MapView.Buttons",props:(genericProps,view,config)=>{let modelParams=genericProps.state;if(!modelParams){const{arch,resModel,fields,context}=genericProps;const parser=new view.ArchParser();const archInfo=parser.parse(arch);const views=config.views||[];modelParams={allowResequence:archInfo.allowResequence||false,context,defaultOrder:archInfo.defaultOrder,fieldNames:archInfo.fieldNames,fieldNamesMarkerPopup:archInfo.fieldNamesMarkerPopup,fields,hasFormView:views.some((view)=>view[1]==="form"),hideAddress:archInfo.hideAddress||false,hideName:archInfo.hideName||false,hideTitle:archInfo.hideTitle||false,limit:archInfo.limit||80,numbering:archInfo.routing||false,offset:0,panelTitle:archInfo.panelTitle||config.getDisplayName()||_t("Items"),resModel,resPartnerField:archInfo.resPartnerField,routing:archInfo.routing||false,};}
return{...genericProps,Model:view.Model,modelParams,Renderer:view.Renderer,buttonTemplate:view.buttonTemplate,};},};registry.category("views").add("map",mapView);return __exports;});;

/* /web_gantt/static/src/gantt_arch_parser.js */
odoo.define('@web_gantt/gantt_arch_parser',['@web/core/l10n/dates','@web/core/l10n/translation','@web/core/py_js/py','@web/core/utils/objects','@web/core/utils/strings','@web/core/utils/xml','@web/views/utils','@web_gantt/gantt_helpers'],function(require){'use strict';let __exports={};const{getLocalYearAndWeek,today}=require("@web/core/l10n/dates");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_gantt",...args);const{evaluateExpr}=require("@web/core/py_js/py");const{omit}=require("@web/core/utils/objects");const{exprToBoolean}=require("@web/core/utils/strings");const{visitXML}=require("@web/core/utils/xml");const{getActiveActions}=require("@web/views/utils");const{diffColumn}=require("@web_gantt/gantt_helpers");const DECORATIONS=["decoration-danger","decoration-info","decoration-secondary","decoration-success","decoration-warning",];const PARTS={full:1,half:2,quarter:4};const SCALES={day:{cellPrecisions:{full:60,half:30,quarter:15},defaultPrecision:"full",time:"minute",unitDescription:_t("minutes"),interval:"hour",minimalColumnWidth:40,colHeaderTitle:(date)=>date.toFormat("DDDD, t"),unit:"day",groupHeaderFormatter:(date)=>date.toFormat("DDD"),groupHeaderTitle:(date)=>date.toFormat("DDDD"),},week:{cellPrecisions:{full:24,half:12},defaultPrecision:"half",time:"hour",unitDescription:_t("hours"),interval:"day",minimalColumnWidth:192,colHeaderFormatter:(date)=>date.toFormat("cccc d"),colHeaderTitle:(date)=>date.toFormat("DDDD"),unit:"week",groupHeaderFormatter:formatLocalWeekYear,groupHeaderTitle:formatLocalWeekYear,},month:{cellPrecisions:{full:24,half:12},defaultPrecision:"half",time:"hour",unitDescription:_t("hours"),interval:"day",minimalColumnWidth:52,colHeaderFormatter:(date)=>date.toFormat("dd"),colHeaderTitle:(date)=>date.toFormat("DDDD"),unit:"month",groupHeaderFormatter:(date,env)=>date.toFormat(env.isSmall?"MMM yyyy":"MMMM yyyy"),groupHeaderTitle:(date,env)=>date.toFormat(env.isSmall?"MMM yyyy":"MMMM yyyy"),},year:{cellPrecisions:{full:1},defaultPrecision:"full",time:"month",unitDescription:_t("months"),interval:"month",minimalColumnWidth:100,colHeaderFormatter:(date,env)=>date.toFormat(env.isSmall?"MMM":"MMMM"),colHeaderTitle:(date,env)=>date.toFormat(env.isSmall?"MMM yyyy":"MMMM yyyy"),unit:"year",groupHeaderFormatter:(date)=>date.toFormat("yyyy"),groupHeaderTitle:(date)=>date.toFormat("yyyy"),},};const RESCHEDULE_METHODS={manual:"Manual Reschedule",consumeBuffer:"Auto-Reschedule (Use Buffer)",maintainBuffer:"Auto-Reschedule (Keep Buffer)",};function formatLocalWeekYear(date){const{year,week,startDate}=getLocalYearAndWeek(date);let result=_t(`Week %(week)s, %(startDate)s - %(endDate)s`,{week,startDate:startDate.toLocaleString({month:"short",day:"numeric"}),endDate:startDate.plus({days:6}).toLocaleString({month:"short",day:"numeric"}),});if(today().year!==year){result+=` ${year}`;}
return result;}
function getPreferedScaleId(scaleId,scales){if(scaleId in scales){return scaleId;}
const scaleIds=Object.keys(SCALES);const index=scaleIds.findIndex((id)=>id===scaleId);for(let j=index-1;j>=0;j--){const id=scaleIds[j];if(id in scales){return id;}}
for(let j=index+1;j<scaleIds.length;j++){const id=scaleIds[j];if(id in scales){return id;}}}
__exports.getScaleForCustomRange=getScaleForCustomRange;function getScaleForCustomRange(params){const{scales,startDate,stopDate}=params;const lengthInDays=diffColumn(startDate,stopDate,"day");let unit;if(lengthInDays<6){unit="day";}else if(lengthInDays<27){unit="week";}else if(lengthInDays<364){unit="month";}else{unit="year";}
const scaleId=getPreferedScaleId(unit,scales);return scales[scaleId];}
const RANGES={day:{scaleId:"day",description:_t("Day")},week:{scaleId:"week",description:_t("Week")},month:{scaleId:"month",description:_t("Month")},quarter:{scaleId:"month",description:_t("Quarter")},year:{scaleId:"year",description:_t("Year")},};const GanttArchParser=__exports.GanttArchParser=class GanttArchParser{parse(arch){let infoFromRootNode;const decorationFields=[];const popoverArchParams={displayGenericButtons:true,bodyTemplate:null,footerTemplate:null,};visitXML(arch,(node)=>{switch(node.tagName){case"gantt":{infoFromRootNode=getInfoFromRootNode(node);break;}
case"field":{const fieldName=node.getAttribute("name");decorationFields.push(fieldName);break;}
case"templates":{const body=node.querySelector("[t-name=gantt-popover]")||null;if(body){popoverArchParams.bodyTemplate=body.cloneNode(true);popoverArchParams.bodyTemplate.removeAttribute("t-name");const footer=popoverArchParams.bodyTemplate.querySelector("footer");if(footer){popoverArchParams.displayGenericButtons=false;footer.remove();const footerTemplate=new Document().createElement("t");footerTemplate.append(...footer.children);popoverArchParams.footerTemplate=footerTemplate;const replace=footer.getAttribute("replace");if(replace&&!exprToBoolean(replace)){popoverArchParams.displayGenericButtons=true;}}
let hasRemainingChild=false;for(const child of popoverArchParams.bodyTemplate.childNodes){if(child.nodeType===8){continue;}
if(child.nodeType===3&&!child.data.trim()){continue;}
hasRemainingChild=true;break;}
if(!hasRemainingChild){delete popoverArchParams.bodyTemplate;}}}}});return{...infoFromRootNode,decorationFields,popoverArchParams,};}}
function getInfoFromRootNode(rootNode){const attrs={};for(const{name,value}of rootNode.attributes){attrs[name]=value;}
const{create:canCreate,delete:canDelete,edit:canEdit}=getActiveActions(rootNode);const canCellCreate=exprToBoolean(attrs.cell_create,true)&&canCreate;const canPlan=exprToBoolean(attrs.plan,true)&&canEdit;let consolidationMaxField;let consolidationMaxValue;const consolidationMax=attrs.consolidation_max?evaluateExpr(attrs.consolidation_max):{};if(Object.keys(consolidationMax).length>0){consolidationMaxField=Object.keys(consolidationMax)[0];consolidationMaxValue=consolidationMax[consolidationMaxField];}
const consolidationParams={excludeField:attrs.consolidation_exclude,field:attrs.consolidation,maxField:consolidationMaxField,maxValue:consolidationMaxValue,};const dependencyField=attrs.dependency_field||null;const dependencyEnabled=!!dependencyField;const dependencyInvertedField=attrs.dependency_inverted_field||null;const allowedRanges=new Set();if(attrs.scales){for(const key of attrs.scales.split(",")){if(RANGES[key]){allowedRanges.add(key);}}}
if(allowedRanges.size===0){for(const rangeId in RANGES){allowedRanges.add(rangeId);}}
let defaultRange=attrs.default_range||attrs.default_scale;if(defaultRange&&RANGES[defaultRange]){if(!allowedRanges.has(defaultRange)){allowedRanges.add(defaultRange);}}else{defaultRange="custom";}
const cellPrecisions={};const precisionAttrs=attrs.precision?evaluateExpr(attrs.precision):{};for(const scaleId in SCALES){if(precisionAttrs[scaleId]){const precision=precisionAttrs[scaleId].split(":");if(precision[1]&&Object.keys(SCALES[scaleId].cellPrecisions).includes(precision[1])){cellPrecisions[scaleId]=precision[1];}}
cellPrecisions[scaleId]||=SCALES[scaleId].defaultPrecision;}
function getScale(scaleId){const precision=cellPrecisions[scaleId];const referenceScale=SCALES[scaleId];return{...omit(referenceScale,"cellPrecisions"),cellPart:PARTS[precision],cellTime:referenceScale.cellPrecisions[precision],id:scaleId,unitDescription:referenceScale.unitDescription.toString(),};}
const scales={};const ranges={};for(const rangeId in RANGES){if(!allowedRanges.has(rangeId)){continue;}
const{scaleId,description}=RANGES[rangeId];ranges[rangeId]={scaleId,id:rangeId,description:description.toString(),};scales[rangeId]=getScale(scaleId);}
let pillDecorations=null;for(const decoration of DECORATIONS){if(decoration in attrs){if(!pillDecorations){pillDecorations={};}
pillDecorations[decoration]=attrs[decoration];}}
return{canCellCreate,canCreate,canDelete,canEdit,canPlan,colorField:attrs.color,computePillDisplayName:!!attrs.pill_label,consolidationParams,createAction:attrs.on_create||null,dateStartField:attrs.date_start,dateStopField:attrs.date_stop,defaultRange,dependencyEnabled,dependencyField,dependencyInvertedField,disableDrag:exprToBoolean(attrs.disable_drag_drop),displayMode:attrs.display_mode||"dense",displayTotalRow:exprToBoolean(attrs.total_row),displayUnavailability:exprToBoolean(attrs.display_unavailability),formViewId:attrs.form_view_id?parseInt(attrs.form_view_id,10):false,kanbanViewId:attrs.kanban_view_id?evaluateExpr(attrs.kanban_view_id):null,multiCreateView:attrs.multi_create_view||null,pagerLimit:attrs.groups_limit?parseInt(attrs.groups_limit,10):null,pillDecorations,progressBarFields:attrs.progress_bar?attrs.progress_bar.split(","):null,progressField:attrs.progress||null,ranges,scales,string:attrs.string||_t("Gantt View").toString(),thumbnails:attrs.thumbnails?evaluateExpr(attrs.thumbnails):{},rescheduleMethods:RESCHEDULE_METHODS,defaultRescheduleMethod:"maintainBuffer",};}
return __exports;});;

/* /web_gantt/static/src/gantt_compiler.js */
odoo.define('@web_gantt/gantt_compiler',['@web/views/view_compiler'],function(require){'use strict';let __exports={};const{ViewCompiler}=require("@web/views/view_compiler");const GanttCompiler=__exports.GanttCompiler=class GanttCompiler extends ViewCompiler{}
GanttCompiler.OWL_DIRECTIVE_WHITELIST=[...ViewCompiler.OWL_DIRECTIVE_WHITELIST,"t-name","t-esc","t-out","t-set","t-value","t-if","t-else","t-elif","t-foreach","t-as","t-key","t-att.*","t-call",];return __exports;});;

/* /web_gantt/static/src/gantt_connector.js */
odoo.define('@web_gantt/gantt_connector',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component,onWillRender,useEffect,useRef}=require("@odoo/owl");__exports.getStrokeAndHoveredStrokeColor=getStrokeAndHoveredStrokeColor;function getStrokeAndHoveredStrokeColor(r,g,b){return{color:`rgba(${r},${g},${b},0.5)`,highlightedColor:`rgba(${r},${g},${b},1)`,};}
const COLORS=__exports.COLORS={default:getStrokeAndHoveredStrokeColor(143,143,143),error:getStrokeAndHoveredStrokeColor(211,65,59),warning:getStrokeAndHoveredStrokeColor(236,151,31),outline:getStrokeAndHoveredStrokeColor(255,255,255),};const GanttConnector=__exports.GanttConnector=class GanttConnector extends Component{static props={reactive:{type:Object,shape:{id:String,alert:{type:[{value:"error"},{value:"warning"},{value:null}],optional:true,},highlighted:{type:Boolean,optional:true},displayButtons:{type:Boolean,optional:true},sourcePoint:[{value:null},Function,{type:Object,shape:{left:Number,top:Number}},],targetPoint:[{value:null},Function,{type:Object,shape:{left:Number,top:Number}},],dashed:{type:Boolean,optional:true},},},onRemoveButtonClick:{type:Function,optional:true},onConnectorHover:{type:Function},};static defaultProps={highlighted:false,displayButtons:false,};static template="web_gantt.GanttConnector";rootRef=useRef("root");style={hoverEaseWidth:10,slackness:0.9,stroke:{width:2},outlineStroke:{width:1},};get alert(){return this.props.reactive.alert;}
get displayButtons(){return this.props.reactive.displayButtons;}
get highlighted(){return this.props.reactive.highlighted;}
get id(){return this.props.reactive.id;}
get isNew(){return this.id.endsWith("new");}
get sourcePoint(){return this.props.reactive.sourcePoint;}
get targetPoint(){return this.props.reactive.targetPoint;}
get isDashed(){return this.props.reactive.dashed;}
setup(){onWillRender(this.onWillRender);useEffect((el,sourceLeft,sourceTop,targetLeft,targetTop)=>{if(!el){return;}
const{sourceControlPoint,targetControlPoint,removeButtonPosition}=this.getPathInfo({left:sourceLeft,top:sourceTop},{left:targetLeft,top:targetTop},this.style.slackness);const drawingCommands=[`M`,`${sourceLeft},${sourceTop}`,`C`,`${sourceControlPoint.left},${sourceControlPoint.top}`,`${targetControlPoint.left},${targetControlPoint.top}`,`${targetLeft},${targetTop}`,].join(" ");const paths=el.querySelectorAll(".o_connector_stroke, .o_connector_stroke_hover_ease");for(const path of paths){path.setAttribute("d",drawingCommands);}
const svgButtons=el.querySelector(".o_connector_stroke_buttons");if(svgButtons){svgButtons.setAttribute("x",removeButtonPosition.left-24);svgButtons.setAttribute("y",removeButtonPosition.top-8);}},()=>this.getEffectDependencies());}
computeStyle({alert,highlighted}){const key=highlighted?"highlightedColor":"color";const strokeType=alert||"default";this.style={hoverEaseWidth:10,slackness:0.9,stroke:{color:COLORS[strokeType][key],width:2,},outlineStroke:{color:COLORS.outline[key],width:1,},};}
getEffectDependencies(){let sourcePoint=this.sourcePoint||{left:0,top:0};if(typeof sourcePoint==="function"){sourcePoint=sourcePoint();}
let targetPoint=this.targetPoint||{left:0,top:0};if(typeof targetPoint==="function"){targetPoint=targetPoint();}
const{x,y}=this.rootRef.el?.getBoundingClientRect()||{x:0,y:0};return[this.rootRef.el,sourcePoint.left-x,sourcePoint.top-y,targetPoint.left-x,targetPoint.top-y,this.displayButtons,];}
getLinearInterpolation(startingPoint,endingPoint,lambda=0.5){return{left:lambda*startingPoint.left+(1-lambda)*endingPoint.left,top:lambda*startingPoint.top+(1-lambda)*endingPoint.top,};}
getPathInfo(sourcePoint,targetPoint,slackness){const xDelta=targetPoint.left-sourcePoint.left;const yDelta=targetPoint.top-sourcePoint.top;const directionFactor=Math.sign(xDelta);const xInc=100+(Math.abs(xDelta)*slackness)/10;const yInc=Math.abs(yDelta)<16&&directionFactor===-1?15-0.001*xDelta*slackness:0;const b={left:sourcePoint.left+xInc,top:sourcePoint.top+yInc,};const c={left:targetPoint.left+(this.isNew&&directionFactor===-1?xInc:-xInc),top:targetPoint.top+yInc,};const e=this.getLinearInterpolation(sourcePoint,b);const f=this.getLinearInterpolation(b,c);const g=this.getLinearInterpolation(c,targetPoint);const h=this.getLinearInterpolation(e,f);const i=this.getLinearInterpolation(f,g);const j=this.getLinearInterpolation(h,i);return{sourceControlPoint:b,targetControlPoint:c,removeButtonPosition:j,};}
onRemoveButtonClick(){if(this.props.onRemoveButtonClick){this.props.onRemoveButtonClick();}}
onWillRender(){const key=this.highlighted?"highlightedColor":"color";this.style.outlineStroke.color=COLORS.outline[key];if(this.props.onConnectorHover()&&this.highlighted){this.style.stroke.color='rgba(52, 152, 219,1)';}else{this.style.stroke.color=COLORS[this.alert||"default"][key];}}}
return __exports;});;

/* /web_gantt/static/src/gantt_controller.js */
odoo.define('@web_gantt/gantt_controller',['@web/core/l10n/translation','@odoo/owl','@web/core/confirmation_dialog/confirmation_dialog','@web/views/view_dialogs/form_view_dialog','@web/search/layout','@web/views/standard_view_props','@web/model/model','@web/search/pager_hook','@web/core/utils/hooks','@web/search/search_bar/search_bar','@web/search/search_bar/search_bar_toggler','@web/search/cog_menu/cog_menu','@web/search/action_hook','@web/views/action_helper'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_gantt",...args);const{Component,onWillUnmount,useEffect,useRef,useSubEnv}=require("@odoo/owl");const{deleteConfirmationMessage,ConfirmationDialog,}=require("@web/core/confirmation_dialog/confirmation_dialog");const{FormViewDialog}=require("@web/views/view_dialogs/form_view_dialog");const{Layout}=require("@web/search/layout");const{standardViewProps}=require("@web/views/standard_view_props");const{useModelWithSampleData}=require("@web/model/model");const{usePager}=require("@web/search/pager_hook");const{useService}=require("@web/core/utils/hooks");const{SearchBar}=require("@web/search/search_bar/search_bar");const{useSearchBarToggler}=require("@web/search/search_bar/search_bar_toggler");const{CogMenu}=require("@web/search/cog_menu/cog_menu");const{CallbackRecorder,useSetupAction}=require("@web/search/action_hook");const{ActionHelper}=require("@web/views/action_helper");const GanttController=__exports.GanttController=class GanttController extends Component{static components={CogMenu,Layout,SearchBar,ActionHelper,};static props={...standardViewProps,Model:Function,Renderer:Function,buttonTemplate:String,modelParams:Object,multiCreateValues:{type:Object,optional:true},scrollPosition:{type:Object,optional:true},};static template="web_gantt.GanttController";setup(){this.actionService=useService("action");this.dialogService=useService("dialog");this.orm=useService("orm");useSubEnv({getCurrentFocusDateCallBackRecorder:new CallbackRecorder(),createFromSelectionCallBackRecorder:new CallbackRecorder(),});const rootRef=useRef("root");this.model=useModelWithSampleData(this.props.Model,this.props.modelParams);useSetupAction({rootRef,getLocalState:()=>({metaData:this.model.metaData,displayParams:this.model.displayParams,}),});onWillUnmount(()=>this.closeDialog?.());usePager(()=>{const{groupedBy,pagerLimit,pagerOffset}=this.model.metaData;const{count}=this.model.data;if(pagerLimit!==null&&groupedBy.length){return{offset:pagerOffset,limit:pagerLimit,total:count,onUpdate:async({offset,limit})=>{await this.model.updatePagerParams({offset,limit});},};}});useEffect((showNoContentHelp)=>{if(showNoContentHelp){const realRows=[...rootRef.el.querySelectorAll(".o_gantt_row_header:not(.o_sample_data_disabled)"),];const headerContainerWidth=rootRef.el.querySelector(".o_gantt_header_groups").clientHeight+
rootRef.el.querySelector(".o_gantt_header_columns").clientHeight;const offset=realRows.reduce((current,el)=>current+el.clientHeight,headerContainerWidth);const noContentHelperEl=rootRef.el.querySelector(".o_view_nocontent");noContentHelperEl.style.top=`${offset}px`;}},()=>[this.showNoContentHelp]);this.searchBarToggler=useSearchBarToggler();}
get className(){if(this.env.isSmall){const classList=(this.props.className||"").split(" ");classList.push("o_action_delegate_scroll");return classList.join(" ");}
return this.props.className;}
get showNoContentHelp(){return this.model.useSampleModel;}
create(context){const{createAction}=this.model.metaData;if(createAction){this.actionService.doAction(createAction,{additionalContext:context,onClose:()=>{this.model.fetchData();},});}else{this.openDialog({context});}}
_getDialogProps(props){const{canDelete,canEdit,resModel,formViewId:viewId}=this.model.metaData;const title=props.title||(props.resId?_t("Open"):_t("Create"));let removeRecord;if(canDelete&&props.resId){removeRecord=()=>new Promise((resolve)=>{this.dialogService.add(ConfirmationDialog,{title:_t("Bye-bye, record!"),body:deleteConfirmationMessage,confirmLabel:_t("Delete"),confirm:async()=>{await this.orm.unlink(resModel,[props.resId]);resolve();},cancel:()=>{},cancelLabel:_t("No, keep it"),});});}
return{title,resModel,viewId,resId:props.resId,size:props.size,canExpand:props.canExpand,readonly:!canEdit,context:props.context,removeRecord,};}
openDialog(props,options={},dialogComponent=FormViewDialog){this.closeDialog=this.dialogService.add(dialogComponent,this._getDialogProps(props),{...options,onClose:()=>{this.closeDialog=null;this.model.fetchData();},});}
_onNewClicked(){const context=this.getAdditionalContext();this.create(context);}
onNewClicked(){const created=this.createFromSelection();if(!created){this._onNewClicked();}}
getAdditionalContext(){const{scale}=this.model.metaData;const focusDate=this.getCurrentFocusDate();const start=focusDate.startOf(scale.unit);const stop=focusDate.endOf(scale.unit).plus({millisecond:1});return this.model.getDialogContext({start,stop,withDefault:true});}
createFromSelection(){const{callbacks}=this.env.createFromSelectionCallBackRecorder;if(callbacks.length){return callbacks[0]();}
return false;}
getCurrentFocusDate(){const{callbacks}=this.env.getCurrentFocusDateCallBackRecorder;if(callbacks.length){return callbacks[0]();}
return this.model.metaData.focusDate;}}
return __exports;});;

/* /web_gantt/static/src/gantt_helpers.js */
odoo.define('@web_gantt/gantt_helpers',['@odoo/owl','@web/core/l10n/dates','@web/core/popover/popover_hook','@web/core/utils/draggable_hook_builder_owl','@web/core/utils/hooks','@web/core/utils/numbers','@web/core/utils/objects','@web/core/utils/ui','@web_gantt/gantt_popover_in_dialog'],function(require){'use strict';let __exports={};const{onWillUnmount,status,useComponent,useEffect,useEnv}=require("@odoo/owl");const{getEndOfLocalWeek,getStartOfLocalWeek}=require("@web/core/l10n/dates");const{makePopover,usePopover}=require("@web/core/popover/popover_hook");const{makeDraggableHook}=require("@web/core/utils/draggable_hook_builder_owl");const{useService}=require("@web/core/utils/hooks");const{clamp}=require("@web/core/utils/numbers");const{isObject,pick,shallowEqual}=require("@web/core/utils/objects");const{closest:getClosest}=require("@web/core/utils/ui");const{GanttPopoverInDialog}=require("@web_gantt/gantt_popover_in_dialog");const{DateTime}=luxon;function closest(target,values){return values.reduce((prev,val)=>(Math.abs(val-target)<Math.abs(prev-target)?val:prev),Infinity);}
__exports.dateAddFixedOffset=dateAddFixedOffset;function dateAddFixedOffset(date,plusParams){const shouldApplyOffset=Object.keys(plusParams).some((key)=>/^(hour|minute|second)s?$/i.test(key));const result=date.plus(plusParams);if(shouldApplyOffset){const initialOffset=date.offset;const diff=initialOffset-result.offset;if(diff){const adjusted=result.plus({minute:diff});return adjusted.offset===initialOffset?result:adjusted;}}
return result;}
__exports.diffColumn=diffColumn;function diffColumn(col1,col2,unit){return col2.diff(col1,unit).values[`${unit}s`];}
__exports.localStartOf=localStartOf;function localStartOf(date,unit){return unit==="week"?getStartOfLocalWeek(date):date.startOf(unit);}
__exports.localEndOf=localEndOf;function localEndOf(date,unit){return unit==="week"?getEndOfLocalWeek(date):date.endOf(unit);}
__exports.getCellColor=getCellColor;function getCellColor(cellPart,subSlotUnavailabilities,isToday){const sum=subSlotUnavailabilities.reduce((acc,d)=>acc+d);if(!sum){return null;}
switch(cellPart){case sum:{return`background-color:${getCellPartColor(sum, isToday)}`;}
case 2:{const[c0,c1]=subSlotUnavailabilities.map((d)=>getCellPartColor(d,isToday));return`background:linear-gradient(90deg,${c0}49%,${c1}50%)`;}
case 4:{const[c0,c1,c2,c3]=subSlotUnavailabilities.map((d)=>getCellPartColor(d,isToday));return`background:linear-gradient(90deg,${c0}24%,${c1}25%,${c1}49%,${c2}50%,${c2}74%,${c3}75%)`;}}}
__exports.getCellPartColor=getCellPartColor;function getCellPartColor(availability,isToday){if(availability){return"var(--Gantt__DayOff-background-color)";}else if(isToday){return"var(--Gantt__DayOffToday-background-color)";}else{return"var(--Gantt__Day-background-color)";}}
__exports.getColorIndex=getColorIndex;function getColorIndex(value){if(typeof value==="number"){return Math.round(value)%NB_GANTT_RECORD_COLORS;}else if(isObject(value)){return value.id%NB_GANTT_RECORD_COLORS;}
return 0;}
__exports.getIntersection=getIntersection;function getIntersection(interval,otherInterval){const[start,end]=interval;const[otherStart,otherEnd]=otherInterval;return[start>=otherStart?start:otherStart,end<=otherEnd?end:otherEnd];}
__exports.getUnionOfIntersections=getUnionOfIntersections;function getUnionOfIntersections(interval,intervals){const[start,end]=interval;const intersecting=intervals.filter((otherInterval)=>{const[otheStart,otherEnd]=otherInterval;return otherEnd>start&&end>otheStart;});const len=intersecting.length;if(len===0){return[];}
const union=[];const first=getIntersection(interval,intersecting[0]);union.push(first);if(len>=2){const last=getIntersection(interval,intersecting[len-1]);union.push(...intersecting.slice(1,len-1),last);}
return union;}
__exports.getHoveredCellPart=getHoveredCellPart;function getHoveredCellPart(cell,pointerX,cellPart,rtl){const rect=cell.getBoundingClientRect();const x=Math.floor(rect.x);const width=Math.floor(rect.width);let part=Math.floor((clamp(pointerX,x,x+width-1)-x)/(width/cellPart));part=clamp(part,0,cellPart-1);if(rtl){part=cellPart-1-part;}
return part;}
__exports.getClosestCell=getClosestCell;function getClosestCell(ctx,rowId){const{hoveredCell,pointer,ref,rtl,scale}=ctx;let{el:cell,part}=hoveredCell;if(!cell){const selector=rowId?`.o_gantt_cells .o_gantt_cell:not(.o_drag_hover)[data-row-id='${CSS.escape(rowId)}']`:`.o_gantt_cells .o_gantt_cell:not(.o_drag_hover)`;cell=getClosest(ref.el.querySelectorAll(selector),pointer);part=getHoveredCellPart(cell,pointer.x,scale.cellPart,rtl);}
return{cell,part};}
__exports.useMultiHover=useMultiHover;function useMultiHover({ref,selector,exception,related,className}){const findSiblings=(el)=>ref.el.querySelectorAll(related.map((attr)=>`[${attr}='${el.getAttribute(attr).replace(/'/g, "\\'")}']`).join(""));const onPointerEnter=(ev)=>{if(!ev.target.classList.contains(exception)){for(const sibling of findSiblings(ev.target)){sibling.classList.add(...classList);classedEls.add(sibling);}}};const onPointerLeave=(ev)=>{for(const sibling of findSiblings(ev.target)){sibling.classList.remove(...classList);classedEls.delete(sibling);}};const classList=className.split(/\s+/g);const classedEls=new Set();useEffect((...targets)=>{if(targets.length){for(const target of targets){target.addEventListener("pointerenter",onPointerEnter);target.addEventListener("pointerleave",onPointerLeave);}
return()=>{for(const el of classedEls){el.classList.remove(...classList);}
classedEls.clear();for(const target of targets){target.removeEventListener("pointerenter",onPointerEnter);target.removeEventListener("pointerleave",onPointerLeave);}};}},()=>[...ref.el.querySelectorAll(selector)]);}
const NB_GANTT_RECORD_COLORS=12;function getElementCenter(el){const{x,y,width,height}=el.getBoundingClientRect();return{x:x+width/2,y:y+height/2,};}
function getBadgesPositions(el,rtl){const rect=el.getBoundingClientRect();const sideBarWidth=document.querySelector(".o_gantt_row_sidebar")?.offsetWidth||0;const startPosition={left:Math.max(rect.x,sideBarWidth),top:rect.top-20,};const stopPosition={top:rect.y+rect.height,right:clamp(document.body.offsetWidth-rect.x-rect.width,1,window.innerWidth-sideBarWidth),};return{startPosition:rtl?stopPosition:startPosition,stopPosition:rtl?startPosition:stopPosition,};}
function getBadgeText(date,diff,scale){const{cellPart,time,unitDescription}=scale;let text;switch(time){case"minute":text=date.toLocaleString(DateTime.TIME_SIMPLE);break;case"hour":text=cellPart>1?date.toLocaleString(DateTime.DATETIME_SHORT):date.toLocaleString();break;default:text=date.toLocaleString();}
if(diff){const prefix=diff>0?"+":"";text+=` (${prefix}${diff} ${unitDescription})`;}
return text;}
function getBadge(position,text,diff){return{class:diff?(diff>0?"text-success":"text-danger"):"",position,text,};}
__exports.getBadges=getBadges;function getBadges(el,[startDate,startDiff],[stopDate,stopDiff],{rtl,scale},showDiff=true){const{startPosition,stopPosition}=getBadgesPositions(el,rtl);const startBadge=getBadge(startPosition,getBadgeText(startDate,showDiff?startDiff:0,scale),startDiff);const stopBadge=getBadge(stopPosition,getBadgeText(stopDate,showDiff?stopDiff:0,scale),stopDiff);return{startBadge,stopBadge};}
const HANDLE_CLASS_START="o_handle_start";const HANDLE_CLASS_END="o_handle_end";const handles={start:document.createElement("div"),end:document.createElement("div"),};const useGanttConnectorDraggable=__exports.useGanttConnectorDraggable=makeDraggableHook({name:"useGanttConnectorDraggable",acceptedParams:{parentWrapper:[String],},onComputeParams({ctx,params}){ctx.parentWrapper=params.parentWrapper;ctx.followCursor=false;},onDragStart:({ctx,addStyle})=>{const{current}=ctx;const parent=current.element.closest(ctx.parentWrapper);if(!parent){return;}
for(const otherParent of ctx.ref.el.querySelectorAll(ctx.parentWrapper)){if(otherParent!==parent){addStyle(otherParent,{pointerEvents:"auto"});}}
return{sourcePill:parent,...current.connectorCenter};},onDrag:({ctx})=>{ctx.current.connectorCenter=getElementCenter(ctx.current.element);return pick(ctx.current,"connectorCenter");},onDragEnd:({ctx})=>pick(ctx.current,"element"),onDrop:({ctx,target})=>{const{current}=ctx;const parent=current.element.closest(ctx.parentWrapper);const targetParent=target.closest(ctx.parentWrapper);if(!targetParent||targetParent===parent){return;}
return{target:targetParent};},onWillStartDrag:({ctx})=>{ctx.current.connectorCenter=getElementCenter(ctx.current.element);return{};},});function getCoordinate(style,name){return+style.getPropertyValue(name).slice(1);}
__exports.getColumnStart=getColumnStart;function getColumnStart(style){return getCoordinate(style,"grid-column-start");}
__exports.getColumnEnd=getColumnEnd;function getColumnEnd(style){return getCoordinate(style,"grid-column-end");}
function getRowStart(style){return getCoordinate(style,"grid-row-start");}
function getRowEnd(style){return getCoordinate(style,"grid-row-end");}
const useGanttDraggable=__exports.useGanttDraggable=makeDraggableHook({name:"useGanttDraggable",acceptedParams:{cells:[String,Function],cellDragClassName:[String,Function],ghostClassName:[String,Function],hoveredCell:[Object],addStickyCoordinates:[Function],rtl:[Boolean,Function],scale:[Object,Function],getBadgesInitialDates:[Function],},onComputeParams({ctx,params}){ctx.cellSelector=params.cells;ctx.ghostClassName=params.ghostClassName;ctx.cellDragClassName=params.cellDragClassName;ctx.hoveredCell=params.hoveredCell;ctx.addStickyCoordinates=params.addStickyCoordinates;ctx.scale=params.scale;ctx.getBadgesInitialDates=params.getBadgesInitialDates;ctx.rtl=params.rtl;},onDragStart({ctx}){const{current,ghostClassName}=ctx;current.element.before(current.placeHolder);if(ghostClassName){current.placeHolder.classList.add(ghostClassName);}
return{pill:current.element};},onDrag({ctx,addStyle}){const{cellSelector,current,getBadgesInitialDates,hoveredCell,scale}=ctx;let{el:cell,part}=hoveredCell;const isDifferentCell=cell!==current.cell.el;const isDifferentPart=part!==current.cell.part;if(cell&&!cell.matches(cellSelector)){cell=null;}
if(cell&&cell.classList.contains("o_gantt_cell_folded")){return;}
current.cell.el=cell;current.cell.part=part;if(cell){if(isDifferentCell){const style=getComputedStyle(cell);current.cell.gridRow=style.getPropertyValue("grid-row");current.cell.gridColumnStart=getColumnStart(style)+current.gridColumnOffset;}
if(isDifferentCell||isDifferentPart){const{pillSpan}=current;const{gridRow,gridColumnStart:start}=current.cell;const gridColumnStart=clamp(start+part,1,current.maxGridColumnStart);const gridColumnEnd=gridColumnStart+pillSpan;current.diff=gridColumnStart-current.initialCol;addStyle(current.cellGhost,{gridRow,gridColumn:`c${gridColumnStart} / c${gridColumnEnd}`,});const[gridRowStart,gridRowEnd]=/r(\d+) \/ r(\d+)/g.exec(gridRow).slice(1);ctx.addStickyCoordinates([gridRowStart,gridRowEnd],[gridColumnStart,gridColumnEnd]);current.cell.col=gridColumnStart;}}else{current.cell.col=null;}
if(isDifferentCell){if(cell){cell.after(current.cellGhost);}else{current.cellGhost.remove();}}
const{cellTime,time}=scale;const{start,stop}=getBadgesInitialDates();const diff=current.diff*cellTime;const startDate=dateAddFixedOffset(start,{[time]:diff});const stopDate=dateAddFixedOffset(stop,{[time]:diff});return getBadges(current.element,[startDate,diff],[stopDate,diff],ctx,false);},onDragEnd({ctx}){return{pill:ctx.current.element};},onDrop({ctx}){const{cellSrc,cell,element,initialCol}=ctx.current;if(cell.col!==null){return{pill:element,cellSrc:cellSrc,cellDst:cell.el,diff:cell.col-initialCol,};}},onWillStartDrag({ctx,addCleanup,addClass}){const{current}=ctx;const{el:cell,part}=ctx.hoveredCell;current.placeHolder=current.element.cloneNode(true);current.cellGhost=document.createElement("div");current.cellGhost.className=ctx.cellDragClassName;current.cell={el:null,index:null,part:0};current.cellSrc=cell;const gridStyle=getComputedStyle(cell.parentElement);const pillStyle=getComputedStyle(current.element);const cellStyle=getComputedStyle(cell);const gridTemplateColumns=gridStyle.getPropertyValue("grid-template-columns");const pGridColumnStart=getColumnStart(pillStyle);const pGridColumnEnd=getColumnEnd(pillStyle);const cGridColumnStart=getColumnStart(cellStyle)+part;let highestGridCol;for(const e of gridTemplateColumns.split(/\s+/).reverse()){const res=/\[c(\d+)\]/g.exec(e);if(res){highestGridCol=+res[1];break;}}
const pillSpan=pGridColumnEnd-pGridColumnStart;current.initialCol=pGridColumnStart;current.diff=0;current.maxGridColumnStart=highestGridCol-pillSpan;current.gridColumnOffset=pGridColumnStart-cGridColumnStart;current.pillSpan=pillSpan;addClass(ctx.ref.el,"pe-auto");addCleanup(()=>{current.placeHolder.remove();current.cellGhost.remove();});return{};},});const useGanttUndraggable=__exports.useGanttUndraggable=makeDraggableHook({name:"useGanttUndraggable",onDragStart({ctx}){return{pill:ctx.current.element};},onDragEnd({ctx}){return{pill:ctx.current.element};},onWillStartDrag({ctx,addCleanup,addClass,addStyle,getRect}){const{x,y,width,height}=getRect(ctx.current.element);ctx.current.container=document.createElement("div");addClass(ctx.ref.el,"pe-auto");addStyle(ctx.current.container,{position:"fixed",left:`${x}px`,top:`${y}px`,width:`${width}px`,height:`${height}px`,});ctx.current.element.after(ctx.current.container);addCleanup(()=>ctx.current.container.remove());return{};},});const useGanttResizable=__exports.useGanttResizable=makeDraggableHook({name:"useGanttResizable",requiredParams:["handles"],acceptedParams:{innerPills:[String,Function],handles:[String,Function],hoveredCell:[Object],rtl:[Boolean,Function],cells:[String,Function],scale:[Object,Function],getBadgesInitialDates:[Function],showHandles:[Function],},onComputeParams({ctx,params,addCleanup,addEffectCleanup,getRect}){const onElementPointerEnter=(ev)=>{if(ctx.dragging||ctx.willDrag){return;}
const pill=ev.target;const innerPill=pill.querySelector(params.innerPills);const pillRect=getRect(innerPill);for(const el of Object.values(handles)){el.style.height=`${pillRect.height}px`;}
const showHandles=params.showHandles?params.showHandles(pill):{};if("start"in showHandles&&!showHandles.start){handles.start.remove();}else{innerPill.appendChild(handles.start);}
if("end"in showHandles&&!showHandles.end){handles.end.remove();}else{innerPill.appendChild(handles.end);}};const onElementPointerLeave=()=>{const remove=()=>Object.values(handles).forEach((h)=>h.remove());if(ctx.dragging||ctx.current.element){addCleanup(remove);}else{remove();}};ctx.hoveredCell=params.hoveredCell;ctx.scale=params.scale;ctx.getBadgesInitialDates=params.getBadgesInitialDates;ctx.rtl=params.rtl;for(const el of ctx.ref.el.querySelectorAll(params.elements)){el.addEventListener("pointerenter",onElementPointerEnter);el.addEventListener("pointerleave",onElementPointerLeave);addEffectCleanup(()=>{el.removeEventListener("pointerenter",onElementPointerEnter);el.removeEventListener("pointerleave",onElementPointerLeave);});}
handles.start.className=`${params.handles} ${HANDLE_CLASS_START}`;handles.start.style.cursor=`${params.rtl ? "e" : "w"}-resize`;handles.end.className=`${params.handles} ${HANDLE_CLASS_END}`;handles.end.style.cursor=`${params.rtl ? "w" : "e"}-resize`;ctx.pillSelector=ctx.elementSelector;ctx.fullSelector=ctx.elementSelector=`.${params.handles}`;ctx.followCursor=false;},onDragStart({ctx,addStyle}){addStyle(ctx.current.pill,{zIndex:15});return{pill:ctx.current.pill};},onDrag({ctx,addStyle,getRect}){const{getBadgesInitialDates,current,scale,pointer,rtl}=ctx;const{cell,part}=getClosestCell(ctx,ctx.current.rowId);if(cell.classList.contains("o_gantt_cell_folded")){return;}
const cellStyle=getComputedStyle(cell);const cGridColStart=getColumnStart(cellStyle);const{x,width}=getRect(cell);const coef=((rtl?-1:1)*width)/scale.cellPart;const startBorder=(rtl?x+width:x)+part*coef;const endBorder=startBorder+coef;const theClosest=closest(pointer.x,[startBorder,endBorder]);let diff=cGridColStart+
part+
(theClosest===startBorder?0:1)-
(current.isStart?current.firstCol:current.lastCol);if(diff===current.lastDiff){return;}
if(current.isStart){diff=Math.min(diff,current.initialDiff-1);addStyle(current.pill,{"grid-column-start":`c${current.firstCol + diff}`});}else{diff=Math.max(diff,1-current.initialDiff);addStyle(current.pill,{"grid-column-end":`c${current.lastCol + diff}`});}
current.lastDiff=diff;const{cellTime,time}=scale;const startDiff=current.isStart?-diff*cellTime:0;const stopDiff=current.isStart?0:diff*cellTime;const{start,stop}=getBadgesInitialDates();const startDate=current.isStart?dateAddFixedOffset(start,{[time]:diff*cellTime,}):start;const stopDate=current.isStart?stop:dateAddFixedOffset(stop,{[time]:diff*cellTime,});return getBadges(current.pill,[startDate,startDiff],[stopDate,stopDiff],ctx);},onDragEnd({ctx}){const{current,pillSelector}=ctx;const pill=current.element.closest(pillSelector);return{pill};},onDrop({ctx}){const{current}=ctx;if(!current.lastDiff){return;}
const direction=current.isStart?"start":"end";return{pill:current.pill,diff:current.lastDiff,direction};},onWillStartDrag({ctx,addClass}){const{current,hoveredCell,pillSelector}=ctx;const pill=ctx.current.element.closest(pillSelector);current.pill=pill;const pillStyle=getComputedStyle(pill);current.firstCol=getColumnStart(pillStyle);current.lastCol=getColumnEnd(pillStyle);current.initialDiff=current.lastCol-current.firstCol;const{el:cell}=hoveredCell;current.rowId=cell.dataset.rowId;ctx.cursor=getComputedStyle(current.element).cursor;current.isStart=current.element.classList.contains(HANDLE_CLASS_START);addClass(ctx.ref.el,"pe-auto");return{};},});function getCellBounds({cell,part}){const startCol=+cell.dataset.col+part;const endCol=startCol+1;const style=getComputedStyle(cell);const startRow=getRowStart(style);const endRow=getRowEnd(style);return{startCol,endCol,startRow,endRow};}
function getBlockBounds(current){const startCol=Math.min(current.initialCellBounds.startCol,current.cellBounds.startCol);const endCol=Math.max(current.initialCellBounds.endCol,current.cellBounds.endCol);const startRow=current.rowId?current.initialCellBounds.startRow:Math.min(current.initialCellBounds.startRow,current.cellBounds.startRow);const endRow=current.rowId?current.initialCellBounds.endRow:Math.max(current.initialCellBounds.endRow,current.cellBounds.endRow);return{startCol,endCol,startRow,endRow};}
function getResult(current){return{...getBlockBounds(current),rowId:current.rowId};}
const useGanttSelectable=__exports.useGanttSelectable=makeDraggableHook({name:"useGanttSelectable",acceptedParams:{hoveredCell:[Object],hasMultiCreate:[Boolean,Function],rtl:[Boolean,Function],scale:[Object,Function],},onComputeParams({ctx,params}){ctx.followCursor=false;ctx.hoveredCell=params.hoveredCell;ctx.hasMultiCreate=params.hasMultiCreate;ctx.rtl=params.rtl;ctx.scale=params.scale;},onWillStartDrag({addClass,ctx}){const{current,hoveredCell,ref}=ctx;const{el:cell,part}=hoveredCell;const cellBounds=getCellBounds({cell,part});current.initialCellBounds=cellBounds;current.cellBounds=cellBounds;current.rowId=ctx.hasMultiCreate?null:cell.dataset.rowId;addClass(ref.el,"pe-auto");addClass(cell,"pe-auto");return getResult(current);},onDragStart({ctx}){const{current}=ctx;return getResult(current);},onDrag({ctx}){const{current}=ctx;const{cell,part}=getClosestCell(ctx,current.rowId);if(cell.classList.contains("o_gantt_cell_folded")){return;}
const cellBounds=getCellBounds({cell,part});if(shallowEqual(current.cellBounds,cellBounds)){return;}
current.cellBounds=cellBounds;return getResult(current);},onDrop({ctx}){const{current}=ctx;return getResult(current);},});__exports.useGanttResponsivePopover=useGanttResponsivePopover;function useGanttResponsivePopover(dialogTitle,component,options={}){const dialogService=useService("dialog");const env=useEnv();const owner=useComponent();const popover=usePopover(component,options);const onClose=()=>{if(status(owner)!=="destroyed"){options.onClose?.();}};const dialogAddFn=(_,comp,props,options)=>dialogService.add(comp,props,options);const popoverInDialog=makePopover(dialogAddFn,GanttPopoverInDialog,{onClose});const ganttReponsivePopover={open:(target,props)=>{if(env.isSmall){popoverInDialog.open(target,{component:component,componentProps:props,dialogTitle,});}else{popover.open(target,props);}},close:()=>{popover.close();popoverInDialog.close();},get isOpen(){return popover.isOpen||popoverInDialog.isOpen;},};onWillUnmount(ganttReponsivePopover.close);return ganttReponsivePopover;}
return __exports;});;

/* /web_gantt/static/src/gantt_mock_server.js */
odoo.define('@web_gantt/gantt_mock_server',['@web/core/registry'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");function _mockGetGanttData(_,{model,kwargs}){let groups=this._mockFormattedReadGroup(model,{...kwargs,aggregates:["id:array_agg"],limit:null,offset:0,});const length=groups.length;const offset=kwargs.offset||0;groups=groups.slice(offset,kwargs.limit?kwargs.limit+offset:undefined);const recordIds=[];for(const group of groups){recordIds.push(...(group["id:array_agg"]||[]));}
const{records}=this.mockWebSearchReadUnity(model,[],{domain:[["id","in",recordIds]],context:kwargs.context,specification:kwargs.read_specification,});const unavailabilities={};for(const fieldName of kwargs.unavailability_fields||[]){unavailabilities[fieldName]={};}
const progress_bars={};for(const fieldName of kwargs.progress_bar_fields||[]){progress_bars[fieldName]={};}
return{groups,length,records,unavailabilities,progress_bars};}
registry.category("mock_server").add("get_gantt_data",_mockGetGanttData);return __exports;});;

/* /web_gantt/static/src/gantt_model.js */
odoo.define('@web_gantt/gantt_model',['@web/core/browser/browser','@web/core/domain','@web/core/l10n/dates','@web/core/l10n/translation','@web/core/orm_service','@web/core/registry','@web/core/utils/arrays','@web/core/utils/concurrency','@web/core/utils/objects','@web/model/model','@web/model/relational_model/utils','@web/views/fields/formatters','@web_gantt/gantt_arch_parser','@web_gantt/gantt_helpers'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{Domain}=require("@web/core/domain");const{deserializeDate,deserializeDateTime,serializeDate,serializeDateTime,}=require("@web/core/l10n/dates");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_gantt",...args);const{x2ManyCommands}=require("@web/core/orm_service");const{registry}=require("@web/core/registry");const{groupBy,unique}=require("@web/core/utils/arrays");const{KeepLast,Mutex}=require("@web/core/utils/concurrency");const{pick}=require("@web/core/utils/objects");const{Model}=require("@web/model/model");const{parseServerValue}=require("@web/model/relational_model/utils");const{formatFloatTime,formatPercentage}=require("@web/views/fields/formatters");const{getScaleForCustomRange}=require("@web_gantt/gantt_arch_parser");const{localStartOf}=require("@web_gantt/gantt_helpers");const{DateTime}=luxon;function firstColumnBefore(date,unit){return localStartOf(date,unit);}
function firstColumnAfter(date,unit){const start=localStartOf(date,unit);if(date.equals(start)){return date;}
return start.plus({[unit]:1});}
__exports.parseServerValues=parseServerValues;function parseServerValues(fields,values){const parsedValues={};if(!values){return parsedValues;}
for(const fieldName in values){parsedValues[fieldName]=parseServerValue(fields[fieldName],values[fieldName]);}
return parsedValues;}
const GanttModel=__exports.GanttModel=class GanttModel extends Model{static services=["notification"];setup(params,services){this.notification=services.notification;this.data={};this.metaData=params.metaData;this.displayParams=params.displayParams;this.searchParams=null;this.closedRows=new Set();this.keepLast=new KeepLast();this.mutex=new Mutex();this._nextMetaData=null;}
async load(searchParams){this.searchParams=searchParams;const metaData=this._buildMetaData();const params={groupedBy:this._getGroupedBy(metaData,searchParams),pagerOffset:0,};if(!metaData.scale||!metaData.startDate||!metaData.stopDate){Object.assign(params,this._getInitialRangeParams(this._buildMetaData(params),searchParams));}
if(this.metaData.dependencyEnabled){Object.assign(params,this._getInitialRescheduleMethod(this._buildMetaData(params)));}
await this._fetchData(this._buildMetaData(params));}
get hasMultiCreate(){return(!!this.metaData.multiCreateView&&!this.env.isSmall&&this.displayParams.displayMode==="dense"&&this.metaData.scale.interval==="day");}
get showMultiCreateTimeRange(){return!this.dateStartFieldIsDate()&&!this.dateStopFieldIsDate();}
collapseRows(){const collapse=(rows)=>{for(const row of rows){this.closedRows.add(row.id);if(row.rows){collapse(row.rows);}}};collapse(this.data.rows);this.notify();}
copy(id,schedule,callback){const{resModel}=this.metaData;const{context}=this.searchParams;const data=this._scheduleToData(schedule);return this.mutex.exec(async()=>{const result=await this.orm.call(resModel,"copy",[[id]],{context,default:data,});if(callback){callback(result[0]);}
this.fetchData();return result[0];});}
async createDependency(masterId,slaveId){const{dependencyField,resModel}=this.metaData;const writeCommand={[dependencyField]:[x2ManyCommands.link(masterId)],};await this.mutex.exec(()=>this.orm.write(resModel,[slaveId],writeCommand));await this.fetchData();}
dateStartFieldIsDate(metaData=this.metaData){return metaData?.fields[metaData.dateStartField].type==="date";}
dateStopFieldIsDate(metaData=this.metaData){return metaData?.fields[metaData.dateStopField].type==="date";}
expandRows(){this.closedRows.clear();this.notify();}
get rowsAreExpanded(){return this.closedRows.size===0;}
async fetchData(params){await this._fetchData(this._buildMetaData(params));this.useSampleModel=false;this.notify();}
getDialogContext(params){const context={...this.getSchedule(params)};if(params.withDefault){const{dateStartField,dateStopField}=this.metaData;for(const k in context){context[`default_${k}`]=context[k];if(![dateStartField,dateStopField].includes(k)){context[`search_default_${k}`]=context[k];}}}
return Object.assign({},this.searchParams.context,context);}
getRangeFromDate(rangeId,date){const startDate=localStartOf(date,rangeId).minus({[rangeId]:1});const stopDate=startDate.plus({[rangeId]:3}).minus({day:1});return{focusDate:date,startDate,stopDate,rangeId};}
getSchedule({rowId,start,stop}={}){const{dateStartField,dateStopField,fields,groupedBy}=this.metaData;const schedule={};if(start){schedule[dateStartField]=this.dateStartFieldIsDate()?serializeDate(start):serializeDateTime(start);}
if(stop&&dateStartField!==dateStopField){schedule[dateStopField]=this.dateStopFieldIsDate()?serializeDate(stop):serializeDateTime(stop);}
if(rowId){const group=Object.assign({},...JSON.parse(rowId));for(const fieldName of groupedBy){if(fieldName in group){const value=group[fieldName];if(Array.isArray(value)){const{type}=fields[fieldName];schedule[fieldName]=type==="many2many"?[value[0]]:value[0];}else{schedule[fieldName]=value;}}}}
return schedule;}
hasData(){return Boolean(this.data.records.length);}
isClosed(rowId){return this.closedRows.has(rowId);}
async multiCreateRecords(multiCreateData,cellsInfo){if(!cellsInfo.length){return;}
const records=[];const values=await multiCreateData.record.getChanges();const timeRange=multiCreateData.timeRange;for(const{start,stop,rowId}of cellsInfo){const schedule=this.getSchedule(timeRange?{start:start.set(timeRange.start.toObject()),stop:start.set(timeRange.end.toObject()),rowId,}:{start,stop,rowId});records.push({...schedule,...values});}
await this.orm.create(this.metaData.resModel,records,{context:{...this.searchParams.context,multi_create:true},});await this.fetchData();}
async unlinkRecords(ids){if(!ids.length){return;}
await this.orm.unlink(this.metaData.resModel,ids);await this.fetchData();}
async removeDependency(masterId,slaveId){const{dependencyField,resModel}=this.metaData;const writeCommand={[dependencyField]:[x2ManyCommands.unlink(masterId)],};await this.mutex.exec(()=>this.orm.write(resModel,[slaveId],writeCommand));await this.fetchData();}
removeRedundantData(data,ids){const records=this.data.records.filter((rec)=>ids.includes(rec.id));if(!records.length){return data;}
const isSameValue=(record,{name,type})=>{const recordValue=record[name];let newValue=data[name];if(Array.isArray(newValue)){[newValue]=newValue;}
if(type==="many2one"){return recordValue.id===newValue;}else if(type==="one2many"){return recordValue[0]===newValue;}else if(type==="many2many"){return recordValue.includes(newValue);}else if(type==="date"){return serializeDate(recordValue)===newValue;}else if(type==="datetime"){return serializeDateTime(recordValue)===newValue;}else{return recordValue===newValue;}};const trimmed={...data};for(const fieldName in data){const field=this.metaData.fields[fieldName];if(records.every((rec)=>isSameValue(rec,field))){delete trimmed[fieldName];}}
return trimmed;}
_getRescheduleData(ids,schedule){if(!Array.isArray(ids)){ids=[ids];}
const allData=this._scheduleToData(schedule);return[ids,this.removeRedundantData(allData,ids),this._getRescheduleContext()];}
async reschedule(ids,schedule,callback){let data,context;[ids,data,context]=this._getRescheduleData(ids,schedule);return this.mutex.exec(async()=>{try{const result=await this._reschedule(ids,data,context);if(callback){await callback(result);}}finally{this.fetchData();}});}
async _reschedule(ids,data,context){return this.orm.write(this.metaData.resModel,ids,data,{context,});}
toggleHighlightPlannedFilter(ids){}
async rescheduleAccordingToDependency(ids,schedule,rescheduleAccordingToDependencyCallback){const{dateStartField,dateStopField,dependencyField,dependencyInvertedField,resModel,}=this.metaData;let data;[ids,data]=this._getRescheduleData(ids,schedule);return await this.mutex.exec(async()=>{try{const result=await this.orm.call(resModel,"web_gantt_reschedule",[data,this.metaData.rescheduleMethod,ids,dependencyField,dependencyInvertedField,dateStartField,dateStopField,]);if(rescheduleAccordingToDependencyCallback){await rescheduleAccordingToDependencyCallback(result);}}finally{this.fetchData();}});}
toggleRow(rowId){if(this.isClosed(rowId)){this.closedRows.delete(rowId);}else{this.closedRows.add(rowId);}
this.notify();}
async toggleDisplayMode(){this.displayParams.displayMode=this.displayParams.displayMode==="dense"?"sparse":"dense";this.closedRows.clear();this.notify();}
async updatePagerParams({limit,offset}){await this.fetchData({pagerLimit:limit,pagerOffset:offset});}
_buildMetaData(params={}){this._nextMetaData={...(this._nextMetaData||this.metaData)};if(params.groupedBy){this._nextMetaData.groupedBy=params.groupedBy;}
if(params.focusDate){this._nextMetaData.focusDate=params.focusDate;}
if(params.startDate){this._nextMetaData.startDate=params.startDate;}
if(params.stopDate){this._nextMetaData.stopDate=params.stopDate;}
if(params.rangeId){browser.localStorage.setItem(this._getLocalStorageKey(),params.rangeId);this._nextMetaData.rangeId=params.rangeId;if(this._nextMetaData.rangeId!=="custom"){this._nextMetaData.scale=this._nextMetaData.scales[params.rangeId];}}
if(params.rescheduleMethod){browser.localStorage.setItem(this._getRescehduleMethodLocalStorageKey(),params.rescheduleMethod);this._nextMetaData.rescheduleMethod=params.rescheduleMethod;}
if("pagerLimit"in params){this._nextMetaData.pagerLimit=params.pagerLimit;}
if("pagerOffset"in params){this._nextMetaData.pagerOffset=params.pagerOffset;}
if("rangeId"in params||"startDate"in params||"stopDate"in params){if(this._nextMetaData.rangeId==="custom"){this._nextMetaData.scale=getScaleForCustomRange(this._nextMetaData);}
let exchange=false;if(this._nextMetaData.startDate>this._nextMetaData.stopDate){exchange=true;const temp=this._nextMetaData.startDate;this._nextMetaData.startDate=this._nextMetaData.stopDate;this._nextMetaData.stopDate=temp;}
const{interval}=this._nextMetaData.scale;const rightLimit=this._nextMetaData.startDate.plus({year:10,day:-1});if(this._nextMetaData.stopDate>rightLimit){if(exchange){this._nextMetaData.startDate=this._nextMetaData.stopDate.minus({year:10,day:-1,});}else{this._nextMetaData.stopDate=this._nextMetaData.startDate.plus({year:10,day:-1,});}}
this._nextMetaData.globalStart=firstColumnBefore(this._nextMetaData.startDate,interval);this._nextMetaData.globalStop=firstColumnAfter(this._nextMetaData.stopDate.plus({day:1}),interval);if(params.currentFocusDate){this._nextMetaData.focusDate=params.currentFocusDate;if(this._nextMetaData.focusDate<this._nextMetaData.startDate){this._nextMetaData.focusDate=this._nextMetaData.startDate;}else if(this._nextMetaData.stopDate<this._nextMetaData.focusDate){this._nextMetaData.focusDate=this._nextMetaData.stopDate;}}}
return this._nextMetaData;}
async _fetchData(metaData,additionalContext){const{globalStart,globalStop,groupedBy,pagerLimit,pagerOffset,resModel,scale}=metaData;const context={...this.searchParams.context,group_by:groupedBy,...additionalContext,};const domain=this._getDomain(metaData);const fields=this._getFields(metaData);const specification={};for(const fieldName of fields){specification[fieldName]={};if(metaData.fields[fieldName].type==="many2one"){specification[fieldName].fields={display_name:{}};}}
const ganttData=await this.keepLast.add(this.orm.call(resModel,"get_gantt_data",[],{domain,groupby:groupedBy,read_specification:specification,scale:scale.unit,start_date:serializeDateTime(globalStart),stop_date:serializeDateTime(globalStop),unavailability_fields:this._getUnavailabilityFields(metaData),progress_bar_fields:this._getProgressBarFields(metaData),context,limit:pagerLimit,offset:pagerOffset,}));const{length,groups,records,progress_bars,unavailabilities}=ganttData;groups.forEach((g)=>(g.fromServer=true));const data={count:length};data.records=this._parseServerData(metaData,records);data.rows=this._generateRows(metaData,{groupedBy,groups,parentGroup:[],});data.unavailabilities=this._processUnavailabilities(unavailabilities);data.progressBars=this._processProgressBars(progress_bars);this._processGanttData(metaData,data,ganttData);if(JSON.stringify(this.metaData.groupedBy)!==JSON.stringify(groupedBy)){this.closedRows.clear();}
this.data=data;this.metaData=metaData;this._nextMetaData=null;}
_processGanttData(metaData,data,ganttData){}
_filterDateIngroupedBy(metaData,groupedBy){return groupedBy.filter((gb)=>{const[fieldName]=gb.split(":");const{type}=metaData.fields[fieldName];return!["date","datetime"].includes(type);});}
_formatTime(floatVal){const timeStr=formatFloatTime(floatVal,{noLeadingZeroHour:true});const[hourStr,minuteStr]=timeStr.split(":");const hour=parseInt(hourStr,10);const minute=parseInt(minuteStr,10);return minute?_t("%(hour)sh%(minute)s",{hour,minute}):_t("%sh",hour);}
_generateRows(metaData,params){const groupedBy=params.groupedBy;const groups=params.groups;const groupLevel=metaData.groupedBy.length-groupedBy.length;const parentGroup=params.parentGroup;if(!groupedBy.length||!groups.length){const recordIds=[];for(const g of groups){recordIds.push(...(g.__record_ids||[]));}
const part=parentGroup.at(-1);const[[parentGroupedField,value]]=part?Object.entries(part):[[]];return[{groupLevel,id:JSON.stringify([...parentGroup,{}]),name:"",recordIds:unique(recordIds),parentGroupedField,parentResId:Array.isArray(value)?value[0]:value,__extra__:true,},];}
const rows=[];const groupedByField=groupedBy[0];const currentLevelGroups=groupBy(groups,(g)=>{if(g[groupedByField]===undefined){g[groupedByField]=false;}
return g[groupedByField];});const{maxField}=metaData.consolidationParams;const consolidate=groupLevel===0&&groupedByField===maxField;const generateSubRow=maxField?true:groupedBy.length>1;for(const key in currentLevelGroups){const subGroups=currentLevelGroups[key];const value=subGroups[0][groupedByField];const part={};part[groupedByField]=value;const fakeGroup=[...parentGroup,part];const id=JSON.stringify(fakeGroup);const resId=Array.isArray(value)?value[0]:value;const fromServer=subGroups.some((g)=>g.fromServer);const recordIds=[];for(const g of subGroups){recordIds.push(...(g.__record_ids||[]));}
const row={consolidate,fromServer,groupedBy,groupedByField,groupLevel,id,name:this._getRowName(metaData,groupedByField,value),resId,recordIds:unique(recordIds),};if(generateSubRow){row.rows=this._generateRows(metaData,{...params,groupedBy:groupedBy.slice(1),groups:subGroups,parentGroup:fakeGroup,});}
if(resId===false){rows.unshift(row);}else{rows.push(row);}}
return rows;}
_getDomain(metaData){const{dateStartField,dateStopField,globalStart,globalStop}=metaData;const domain=Domain.and([this.searchParams.domain,["&",[dateStartField,"<",this.dateStopFieldIsDate(metaData)?serializeDate(globalStop):serializeDateTime(globalStop),],[dateStopField,this.dateStartFieldIsDate(metaData)?">=":">",this.dateStartFieldIsDate(metaData)?serializeDate(globalStart):serializeDateTime(globalStart),],],]);return domain.toList();}
_getFieldFormattedValue(value,field){if(field.type==="boolean"){return value?"True":"False";}else if(!value){return field.falsy_value_label||_t("Undefined %s",field.string);}else if(field.type==="many2many"){return value[1];}
const formatter=registry.category("formatters").get(field.type);return formatter(value,field);}
_getFields(metaData){const fields=new Set(["display_name",metaData.dateStartField,metaData.dateStopField,...metaData.groupedBy,...metaData.decorationFields,]);if(metaData.colorField){fields.add(metaData.colorField);}
if(metaData.consolidationParams.field){fields.add(metaData.consolidationParams.field);}
if(metaData.consolidationParams.excludeField){fields.add(metaData.consolidationParams.excludeField);}
if(metaData.dependencyField){fields.add(metaData.dependencyField);}
if(metaData.progressField){fields.add(metaData.progressField);}
return[...fields];}
_getGroupedBy(metaData,searchParams){let groupedBy=[...searchParams.groupBy];groupedBy=groupedBy.filter((gb)=>{const[fieldName]=gb.split(".");const field=metaData.fields[fieldName];return field?.type!=="properties";});return this._filterDateIngroupedBy(metaData,groupedBy);}
_getDefaultFocusDate(searchParams){const{context}=searchParams;const focusDate="initialDate"in context?deserializeDateTime(context.initialDate):DateTime.local();return focusDate.startOf("day");}
_getInitialRangeParams(metaData,searchParams){const{context}=searchParams;const localRangeId=this._getRangeIdFromLocalStorage(metaData);const rangeFromContext=context.default_range||context.default_scale;let rangeId=localRangeId||(rangeFromContext in metaData.ranges?rangeFromContext:metaData.defaultRange);let focusDate;if(rangeId in metaData.ranges){focusDate=this._getDefaultFocusDate(searchParams);return{...this.getRangeFromDate(rangeId,focusDate)};}
rangeId="custom";let startDate=context.default_start_date&&deserializeDate(context.default_start_date);let stopDate=context.default_stop_date&&deserializeDate(context.default_stop_date);const defaultRangeCount=3;const defaultRangeUnit="month";if(!startDate&&!stopDate){focusDate=this._getDefaultFocusDate(searchParams);startDate=firstColumnBefore(focusDate,defaultRangeUnit);stopDate=startDate.plus({[defaultRangeUnit]:defaultRangeCount}).minus({day:1});}else if(startDate&&!stopDate){const column=firstColumnBefore(startDate,defaultRangeUnit);focusDate=startDate;stopDate=column.plus({[defaultRangeUnit]:defaultRangeCount}).minus({day:1});}else if(!startDate&&stopDate){const column=firstColumnAfter(stopDate,defaultRangeUnit);focusDate=stopDate;startDate=column.minus({[defaultRangeUnit]:defaultRangeCount});}else{focusDate=DateTime.local();if(focusDate<startDate){focusDate=startDate;}else if(focusDate>stopDate){focusDate=stopDate;}}
return{focusDate,startDate,stopDate,rangeId};}
_getLocalStorageKey(){return`rangeOf-viewId-${this.env.config.viewId}`;}
_getProgressBarFields(metaData){if(metaData.progressBarFields&&!this.orm.isSample){return metaData.progressBarFields.filter((fieldName)=>metaData.groupedBy.includes(fieldName)&&["many2many","many2one"].includes(metaData.fields[fieldName]?.type));}
return[];}
_getRescheduleContext(){return{...this.searchParams.context};}
_getRowName(metaData,groupedByField,value){const field=metaData.fields[groupedByField];return this._getFieldFormattedValue(value,field);}
_getRangeIdFromLocalStorage(metaData){const{ranges}=metaData;const localRangeId=browser.localStorage.getItem(this._getLocalStorageKey());return localRangeId in ranges?localRangeId:null;}
_getInitialRescheduleMethod(metaData){return{rescheduleMethod:this._getRescheduleMethodFromLocalStorage(metaData)||metaData.defaultRescheduleMethod,};}
_getRescehduleMethodLocalStorageKey(){return`rescheduleMethod-viewId-${this.env.config.viewId}`;}
_getRescheduleMethodFromLocalStorage(metaData){const{rescheduleMethods}=metaData;const localRescheduleMethod=browser.localStorage.getItem(this._getRescehduleMethodLocalStorageKey());return localRescheduleMethod in rescheduleMethods?localRescheduleMethod:null;}
_getUnavailabilityFields(metaData){if(metaData.displayUnavailability&&!this.orm.isSample&&metaData.groupedBy.length){const lastGroupBy=metaData.groupedBy.at(-1);const{type}=metaData.fields[lastGroupBy]||{};if(["many2many","many2one"].includes(type)){return[lastGroupBy];}}
return[];}
_parseServerData(metaData,records){const{dateStartField,dateStopField,fields}=metaData;const parsedRecords=[];for(const record of records){const parsedRecord=parseServerValues(fields,record);const dateStart=parsedRecord[dateStartField];const dateStop=parsedRecord[dateStopField];if(dateStart<=dateStop){parsedRecords.push(parsedRecord);}}
return parsedRecords;}
_processProgressBar(progressBar,warning){const processedProgressBar={...progressBar,value_formatted:this._formatTime(progressBar.value),max_value_formatted:this._formatTime(progressBar.max_value),ratio:progressBar.max_value?(progressBar.value/progressBar.max_value)*100:0,warning,};if(processedProgressBar?.max_value){processedProgressBar.ratio_formatted=formatPercentage(processedProgressBar.ratio/100);}
return processedProgressBar;}
_processProgressBars(progressBars){const processedProgressBars={};for(const fieldName in progressBars){processedProgressBars[fieldName]={};const progressBarInfo=progressBars[fieldName];for(const[resId,progressBar]of Object.entries(progressBarInfo)){processedProgressBars[fieldName][resId]=this._processProgressBar(progressBar,progressBarInfo.warning);}}
return processedProgressBars;}
_processUnavailabilities(unavailabilities){const processedUnavailabilities={};for(const fieldName in unavailabilities){processedUnavailabilities[fieldName]={};for(const[resId,resUnavailabilities]of Object.entries(unavailabilities[fieldName])){processedUnavailabilities[fieldName][resId]=resUnavailabilities.map((u)=>({start:deserializeDateTime(u.start),stop:deserializeDateTime(u.stop),}));}}
return processedUnavailabilities;}
_scheduleToData(schedule){const allowedFields=[this.metaData.dateStartField,this.metaData.dateStopField,...this.metaData.groupedBy,];return pick(schedule,...allowedFields);}}
return __exports;});;

/* /web_gantt/static/src/gantt_multi_selection_buttons.js */
odoo.define('@web_gantt/gantt_multi_selection_buttons',['@web/views/view_components/multi_selection_buttons'],function(require){'use strict';let __exports={};const{MultiSelectionButtons}=require("@web/views/view_components/multi_selection_buttons");const GanttMultiSelectionButtons=__exports.GanttMultiSelectionButtons=class GanttMultiSelectionButtons extends MultiSelectionButtons{static template="web_gantt.GanttMultiSelectionButtons";static props={reactive:{type:Object,shape:{...MultiSelectionButtons.props.reactive.shape,onPlan:{type:Function,optional:true},},},};}
return __exports;});;

/* /web_gantt/static/src/gantt_popover.js */
odoo.define('@web_gantt/gantt_popover',['@odoo/owl','@web/model/record','@web/views/view_button/view_button','@web/views/view_button/view_button_hook','@web/views/view_compiler','@web_gantt/gantt_compiler'],function(require){'use strict';let __exports={};const{Component,useRef}=require("@odoo/owl");const{Record}=require("@web/model/record");const{ViewButton}=require("@web/views/view_button/view_button");const{useViewButtons}=require("@web/views/view_button/view_button_hook");const{useViewCompiler}=require("@web/views/view_compiler");const{GanttCompiler}=require("@web_gantt/gantt_compiler");const GanttPopover=__exports.GanttPopover=class GanttPopover extends Component{static template="web_gantt.GanttPopover";static components={ViewButton,Record};static props=["title?","displayGenericButtons","bodyTemplate?","footerTemplate?","KanbanRecord?","kanbanViewParams?","resModel","resId","context","close","reloadOnClose","buttons","actionContext?",];setup(){this.rootRef=useRef("root");this.templates={};const toCompile={};const{bodyTemplate,footerTemplate}=this.props;if(bodyTemplate){toCompile.body=bodyTemplate;}
if(footerTemplate){toCompile.footer=footerTemplate;}
Object.assign(this.templates,useViewCompiler(GanttCompiler,toCompile,{recordExpr:"__record__"}));useViewButtons(this.rootRef,{reload:()=>{this.props.reloadOnClose();this.props.close();},});this.displayPopoverHeader=Boolean(this.templates.body);if(!this.templates.body){const{kanbanViewParams,resId,resModel}=this.props;const{activeFields,archInfo,fields}=kanbanViewParams;this.recordProps={resModel,resId,activeFields,fields,hooks:{onRecordSaved:this.props.reloadOnClose,},context:this.props.actionContext,};this.kanbanRecordProps={archInfo};}}
get renderingContext(){return Object.assign({},this.props.context,{__comp__:this,__record__:{resModel:this.props.resModel,resId:this.props.resId},});}
async onClick(button){await button.onClick();this.props.close();}}
return __exports;});;

/* /web_gantt/static/src/gantt_popover_in_dialog.js */
odoo.define('@web_gantt/gantt_popover_in_dialog',['@odoo/owl','@web/core/dialog/dialog'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{Dialog}=require("@web/core/dialog/dialog");const GanttPopoverInDialog=__exports.GanttPopoverInDialog=class GanttPopoverInDialog extends Component{static components={Dialog};static props=["close","component","componentProps","dialogTitle"];static template="web_gantt.GanttPopoverInDialog";get componentProps(){return{...this.props.componentProps,close:this.props.close};}}
return __exports;});;

/* /web_gantt/static/src/gantt_renderer.js */
odoo.define('@web_gantt/gantt_renderer',['@odoo/owl','@web/core/browser/feature_detection','@web/core/domain','@web/core/l10n/dates','@web/core/l10n/localization','@web/core/l10n/time','@web/core/l10n/translation','@web/core/popover/popover_hook','@web/core/py_js/py','@web/core/registry','@web/core/user','@web/core/utils/arrays','@web/core/utils/concurrency','@web/core/utils/hooks','@web/core/utils/objects','@web/core/utils/strings','@web/core/utils/timing','@web/core/utils/urls','@web/core/utils/xml','@web/core/virtual_grid_hook','@web/model/relational_model/utils','@web/search/action_hook','@web/views/fields/formatters','@web/views/kanban/kanban_record','@web/views/view_dialogs/select_create_dialog','@web_gantt/gantt_connector','@web_gantt/gantt_helpers','@web_gantt/gantt_multi_selection_buttons','@web_gantt/gantt_popover','@web_gantt/gantt_renderer_controls','@web_gantt/gantt_row_progress_bar','@web_gantt/gantt_time_display_badge'],function(require){'use strict';let __exports={};const{Component,markup,onWillRender,onWillStart,onWillUnmount,onWillUpdateProps,reactive,useEffect,useExternalListener,useRef,useState,}=require("@odoo/owl");const{hasTouch,isMobileOS}=require("@web/core/browser/feature_detection");const{Domain}=require("@web/core/domain");const{serializeDate,serializeDateTime,toLocaleDateTimeString}=require("@web/core/l10n/dates");const{localization}=require("@web/core/l10n/localization");const{is24HourFormat}=require("@web/core/l10n/time");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_gantt",...args);const{usePopover}=require("@web/core/popover/popover_hook");const{evaluateBooleanExpr}=require("@web/core/py_js/py");const{registry}=require("@web/core/registry");const{user}=require("@web/core/user");const{zipWith}=require("@web/core/utils/arrays");const{KeepLast}=require("@web/core/utils/concurrency");const{useBus,useService}=require("@web/core/utils/hooks");const{omit,pick}=require("@web/core/utils/objects");const{nbsp}=require("@web/core/utils/strings");const{debounce,throttleForAnimation}=require("@web/core/utils/timing");const{url}=require("@web/core/utils/urls");const{parseXML}=require("@web/core/utils/xml");const{useVirtualGrid}=require("@web/core/virtual_grid_hook");const{extractFieldsFromArchInfo}=require("@web/model/relational_model/utils");const{useCallbackRecorder}=require("@web/search/action_hook");const{formatFloatTime}=require("@web/views/fields/formatters");const{KanbanRecord}=require("@web/views/kanban/kanban_record");const{SelectCreateDialog}=require("@web/views/view_dialogs/select_create_dialog");const{GanttConnector}=require("@web_gantt/gantt_connector");const{dateAddFixedOffset,diffColumn,getBadges,getCellColor,getColorIndex,getHoveredCellPart,localEndOf,localStartOf,useGanttConnectorDraggable,useGanttDraggable,useGanttResizable,useGanttSelectable,useGanttUndraggable,useMultiHover,}=require("@web_gantt/gantt_helpers");const{GanttMultiSelectionButtons}=require("@web_gantt/gantt_multi_selection_buttons");const{GanttPopover}=require("@web_gantt/gantt_popover");const{GanttRendererControls}=require("@web_gantt/gantt_renderer_controls");const{GanttRowProgressBar}=require("@web_gantt/gantt_row_progress_bar");const{GanttTimeDisplayBadge}=require("@web_gantt/gantt_time_display_badge");const viewRegistry=registry.category("views");const{DateTime,Interval}=luxon;const INTERACTION_CLASSNAMES=[["connect","o_connect"],["copy","o_copying"],["locked","o_grabbing_locked"],["reschedule","o_grabbing"],["resize","o_resizing"],];const NEW_CONNECTOR_ID="__connector__new";const rtl=()=>localization.direction==="rtl";const clearObject=(obj)=>{for(const key in obj){delete obj[key];}};const GanttRenderer=__exports.GanttRenderer=class GanttRenderer extends Component{static components={GanttConnector,GanttRendererControls,GanttTimeDisplayBadge,GanttRowProgressBar,Popover:GanttPopover,MultiSelectionButtons:GanttMultiSelectionButtons,};static props=["model","arch","class","create","openDialog","scrollPosition?","multiCreateValues?","contentRef?","context?",];static template="web_gantt.GanttRenderer";static connectorCreatorTemplate="web_gantt.GanttRenderer.ConnectorCreator";static headerTemplate="web_gantt.GanttRenderer.Header";static pillTemplate="web_gantt.GanttRenderer.Pill";static groupPillTemplate="web_gantt.GanttRenderer.GroupPill";static rowContentTemplate="web_gantt.GanttRenderer.RowContent";static rowHeaderTemplate="web_gantt.GanttRenderer.RowHeader";static totalRowTemplate="web_gantt.GanttRenderer.TotalRow";static getRowHeaderWidth=(width)=>100/(width>768?6:3);setup(){this.model=this.props.model;this.gridRef=useRef("grid");this.cellContainerRef=useRef("cellContainer");this.actionService=useService("action");this.dialogService=useService("dialog");this.notificationService=useService("notification");this.orm=useService("orm");this.viewService=useService("view");this.keepLast=new KeepLast();this.defaultkanbanViewParams=null;this.is24HourFormat=is24HourFormat();this.hovered={connector:null,hoverable:null,pill:null,collapsableColumnHeader:null,};this.interaction=reactive({mode:null,dragAction:"reschedule",},()=>this.onInteractionChange());this.onInteractionChange();this.connectors=reactive({});this.progressBarsReactive=reactive({hoveredRowId:null});this.timeDisplayBadgeReactiveStart=reactive({});this.timeDisplayBadgeReactiveStop=reactive({});this.columnsGroups=[];this.columns=[];this.extraPills=[];this.pills={};this.rows=[];this.subColumns=[];this.rowPills={};this.mappingColToColumn=new Map();this.mappingColToSubColumn=new Map();this.cursorPosition={x:0,y:0,};this.popover=usePopover(this.constructor.components.Popover,{onClose:()=>{if(!this.preventClick){this.preventClick=true;setTimeout(()=>(this.preventClick=false),250);}
this.onCloseCurrentPopover?.();},});this.throttledComputeHoverParams=throttleForAnimation((ev)=>this.computeHoverParams(ev));this.offHoursState=useState({});useExternalListener(window,"keydown",(ev)=>this.onWindowKeyDown(ev));useExternalListener(window,"keyup",(ev)=>this.onWindowKeyUp(ev));useExternalListener(window,"resize",debounce(()=>{this.shouldComputeSomeWidths=true;this.render();},100));useMultiHover({ref:this.gridRef,selector:".o_gantt_group",exception:"o_gantt_cell_folded",related:["data-row-id"],className:"o_gantt_group_hovered",});const scale=()=>this.model.metaData.scale;this.cellForDrag={el:null,part:0};const dragState=useGanttDraggable({enable:()=>Boolean(this.cellForDrag.el),ref:this.gridRef,hoveredCell:this.cellForDrag,elements:".o_draggable",ignore:".o_resize_handle,.o_connector_creator_bullet",cells:".o_gantt_cell",cellDragClassName:"o_gantt_cell o_drag_hover",ghostClassName:"o_dragged_pill_ghost",rtl,scale,getBadgesInitialDates:()=>({start:this.badgeInitialStartDate,stop:this.badgeInitialStopDate,}),addStickyCoordinates:this.addStickyCoordinates.bind(this),onWillStartDrag:this.cleanMultiSelection.bind(this),onDragStart:({pill})=>{this.initBadges(pill);this.popover.close();this.setStickyPill(pill);this.interaction.mode="drag";},onDrag:this.updateBadges.bind(this),onDragEnd:()=>{this.clearBadges();this.setStickyPill();this.removeStickyCoordinates();this.interaction.mode=null;},onDrop:(params)=>this.dragPillDrop(params),});const unDragState=useGanttUndraggable({ref:this.gridRef,elements:".o_undraggable",ignore:".o_resize_handle,.o_connector_creator_bullet",edgeScrolling:{enabled:false},onWillStartDrag:this.cleanMultiSelection.bind(this),onDragStart:()=>{this.interaction.mode="locked";},onDragEnd:()=>{this.interaction.mode=null;},});const resizeState=useGanttResizable({ref:this.gridRef,hoveredCell:this.cellForDrag,elements:".o_resizable",innerPills:".o_gantt_pill",handles:"o_resize_handle",edgeScrolling:{speed:40,threshold:150,direction:"horizontal"},scale,getBadgesInitialDates:()=>({start:this.badgeInitialStartDate,stop:this.badgeInitialStopDate,}),showHandles:(pillEl)=>{const pill=this.pills[pillEl.dataset.pillId];const hideHandles=this.connectorDragState.dragging;return{start:!pill.disableStartResize&&!hideHandles,end:!pill.disableStopResize&&!hideHandles,};},rtl,onWillStartDrag:this.cleanMultiSelection.bind(this),onDragStart:({pill,addClass})=>{this.initBadges(pill);this.popover.close();this.setStickyPill(pill);addClass(pill,"o_resized");this.interaction.mode="resize";},onDrag:this.updateBadges.bind(this),onDragEnd:({pill,removeClass})=>{this.clearBadges();this.setStickyPill();removeClass(pill,"o_resized");this.interaction.mode=null;},onDrop:(params)=>this.resizePillDrop(params),});let initialPillId;this.connectorDragState=useGanttConnectorDraggable({ref:this.gridRef,elements:".o_connector_creator_bullet",parentWrapper:".o_gantt_cells .o_gantt_pill_wrapper",onWillStartDrag:this.cleanMultiSelection.bind(this),onDragStart:({sourcePill,x,y,addClass})=>{this.popover.close();initialPillId=sourcePill.dataset.pillId;addClass(sourcePill,"o_connector_creator_lock");this.setConnector({id:NEW_CONNECTOR_ID,highlighted:true,sourcePoint:{left:x,top:y},targetPoint:{left:x,top:y},});this.setStickyPill(sourcePill);this.interaction.mode="connect";},onDrag:({connectorCenter,x,y})=>{this.setConnector({id:NEW_CONNECTOR_ID,sourcePoint:{left:connectorCenter.x,top:connectorCenter.y},targetPoint:{left:x,top:y},});},onDragEnd:()=>{this.setConnector({id:NEW_CONNECTOR_ID,sourcePoint:null,targetPoint:null});this.setStickyPill();this.interaction.mode=null;},onDrop:({target})=>{if(initialPillId===target.dataset.pillId){return;}
const{id:masterId}=this.pills[initialPillId].record;const{id:slaveId}=this.pills[target.dataset.pillId].record;this.model.createDependency(masterId,slaveId);},});this.dragStates=[dragState,unDragState,resizeState];this.prepareSelectionFeature();onWillStart(this.computeDerivedParams);onWillUpdateProps(this.computeDerivedParams);this.virtualGrid=useVirtualGrid({scrollableRef:this.props.contentRef,initialScroll:this.props.scrollPosition,bufferCoef:0.1,onChange:(changed)=>{if("columnsIndexes"in changed){this.shouldComputeGridColumns=true;}
if("rowsIndexes"in changed){this.shouldComputeGridRows=true;}
this.render();},});onWillRender(this.onWillRender);onWillUnmount(this.onWillUnmount);useEffect((content)=>{content.addEventListener("scroll",this.throttledComputeHoverParams);return()=>{content.removeEventListener("scroll",this.throttledComputeHoverParams);};},()=>[this.gridRef.el?.parentElement]);useEffect(()=>{if(this.useFocusDate){this.useFocusDate=false;this.focusDate(this.model.metaData.focusDate);}});useCallbackRecorder(this.env.getCurrentFocusDateCallBackRecorder,this.getCurrentFocusDate.bind(this));}
get foldedGridColumnCount(){return this.offHoursState.foldedGridColumnSpans?.length??this.columnCount;}
get controlsProps(){return{displayExpandCollapseButtons:this.rows[0]?.isGroup,model:this.model,focusToday:()=>this.focusToday(),getCurrentFocusDate:()=>this.getCurrentFocusDate(),};}
get hasRowHeaders(){const{groupedBy}=this.model.metaData;const{displayMode}=this.model.displayParams;return groupedBy.length||displayMode==="sparse";}
get isDragging(){return this.dragStates.some((s)=>s.dragging);}
get isTouchDevice(){return isMobileOS()||hasTouch();}
get allColumnsFolded(){if(this.model.metaData.displayUnavailability&&JSON.stringify(this.offHoursState.foldedColumns)===JSON.stringify(this.foldableColumns)){return true;}
return false;}
addStickyCoordinates(rows,columns){this.stickyGridRows=Object.assign({},...rows.map((row)=>({[row]:true})));this.stickyGridColumns=Object.assign({},...columns.map((column)=>({[column]:true})));this.setSomeGridStyleProperties();}
removeStickyCoordinates(){this.stickyGridRows={};this.stickyGridColumns={};this.setSomeGridStyleProperties();}
appendCellGhost({startCol,endCol,startRow,endRow}){this.cellGhost.style=this.getGridPosition({row:[startRow,endRow],column:[startCol,endCol],});this.addStickyCoordinates([startRow,endRow],[startCol,endCol]);this.cellContainerRef.el.append(this.cellGhost);}
drawCellGhosts(selectedCells){this.removeCellGhosts();const rows=[];const columns=[];for(const selectedCell of selectedCells){const clone=this.cellGhost.cloneNode();const{startRow,endRow,startCol,endCol}=this.getBlock(selectedCell);const row=[startRow,endRow];const column=[startCol,endCol];clone.style=this.getGridPosition({row,column});this.cellContainerRef.el.append(clone);rows.push(...row);columns.push(...column);}
this.addStickyCoordinates(rows,columns);}
removeCellGhosts(){for(const ghost of this.gridRef.el.querySelectorAll(".o_cell_ghost")){ghost.remove();}
this.removeStickyCoordinates();}
removeCellGhost(){this.cellGhost.remove();this.removeStickyCoordinates();}
getAllCells(cells,action){switch(action){case"add":return this.selectedCells.union(cells);case"toggle":return this.selectedCells.symmetricDifference(cells);case"replace":return cells;}}
updateMultiSelection({startCol,endCol,startRow,endRow},action){const cells=this.getCellsInBlock({startCol,endCol,startRow,endRow});this.selectedCells=this.getAllCells(cells,action);this.multiSelectionButtonsReactive.visible=Boolean(this.selectedCells.size);this.multiSelectionButtonsReactive.nbSelected=this.getSelectedRecordIds(this.selectedCells).length;if(this.selectedCells.size===1&&this.model.metaData.canPlan){const selectedCell=[...this.selectedCells][0];const{startRow,startCol}=this.getBlock(selectedCell);const rowId=this.rowIdsByFirstRow[startRow];this.multiSelectionButtonsReactive.onPlan=()=>this.onPlan(rowId,startCol,startCol);}else{delete this.multiSelectionButtonsReactive.onPlan;}}
createFromSelection(){if(!this.selectedCells?.size){return false;}
const cellBlocks=[];for(const selectedCell of this.selectedCells){cellBlocks.push(this.getBlock(selectedCell));}
cellBlocks.sort((b1,b2)=>b1.startRow-b2.startRow||b1.startCol-b2.startCol);const firstBlock=cellBlocks[0];for(let i=1;i<cellBlocks.length;i++){const{startRow,startCol,endCol}=cellBlocks[i];if(startRow!==firstBlock.startRow||startCol!==firstBlock.endCol){break;}
firstBlock.endCol=endCol;}
const rowId=this.rowIdsByFirstRow[firstBlock.startRow];this.onCreate(rowId,firstBlock.startCol,firstBlock.endCol-1);return true;}
cleanMultiSelection(){this.selectedCells=new Set();this.multiSelectionButtonsReactive.visible=false;this.multiSelectionButtonsReactive.nbSelected=0;delete this.multiSelectionButtonsReactive.onPlan;this.removeCellGhosts();}
prepareMultiSelectionButtonsReactive(){return reactive({onCancel:this.cleanMultiSelection.bind(this),onAdd:(multiCreateData)=>{this.onMultiCreate(multiCreateData,this.selectedCells);this.cleanMultiSelection();},onDelete:()=>{this.onMultiDelete(this.selectedCells);this.cleanMultiSelection();},nbSelected:0,resModel:this.model.metaData.resModel,multiCreateView:this.model.metaData.multiCreateView||"",multiCreateValues:this.props.multiCreateValues,showMultiCreateTimeRange:this.model.showMultiCreateTimeRange,visible:false,context:this.model.searchParams.context,});}
prepareSelectionFeature(){const scale=()=>this.model.metaData.scale;const getDatetime=(col)=>this.getSubColumnFromColNumber(col).start;this.selectedCells=new Set();this.cellGhost=document.createElement("div");this.cellGhost.classList.add("o_gantt_cell","o_drag_hover","o_cell_ghost","pe-none");this.multiSelectionButtonsReactive=this.prepareMultiSelectionButtonsReactive();let action=null;const update=({startCol,endCol,startRow,endRow})=>{if(this.model.hasMultiCreate){const cells=this.getCellsInBlock({startCol,endCol,startRow,endRow});const selectedCells=this.getAllCells(cells,action);this.drawCellGhosts(selectedCells);return;}
this.appendCellGhost({startCol,endCol,startRow,endRow});const startDate=getDatetime(startCol);const stopDate=getDatetime(endCol);this.updateBadges(getBadges(this.cellGhost,[startDate],[stopDate],{rtl:rtl(),scale:scale(),}));};const selectState=useGanttSelectable({enable:()=>Boolean(this.cellForDrag.el)&&!this.cellForDrag.el.classList.contains("o_gantt_group")&&(this.model.metaData.canCellCreate||this.model.hasMultiCreate),ref:this.gridRef,hoveredCell:this.cellForDrag,elements:".o_gantt_cell",edgeScrolling:{speed:40,threshold:150,direction:this.model.hasMultiCreate?undefined:"horizontal",},hasMultiCreate:()=>this.model.hasMultiCreate,rtl,scale,onDragStart:({startCol,endCol,startRow,endRow})=>{action=this.ctrlPressed?"add":"replace";update({startCol,endCol,startRow,endRow});},onDrag:update,onDrop:({rowId,startCol,endCol,startRow,endRow})=>{if(this.model.hasMultiCreate){this.updateMultiSelection({startCol,endCol,startRow,endRow},action);}else{this.removeCellGhost();this.clearBadges();this.onCreate(rowId,startCol,endCol-1);}
action=null;},});useBus(this.model.bus,"update",this.cleanMultiSelection.bind(this));useCallbackRecorder(this.env.createFromSelectionCallBackRecorder,this.createFromSelection.bind(this));this.dragStates.push(selectState);}
addCoordinatesToCoarseGrid({grid}){if(grid.row){this.coarseGridRows[this.getFirstGridRow({grid})]=true;this.coarseGridRows[this.getLastGridRow({grid})]=true;}
if(grid.column){this.coarseGridCols[this.getFirstGridCol({grid})]=true;this.coarseGridCols[this.getLastGridCol({grid})]=true;}}
addTo(pill,group){group.pills.push(pill);group.aggregateValue++;return true;}
shouldAggregate(row,group){return Boolean(group.pills.length);}
aggregatePills(pills,row){const groups={};function getGroup(col){if(!(col in groups)){groups[col]={break:false,col,pills:[],aggregateValue:0,grid:{column:[col,col+1]},};}
return groups[col];}
const lastCol=this.columnCount*this.model.metaData.scale.cellPart+1;for(const pill of pills){let addedInPreviousCol=false;let col;for(col=this.getFirstGridCol(pill);col<this.getLastGridCol(pill);col++){const group=getGroup(col);const added=this.addTo(pill,group);if(addedInPreviousCol!==added){group.break=true;}
addedInPreviousCol=added;}
if(addedInPreviousCol&&col<lastCol){const group=getGroup(col);group.break=true;}}
const filteredGroups=Object.values(groups).filter((g)=>this.shouldAggregate(row,g));if(this.shouldMergeGroups()){return this.mergeGroups(filteredGroups);}
return filteredGroups;}
calculatePillsLevel(pills){const firstPill=pills[0];firstPill.level=0;const levels=[{pills:[firstPill],maxCol:this.getLastGridCol(firstPill)-1,},];for(const currentPill of pills.slice(1)){const lastCol=this.getLastGridCol(currentPill)-1;for(let l=0;l<levels.length;l++){const level=levels[l];if(this.getFirstGridCol(currentPill)>level.maxCol){currentPill.level=l;level.pills.push(currentPill);level.maxCol=lastCol;break;}}
if(isNaN(currentPill.level)){currentPill.level=levels.length;levels.push({pills:[currentPill],maxCol:lastCol,});}}
return levels.length;}
makeSubColumn(start,delta,cellTime,time){const subCellStart=dateAddFixedOffset(start,{[time]:delta*cellTime});const subCellStop=dateAddFixedOffset(start,{[time]:(delta+1)*cellTime,seconds:-1,});return{start:subCellStart,stop:subCellStop};}
computeVisibleColumns(){const[firstIndex,lastIndex]=this.virtualGrid.columnsIndexes;this.columnsGroups=[];this.columns=[];this.subColumns=[];this.coarseGridCols={1:true,[this.columnCount*this.model.metaData.scale.cellPart+1]:true,};const{displayUnavailability,globalStart,globalStop,scale}=this.model.metaData;const{cellPart,interval,unit}=scale;const now=DateTime.local();const nowStart=now.startOf(interval);const nowEnd=now.endOf(interval);const groupsLeftBound=DateTime.max(globalStart,localStartOf(globalStart.plus({[interval]:this.getIndexInTotalGrid(firstIndex),}),unit));const groupsRightBound=DateTime.min(localEndOf(globalStart.plus({[interval]:this.getIndexInTotalGrid(lastIndex),}),unit),globalStop);let currentGroup=null;for(let j=firstIndex;j<=lastIndex;j++){const columnIndex=this.getIndexInTotalGrid(j);const col=columnIndex*cellPart+1;const{start,stop}=this.getColumnFromColNumber(col);const span=this.offHoursState.foldedGridColumnSpans?.[j]||1;const column={index:columnIndex,grid:{column:[col,col+cellPart]},start,stop,};const isToday=nowStart<=start&&start<=nowEnd;if(isToday){column.isToday=true;}
if(this.offHoursState.foldedColumns?.[columnIndex]){column.stop=this.getColumnFromColNumber(col+(span-1)*cellPart).stop;column.isFolded=true;column.grid.column[1]=col+span*cellPart;}
if(displayUnavailability){const foldableColumnsGroup=this.foldableColumnsMapping[columnIndex];column.isFoldable=foldableColumnsGroup?foldableColumnsGroup.stopIndex===columnIndex+span-1?"stop":1:0;}
if(column.isFolded){this.coarseGridCols[col]=true;}else{for(let i=0;i<cellPart;i++){const subColumn=this.getSubColumnFromColNumber(col+i);this.subColumns.push({...subColumn,isToday,columnIndex});this.coarseGridCols[col+i]=true;}}
this.columns.push(column);const groupStart=localStartOf(start,unit);if(!currentGroup||!groupStart.equals(currentGroup.start)){const startingBound=DateTime.max(groupsLeftBound,groupStart);const endingBound=DateTime.min(groupsRightBound,localEndOf(groupStart,unit));const[groupFirstCol,groupLastCol]=this.getGridColumnFromDates(startingBound,endingBound);currentGroup={grid:{column:[groupFirstCol,groupLastCol]},start:groupStart,isFolded:columnIndex===0&&groupLastCol<column.grid.column[1],};this.columnsGroups.push(currentGroup);this.coarseGridCols[groupFirstCol]=true;this.coarseGridCols[groupLastCol]=true;}
if(j===lastIndex&&currentGroup.grid.column[1]<column.grid.column[1]){this.columnsGroups.push({grid:{column:[currentGroup.grid.column[1],column.grid.column[1]]},isFolded:true,});}}}
computeVisibleRows(){this.coarseGridRows={1:true,[this.getLastGridRow(this.rows[this.rows.length-1])]:true,};const[rowStart,rowEnd]=this.virtualGrid.rowsIndexes;this.rowsToRender=new Set();for(const row of this.rows){const[first,last]=row.grid.row;if(last<=rowStart+1||first>rowEnd+1){continue;}
this.addToRowsToRender(row);}}
getIndexInTotalGrid(index){return this.offHoursState.mappingFoldedGridToTotalGridColumnIndex?.get(index)||index;}
getColNumberInFoldedGrid(num){return this.offHoursState.mappingTotalGridToFoldedGridSubColumns?.get(num)||num;}
getFirstGridCol({grid}){const[first]=grid.column;return first;}
getLastGridCol({grid}){const[,last]=grid.column;return last;}
getFirstGridRow({grid}){const[first]=grid.row;return first;}
getLastGridRow({grid}){const[,last]=grid.row;return last;}
addToPillsToRender(pill){this.pillsToRender.add(pill);this.addCoordinatesToCoarseGrid(pill);}
addToRowsToRender(row){this.rowsToRender.add(row);const[first,last]=row.grid.row;for(let i=first;i<=last;i++){this.coarseGridRows[i]=true;}}
getVisibleCols(){const[firstIndex,lastIndex]=this.virtualGrid.columnsIndexes;const startIndex=this.getIndexInTotalGrid(firstIndex);const endIndex=this.getIndexInTotalGrid(lastIndex);const{cellPart}=this.model.metaData.scale;const firstVisibleCol=1+cellPart*startIndex;const lastVisibleCol=1+cellPart*(endIndex+1);return[firstVisibleCol,lastVisibleCol];}
getVisibleRows(){const[firstIndex,lastIndex]=this.virtualGrid.rowsIndexes;const firstVisibleRow=firstIndex+1;const lastVisibleRow=lastIndex+1;return[firstVisibleRow,lastVisibleRow];}
computeVisiblePills(){this.pillsToRender=new Set();const[firstVisibleCol,lastVisibleCol]=this.getVisibleCols();const[firstVisibleRow,lastVisibleRow]=this.getVisibleRows();const isOut=(pill,filterOnRow=true)=>this.getFirstGridCol(pill)>lastVisibleCol||this.getLastGridCol(pill)<firstVisibleCol||(filterOnRow&&(this.getFirstGridRow(pill)>lastVisibleRow||this.getLastGridRow(pill)-1<firstVisibleRow));const getRowPills=(row,filterOnRow)=>(this.rowPills[row.id]||[]).filter((pill)=>!isOut(pill,filterOnRow));for(const row of this.rowsToRender){for(const rowPill of getRowPills(row)){this.addToPillsToRender(rowPill);}
if(!row.isGroup&&row.unavailabilities?.length){row.cellColors=this.getRowCellColors(row);}}
if(this.stickyPillId){this.addToPillsToRender(this.pills[this.stickyPillId]);}
if(this.totalRow){this.totalRow.pills=getRowPills(this.totalRow,false);for(const pill of this.totalRow.pills){this.addCoordinatesToCoarseGrid({grid:omit(pill.grid,"row")});}}}
computeVisibleConnectors(){const visibleConnectorIds=new Set([NEW_CONNECTOR_ID]);for(const pill of this.pillsToRender){const row=this.getRowFromPill(pill);if(row.isGroup){continue;}
for(const connectorId of this.mappingPillToConnectors[pill.id]||[]){visibleConnectorIds.add(connectorId);}}
this.connectorsToRender=[];for(const connectorId in this.connectors){if(!visibleConnectorIds.has(connectorId)){continue;}
this.connectorsToRender.push(this.connectors[connectorId]);const{sourcePillId,targetPillId}=this.mappingConnectorToPills[connectorId];if(sourcePillId){this.addToPillsToRender(this.pills[sourcePillId]);}
if(targetPillId){this.addToPillsToRender(this.pills[targetPillId]);}}}
getRowFromPill(pill){return this.rowByIds[pill.rowId];}
getColInCoarseGridKeys(){return Object.keys({...this.coarseGridCols,...this.stickyGridColumns});}
getRowInCoarseGridKeys(){return Object.keys({...this.coarseGridRows,...this.stickyGridRows});}
computeColsTemplate(){const colsTemplate=[];const colInCoarseGridKeys=this.getColInCoarseGridKeys();for(let i=0;i<colInCoarseGridKeys.length-1;i++){const x=+colInCoarseGridKeys[i];const y=+colInCoarseGridKeys[i+1];const{distance,flexible}=this.getSubColumnsDistance(x,y,this.cellPartWidth);const colName=`c${x}`;colsTemplate.push(`[${colName}]minmax(${distance}px,${+flexible}fr)`);}
colsTemplate.push(`[c${colInCoarseGridKeys.at(-1)}]`);return colsTemplate.join("");}
getSubColumnsDistance(start,stop,cellPartWidth){const{cellPart}=this.model.metaData.scale;if(this.offHoursState.foldedGridColumnSpans){const X=this.getColNumberInFoldedGrid(start);const Y=this.getColNumberInFoldedGrid(stop);let distance=0;let flexible=true;for(let j=X;j<Y;j++){if(this.offHoursState.foldedColumns[this.getIndexInTotalGrid(Math.floor((j-1)/cellPart))]){distance+=36/cellPart;if(this.offHoursState.foldedGridColumnSpans.length>1){flexible=false;}}else{distance+=cellPartWidth;}}
return{distance,flexible};}
return{distance:(stop-start)*cellPartWidth,flexible:true};}
computeRowsTemplate(){const rowsTemplate=[];const rowInCoarseGridKeys=this.getRowInCoarseGridKeys();for(let i=0;i<rowInCoarseGridKeys.length-1;i++){const x=+rowInCoarseGridKeys[i];const y=+rowInCoarseGridKeys[i+1];const rowName=`r${x}`;const height=this.gridRows.slice(x-1,y-1).reduce((a,b)=>a+b,0);rowsTemplate.push(`[${rowName}]${height}px`);}
rowsTemplate.push(`[r${rowInCoarseGridKeys.at(-1)}]`);return rowsTemplate.join("");}
computeSomeWidths(){const{cellPart,minimalColumnWidth}=this.model.metaData.scale;this.contentRefWidth=this.props.contentRef.el?.clientWidth??document.body.clientWidth;const rowHeaderWidthPercentage=this.hasRowHeaders?this.constructor.getRowHeaderWidth(this.contentRefWidth):0;this.rowHeaderWidth=this.hasRowHeaders?Math.round((rowHeaderWidthPercentage*this.contentRefWidth)/100):0;if(this.foldedGridColumnCount===1){this.cellPartWidth=Math.floor((this.contentRefWidth-this.rowHeaderWidth)/cellPart);this.columnWidth=this.cellPartWidth*cellPart;this.virtualGrid.setColumnsWidths([this.columnWidth]);this.totalWidth=null;return;}
this.visibleCellContainerWidth=this.contentRefWidth-this.rowHeaderWidth;const hiddenColumnsCount=this.offHoursState.foldedColumns?.reduce((sum,folded)=>(folded?sum+1:sum),0)||0;const foldedColumnsCount=this.foldedGridColumnCount+hiddenColumnsCount-this.columnCount;const columnWidth=Math.floor((this.visibleCellContainerWidth-36*foldedColumnsCount)/(this.foldedGridColumnCount-foldedColumnsCount));const rectifiedColumnWidth=Math.max(columnWidth,minimalColumnWidth);this.cellPartWidth=Math.floor(rectifiedColumnWidth/cellPart);this.columnWidth=this.cellPartWidth*cellPart;let offPeriod=0;const columnWidths=this.offHoursState.foldedColumns?this.offHoursState.foldedColumns?.reduce((res,val,index)=>{if(val===1){offPeriod++;}else{if(offPeriod>0){res.push(36);}
res.push(this.columnWidth);offPeriod=0;}
if(index===this.offHoursState.foldedColumns.length-1&&offPeriod>0){res.push(36);}
return res;},[]):new Array(this.foldedGridColumnCount).fill(this.columnWidth);this.virtualGrid.setColumnsWidths(columnWidths);if(columnWidth<=minimalColumnWidth){this.totalWidth=columnWidths.reduce((sum,w)=>sum+w,0)+this.rowHeaderWidth;}else{this.totalWidth=null;}}
computeDerivedParams(){const{rows:modelRows}=this.model.data;if(this.shouldRenderConnectors()){this.mappingRecordToPillsByRow={};this.mappingRowToPillsByRecord={};this.mappingConnectorToPills={};this.mappingPillToConnectors={};}
this.mappingCellToRecords={};this.rowIdsByFirstRow={};const{displayUnavailability,globalStart,globalStop,scale,startDate,stopDate}=this.model.metaData;this.columnCount=diffColumn(globalStart,globalStop,scale.interval);if(!this.currentStartDate||diffColumn(this.currentStartDate,startDate,"day")||diffColumn(this.currentStopDate,stopDate,"day")||this.currentScaleId!==scale.id){this.useFocusDate=true;this.mappingColToColumn=new Map();this.mappingColToSubColumn=new Map();delete this.offHoursState.foldedColumns;}
this.currentStartDate=startDate;this.currentStopDate=stopDate;this.currentScaleId=scale.id;this.currentGridRow=1;this.gridRows=[];this.nextPillId=1;this.pills={};this.rows=[];this.rowPills={};this.rowByIds={};const prePills=this.getPills();let pillsToProcess=[...prePills];for(const row of modelRows){const result=this.processRow(row,pillsToProcess);this.rows.push(...result.rows);pillsToProcess=result.pillsToProcess;}
const{displayTotalRow}=this.model.metaData;if(displayTotalRow){this.totalRow=this.getTotalRow(prePills);}
if(this.shouldRenderConnectors()){this.initializeConnectors();this.generateConnectors();}
if(displayUnavailability){this.computeUnavailabilityPeriods();this.computeFoldedGrid();}
this.shouldComputeSomeWidths=true;this.shouldComputeGridColumns=true;this.shouldComputeGridRows=true;}
computeDerivedParamsFromHover(){const{scale}=this.model.metaData;const{connector,collapsableColumnHeader,hoverable}=this.hovered;const isCellHovered=hoverable?.matches(".o_gantt_cell");this.cellForDrag.el=isCellHovered?hoverable:null;this.cellForDrag.part=0;if(isCellHovered&&scale.cellPart>1){this.cellForDrag.part=getHoveredCellPart(hoverable,this.cursorPosition.x,scale.cellPart,rtl());}
if(this.isDragging){this.progressBarsReactive.hoveredRowId=null;return;}
if(!this.connectorDragState.dragging){const hoveredConnectorId=connector?.dataset.connectorId;for(const connectorId in this.connectors){if(connectorId!==hoveredConnectorId){this.toggleConnectorHighlighting(connectorId,false);}}
if(hoveredConnectorId){this.progressBarsReactive.hoveredRowId=null;return this.toggleConnectorHighlighting(hoveredConnectorId,true);}}
this.toggleCollapsableColumnHeaderHighlighting(collapsableColumnHeader);this.progressBarsReactive.hoveredRowId=hoverable&&!hoverable.classList.contains("o_gantt_cell_folded")?hoverable.dataset.rowId:null;}
deleteConnector(connectorId){delete this.connectors[connectorId];delete this.mappingConnectorToPills[connectorId];}
get isAutoPlan(){return["consumeBuffer","maintainBuffer"].includes(this.model.metaData.rescheduleMethod);}
async dragPillDrop({pill,cellSrc,cellDst,diff}){const{rowId}=cellDst.dataset;const{dateStartField,dateStopField,scale}=this.model.metaData;const{cellTime,time}=scale;const{record}=this.pills[pill.dataset.pillId];const params=this.getScheduleParams(pill);const isCopyMode=this.interaction.dragAction==="copy";params.start=(diff||isCopyMode)&&dateAddFixedOffset(record[dateStartField],{[time]:cellTime*diff});params.stop=(diff||isCopyMode)&&dateAddFixedOffset(record[dateStopField],{[time]:cellTime*diff});params.rowId=rowId;const schedule=this.model.getSchedule(params);let copyResId;let fallbackSchedule;if(isCopyMode){copyResId=await this.model.copy(record.id,schedule,this.openPlanDialogCallback.bind(this));}else{const fallbackParams={...this.getUndoAfterDragRecordData(record),rowId:cellSrc.dataset.rowId,};fallbackSchedule=this.model.getSchedule(fallbackParams);if(this.isAutoPlan){await this.model.rescheduleAccordingToDependency(record.id,schedule,this.rescheduleAccordingToDependencyCallback.bind(this));}else{await this.model.reschedule(record.id,schedule,this.openPlanDialogCallback.bind(this));}}
if(cellDst.classList.contains("o_gantt_group")&&this.model.isClosed(rowId)){this.model.toggleRow(rowId);}
this.displayUndoNotificationAfterDrag(copyResId||record.id,this.interaction.dragAction,fallbackSchedule);}
displayUndoNotificationAfterDrag(resId,dragAction,fallbackData={}){if(!(dragAction==="copy"||dragAction==="reschedule")){return;}
if(dragAction==="reschedule"&&this.isAutoPlan){return;}
const messages=this.getUndoAfterDragMessages(dragAction);this.closeNotificationFn?.();this.closeNotificationFn=this.notificationService.add(markup`<i class="fa fa-fw fa-check"></i><span class="ms-1">${messages.success}</span>`,{type:"success",buttons:[{name:"Undo",icon:"fa-undo",onClick:async()=>{const result=await this.model.orm.call(this.model.metaData.resModel,"gantt_undo_drag_drop",[resId,dragAction,fallbackData]);this.closeNotificationFn?.();if(result){this.closeNotificationFn=this.notificationService.add(markup`<i class="fa fa-fw fa-check"></i><span class="ms-1">${messages.undo}</span>`,{type:"success"});}else{this.closeNotificationFn=this.notificationService.add(markup`<i class="fa fa-fw fa-check"></i><span class="ms-1">${messages.failure}</span>`,{type:"danger"});}
this.model.fetchData();},},],});}
getUndoAfterDragMessages(dragAction){if(dragAction==="copy"){return{success:_t("Record duplicated"),undo:_t("Record removed"),failure:_t("Record could not be removed"),};}
return{success:_t("Record rescheduled"),undo:_t("Record reschedule undone"),failure:_t("Failed to undo reschedule"),};}
getUndoAfterDragRecordData(record){const{dateStartField,dateStopField}=this.model.metaData;return{start:record[dateStartField],stop:record[dateStopField],};}
enrichPill(pill){const{colorField,fields,pillDecorations,progressField}=this.model.metaData;pill.displayName=this.getDisplayName(pill);const classes=[];if(pillDecorations){const pillContext=Object.assign({},user.context);for(const[fieldName,value]of Object.entries(pill.record)){const field=fields[fieldName];switch(field.type){case"date":{pillContext[fieldName]=value?serializeDate(value):false;break;}
case"datetime":{pillContext[fieldName]=value?serializeDateTime(value):false;break;}
default:{pillContext[fieldName]=value;}}}
for(const decoration in pillDecorations){const expr=pillDecorations[decoration];if(evaluateBooleanExpr(expr,pillContext)){classes.push(decoration);}}}
if(colorField){pill._color=getColorIndex(pill.record[colorField]);classes.push(`o_gantt_color_${pill._color}`);}
if(progressField){pill._progress=pill.record[progressField]||0;}
pill.className=classes.join(" ");return pill;}
focusDate(date,focusGroup=true){const{globalStart,globalStop,scale}=this.model.metaData;const{cellPart,interval,unit}=scale;const focusedDate=focusGroup?localStartOf(date,unit):date;const diff=focusedDate.diff(globalStart);const totalDiff=globalStop.diff(globalStart);const factor=diff/totalDiff;if(!focusGroup&&(factor<0||1<factor)){return false;}
const rtlFactor=rtl()?-1:1;if(this.columnCount===this.foldedGridColumnCount){const scrollLeft=factor*this.cellContainerRef.el.clientWidth;this.props.contentRef.el.scrollLeft=rtlFactor*scrollLeft;return true;}
const{column,delta}=this.getSubColumnFromDate(focusedDate);const col=1+diffColumn(globalStart,column,interval)*cellPart+delta;const{distance}=this.getSubColumnsDistance(1,col,this.cellPartWidth);this.props.contentRef.el.scrollLeft=rtlFactor*distance;return true;}
focusFirstPill(rowId){const pill=this.rowPills[rowId][0];if(pill){const col=this.getFirstGridCol(pill);const{start:date}=this.getColumnFromColNumber(col);this.focusDate(date);}}
focusToday(){return this.focusDate(DateTime.local().startOf("day"),false);}
generateConnectors(){this.nextConnectorId=1;this.setConnector({id:NEW_CONNECTOR_ID,highlighted:true,sourcePoint:null,targetPoint:null,});for(const slaveId in this.mappingRecordToPillsByRow){const{masterIds,pills:slavePills}=this.mappingRecordToPillsByRow[slaveId];for(const masterId of masterIds){if(!(masterId in this.mappingRecordToPillsByRow)){continue;}
const{pills:masterPills}=this.mappingRecordToPillsByRow[masterId];for(const[slaveRowId,targetPill]of Object.entries(slavePills)){for(const[masterRowId,sourcePill]of Object.entries(masterPills)){if(masterRowId===slaveRowId||!(slaveId in this.mappingRowToPillsByRecord[masterRowId]||masterId in this.mappingRowToPillsByRecord[slaveRowId])||Object.keys(this.mappingRecordToPillsByRow[slaveId].pills).every((rowId)=>rowId!==masterRowId&&masterId in this.mappingRowToPillsByRecord[rowId])||Object.keys(this.mappingRecordToPillsByRow[masterId].pills).every((rowId)=>rowId!==slaveRowId&&slaveId in this.mappingRowToPillsByRecord[rowId])){this.setConnector(...this.getConnecterValues(sourcePill,targetPill));}}}}}}
getConnecterValues(sourcePill,targetPill){return[{alert:this.getConnectorAlert(sourcePill.record,targetPill.record)},sourcePill.id,targetPill.id,this.shouldConnectorBeDashed(sourcePill),];}
shouldConnectorBeDashed(sourcePill){return false;}
getAggregateValue(group,previousGroup){return group.aggregateValue;}
getColumnStartStop(startCol,stopCol){const{start}=this.getColumnFromColNumber(startCol);const{stop}=this.getColumnFromColNumber(stopCol);return{start,stop};}
getConnectorAlert(masterRecord,slaveRecord){const{dateStartField,dateStopField}=this.model.metaData;if(slaveRecord[dateStartField]<masterRecord[dateStopField]){if(slaveRecord[dateStartField]<masterRecord[dateStartField]){return"error";}else{return"warning";}}
return null;}
ganttCellAttClass(row,column){return{o_sample_data_disabled:this.isDisabled(row),o_gantt_today:column.isToday,o_gantt_cell_folded:column.isFolded,o_gantt_group:row.isGroup,o_gantt_hoverable:this.isHoverable(row),o_group_open:!this.model.isClosed(row.id),};}
getCurrentFocusDate(){const{globalStart,globalStop}=this.model.metaData;const rtlFactor=rtl()?-1:1;const cellGridMiddleX=rtlFactor*this.props.contentRef.el.scrollLeft+
(this.contentRefWidth+this.rowHeaderWidth)/2;let factor=(cellGridMiddleX-this.rowHeaderWidth)/this.cellContainerRef.el.clientWidth;if(this.columnCount!==this.foldedGridColumnCount){let columnWidthSum=0;for(let i=0;i<this.foldedGridColumnCount;i++){if(this.offHoursState.foldedColumns[this.getIndexInTotalGrid(i)]){columnWidthSum+=36;}else{columnWidthSum+=this.columnWidth;}
if(columnWidthSum>cellGridMiddleX-this.rowHeaderWidth){factor=(this.getIndexInTotalGrid(i)+1)/this.columnCount;break;}}}
const totalDiff=globalStop.diff(globalStart);const diff=factor*totalDiff;const focusDate=globalStart.plus(diff);return focusDate;}
getConnectorCreatorAlignment(vertical){const alignment={vertical};if(rtl()){alignment.horizontal=vertical==="top"?"right":"left";}else{alignment.horizontal=vertical==="top"?"left":"right";}
return alignment;}
getScheduleParams(pill){return{};}
getDisplayName(pill){const{computePillDisplayName,dateStartField,dateStopField,scale}=this.model.metaData;const{id:scaleId}=scale;const{record}=pill;if(!computePillDisplayName){return record.display_name;}
const startDate=record[dateStartField];const stopDate=record[dateStopField];const yearlessDateFormat=omit(DateTime.DATE_SHORT,"year");const daysDelta=Interval.fromDateTimes(startDate.startOf("day"),stopDate.startOf("day")).toDuration(["day","hour"]).days;const spanAccrossDays=daysDelta&&(daysDelta>2||(startDate.endOf("day").diff(startDate,"hours").toObject().hours>=3&&stopDate.diff(stopDate.startOf("day"),"hours").toObject().hours>=3));const labels=[];if(scaleId==="year"&&!spanAccrossDays){labels.push(startDate.toLocaleString(yearlessDateFormat));}else if(scaleId==="year"||(spanAccrossDays&&(startDate<this.currentStartDate||this.currentStopDate.endOf("day")<stopDate))){labels.push(startDate.toLocaleString(yearlessDateFormat));labels.push(stopDate.toLocaleString(yearlessDateFormat));}
if(record.allocated_hours&&!spanAccrossDays&&["week","month"].includes(scaleId)){const durationStr=this.getDurationStr(record);labels.push(toLocaleDateTimeString(startDate,{showDate:false}),`${toLocaleDateTimeString(stopDate, { showDate: false })}${durationStr}`);}
const labelElements=[labels.join(" - ")];if(scaleId!=="month"||!record.allocated_hours||spanAccrossDays){labelElements.push(record.display_name);}
return labelElements.filter((el)=>!!el).join(" ");}
getDurationStr(record){const durationStr=formatFloatTime(record.allocated_hours,{noLeadingZeroHour:true,}).replace(/(:00|:)/g,"h");return` (${durationStr})`;}
getGroupPillDisplayName(pill){return pill.aggregateValue;}
getGridPosition(position){const style=[];const keys=Object.keys(pick(position,"column","row"));for(const key of keys){const prefix=key.slice(0,1);const[first,last]=position[key];style.push(`grid-${key}:${prefix}${first}/${prefix}${last}`);}
return style.join(";");}
getGroupHeaderStyle(position){return this.getGridPosition(position)+`;max-width: ${this.visibleCellContainerWidth}px`;}
setSomeGridStyleProperties(){const rowsTemplate=this.computeRowsTemplate();const colsTemplate=this.computeColsTemplate();this.gridRef.el.style.setProperty("--Gantt__GridRows-grid-template-rows",rowsTemplate);this.gridRef.el.style.setProperty("--Gantt__GridColumns-grid-template-columns",colsTemplate);}
getGridStyle(){const rowsTemplate=this.computeRowsTemplate();const colsTemplate=this.computeColsTemplate();const style={"--Gantt__RowHeader-width":`${this.rowHeaderWidth}px`,"--Gantt__Pill-height":"25px","--Gantt__Thumbnail-max-height":"16px","--Gantt__GridRows-grid-template-rows":rowsTemplate,"--Gantt__GridColumns-grid-template-columns":colsTemplate,};if(this.totalWidth!==null){style.width=`${this.totalWidth}px`;}
return Object.entries(style).map((entry)=>entry.join(":")).join(";");}
getPill(record){const{canEdit,dateStartField,dateStopField,disableDrag,globalStart,globalStop}=this.model.metaData;const startOutside=record[dateStartField]<globalStart;let recordDateStopField=record[dateStopField];if(this.model.dateStopFieldIsDate()){recordDateStopField=recordDateStopField.plus({day:1});}
const stopOutside=recordDateStopField>globalStop;const pillStartDate=startOutside?globalStart:record[dateStartField];const pillStopDate=stopOutside?globalStop:recordDateStopField;const disableStartResize=!canEdit||startOutside;const disableStopResize=!canEdit||stopOutside;const pill={disableDrag:disableDrag||disableStartResize||disableStopResize,disableStartResize,disableStopResize,grid:{column:this.getGridColumnFromDates(pillStartDate,pillStopDate)},record,};return pill;}
getGridColumnFromDates(startDate,stopDate){const{globalStart,scale}=this.model.metaData;const{cellPart,interval}=scale;const{column:column1,delta:delta1}=this.getSubColumnFromDate(startDate);const{column:column2,delta:delta2}=this.getSubColumnFromDate(stopDate,false);const firstCol=1+diffColumn(globalStart,column1,interval)*cellPart+delta1;const span=diffColumn(column1,column2,interval)*cellPart+delta2-delta1;return[firstCol,firstCol+span];}
getSubColumnFromDate(date,onLeft=true){const{interval,cellPart,cellTime,time}=this.model.metaData.scale;const column=date.startOf(interval);let delta;if(onLeft){delta=0;for(let i=1;i<cellPart;i++){const subCellStart=dateAddFixedOffset(column,{[time]:i*cellTime});if(subCellStart<=date){delta+=1;}else{break;}}}else{delta=cellPart;for(let i=cellPart-1;i>=0;i--){const subCellStart=dateAddFixedOffset(column,{[time]:i*cellTime});if(subCellStart>=date){delta-=1;}else{break;}}}
return{column,delta};}
getSubColumnFromColNumber(col){let subColumn=this.mappingColToSubColumn.get(col);if(!subColumn){const{globalStart,scale}=this.model.metaData;const{interval,cellPart,cellTime,time}=scale;const delta=(col-1)%cellPart;const columnIndex=(col-1-delta)/cellPart;const start=globalStart.plus({[interval]:columnIndex});subColumn=this.makeSubColumn(start,delta,cellTime,time);this.mappingColToSubColumn.set(col,subColumn);}
return subColumn;}
getColumnIndexFromColNumber(col){const{cellPart}=this.model.metaData.scale;const delta=(col-1)%cellPart;return(col-1-delta)/cellPart;}
getColumnFromColNumber(col){let column=this.mappingColToColumn.get(col);if(!column){const{globalStart,scale}=this.model.metaData;const{interval}=scale;const columnIndex=this.getColumnIndexFromColNumber(col);const start=globalStart.plus({[interval]:columnIndex});const stop=start.endOf(interval);column={start,stop};this.mappingColToColumn.set(col,column);}
return column;}
getPillEl(pillId){return this.getPillWrapperEl(pillId).querySelector(".o_gantt_pill");}
getPillFromGroup(group,maxAggregateValue,consolidate){const{excludeField,field,maxValue}=this.model.metaData.consolidationParams;const minColor=215;const maxColor=100;const newPill={id:`__pill__${this.nextPillId++}`,level:0,aggregateValue:group.aggregateValue,grid:group.grid,};if(consolidate&&field){newPill.consolidationValue=0;for(const pill of group.pills){if(!pill.record[excludeField]){newPill.consolidationValue+=pill.record[field];}}
newPill.consolidationMaxValue=maxValue;newPill.consolidationExceeded=newPill.consolidationValue>newPill.consolidationMaxValue;}
if(consolidate&&maxValue){const status=newPill.consolidationExceeded?"danger":"success";newPill.className=`bg-${status} border-${status}`;newPill.displayName=newPill.consolidationValue;}else{const color=minColor-
Math.round((newPill.aggregateValue-1)/maxAggregateValue)*(minColor-maxColor);newPill.style=`background-color:rgba(${color},${color},${color},0.6)`;newPill.displayName=this.getGroupPillDisplayName(newPill);}
return newPill;}
getPills(){const{records}=this.model.data;const{dateStartField}=this.model.metaData;const pills=[];for(const record of records){const pill=this.getPill(record);pills.push(this.enrichPill(pill));}
return pills.sort((p1,p2)=>p1.grid.column[0]-p2.grid.column[0]||p1.record[dateStartField]-p2.record[dateStartField]);}
getPillWrapperEl(pillId){const pillSelector=`:scope > [data-pill-id="${pillId}"]`;return this.cellContainerRef.el?.querySelector(pillSelector);}
getPlanDialogDomain(){const{dateStartField,dateStopField}=this.model.metaData;const newDomain=Domain.removeDomainLeaves(this.env.searchModel.globalDomain,[dateStartField,dateStopField,]);return Domain.and([newDomain,["|",[dateStartField,"=",false],[dateStopField,"=",false]],]).toList({});}
getPoint(pillId,onRight){if(rtl()){onRight=!onRight;}
const pillEl=this.getPillEl(pillId);const pillRect=pillEl.getBoundingClientRect();return{left:pillRect.left+(onRight?pillRect.width:0),top:pillRect.top+pillRect.height/2,};}
async _getKanbanViewParams(){const{dateStartField,dateStopField,kanbanViewId,fields,resModel}=this.model.metaData;if(kanbanViewId!==undefined){const result=await this.viewService.loadViews({resModel,views:[[kanbanViewId,"kanban"]],});const arch=result.views.kanban.arch;const archXmlDoc=parseXML(arch.replace(/&amp;nbsp;/g,nbsp));archXmlDoc.removeAttribute("highlight_color");const menu=archXmlDoc.querySelector(`templates [t-name=${KanbanRecord.KANBAN_MENU_ATTRIBUTE}]`);menu?.remove();const{relatedModels}=result;const{ArchParser}=viewRegistry.get("kanban");const archInfo=new ArchParser().parse(archXmlDoc,relatedModels,resModel);return{archInfo,...extractFieldsFromArchInfo(archInfo,fields),};}
if(!this.defaultkanbanViewParams){const nameString=_t("Name");const startString=_t("Start");const stopString=_t("Stop");const arch=`
                <kanban>
                    <templates>
                        <field name="${dateStartField}"/>
                        <field name="${dateStopField}"/>
                        <t t-name="${KanbanRecord.KANBAN_CARD_ATTRIBUTE}">
                            <ul class="p-0 mb-0 list-unstyled">
                                <li class="pe-2">
                                    <strong>${nameString}</strong>: <field name="display_name"/>
                                </li>
                                <li class="pe-2">
                                    <strong>${startString}</strong>: <span t-esc="luxon.DateTime.fromISO(record.${dateStartField}.raw_value).toFormat('f')"/>
                                </li>
                                <li class="pe-2">
                                    <strong>${stopString}</strong>: <span t-esc="luxon.DateTime.fromISO(record.${dateStopField}.raw_value).toFormat('f')"/>
                                </li>
                            </ul>
                        </t>
                    </templates>
                </kanban>
            `;const archXmlDoc=parseXML(arch.replace(/&amp;nbsp;/g,nbsp));const relatedModels={[resModel]:{fields}};const{ArchParser}=viewRegistry.get("kanban");const archInfo=new ArchParser().parse(archXmlDoc,relatedModels,resModel);this.defaultkanbanViewParams={archInfo,...extractFieldsFromArchInfo(archInfo,fields),};}
return this.defaultkanbanViewParams;}
async getPopoverProps(pill){const{record}=pill;const{id:resId,display_name:displayName}=record;const{canEdit,popoverArchParams,resModel}=this.model.metaData;const kanbanViewParams=popoverArchParams.bodyTemplate?{}:await this._getKanbanViewParams();return{...popoverArchParams,kanbanViewParams,KanbanRecord,title:displayName,context:{...record},actionContext:this.props.context,resId,resModel,reloadOnClose:()=>{this.onCloseCurrentPopover=()=>{delete this.onCloseCurrentPopover;this.model.fetchData();};},buttons:[{id:"open_view_edit_dialog",text:canEdit?_t("Edit"):_t("View"),class:"btn btn-sm btn-primary",onClick:()=>this.model.mutex.exec(()=>this.props.openDialog({resId})),},],};}
getProgressBarProps(row){return{progressBar:row.progressBar,reactive:this.progressBarsReactive,rowId:row.id,};}
getRowCellColors(row){const{unavailabilities}=row;const{cellPart}=this.model.metaData.scale;let index=0;let j=0;const cellColors={};const subSlotUnavailabilities=[];for(const subColumn of this.subColumns){const{isToday,start,stop,columnIndex}=subColumn;if(index<unavailabilities.length){let subSlotUnavailable=0;for(let i=index;i<unavailabilities.length;i++){const u=unavailabilities[i];if(stop>u.stop){index++;continue;}else if(u.start<=start){subSlotUnavailable=1;}
break;}
subSlotUnavailabilities.push(subSlotUnavailable);if((j+1)%cellPart===0){const style=getCellColor(cellPart,subSlotUnavailabilities,isToday);subSlotUnavailabilities.splice(0,cellPart);if(style){cellColors[columnIndex]=style;}}
j++;}}
return cellColors;}
getFromData(groupedByField,resId,key,defaultVal){const values=this.model.data[key];if(groupedByField){return values[groupedByField]?.[resId??false]||defaultVal;}
return values.__default?.false||defaultVal;}
getRowProgressBar(groupedByField,resId){return this.getFromData(groupedByField,resId,"progressBars",null);}
getRowUnavailabilities(groupedByField,resId){return this.getFromData(groupedByField,resId,"unavailabilities",[]);}
getRowTypeHeight(type){return{t0:24,t1:25,t2:10}[type];}
getRowTitleStyle(row){return`grid-column: ${row.groupLevel + 2} / -1`;}
openPlanDialogCallback(){}
getSelectCreateDialogProps(params){const domain=this.getPlanDialogDomain();const schedule=this.model.getDialogContext(params);return{title:_t("Plan"),resModel:this.model.metaData.resModel,context:schedule,domain,noCreate:!this.model.metaData.canCellCreate,onSelected:(resIds)=>{if(resIds.length){this.model.reschedule(resIds,schedule,this.openPlanDialogCallback.bind(this));}},};}
getTotalRow(pills){const preRow={groupLevel:0,id:"[]",rows:[],name:_t("Total"),recordIds:pills.map(({record})=>record.id),};this.currentGridRow=1;const result=this.processRow(preRow,pills);const[totalRow]=result.rows;const allPills=this.rowPills[totalRow.id]||[];const maxAggregateValue=Math.max(...allPills.map((p)=>p.aggregateValue));totalRow.factor=maxAggregateValue?90/maxAggregateValue:0;return totalRow;}
highlightPill(pillId,highlighted){const pill=this.pills[pillId];if(!pill){return;}
const pillWrapper=this.getPillWrapperEl(pillId);if(pillWrapper){pillWrapper.classList.toggle("highlight",highlighted);pillWrapper.classList.toggle("o_connector_creator_highlight",highlighted&&this.connectorDragState.dragging);}}
initializeConnectors(){for(const connectorId in this.connectors){this.deleteConnector(connectorId);}}
isPillSmall(pill){return this.cellPartWidth*pill.grid.column[1]<pill.displayName.length*10;}
isDisabled(row=null){return this.model.useSampleModel;}
isHoverable(row){return!this.model.useSampleModel;}
mergeGroups(groups){if(groups.length<=1){return groups;}
const index=Math.floor(groups.length/2);const left=this.mergeGroups(groups.slice(0,index));const right=this.mergeGroups(groups.slice(index));const group=right[0];if(!group.break){const previousGroup=left.pop();group.break=previousGroup.break;group.grid.column[0]=previousGroup.grid.column[0];group.aggregateValue=this.getAggregateValue(group,previousGroup);}
return[...left,...right];}
onWillRender(){if(this.noDisplayedConnectors&&this.shouldRenderConnectors()){delete this.noDisplayedConnectors;this.computeDerivedParams();}
if(this.shouldComputeSomeWidths){this.computeSomeWidths();}
if(this.shouldComputeSomeWidths||this.shouldComputeGridColumns){this.computeVisibleColumns();}
if(this.shouldComputeGridRows){this.virtualGrid.setRowsHeights(this.gridRows);this.computeVisibleRows();}
if(this.shouldComputeSomeWidths||this.shouldComputeGridColumns||this.shouldComputeGridRows){delete this.shouldComputeSomeWidths;delete this.shouldComputeGridColumns;delete this.shouldComputeGridRows;this.computeVisiblePills();if(this.shouldRenderConnectors()){this.computeVisibleConnectors();}else{this.noDisplayedConnectors=true;}}
delete this.shouldComputeSomeWidths;delete this.shouldComputeGridColumns;delete this.shouldComputeGridRows;}
onWillUnmount(){this.closeNotificationFn?.();}
pushGridRows(gridRows){for(const key of["t0","t1","t2"]){if(key in gridRows){const types=new Array(gridRows[key]).fill(this.getRowTypeHeight(key));this.gridRows.push(...types);}}}
processPillsAsRows(row,pills){const rows=[];const parsedId=JSON.parse(row.id);if(pills.length){for(const pill of pills){const{id:resId,display_name:name}=pill.record;const subRow={id:JSON.stringify([...parsedId,{id:resId}]),resId,name,groupLevel:row.groupLevel+1,recordIds:[resId],fromServer:row.fromServer,parentResId:row.resId??row.parentResId,parentGroupedField:row.groupedByField||row.parentGroupedField,};const res=this.processRow(subRow,[pill],false);rows.push(...res.rows);}}else{const subRow={id:JSON.stringify([...parsedId,{}]),resId:false,name:"",groupLevel:row.groupLevel+1,recordIds:[],fromServer:row.fromServer,parentResId:row.resId??row.parentResId,parentGroupedField:row.groupedByField||row.parentGroupedField,};const res=this.processRow(subRow,[],false);rows.push(...res.rows);}
return rows;}
processRow(row,pills,processAsGroup=true){const{dependencyField,displayUnavailability,fields}=this.model.metaData;const{displayMode}=this.model.displayParams;const{consolidate,fromServer,groupedByField,groupLevel,id,name,parentResId,parentGroupedField,resId,rows,recordIds,__extra__,}=row;const remainingPills=[];let rowPills=[];const groupPills=[];const isMany2many=groupedByField&&fields[groupedByField].type==="many2many";for(const pill of pills){const{record}=pill;const pushPill=recordIds.includes(record.id);let keepPill=false;if(pushPill&&isMany2many){const value=record[groupedByField];if(Array.isArray(value)&&value.length>1){keepPill=true;}}
if(pushPill){const rowPill={...pill};rowPills.push(rowPill);groupPills.push(pill);}
if(!pushPill||keepPill){remainingPills.push(pill);}}
if(displayMode==="sparse"&&__extra__){const rows=this.processPillsAsRows(row,groupPills);return{rows,pillsToProcess:remainingPills};}
const isGroup=displayMode==="sparse"?processAsGroup:Boolean(rows);const gridRowTypes=isGroup?{t0:1}:{t1:1,t2:+!this.isTouchDevice};if(rowPills.length){if(isGroup){if(this.shouldComputeAggregateValues(row)){const groups=this.aggregatePills(rowPills,row);const maxAggregateValue=Math.max(...groups.map((group)=>group.aggregateValue));rowPills=groups.map((group)=>this.getPillFromGroup(group,maxAggregateValue,consolidate));}else{rowPills=[];}}else{const level=this.calculatePillsLevel(rowPills);gridRowTypes.t1=level;}}
const progressBar=this.getRowProgressBar(groupedByField,resId);if(progressBar&&this.isTouchDevice&&(!gridRowTypes.t1||gridRowTypes.t1===1)){gridRowTypes.t1=(gridRowTypes.t1||0)+1;}
if(row.id!=="[]"){this.pushGridRows(gridRowTypes);}
const subRowsCount=Object.values(gridRowTypes).reduce((acc,val)=>acc+val,0);const gridRow=[this.currentGridRow,this.currentGridRow+subRowsCount];const subKey=`${gridRow[0]}_${gridRow[1]}`;if(this.model.hasMultiCreate&&!isGroup){this.rowIdsByFirstRow[this.currentGridRow]=row.id;}
for(const rowPill of rowPills){rowPill.id=`__pill__${this.nextPillId++}`;const pillFirstRow=this.currentGridRow+rowPill.level;rowPill.grid={...rowPill.grid,row:[pillFirstRow,pillFirstRow+1],};if(!isGroup){const{record}=rowPill;if(this.shouldRenderRecordConnectors(record)){if(!this.mappingRecordToPillsByRow[record.id]){this.mappingRecordToPillsByRow[record.id]={masterIds:record[dependencyField],pills:{},};}
this.mappingRecordToPillsByRow[record.id].pills[id]=rowPill;if(!this.mappingRowToPillsByRecord[id]){this.mappingRowToPillsByRecord[id]={};}
this.mappingRowToPillsByRecord[id][record.id]=rowPill;}
if(this.model.hasMultiCreate){const[firstRow,lastRow]=rowPill.grid.column;for(let col=firstRow;col<lastRow;col++){const key=`${subKey}_${col}_${col + 1}`;if(!this.mappingCellToRecords[key]){this.mappingCellToRecords[key]=[];}
this.mappingCellToRecords[key].push(rowPill.record);}}}
rowPill.rowId=id;this.pills[rowPill.id]=rowPill;}
this.rowPills[id]=rowPills;const processedRow={cellColors:{},fromServer,groupedByField,groupLevel,id,isGroup,name,progressBar,resId,grid:{row:gridRow},};if(displayUnavailability&&!isGroup){processedRow.unavailabilities=this.getRowUnavailabilities(parentGroupedField||groupedByField,parentResId??resId);}
this.rowByIds[id]=processedRow;this.currentGridRow+=subRowsCount;const field=this.model.metaData.thumbnails[groupedByField];if(field){const model=this.model.metaData.fields[groupedByField].relation;processedRow.thumbnailUrl=url("/web/image",{model,id:resId,field,});}
const result={rows:[processedRow],pillsToProcess:remainingPills};if(!this.model.isClosed(id)){if(rows){let pillsToProcess=groupPills;for(const subRow of rows){const res=this.processRow(subRow,pillsToProcess);result.rows.push(...res.rows);pillsToProcess=res.pillsToProcess;}}else if(displayMode==="sparse"&&processAsGroup){const rows=this.processPillsAsRows(row,groupPills);result.rows.push(...rows);}}
return result;}
async resizePillDrop({pill,diff,direction}){const{dateStartField,dateStopField,scale}=this.model.metaData;const{cellTime,time}=scale;const{record}=this.pills[pill.dataset.pillId];const params=this.getScheduleParams(pill);if(direction==="start"){params.start=dateAddFixedOffset(record[dateStartField],{[time]:cellTime*diff});if(params.start>record[dateStopField]){return this.notificationService.add(_t("Starting date cannot be after the ending date"),{type:"warning",});}}else{params.stop=dateAddFixedOffset(record[dateStopField],{[time]:cellTime*diff});if(params.stop<record[dateStartField]){return this.notificationService.add(_t("Ending date cannot be before the starting date"),{type:"warning",});}}
const schedule=this.model.getSchedule(params);const fallbackParams=this.getUndoAfterDragRecordData(record);const fallbackSchedule=this.model.getSchedule(fallbackParams);await this.model.reschedule(record.id,schedule,this.openPlanDialogCallback.bind(this));this.displayUndoNotificationAfterDrag(record.id,this.interaction.dragAction,fallbackSchedule);}
setConnector(params,sourceId=null,targetId=null,dashed=null){const connectorParams={...params};const connectorId=params.id||`__connector__${this.nextConnectorId++}`;if(sourceId){connectorParams.sourcePoint=()=>this.getPoint(sourceId,true);}
if(targetId){connectorParams.targetPoint=()=>this.getPoint(targetId,false);}
if(dashed){connectorParams.dashed=true;}
if(this.connectors[connectorId]){Object.assign(this.connectors[connectorId],connectorParams);}else{this.connectors[connectorId]={id:connectorId,highlighted:false,displayButtons:false,...connectorParams,};this.mappingConnectorToPills[connectorId]={sourcePillId:sourceId,targetPillId:targetId,};}
if(sourceId){if(!this.mappingPillToConnectors[sourceId]){this.mappingPillToConnectors[sourceId]=[];}
this.mappingPillToConnectors[sourceId].push(connectorId);}
if(targetId){if(!this.mappingPillToConnectors[targetId]){this.mappingPillToConnectors[targetId]=[];}
this.mappingPillToConnectors[targetId].push(connectorId);}}
setStickyPill(pillEl){this.stickyPillId=pillEl?pillEl.dataset.pillId:null;}
shouldComputeAggregateValues(row){return true;}
shouldMergeGroups(){return true;}
shouldRenderConnectors(){return(this.model.metaData.dependencyField&&!this.model.useSampleModel&&!this.env.isSmall);}
shouldRenderRecordConnectors(record){return this.shouldRenderConnectors();}
onConnectorHover(){return false;}
toggleConnectorHighlighting(connectorId,highlighted){const connector=this.connectors[connectorId];if(!connector||(!connector.highlighted&&!highlighted)){return;}
connector.highlighted=highlighted;connector.displayButtons=highlighted;if(this.onConnectorHover()){const{sourcePillId,targetPillId}=this.mappingConnectorToPills[connectorId];this.highlightPill(sourcePillId,highlighted);this.highlightPill(targetPillId,highlighted);}}
computeUnavailabilityPeriods(){const{cellPart,unit}=this.model.metaData.scale;const columns=[...Array(this.columnCount).keys()].map((i)=>this.getColumnFromColNumber(i*cellPart+1));this.foldableColumns=Array(this.columnCount);let allNull=true;for(const row of this.rows){if(row.isGroup){continue;}
const{unavailabilities}=row;allNull=true;if(unavailabilities){let index=0;for(let columnIndex=0;columnIndex<columns.length;columnIndex++){if(this.foldableColumns[columnIndex]===0){continue;}
this.foldableColumns[columnIndex]=0;if(index<unavailabilities.length){const{start,stop}=columns[columnIndex];for(let i=index;i<unavailabilities.length;i++){const u=unavailabilities[i];if(stop>u.stop){index++;continue;}else if(u.start<=start){this.foldableColumns[columnIndex]=1;allNull=false;}
break;}}}}
if(allNull){break;}}
if(allNull){this.foldableColumns.fill(0);}else{for(const pill of Object.values(this.pills)){this.foldableColumns.fill(0,Math.floor((pill.grid.column[0]-1)/cellPart),Math.ceil((pill.grid.column[1]-1)/cellPart));}}
this.foldableColumnsMapping={};let foldableGroupNum=0;let foldableSubSet;for(let i=0;i<this.foldableColumns.length;i++){if(this.foldableColumns[i]){const next=this.foldableColumns[i+1];const previous=this.foldableColumns[i-1];if(!previous){foldableSubSet={foldableGroupNum};foldableGroupNum++;foldableSubSet.startIndex=i;}
if(next===1){this.foldableColumnsMapping[i]=foldableSubSet;continue;}
if(!previous&&unit!=="week"){this.foldableColumns[i]=0;continue;}
foldableSubSet.stopIndex=i;this.foldableColumnsMapping[i]=foldableSubSet;}}}
computeFoldedGrid(){this.shouldComputeSomeWidths=true;if(this.offHoursState.foldedColumns&&!this.offHoursState.foldedColumns.includes(1)){clearObject(this.offHoursState);return;}
let foldedColumns=this.foldableColumns;if(this.offHoursState.foldedColumns?.length===this.columnCount){foldedColumns=zipWith(this.foldableColumns,this.offHoursState.foldedColumns,(a,b)=>a&b);}
let offPeriod=0;this.offHoursState.foldedGridColumnSpans=foldedColumns.reduce((res,val,index)=>{if(val===1){offPeriod++;}else{if(offPeriod>0){res.push(offPeriod);}
res.push(1);offPeriod=0;}
if(index===foldedColumns.length-1&&offPeriod>0){res.push(offPeriod);}
return res;},[]);const{cellPart,unit}=this.model.metaData.scale;this.offHoursState.mappingTotalGridToFoldedGridSubColumns=new Map();this.offHoursState.foldedColumns=[];const halfCut=Math.floor(cellPart/2);let count=0;for(let index=0;index<this.offHoursState.foldedGridColumnSpans.length;index++){const val=this.offHoursState.foldedGridColumnSpans[index];if(val>1){for(let j=0;j<val;j++){for(let i=1;i<=cellPart;i++){const targetIndex=j===0?index*cellPart+(i<=halfCut?i:halfCut+1):j===val-1?index*cellPart+(i<=halfCut?halfCut+1:i):index*cellPart+halfCut+1;this.offHoursState.mappingTotalGridToFoldedGridSubColumns.set(count*cellPart+i,targetIndex);}
count++;this.offHoursState.foldedColumns.push(1);}}else{for(let i=1;i<=cellPart;i++){this.offHoursState.mappingTotalGridToFoldedGridSubColumns.set(count*cellPart+i,index*cellPart+i);}
if(foldedColumns[count]&&unit==="week"){this.offHoursState.foldedColumns.push(1);}else{this.offHoursState.foldedColumns.push(0);}
count++;}}
this.offHoursState.mappingTotalGridToFoldedGridSubColumns.set(this.columnCount*cellPart+1,this.offHoursState.foldedGridColumnSpans.length*cellPart+1);let colIndex=0;this.offHoursState.mappingFoldedGridToTotalGridColumnIndex=new Map(this.offHoursState.foldedGridColumnSpans.map((val,gridIndex)=>{const res=[gridIndex,colIndex];colIndex+=val;return res;}));}
toggleFoldableColumn(column,fold){if(!this.offHoursState.foldedColumns){this.offHoursState.foldedColumns=new Array(this.columnCount).fill(0);}
const{startIndex,stopIndex}=this.foldableColumnsMapping[column.index];this.offHoursState.foldedColumns.fill(fold?1:0,startIndex,stopIndex+1);this.computeFoldedGrid();this.cleanMultiSelection();}
toggleCollapsableColumnHeaderHighlighting(collapsableColumnHeader){if(!collapsableColumnHeader||collapsableColumnHeader.classList.contains("o_gantt_header_folded")){const columnHeaders=this.gridRef.el.querySelectorAll(".o_gantt_foldable_hovered");for(const columnHeader of columnHeaders){columnHeader.classList.remove("o_gantt_foldable_hovered");}
return;}
const columnHeaders=this.gridRef.el.querySelectorAll(".o_gantt_foldable");const foldableColumnsGroup=this.foldableColumnsMapping[+collapsableColumnHeader.dataset.columnIndex];for(const columnHeader of columnHeaders){const columnIndex=+columnHeader.dataset.columnIndex;const currentGroup=this.foldableColumnsMapping[columnIndex];if(foldableColumnsGroup.foldableGroupNum===currentGroup.foldableGroupNum){columnHeader.classList.add("o_gantt_foldable_hovered");}else{columnHeader.classList.remove("o_gantt_foldable_hovered");}}}
initBadges(pill){const{dateStartField,dateStopField}=this.model.metaData;const{record}=this.pills[pill.dataset.pillId];this.badgeInitialStartDate=record[dateStartField];this.badgeInitialStopDate=record[dateStopField];}
updateBadges({startBadge,stopBadge}){Object.assign(this.timeDisplayBadgeReactiveStart,startBadge);Object.assign(this.timeDisplayBadgeReactiveStop,stopBadge);}
clearBadges(){clearObject(this.timeDisplayBadgeReactiveStart);clearObject(this.timeDisplayBadgeReactiveStop);delete this.badgeInitialStartDate;delete this.badgeInitialStopDate;}
getSelectedRecordIds(selectedCells,predicate=()=>true){const ids=new Set();for(const selectedCell of selectedCells){const recordsInSelectedCell=this.mappingCellToRecords[selectedCell];for(const record of recordsInSelectedCell||[]){if(predicate(record)){ids.add(record.id);}}}
return[...ids];}
onMultiDelete(selectedCells){const ids=this.getSelectedRecordIds(selectedCells);return this.model.unlinkRecords(ids);}
getCellsInBlock(block){const{startCol,endCol,startRow,endRow}=block;const gridRowByFirstRow={};for(const row of this.rows){const gridRow=row.grid.row;const[first]=gridRow;if(first>=endRow){break;}
if(startRow<=first){gridRowByFirstRow[first]=gridRow;}}
const notFoldedCols=new Set();for(let col=startCol;col<endCol;col++){const columnIndex=this.getColumnIndexFromColNumber(col);const isFolded=Boolean(this.offHoursState.foldedColumns?.[columnIndex]);if(!isFolded){notFoldedCols.add(col);}}
const cells=new Set();for(const gridRow of Object.values(gridRowByFirstRow)){const subKey=`${gridRow[0]}_${gridRow[1]}`;for(const col of notFoldedCols){cells.add(`${subKey}_${col}_${col + 1}`);}}
return cells;}
getBlock(selectedCell){const[startRow,endRow,startCol,endCol]=selectedCell.split("_");return{startCol:+startCol,endCol:+endCol,startRow:+startRow,endRow:+endRow};}
getCellsInfo(selectedCells){const cellsInfo=[];const colsInfo={};for(const selectedCell of selectedCells){const{startRow,startCol}=this.getBlock(selectedCell);const rowId=this.rowIdsByFirstRow[startRow];if(!rowId){continue;}
if(!colsInfo[startCol]){let{start,stop}=this.getSubColumnFromColNumber(startCol);({start,stop}=this.normalizeTimeRange(start,stop));colsInfo[startCol]={start,stop};}
const{start,stop}=colsInfo[startCol];cellsInfo.push({rowId,start,stop});}
return cellsInfo;}
onMultiCreate(multiCreateData,selectedCells){const cellsInfo=this.getCellsInfo(selectedCells);return this.model.multiCreateRecords(multiCreateData,cellsInfo);}
onCellClicked(rowId,column,row){const startCol=column.grid.column[0];if(this.model.hasMultiCreate){if(column.isFolded){return;}
const endCol=startCol+this.model.metaData.scale.cellPart;const[startRow,endRow]=row;const block={startCol,endCol,startRow,endRow};const action=this.ctrlPressed?"toggle":"replace";this.updateMultiSelection(block,action);this.drawCellGhosts(this.selectedCells);return;}
if(!this.preventClick){this.preventClick=true;setTimeout(()=>(this.preventClick=false),1000);if(column.isFolded){this.toggleFoldableColumn(column,false);return;}
const{canCellCreate,canPlan}=this.model.metaData;if(canPlan){this.onPlan(rowId,startCol,startCol);}else if(canCellCreate){this.onCreate(rowId,startCol,startCol+this.model.metaData.scale.cellPart-1);}}}
onCreate(rowId,startCol,stopCol,additionalContext={}){let{start}=this.getSubColumnFromColNumber(startCol);let{stop}=this.getSubColumnFromColNumber(stopCol);({start,stop}=this.normalizeTimeRange(start,stop));const context=this.model.getDialogContext({rowId,start,stop,withDefault:true,});this.props.create({...context,...additionalContext,});}
normalizeTimeRange(start,stop){stop=stop.plus({second:1});return{start,stop};}
onInteractionChange(){let{dragAction,mode}=this.interaction;if(mode==="drag"){mode=dragAction;}
if(this.gridRef.el){for(const[action,className]of INTERACTION_CLASSNAMES){this.gridRef.el.classList.toggle(className,mode===action);}}}
onPointerLeave(){this.throttledComputeHoverParams.cancel();if(!this.isDragging){const hoveredConnectorId=this.hovered.connector?.dataset.connectorId;this.toggleConnectorHighlighting(hoveredConnectorId,false);this.toggleCollapsableColumnHeaderHighlighting(null);}
this.hovered.connector=null;this.hovered.pill=null;this.hovered.hoverable=null;this.hovered.collapsableColumnHeader=null;this.computeDerivedParamsFromHover();}
computeHoverParams(ev){let els=null;let position={};if(ev.type==="scroll"){position=this.cursorPosition;}else{position.x=ev.clientX;position.y=ev.clientY;this.cursorPosition=position;}
const pointedEls=()=>els||(els=document.elementsFromPoint(position.x,position.y));const find=(selector)=>ev.target.closest?.(selector)||pointedEls().find((el)=>el.matches(selector))||null;this.hovered.connector=find(".o_gantt_connector");this.hovered.hoverable=find(".o_gantt_hoverable");this.hovered.pill=find(".o_gantt_pill_wrapper");this.hovered.collapsableColumnHeader=find(".o_gantt_foldable");this.computeDerivedParamsFromHover();}
async onPillClicked(ev,pill){if(this.popover.isOpen){return;}
const target=ev.target.closest(".o_gantt_pill_wrapper");const props=await this.keepLast.add(this.getPopoverProps(pill));this.popover.open(target,props);}
onPlan(rowId,startCol,stopCol){let{start,stop}=this.getColumnStartStop(startCol,stopCol);({start,stop}=this.normalizeTimeRange(start,stop));this.dialogService.add(SelectCreateDialog,this.getSelectCreateDialogProps({rowId,start,stop,withDefault:true}));}
getRecordIds(connectorId){const{sourcePillId,targetPillId}=this.mappingConnectorToPills[connectorId];return{masterId:this.pills[sourcePillId]?.record.id,slaveId:this.pills[targetPillId]?.record.id,};}
onRemoveButtonClick(connectorId){const{masterId,slaveId}=this.getRecordIds(connectorId);this.model.removeDependency(masterId,slaveId);}
rescheduleAccordingToDependencyCallback(result){const isWarning=result.type==="warning";if(!isWarning&&"old_vals_per_pill_id"in result){this.model.toggleHighlightPlannedFilter(Object.keys(result["old_vals_per_pill_id"]).map(Number));}
this.closeNotificationFn?.();const icon=isWarning?"fa-warning":"fa-check";this.closeNotificationFn=this.notificationService.add(markup`<i class="fa ${icon}"></i><span class="ms-1">${result["message"]}</span>`,{type:result["type"],sticky:true,buttons:isWarning||!result.old_vals_per_pill_id?[]:[{name:"Undo",icon:"fa-undo",onClick:async()=>{const ids=Object.keys(result["old_vals_per_pill_id"]).map(Number);await this.orm.call(this.model.metaData.resModel,"action_rollback_scheduling",[ids,result["old_vals_per_pill_id"]]);this.closeNotificationFn();await this.model.fetchData();},},],});}
onWindowKeyDown(ev){if(ev.key==="Control"){this.prevDragAction=this.interaction.dragAction==="copy"?"reschedule":this.interaction.dragAction;this.interaction.dragAction="copy";this.ctrlPressed=true;}}
onWindowKeyUp(ev){if(ev.key==="Control"){this.interaction.dragAction=this.prevDragAction||"reschedule";this.ctrlPressed=false;}}}
return __exports;});;

/* /web_gantt/static/src/gantt_renderer_controls.js */
odoo.define('@web_gantt/gantt_renderer_controls',['@odoo/owl','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@web/core/l10n/dates','@web/core/l10n/translation','@web/core/utils/objects','@web/core/utils/timing','@web_gantt/gantt_helpers','@web_gantt/gantt_scale_selector'],function(require){'use strict';let __exports={};const{Component,useState}=require("@odoo/owl");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{formatDate}=require("@web/core/l10n/dates");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_gantt",...args);const{pick}=require("@web/core/utils/objects");const{debounce}=require("@web/core/utils/timing");const{diffColumn}=require("@web_gantt/gantt_helpers");const{GanttScaleSelector}=require("@web_gantt/gantt_scale_selector");const{DateTime}=luxon;const KEYS=["startDate","stopDate","rangeId","focusDate","rescheduleMethod"];const GanttRendererControls=__exports.GanttRendererControls=class GanttRendererControls extends Component{static template="web_gantt.GanttRendererControls";static components={Dropdown,DropdownItem,GanttScaleSelector,};static props=["model","displayExpandCollapseButtons","focusToday","getCurrentFocusDate","slots?",];static toolbarContentTemplate="web_gantt.GanttRendererControls.ToolbarContent";static rangeMenuTemplate="web_gantt.GanttRendererControls.RangeMenu";setup(){this.model=this.props.model;this.updateMetaData=debounce(()=>this.model.fetchData(this.makeParams()),500);this.state=useState(pick(this.model.metaData,...KEYS));}
getGanttScaleSelectorProps(){return{scales:{...this.model.metaData.ranges,custom:{description:_t("From: %(from_date)s to: %(to_date)s",{from_date:formatDate(this.state.startDate),to_date:formatDate(this.state.stopDate),}),},},currentScale:this.state.rangeId,setScale:this.selectRangeId.bind(this),selectCustomRange:this.selectCustomRange.bind(this),startDate:this.state.startDate,stopDate:this.state.stopDate,};}
makeParams(){const params=pick(this.state,...KEYS);if(this.state.keepCurrentFocusDate){params.currentFocusDate=this.props.getCurrentFocusDate();}
return params;}
onTodayClicked(){const success=this.props.focusToday();if(success){return;}
this.state.focusDate=DateTime.local().startOf("day");if(this.state.rangeId==="custom"){const diff=diffColumn(this.state.startDate,this.state.stopDate,"day");if(diff===0){this.state.startDate=this.state.stopDate=this.state.focusDate;}else{const n=Math.floor(diff/2);const m=diff-n;this.state.startDate=this.state.focusDate.minus({day:n});this.state.stopDate=this.state.focusDate.plus({day:m-1});}}else{Object.assign(this.state,this.model.getRangeFromDate(this.state.rangeId,this.state.focusDate));}
delete this.state.keepCurrentFocusDate;this.updateMetaData();}
selectRange(direction){const sign=direction==="next"?1:-1;const{focusDate,rangeId,startDate,stopDate}=this.state;if(rangeId==="custom"){const diff=diffColumn(startDate,stopDate,"day")+1;this.state.focusDate=focusDate.plus({day:sign*diff});this.state.startDate=startDate.plus({day:sign*diff});this.state.stopDate=stopDate.plus({day:sign*diff});}else{Object.assign(this.state,this.model.getRangeFromDate(rangeId,focusDate.plus({[rangeId]:sign})));}
delete this.state.keepCurrentFocusDate;this.updateMetaData();}
selectRangeId(rangeId){Object.assign(this.state,this.model.getRangeFromDate(rangeId,DateTime.now().startOf("day")));delete this.state.keepCurrentFocusDate;this.updateMetaData();}
selectCustomRange(startDate,stopdDate){this.state.rangeId="custom";this.state.startDate=startDate;this.state.stopDate=stopdDate;this.state.keepCurrentFocusDate=true;this.updateMetaData();}
get displayRescheduleMethods(){return(this.model.metaData.dependencyEnabled&&!this.model.useSampleModel&&!this.env.isSmall);}
selectRescheduleMethod(method){Object.assign(this.state,{rescheduleMethod:method});this.updateMetaData();}}
return __exports;});;

/* /web_gantt/static/src/gantt_row_progress_bar.js */
odoo.define('@web_gantt/gantt_row_progress_bar',['@odoo/owl','@web/core/browser/feature_detection'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{hasTouch,isMobileOS}=require("@web/core/browser/feature_detection");const GanttRowProgressBar=__exports.GanttRowProgressBar=class GanttRowProgressBar extends Component{static props={reactive:{type:Object,shape:{hoveredRowId:[String,{value:null}],},},rowId:String,progressBar:{type:Object,shape:{max_value:Number,max_value_formatted:String,ratio:Number,value_formatted:String,warning:{type:String,optional:true},"*":true,},},};static template="web_gantt.GanttRowProgressBar";get show(){const{reactive,rowId}=this.props;return reactive.hoveredRowId===rowId||isMobileOS()||hasTouch();}
get status(){const{ratio}=this.props.progressBar;return ratio>100?"danger":ratio>0?"success":null;}}
return __exports;});;

/* /web_gantt/static/src/gantt_sample_server.js */
odoo.define('@web_gantt/gantt_sample_server',['@web/core/registry'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");function _mockGetGanttData(params){let groups=this._mockFormattedReadGroup({...params,aggregates:["id:array_agg"]});if(params.limit){groups=groups.slice(0,params.limit);}
const length=groups.length;groups.forEach((g)=>(g["id:array_agg"]=g.id));const unavailabilities={};for(const fieldName of params.unavailability_fields||[]){unavailabilities[fieldName]={};}
const progress_bars={};for(const fieldName of params.progress_bar_fields||[]){progress_bars[fieldName]={};}
return{groups,length,records:[],unavailabilities,progress_bars};}
registry.category("sample_server").add("get_gantt_data",_mockGetGanttData);return __exports;});;

/* /web_gantt/static/src/gantt_scale_selector.js */
odoo.define('@web_gantt/gantt_scale_selector',['@odoo/owl','@web/core/datetime/datetime_picker_hook','@web/core/dropdown/dropdown_hooks','@web/core/l10n/dates','@web/core/l10n/translation','@web/views/view_components/view_scale_selector','@web_gantt/gantt_helpers'],function(require){'use strict';let __exports={};const{onWillUpdateProps,useState}=require("@odoo/owl");const{useDateTimePicker}=require("@web/core/datetime/datetime_picker_hook");const{useDropdownState}=require("@web/core/dropdown/dropdown_hooks");const{formatDate}=require("@web/core/l10n/dates");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_gantt",...args);const{ViewScaleSelector}=require("@web/views/view_components/view_scale_selector");const{useGanttResponsivePopover}=require("@web_gantt/gantt_helpers");const{DateTime}=luxon;const GanttScaleSelector=__exports.GanttScaleSelector=class GanttScaleSelector extends ViewScaleSelector{static template="web_gantt.GanttScaleSelector";static props={...ViewScaleSelector.props,startDate:DateTime,stopDate:DateTime,selectCustomRange:Function,};setup(){super.setup();this.pickerValues=useState({startDate:this.props.startDate,stopDate:this.props.stopDate,});onWillUpdateProps((nextProps)=>{this.pickerValues.startDate=nextProps.startDate;this.pickerValues.stopDate=nextProps.stopDate;});const getPickerProps=(key)=>({type:"date",value:this.pickerValues[key]});this.startPicker=useDateTimePicker({target:"start-picker",onApply:(date)=>{this.pickerValues.startDate=date;if(this.pickerValues.stopDate<date){this.pickerValues.stopDate=date;}else if(date.plus({year:10,day:-1})<this.pickerValues.stopDate){this.pickerValues.stopDate=date.plus({year:10,day:-1});}},get pickerProps(){return getPickerProps("startDate");},createPopover:(...args)=>useGanttResponsivePopover(_t("Gantt start date"),...args),ensureVisibility:()=>false,});this.stopPicker=useDateTimePicker({target:"stop-picker",onApply:(date)=>{this.pickerValues.stopDate=date;if(date<this.pickerValues.startDate){this.pickerValues.startDate=date;}else if(this.pickerValues.startDate.plus({year:10,day:-1})<date){this.pickerValues.startDate=date.minus({year:10,day:-1});}},get pickerProps(){return getPickerProps("stopDate");},createPopover:(...args)=>useGanttResponsivePopover(_t("Gantt stop date"),...args),ensureVisibility:()=>false,});this.dropdownState=useDropdownState();}
getFormattedDate(date){return formatDate(date);}
onApply(){const{startDate,stopDate}=this.pickerValues;this.props.selectCustomRange(startDate,stopDate);this.dropdownState.close();}}
return __exports;});;

/* /web_gantt/static/src/gantt_time_display_badge.js */
odoo.define('@web_gantt/gantt_time_display_badge',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const GanttTimeDisplayBadge=__exports.GanttTimeDisplayBadge=class GanttTimeDisplayBadge extends Component{static props={reactive:{type:Object,shape:{position:{type:Object,shape:{top:{type:Number,optional:true},right:{type:Number,optional:true},left:{type:Number,optional:true},},optional:true,},class:{type:String,optional:true},text:{type:String,optional:true},},},};static template="web_gantt.GanttTimeDisplayBadge";get positionStyle(){const{position}=this.props.reactive;const style=[`top:${position.top}px`];if("left"in position){style.push(`left:${position.left}px`);}else{style.push(`right:${position.right}px`);}
return style.join(";");}}
return __exports;});;

/* /web_gantt/static/src/gantt_view.js */
odoo.define('@web_gantt/gantt_view',['@web/core/registry','@web/search/action_hook','@web_gantt/gantt_arch_parser','@web_gantt/gantt_controller','@web_gantt/gantt_model','@web_gantt/gantt_renderer','@web/core/utils/objects'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{scrollSymbol}=require("@web/search/action_hook");const{GanttArchParser}=require("@web_gantt/gantt_arch_parser");const{GanttController}=require("@web_gantt/gantt_controller");const{GanttModel}=require("@web_gantt/gantt_model");const{GanttRenderer}=require("@web_gantt/gantt_renderer");const{omit}=require("@web/core/utils/objects");const viewRegistry=registry.category("views");const ganttView=__exports.ganttView={type:"gantt",Controller:GanttController,Renderer:GanttRenderer,Model:GanttModel,ArchParser:GanttArchParser,searchMenuTypes:["filter","groupBy","favorite"],buttonTemplate:"web_gantt.GanttView.Buttons",props:(genericProps,view,config)=>{const modelParams={};let scrollPosition;let multiCreateValues;if(genericProps.state){scrollPosition=genericProps.state[scrollSymbol];modelParams.metaData=genericProps.state.metaData;modelParams.displayParams=genericProps.state.displayParams;multiCreateValues=genericProps.state.multiCreateValues;}else{const{arch,fields,resModel}=genericProps;const parser=new view.ArchParser();const archInfo=parser.parse(arch);let formViewId=archInfo.formViewId;if(!formViewId){const formView=config.views.find((v)=>v[1]==="form");if(formView){formViewId=formView[0];}}
const kanbanViewId=archInfo.kanbanViewId??config.views.find(([_,type])=>type==="kanban")?.[0];modelParams.metaData={...omit(archInfo,"displayMode"),fields,resModel,formViewId,kanbanViewId,};modelParams.displayParams={displayMode:archInfo.displayMode,};}
return{...genericProps,modelParams,Model:view.Model,Renderer:view.Renderer,buttonTemplate:view.buttonTemplate,scrollPosition,multiCreateValues,};},};viewRegistry.add("gantt",ganttView);return __exports;});;

/* /web_cohort/static/src/cohort_arch_parser.js */
odoo.define('@web_cohort/cohort_arch_parser',['@web/core/l10n/translation','@web/core/utils/strings','@web/core/utils/xml','@web_cohort/cohort_model'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_cohort",...args);const{exprToBoolean}=require("@web/core/utils/strings");const{visitXML}=require("@web/core/utils/xml");const{INTERVALS,MODES,TIMELINES}=require("@web_cohort/cohort_model");const CohortArchParser=__exports.CohortArchParser=class CohortArchParser{parse(arch,fields){const archInfo={fieldAttrs:{},widgets:{},};visitXML(arch,(node)=>{switch(node.tagName){case"cohort":{if(node.hasAttribute("disable_linking")){archInfo.disableLinking=exprToBoolean(node.getAttribute("disable_linking"));}
const title=node.getAttribute("string");if(title){archInfo.title=title;}
const dateStart=node.getAttribute("date_start");if(dateStart){archInfo.dateStart=dateStart;archInfo.dateStartString=fields[dateStart].string;}else{throw new Error(_t('Cohort view has not defined "date_start" attribute.'));}
const dateStop=node.getAttribute("date_stop");if(dateStop){archInfo.dateStop=dateStop;archInfo.dateStopString=fields[dateStop].string;}else{throw new Error(_t('Cohort view has not defined "date_stop" attribute.'));}
const mode=node.getAttribute("mode")||"retention";if(mode&&MODES.includes(mode)){archInfo.mode=mode;}else{throw new Error(_t("The argument %(mode)s is not a valid mode. Here are the modes: %(modes)s",{mode,modes:MODES}));}
const timeline=node.getAttribute("timeline")||"forward";if(timeline&&TIMELINES.includes(timeline)){archInfo.timeline=timeline;}else{throw new Error(_t("The argument %(timeline)s is not a valid timeline. Here are the timelines: %(timelines)s",{timeline,timelines:TIMELINES}));}
archInfo.measure=node.getAttribute("measure")||"__count";const interval=node.getAttribute("interval")||"day";if(interval&&interval in INTERVALS){archInfo.interval=interval;}else{throw new Error(_t("The argument %(interval)s is not a valid interval. Here are the intervals: %(intervals)s",{interval,intervals:INTERVALS}));}
break;}
case"field":{const fieldName=node.getAttribute("name");archInfo.fieldAttrs[fieldName]={};if(node.hasAttribute("string")){archInfo.fieldAttrs[fieldName].string=node.getAttribute("string");}
if(node.getAttribute("invisible")==="True"||node.getAttribute("invisible")==="1"){archInfo.fieldAttrs[fieldName].isInvisible=true;break;}
if(node.hasAttribute("widget")){archInfo.widgets[fieldName]=node.getAttribute("widget");}}}});return archInfo;}}
return __exports;});;

/* /web_cohort/static/src/cohort_controller.js */
odoo.define('@web_cohort/cohort_controller',['@web/core/utils/hooks','@web/search/layout','@web/model/model','@web/views/standard_view_props','@web/search/action_hook','@web/search/search_bar/search_bar','@web/search/cog_menu/cog_menu','@web/views/widgets/widget','@web/views/action_helper','@odoo/owl'],function(require){'use strict';let __exports={};const{useService}=require("@web/core/utils/hooks");const{Layout}=require("@web/search/layout");const{useModelWithSampleData}=require("@web/model/model");const{standardViewProps}=require("@web/views/standard_view_props");const{useSetupAction}=require("@web/search/action_hook");const{SearchBar}=require("@web/search/search_bar/search_bar");const{CogMenu}=require("@web/search/cog_menu/cog_menu");const{Widget}=require("@web/views/widgets/widget");const{ActionHelper}=require("@web/views/action_helper");const{Component,toRaw,useRef}=require("@odoo/owl");const CohortController=__exports.CohortController=class CohortController extends Component{static template="web_cohort.CohortView";static components={Layout,SearchBar,CogMenu,Widget,ActionHelper};static props={...standardViewProps,Model:Function,modelParams:Object,Renderer:Function,buttonTemplate:String,};setup(){this.actionService=useService("action");this.model=useModelWithSampleData(this.props.Model,toRaw(this.props.modelParams));useSetupAction({rootRef:useRef("root"),getLocalState:()=>{return{metaData:this.model.metaData};},getContext:()=>this.getContext(),});}
getContext(){const{measure,interval}=this.model.metaData;return{cohort_measure:measure,cohort_interval:interval};}
onRowClicked(row,newWindow){if(row.value===undefined||this.model.metaData.disableLinking){return;}
const context=Object.assign({},this.model.searchParams.context);const domain=row.domain;const views={};for(const[viewId,viewType]of this.env.config.views||[]){views[viewType]=viewId;}
function getView(viewType){return[context[`${viewType}_view_id`]||views[viewType]||false,viewType];}
const actionViews=[getView("list"),getView("form")];this.openView(domain,actionViews,context,newWindow);}
openView(domain,views,context,newWindow){this.actionService.doAction({type:"ir.actions.act_window",name:this.model.metaData.title,res_model:this.model.metaData.resModel,views,view_mode:"list",target:"current",context,domain,},{newWindow});}}
return __exports;});;

/* /web_cohort/static/src/cohort_model.js */
odoo.define('@web_cohort/cohort_model',['@web/core/l10n/translation','@web/core/utils/concurrency','@web/model/model','@web/views/utils','@web/core/browser/browser'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_cohort",...args);const{KeepLast,Race}=require("@web/core/utils/concurrency");const{Model}=require("@web/model/model");const{computeReportMeasures,processMeasure}=require("@web/views/utils");const{browser}=require("@web/core/browser/browser");const MODES=__exports.MODES=["retention","churn"];const TIMELINES=__exports.TIMELINES=["forward","backward"];const INTERVALS=__exports.INTERVALS={day:_t("Day"),week:_t("Week"),month:_t("Month"),quarter:_t("Quarter"),year:_t("Year"),};const CohortModel=__exports.CohortModel=class CohortModel extends Model{setup(params){this.keepLast=new KeepLast();this.race=new Race();const _load=this._load.bind(this);this._load=(...args)=>this.race.add(_load(...args));this.metaData=params;this.data=null;this.searchParams=null;this.intervals=INTERVALS;const activeInterval=browser.localStorage.getItem(this.storageKey)||params.interval;if(Object.keys(this.intervals).includes(activeInterval)){this.metaData.interval=activeInterval;}}
load(searchParams){const{context,domain}=searchParams;this.searchParams={context,domain};const{cohort_interval,cohort_measure}=searchParams.context;this.metaData.interval=cohort_interval||this.metaData.interval;this.metaData.measure=processMeasure(cohort_measure)||this.metaData.measure;this.metaData.measures=computeReportMeasures(this.metaData.fields,this.metaData.fieldAttrs,[this.metaData.measure],{sumAggregatorOnly:true});return this._load(this.metaData);}
get storageKey(){return`scaleOf-viewId-${this.env.config.viewId}`;}
hasData(){return this.data.rows.length>0;}
async updateMetaData(params){Object.assign(this.metaData,params);browser.localStorage.setItem(this.storageKey,this.metaData.interval);await this._load(this.metaData);this.notify();}
async _load(metaData){this.data=await this.keepLast.add(this._fetchData(metaData));this.data.rows.forEach((row)=>{row.columns=row.columns.filter((col)=>col.percentage!=="");});}
async _fetchData(metaData){const{context,domain}=this.searchParams;return this.orm.call(metaData.resModel,"get_cohort_data",[],{date_start:metaData.dateStart,date_stop:metaData.dateStop,measure:metaData.measure,interval:metaData.interval,domain,mode:metaData.mode,timeline:metaData.timeline,context,});}}
return __exports;});;

/* /web_cohort/static/src/cohort_renderer.js */
odoo.define('@web_cohort/cohort_renderer',['@web/core/l10n/translation','@web/views/fields/formatters','@web/core/registry','@odoo/owl','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@web/views/view_components/view_scale_selector','@web/core/network/download','@web/views/view_components/report_view_measures'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_cohort",...args);const{formatPercentage}=require("@web/views/fields/formatters");const{registry}=require("@web/core/registry");const{Component}=require("@odoo/owl");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{ViewScaleSelector}=require("@web/views/view_components/view_scale_selector");const{download}=require("@web/core/network/download");const{ReportViewMeasures}=require("@web/views/view_components/report_view_measures");const formatters=registry.category("formatters");const CohortRenderer=__exports.CohortRenderer=class CohortRenderer extends Component{static components={Dropdown,DropdownItem,ViewScaleSelector,ReportViewMeasures};static template="web_cohort.CohortRenderer";static props=["class","model","onRowClicked"];setup(){this.model=this.props.model;}
range(n){return Array.from({length:n},(_,i)=>i);}
getFormattedValue(value){const fieldName=this.model.metaData.measure;const field=this.model.metaData.measures[fieldName];let formatType=this.model.metaData.widgets[fieldName];if(!formatType){const fieldType=field.type;formatType=["many2one","reference"].includes(fieldType)?"integer":fieldType;}
const formatter=formatters.get(formatType);return formatter(value,field);}
formatPercentage(value){return formatPercentage(value,{digits:[false,1]});}
getCellTitle(period,measure,count){return _t("Period: %(period)s\n%(measure)s: %(count)s",{period,measure,count});}
get scales(){return Object.fromEntries(Object.entries(this.model.intervals).map(([s,d])=>[s,{description:d}]));}
setScale(scale){this.model.updateMetaData({interval:scale,});}
onMeasureSelected({measure}){this.model.updateMetaData({measure});}
async downloadExcel(){const{title,resModel,interval,measure,measures,dateStartString,dateStopString,timeline,}=this.model.metaData;const data={title:title,model:resModel,interval_string:this.model.intervals[interval].toString(),measure_string:measures[measure].string,date_start_string:dateStartString,date_stop_string:dateStopString,timeline:timeline,report:this.model.data,};this.env.services.ui.block();try{await download({url:"/web/cohort/export",data:{data:new Blob([JSON.stringify(data)],{type:"application/json"})},});}finally{this.env.services.ui.unblock();}}}
return __exports;});;

/* /web_cohort/static/src/cohort_view.js */
odoo.define('@web_cohort/cohort_view',['@web/core/registry','@web_cohort/cohort_controller','@web_cohort/cohort_renderer','@web_cohort/cohort_arch_parser','@web_cohort/cohort_model'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{CohortController}=require("@web_cohort/cohort_controller");const{CohortRenderer}=require("@web_cohort/cohort_renderer");const{CohortArchParser}=require("@web_cohort/cohort_arch_parser");const{CohortModel}=require("@web_cohort/cohort_model");const cohortView=__exports.cohortView={type:"cohort",buttonTemplate:"web_cohort.CohortView.Buttons",searchMenuTypes:["filter","favorite"],Model:CohortModel,ArchParser:CohortArchParser,Controller:CohortController,Renderer:CohortRenderer,props:(genericProps,view)=>{let modelParams;if(genericProps.state){modelParams=genericProps.state.metaData;}else{const{arch,fields,resModel}=genericProps;const{ArchParser}=view;const archInfo=new ArchParser().parse(arch,fields);modelParams={dateStart:archInfo.dateStart,dateStartString:archInfo.dateStartString,dateStop:archInfo.dateStop,dateStopString:archInfo.dateStopString,fieldAttrs:archInfo.fieldAttrs,fields:fields,interval:archInfo.interval,measure:archInfo.measure,mode:archInfo.mode,resModel:resModel,timeline:archInfo.timeline,title:archInfo.title,disableLinking:Boolean(archInfo.disableLinking),widgets:archInfo.widgets,};}
return{...genericProps,modelParams,Model:view.Model,Renderer:view.Renderer,buttonTemplate:view.buttonTemplate,};},};registry.category("views").add("cohort",cohortView);return __exports;});;

/* /web_cohort/static/src/cohort_view_sample_server.js */
odoo.define('@web_cohort/cohort_view_sample_server',['@web/core/l10n/dates','@web/core/registry','@web/model/sample_server'],function(require){'use strict';let __exports={};const{parseDate}=require("@web/core/l10n/dates");const{registry}=require("@web/core/registry");const{SampleServer}=require("@web/model/sample_server");function _mockGetCohortData(params){const{model,date_start,interval,measure,mode,timeline}=params;const columns_avg={};const rows=[];let initialChurnValue=0;const groups=this._mockFormattedReadGroup({model,groupBy:[date_start+":"+interval],aggregates:["__count"],});const totalCount=groups.length;let totalValue=0;for(const group of groups){const format=SampleServer.FORMATS[interval];const displayFormat=SampleServer.DISPLAY_FORMATS[interval];const date=parseDate(group[date_start+":"+interval][0],{format});const now=luxon.DateTime.local();let colStartDate=date;if(timeline==="backward"){colStartDate=colStartDate.plus({[`${interval}s`]:-15});}
let value=measure==="__count"?this._getRandomInt(SampleServer.MAX_INTEGER):this._generateFieldValue(model,measure);value=value||25;totalValue+=value;let initialValue=value;let max=value;const columns=[];for(let column=0;column<=15;column++){if(!columns_avg[column]){columns_avg[column]={percentage:0,count:0};}
if(colStartDate.plus({[`${interval}s`]:column})>now){columns.push({value:"-",churn_value:"-",percentage:""});continue;}
let colValue=0;if(max>0){colValue=Math.min(Math.round(Math.random()*max),max);max-=colValue;}
if(timeline==="backward"&&column===0){initialValue=Math.min(Math.round(Math.random()*value),value);initialChurnValue=value-initialValue;}
const previousValue=column===0?initialValue:columns[column-1].value;const remainingValue=previousValue-colValue;const previousChurnValue=column===0?initialChurnValue:columns[column-1].churn_value;const churn_value=colValue+previousChurnValue;let percentage=value?parseFloat(remainingValue/value):0;if(mode==="churn"){percentage=1-percentage;}
percentage=Number((100*percentage).toFixed(1));columns_avg[column].percentage+=percentage;columns_avg[column].count+=1;columns.push({value:remainingValue,churn_value,percentage,period:column,});}
const keepRow=columns.some((c)=>c.percentage!=="");if(keepRow){rows.push({date:date.toFormat(displayFormat),value,columns});}}
const avg_value=totalCount?totalValue/totalCount:0;const avg={avg_value,columns_avg};return{rows,avg};}
registry.category("sample_server").add("get_cohort_data",_mockGetCohortData);return __exports;});;

/* /documents/static/src/views/activity/documents_activity_controller.js */
odoo.define('@documents/views/activity/documents_activity_controller',['@web/core/l10n/translation','@mail/views/web/activity/activity_controller','@documents/views/hooks','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"documents",...args);const{ActivityController}=require("@mail/views/web/activity/activity_controller");const{preSuperSetup,useDocumentView}=require("@documents/views/hooks");const{useState}=require("@odoo/owl");const DocumentsActivityController=__exports.DocumentsActivityController=class DocumentsActivityController extends ActivityController{static template="documents.DocumentsActivityController";setup(){preSuperSetup();super.setup(...arguments);const properties=useDocumentView(this.documentsViewHelpers());Object.assign(this,properties);this.documentStates=useState({previewStore:{},});}
get rendererProps(){const props=super.rendererProps;props.previewStore=this.documentStates.previewStore;return props;}
get modelParams(){const modelParams=super.modelParams;modelParams.multiEdit=true;return modelParams;}
documentsViewHelpers(){return{getSelectedDocumentsElements:()=>[],isRecordPreviewable:this.isRecordPreviewable.bind(this),setPreviewStore:(previewStore)=>{this.documentStates.previewStore=previewStore;},};}
async openRecord(record){for(const record of this.model.root.selection){record.selected=false;}
record.selected=true;this.model.notify();}
isRecordPreviewable(record){return this.model.activityData.activity_res_ids.includes(record.resId);}
sendMailTemplate(templateID,activityTypeID){super.sendMailTemplate(templateID,activityTypeID);this.env.services.notification.add(_t("Reminder emails have been sent."),{type:"success",});}}
return __exports;});;

/* /documents/static/src/views/activity/documents_activity_model.js */
odoo.define('@documents/views/activity/documents_activity_model',['@mail/views/web/activity/activity_model','@documents/views/documents_model_mixin','@documents/views/documents_record_mixin'],function(require){'use strict';let __exports={};const{ActivityModel}=require("@mail/views/web/activity/activity_model");const{DocumentsModelMixin}=require("@documents/views/documents_model_mixin");const{DocumentsRecordMixin}=require("@documents/views/documents_record_mixin");const DocumentsActivityModel=__exports.DocumentsActivityModel=class DocumentsActivityModel extends DocumentsModelMixin(ActivityModel){}
DocumentsActivityModel.Record=class DocumentsActivityRecord extends(DocumentsRecordMixin(ActivityModel.Record)){};return __exports;});;

/* /documents/static/src/views/activity/documents_activity_renderer.js */
odoo.define('@documents/views/activity/documents_activity_renderer',['@mail/views/web/activity/activity_renderer','@documents/components/documents_right_panel/documents_right_panel','@documents/views/documents_renderer_mixin','@documents/views/helper/documents_file_viewer','@odoo/owl'],function(require){'use strict';let __exports={};const{ActivityRenderer}=require("@mail/views/web/activity/activity_renderer");const{DocumentsRightPanel}=require("@documents/components/documents_right_panel/documents_right_panel");const{DocumentsRendererMixin}=require("@documents/views/documents_renderer_mixin");const{DocumentsFileViewer}=require("@documents/views/helper/documents_file_viewer");const{onWillUpdateProps,useRef}=require("@odoo/owl");const DocumentsActivityRenderer=__exports.DocumentsActivityRenderer=class DocumentsActivityRenderer extends DocumentsRendererMixin(ActivityRenderer){static props={...ActivityRenderer.props,previewStore:Object,};static template="documents.DocumentsActivityRenderer";static components={...ActivityRenderer.components,DocumentsRightPanel,DocumentsFileViewer,};setup(){super.setup();this.root=useRef("root");onWillUpdateProps((nextProps)=>{const selectedRecord=nextProps.records.find((r)=>r.selected);if(selectedRecord){this.documentService.focusRecord(selectedRecord);}});}
getDocumentsAttachmentViewerProps(){return{previewStore:this.props.previewStore};}}
return __exports;});;

/* /documents/static/src/views/activity/documents_activity_view.js */
odoo.define('@documents/views/activity/documents_activity_view',['@web/core/registry','@mail/views/web/activity/activity_view','@documents/views/activity/documents_activity_controller','@documents/views/activity/documents_activity_model','@documents/views/activity/documents_activity_renderer','@documents/views/search/documents_control_panel','@documents/views/search/documents_search_model'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{activityView}=require("@mail/views/web/activity/activity_view");const{DocumentsActivityController}=require("@documents/views/activity/documents_activity_controller");const{DocumentsActivityModel}=require("@documents/views/activity/documents_activity_model");const{DocumentsActivityRenderer}=require("@documents/views/activity/documents_activity_renderer");const{DocumentsControlPanel}=require("@documents/views/search/documents_control_panel");const{DocumentsSearchModel}=require("@documents/views/search/documents_search_model");const DocumentsActivityView=__exports.DocumentsActivityView={...activityView,ControlPanel:DocumentsControlPanel,Controller:DocumentsActivityController,Model:DocumentsActivityModel,Renderer:DocumentsActivityRenderer,SearchModel:DocumentsSearchModel,};registry.category("views").add("documents_activity",DocumentsActivityView);return __exports;});;

/* /ai/static/src/core/web/lazy/graph_controller_patch.js */
odoo.define('@ai/core/web/lazy/graph_controller_patch',['@web/views/graph/graph_controller','@web/core/utils/patch','@web/core/utils/hooks','@web/views/graph/graph_model'],function(require){'use strict';let __exports={};const{GraphController}=require("@web/views/graph/graph_controller");const{patch}=require("@web/core/utils/patch");const{useBus}=require("@web/core/utils/hooks");const{GraphModel}=require("@web/views/graph/graph_model");patch(GraphController.prototype,{setup(){super.setup(...arguments);useBus(this.env.bus,"APPLY_AI_ADJUST_MODEL",async({detail})=>{const{measures,mode,order,stacked,cumulated}=detail;if(this.model instanceof GraphModel){const defaultMetaData=this.model._buildMetaData();const metaData=this.model._buildMetaData({measures,mode:mode??defaultMetaData.mode,order:order??defaultMetaData.order,stacked:stacked??defaultMetaData.stacked,cumulated:cumulated??defaultMetaData.stacked,});const validMeasures=measures.filter((m)=>m in metaData.measures);const activeMeasures=metaData.activeMeasures||[];const measuresToActivate=validMeasures.filter((m)=>!activeMeasures.includes(m));const measure=measuresToActivate[0]??metaData.measure;if(measure){await this.model.updateMetaData({measure});}
this.model.updateMetaData({mode:mode??metaData.mode,order:order??metaData.order,stacked:stacked??metaData.stacked,cumulated:cumulated??metaData.cumulated,});}});},});return __exports;});;

/* /ai/static/src/core/web/lazy/pivot_controller_patch.js */
odoo.define('@ai/core/web/lazy/pivot_controller_patch',['@web/views/pivot/pivot_controller','@web/core/utils/patch','@web/core/utils/hooks','@web/views/pivot/pivot_model','@web/views/utils'],function(require){'use strict';let __exports={};const{PivotController}=require("@web/views/pivot/pivot_controller");const{patch}=require("@web/core/utils/patch");const{useBus}=require("@web/core/utils/hooks");const{PivotModel}=require("@web/views/pivot/pivot_model");const{computeReportMeasures}=require("@web/views/utils");patch(PivotController.prototype,{setup(){super.setup(...arguments);useBus(this.env.bus,"APPLY_AI_ADJUST_MODEL",async({detail})=>{const{measures}=detail;if(this.model instanceof PivotModel){const metaData=this.model._buildMetaData();const metaDataMeasures=computeReportMeasures(metaData.fields,metaData.fieldAttrs,[...(metaData.activeMeasures||[])]);const validMeasures=measures.filter((m)=>m in metaDataMeasures);const activeMeasures=metaData.activeMeasures||[];const measuresToToggle=new Set([...validMeasures.filter((m)=>!activeMeasures.includes(m)),...activeMeasures.filter((m)=>!validMeasures.includes(m)),]);for(const measure of measuresToToggle){this.model.toggleMeasure(measure);}}});},});return __exports;});;

/* /web_hierarchy/static/src/hierarchy_arch_parser.js */
odoo.define('@web_hierarchy/hierarchy_arch_parser',['@web/core/utils/xml','@web/search/utils/order_by','@web/views/fields/field','@web/views/utils','@web/core/utils/strings'],function(require){'use strict';let __exports={};const{visitXML}=require("@web/core/utils/xml");const{stringToOrderBy}=require("@web/search/utils/order_by");const{Field}=require("@web/views/fields/field");const{getActiveActions}=require("@web/views/utils");const{exprToBoolean}=require("@web/core/utils/strings");const HierarchyArchParser=__exports.HierarchyArchParser=class HierarchyArchParser{parse(xmlDoc,models,modelName){const archInfo={activeActions:getActiveActions(xmlDoc),defaultOrder:stringToOrderBy(xmlDoc.getAttribute("default_order")||null),draggable:false,icon:"fa-share-alt fa-rotate-90 align-text-top",parentFieldName:"parent_id",fieldNodes:{},templateDocs:{},xmlDoc,};const fieldNextIds={};const fields=models[modelName].fields;visitXML(xmlDoc,(node)=>{if(node.hasAttribute("t-name")){archInfo.templateDocs[node.getAttribute("t-name")]=node;return;}
if(node.tagName==="hierarchy"){if(node.hasAttribute("parent_field")){const parentFieldName=node.getAttribute("parent_field");if(!(parentFieldName in fields)){throw new Error(`The parent field set (${parentFieldName}) is not defined in the model (${modelName}).`);}else if(fields[parentFieldName].type!=="many2one"){throw new Error(`Invalid parent field, it should be a Many2One field.`);}else if(fields[parentFieldName].relation!==modelName){throw new Error(`Invalid parent field, the co-model should be same model than the current one (expected: ${modelName}).`);}
archInfo.parentFieldName=parentFieldName;}
if(node.hasAttribute("child_field")){const childFieldName=node.getAttribute("child_field");if(!(childFieldName in fields)){throw new Error(`The child field set (${childFieldName}) is not defined in the model (${modelName}).`);}else if(fields[childFieldName].type!=="one2many"){throw new Error(`Invalid child field, it should be a One2Many field.`);}else if(fields[childFieldName].relation!==modelName){throw new Error(`Invalid child field, the co-model should be same model than the current one (expected: ${modelName}).`);}
archInfo.childFieldName=childFieldName;}
if(node.hasAttribute("draggable")){archInfo.draggable=exprToBoolean(node.getAttribute("draggable"));}
if(node.hasAttribute("icon")){archInfo.icon=node.getAttribute("icon");}}else if(node.tagName==="field"){const fieldInfo=Field.parseFieldNode(node,models,modelName,"hierarchy");const name=fieldInfo.name;if(!(name in fieldNextIds)){fieldNextIds[name]=0;}
const fieldId=`${name}_${fieldNextIds[name]++}`;archInfo.fieldNodes[fieldId]=fieldInfo;node.setAttribute("field_id",fieldId);}});const cardDoc=archInfo.templateDocs["hierarchy-box"];if(!cardDoc){throw new Error("Missing 'hierarchy-box' template.");}
return archInfo;}}
return __exports;});;

/* /web_hierarchy/static/src/hierarchy_card.js */
odoo.define('@web_hierarchy/hierarchy_card',['@odoo/owl','@web/core/py_js/py','@web/views/fields/field','@web/model/record','@web/views/view_button/view_button','@web/views/view_compiler','@web_hierarchy/hierarchy_compiler','@web/views/kanban/kanban_record'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{evaluateBooleanExpr}=require("@web/core/py_js/py");const{Field}=require("@web/views/fields/field");const{Record}=require("@web/model/record");const{ViewButton}=require("@web/views/view_button/view_button");const{useViewCompiler}=require("@web/views/view_compiler");const{HierarchyCompiler}=require("@web_hierarchy/hierarchy_compiler");const{getFormattedRecord}=require("@web/views/kanban/kanban_record");const HierarchyCard=__exports.HierarchyCard=class HierarchyCard extends Component{static components={Record,Field,ViewButton,};static props={node:Object,openRecord:Function,archInfo:Object,classNames:{type:String,optional:true},};static defaultProps={classNames:"",};static template="web_hierarchy.HierarchyCard";static Compiler=HierarchyCompiler;setup(){const{archInfo}=this.props;this.templates=useViewCompiler(this.constructor.Compiler,archInfo.templateDocs);this.evaluateBooleanExpr=evaluateBooleanExpr;}
get classNames(){const classNames=[this.props.classNames];if(this.props.node.nodes.length){classNames.push("o_hierarchy_node_unfolded");}
return classNames.join(" ");}
getRenderingContext(data){const record=getFormattedRecord(data.record);return{context:this.props.node.context,JSON,luxon,record,__comp__:Object.assign(Object.create(this),{this:this}),__record__:data.record,};}
onGlobalClick(ev,newWindow){if(ev.target.closest("button")){return;}
this.props.openRecord(this.props.node,newWindow);}
onClickArrowUp(ev){this.props.node.fetchParentNode();}
onClickArrowDown(ev){if(this.props.node.nodes.length){this.props.node.collapseChildNodes();}else{this.props.node.showChildNodes();}}}
return __exports;});;

/* /web_hierarchy/static/src/hierarchy_compiler.js */
odoo.define('@web_hierarchy/hierarchy_compiler',['@web/views/kanban/kanban_compiler'],function(require){'use strict';let __exports={};const{KanbanCompiler}=require("@web/views/kanban/kanban_compiler");const HierarchyCompiler=__exports.HierarchyCompiler=class HierarchyCompiler extends KanbanCompiler{compileField(el,params){const fieldName=el.getAttribute("name");return super.compileField(el,{...(params||{}),recordExpr:"__record__",dataPointIdExpr:"__comp__.props.node.id",formattedValueExpr:`record['${fieldName}'].value`,});}
compileButton(el,params){return super.compileButton(el,{...(params||{}),recordExpr:"__record__",});}
compileNode(node,params={},evalInvisible=true){return super.compileNode(node,{...params,recordExpr:"__record__",},evalInvisible);}}
return __exports;});;

/* /web_hierarchy/static/src/hierarchy_controller.js */
odoo.define('@web_hierarchy/hierarchy_controller',['@odoo/owl','@web/core/utils/hooks','@web/model/model','@web/model/relational_model/utils','@web/search/action_hook','@web/search/cog_menu/cog_menu','@web/search/layout','@web/search/search_bar/search_bar','@web/search/search_bar/search_bar_toggler','@web/views/standard_view_props','@web/views/view_button/view_button_hook','@web/views/action_helper'],function(require){'use strict';let __exports={};const{Component,useRef}=require("@odoo/owl");const{useBus}=require("@web/core/utils/hooks");const{useModel}=require("@web/model/model");const{addFieldDependencies,extractFieldsFromArchInfo}=require("@web/model/relational_model/utils");const{useSetupAction}=require("@web/search/action_hook");const{CogMenu}=require("@web/search/cog_menu/cog_menu");const{Layout}=require("@web/search/layout");const{SearchBar}=require("@web/search/search_bar/search_bar");const{useSearchBarToggler}=require("@web/search/search_bar/search_bar_toggler");const{standardViewProps}=require("@web/views/standard_view_props");const{useViewButtons}=require("@web/views/view_button/view_button_hook");const{ActionHelper}=require("@web/views/action_helper");const HierarchyController=__exports.HierarchyController=class HierarchyController extends Component{static components={Layout,CogMenu,SearchBar,ActionHelper,};static props={...standardViewProps,Model:Function,Renderer:Function,buttonTemplate:String,archInfo:Object,};static template="web_hierarchy.HierarchyView";setup(){this.rootRef=useRef("root");const{parentFieldName,childFieldName}=this.props.archInfo;const{activeFields,fields}=extractFieldsFromArchInfo(this.props.archInfo,this.props.fields);const additionalFields=[{name:parentFieldName}];if(childFieldName){additionalFields.push({name:childFieldName});}
addFieldDependencies(activeFields,fields,additionalFields);const modelConfig=this.props.state?.modelState?.config||{};this.model=useModel(this.props.Model,{config:modelConfig,resModel:this.props.resModel,activeFields,defaultOrderBy:this.props.archInfo.defaultOrder,fields,parentFieldName,childFieldName,});useBus(this.model.bus,"update",()=>{this.render(true);});useViewButtons(this.rootRef,{beforeExecuteAction:this.beforeExecuteActionButton.bind(this),afterExecuteAction:this.afterExecuteActionButton.bind(this),reload:this.model.reload.bind(this.model),});useSetupAction({rootRef:this.rootRef,getLocalState:()=>{return{modelState:this.model.exportState(),};},});this.searchBarToggler=useSearchBarToggler();}
get displayNoContent(){return this.model.resIds.length===0;}
async openRecord(node,newWindow){const activeIds=this.model.root.resIds;this.props.selectRecord(node.resId,{activeIds,newWindow});}
async beforeExecuteActionButton(clickParams){}
async afterExecuteActionButton(clickParams){}}
return __exports;});;

/* /web_hierarchy/static/src/hierarchy_model.js */
odoo.define('@web_hierarchy/hierarchy_model',['@odoo/owl','@web/core/domain','@web/core/l10n/translation','@web/core/utils/concurrency','@web/model/model','@web/model/relational_model/utils','@web/search/utils/order_by'],function(require){'use strict';let __exports={};const{toRaw}=require("@odoo/owl");const{Domain}=require("@web/core/domain");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_hierarchy",...args);const{KeepLast,Mutex}=require("@web/core/utils/concurrency");const{Model}=require("@web/model/model");const{getFieldsSpec}=require("@web/model/relational_model/utils");const{orderByToString}=require("@web/search/utils/order_by");let nodeId=0;let forestId=0;let treeId=0;function getIdOfMany2oneField(value){return value&&value.id;}
const HierarchyNode=__exports.HierarchyNode=class HierarchyNode{constructor(model,config,data,tree,parentNode=null,populateChildNodes=true){this.id=nodeId++;this.data=data;this.parentNode=parentNode;this.tree=tree;this.model=model;this._config=config;this.hidden=false;tree.addNode(this);if(populateChildNodes){this.populateChildNodes();}}
get ancestorNode(){return this.parentNode?this.ancestorNode:this;}
get isLeaf(){return!this.nodes.length;}
get forest(){return this.tree.forest;}
get resId(){return this.data.id;}
get parentFieldName(){return this.model.parentFieldName;}
get parentResId(){return this.parentNode?.resId||getIdOfMany2oneField(this.data[this.parentFieldName]);}
get childResIds(){return this._nodes.length?this._nodes.map((node)=>node.resId):this.data[this.childFieldName]?.map((d)=>(typeof d==="number"?d:d.id))||[];}
get childFieldName(){return this.model.childFieldName||this.model.defaultChildFieldName;}
get hasChildren(){return this._nodes.length>0||this.data[this.childFieldName]?.length>0;}
get canShowParentNode(){return(Boolean(this.parentResId)&&this.parentResId!==this.resId&&!this.parentNode&&this.tree.forest.resIds.filter((resId)=>resId===this.resId).length===1);}
get canShowChildNodes(){return(this.hasChildren&&this.nodes.length===0&&this.tree.forest.resIds.filter((resId)=>resId===this.resId).length===1);}
getDescendantNodes(hideNodesIncluded=false){const subNodes=[];const nodes=hideNodesIncluded?this._nodes:this.nodes;if(nodes.length){subNodes.push(...nodes);for(const node of nodes){const descendantNodes=node.getDescendantNodes(hideNodesIncluded);if(descendantNodes.length){subNodes.push(...descendantNodes);}}}
return subNodes;}
get descendantsParentNodes(){const descendantsParentNodes=[];if(!this.isLeaf){descendantsParentNodes.push(this);this.nodes.reduce((parents,node)=>{if(!node.isLeaf){parents.push(...node.descendantsParentNodes);}
return parents;},descendantsParentNodes);}
return descendantsParentNodes;}
get allSubsidiaryResIds(){return this.getDescendantNodes().map((n)=>n.resId);}
get nodes(){return this._nodes.filter((n)=>!n.hidden);}
populateChildNodes(){this._nodes=[];const children=this.data[this.childFieldName]||[];if(children.length&&children[0]instanceof Object&&this.tree.forest.resIds.filter((resId)=>resId===this.resId).length===1){this.createChildNodes(children);}}
createChildNodes(childNodesData){this._nodes=(childNodesData||this.data[this.childFieldName]).map((childData)=>new HierarchyNode(this.model,this._config,childData,this.tree,this));}
removeParentNode(){this.parentNode?.removeChildNode(this);this.parentNode=null;this.data[this.parentFieldName]=false;}
async fetchParentNode(){await this.model.fetchManager(this);}
async showChildNodes(){if(this.hasChildren){if(this._nodes.length){const nodeToCollapse=this.model._searchNodeToCollapse(this);if(nodeToCollapse){nodeToCollapse.collapseChildNodes(true);}
this.getDescendantNodes(true).map((n)=>{n.hidden=false;this.tree.addNode(n);});this.model.notify();}else{await this.model.fetchSubordinates(this);}}}
collapseChildNodes(hideNodes=false){const childrenData=[];if(hideNodes){const nodesToHide=this.getDescendantNodes();nodesToHide.map((n)=>(n.hidden=true));this.tree.removeNodes(nodesToHide);}else{for(const childNode of this.nodes){childNode.data[this.childFieldName]=childNode.childResIds;childrenData.push(childNode.data);}
this.data[this.childFieldName]=childrenData;this.removeChildNodes();}
this.model.notify();}
removeChildNode(node){node.removeChildNodes();this.tree.removeNodes([node]);this._nodes=this._nodes.filter((n)=>n.id!==node.id);this.data[this.childFieldName]=this._nodes.map((n)=>n.data);}
removeChildNodes(rootNode=this){for(const childNode of this.nodes){if(!childNode.isLeaf&&childNode!==rootNode){childNode.removeChildNodes(rootNode);}}
this.tree.removeNodes(this._nodes);this._nodes=[];}
setParentNode(node){const tree=node.tree;if(tree.root===this){tree.root=node;}else if(this.tree.root===this){this.tree.removeRoot();this.setTree(node.tree);}
this.parentNode=node;node.addChildNode(this);}
setTree(tree){this.tree=tree;for(const childNode of this.nodes){childNode.setTree(tree);}}
addChildNode(node){this._nodes.push(node);this.data[this.childFieldName].push(node.data);this.tree.addNode(node);}}
const HierarchyTree=__exports.HierarchyTree=class HierarchyTree{constructor(model,config,data,forest){this.id=treeId++;this.nodePerNodeId={};this.forest=forest;if(data){this.root=new HierarchyNode(model,config,data,this);this.forest.nodePerNodeId={...this.forest.nodePerNodeId,...this.nodePerNodeId,};}
this.model=model;this._config=config;}
get resIds(){return Object.values(this.nodePerNodeId).map((node)=>node.resId);}
addNode(node){this.nodePerNodeId[node.id]=node;this.forest.addNode(node);}
removeNodes(nodes){const nodeIds=nodes.map((node)=>node.id);this.nodePerNodeId=Object.fromEntries(Object.entries(this.nodePerNodeId).filter(([nodeId])=>!nodeIds.includes(Number(nodeId))));this.forest.removeNodes(nodes);}
removeRoot(){this.forest.removeTree(this);}}
const HierarchyForest=__exports.HierarchyForest=class HierarchyForest{constructor(model,config,data){this.id=forestId++;this.nodePerNodeId={};this._trees=data.map((d)=>new HierarchyTree(model,config,d,this));this.model=model;this._config=config;}
get trees(){return this._trees.filter((t)=>!t.root.hidden);}
get resIds(){return Object.values(this.nodePerNodeId).map((node)=>node.resId);}
get rootNodes(){return this.trees.map((t)=>t.root);}
addNode(node){this.nodePerNodeId[node.id]=node;}
removeNodes(nodes){const nodeIds=nodes.map((node)=>node.id);this.nodePerNodeId=Object.fromEntries(Object.entries(this.nodePerNodeId).filter(([nodeId])=>!nodeIds.includes(Number(nodeId))));}
addNewRootNode(node){const tree=new HierarchyTree(this.model,this._config,null,this);tree.root=node;node.tree=tree;tree.addNode(node);for(const subNode of node.getDescendantNodes()){tree.addNode(subNode);}
this._trees.push(tree);}
removeTree(tree){this.nodePerNodeId=Object.fromEntries(Object.entries(this.nodePerNodeId).filter(([nodeId])=>!(nodeId in tree.nodePerNodeId)));this._trees=this.trees.filter((t)=>t.id!==tree.id);}}
const HierarchyModel=__exports.HierarchyModel=class HierarchyModel extends Model{static services=["notification"];setup(params,{notification}){this.keepLast=new KeepLast();this.mutex=new Mutex();this.resModel=params.resModel;this.fields=params.fields;this.parentFieldName=params.parentFieldName;this.childFieldName=params.childFieldName;this.activeFields=params.activeFields;this.defaultOrderBy=params.defaultOrderBy;this.notification=notification;this.config={domain:[],...params.config,isRoot:true,};}
get parentField(){return this.fields[this.parentFieldName];}
get resIds(){return this.root?.resIds||[];}
get defaultChildFieldName(){return"__child_ids__";}
get defaultDomain(){return[[this.parentFieldName,"=",false]];}
get globalDomain(){if(!this.env.searchModel?.globalDomain.length){return[];}
return new Domain(this.env.searchModel.globalDomain).toList(this.env.searchModel.domainEvalContext);}
get activeFieldNames(){return Object.keys(this.activeFields);}
get context(){return{bin_size:true,...(this.config.context||{}),};}
exportState(){return{config:toRaw({...this.config,resIds:this.resIds,}),};}
async load(params={}){nodeId=forestId=treeId=0;const{resIds,...config}=this._getNextConfig(this.config,params);const data=await this.keepLast.add(this._loadData({...config,resIds}));this.root=this._createRoot(config,data);this.config=config;this.notify({scrollTarget:"none"});}
async reload(){nodeId=forestId=treeId=0;const data=await this.keepLast.add(this._loadData(this.config,true));this.root=this._createRoot(this.config,data);this.notify({scrollTarget:"none"});}
notify(payload={scrollTarget:"bottom"}){super.notify();this.bus.trigger("hierarchyScrollTarget",payload);}
async fetchManager(node){if(this.root.trees.length>1){const treeExpanded=this._findTreeExpanded();const resIdsToFetch=[node.parentResId,node.resId,...node.allSubsidiaryResIds];if(treeExpanded&&treeExpanded.root.id!==node.id&&treeExpanded.root.parentResId===node.parentResId){resIdsToFetch.push(...treeExpanded.root.allSubsidiaryResIds);}
const config={...this.config,domain:["|",[this.parentFieldName,"=",node.parentResId],["id","in",resIdsToFetch],],};const data=await this._loadData(config);this.root=this._createRoot(config,data);this.notify();return;}
const managerData=await this.keepLast.add(this._fetchManager(node));if(managerData){const parentNode=new HierarchyNode(this,this.config,managerData,node.tree,null,false);parentNode.createChildNodes();node.setParentNode(parentNode);this.notify({scrollTarget:"up"});}}
async fetchSubordinates(node){const childFieldName=this.childFieldName||this.defaultChildFieldName;const children=node.data[childFieldName];if(children.length){const nodesToUpdate=[];if(!(children[0]instanceof Object)){const allNodeResIds=this.root.resIds;let existingChildResIds=children.filter((childResId)=>allNodeResIds.includes(childResId));if(existingChildResIds.length){for(const tree of this.root.trees){if(existingChildResIds.includes(tree.root.resId)&&tree.root.id!==node.id){if(node.tree.id===tree.id){existingChildResIds=existingChildResIds.filter((resId)=>resId!==tree.root.resId);continue;}
nodesToUpdate.push(tree.root);}}}
const subordinates=await this.keepLast.add(this._fetchSubordinates(node,existingChildResIds));if(subordinates.length){node.data[childFieldName]=subordinates;}}
const nodeToCollapse=this._searchNodeToCollapse(node);if(nodeToCollapse&&!nodesToUpdate.includes(nodeToCollapse)){nodeToCollapse.collapseChildNodes(true);}
node.populateChildNodes();for(const n of nodesToUpdate){n.setParentNode(node);}
this.notify();}}
_searchNodeToCollapse(node){const parentNode=node.parentNode;let nodeToCollapse=null;if(parentNode){nodeToCollapse=parentNode.nodes.find((n)=>n.nodes.length);}else{const treeExpanded=this._findTreeExpanded();if(treeExpanded){nodeToCollapse=treeExpanded.root;}}
return nodeToCollapse;}
_findTreeExpanded(){return this.root.trees.find((t)=>t.root.nodes.length);}
_getNextConfig(currentConfig,params){const config=Object.assign({},currentConfig);config.context="context"in params?params.context:config.context;if("domain"in params){config.domain=params.domain;if(this.isSearchDefaultOrEmpty()&&config.context.hierarchy_res_id){config.domain=[["id","=",config.context.hierarchy_res_id]];const globalDomain=this.globalDomain;if(globalDomain.length){config.domain=Domain.and([config.domain,globalDomain]);}
delete config.context.hierarchy_res_id;}}
config.orderBy="orderBy"in params?params.orderBy:config.orderBy;if(!config.orderBy.length){config.orderBy=currentConfig.orderBy||[];}
if(this.defaultOrderBy&&!config.orderBy.length){config.orderBy=this.defaultOrderBy;}
return config;}
_getFieldsSpec(context=this.config.context){return getFieldsSpec(this.activeFields,this.fields,context);}
isSearchDefaultOrEmpty(){if(!this.env.searchModel){return true;}
const isDisabledOptionalSearchMenuType=(type)=>{return(["filter","groupBy","favorite"].includes(type)&&!this.env.searchModel.searchMenuTypes.has(type));};const activeSearchItems=this.env.searchModel.getSearchItems((item)=>item.isActive&&!isDisabledOptionalSearchMenuType(item.type));if(!activeSearchItems.length){return true;}
const defaultSearchItems=this.env.searchModel.getSearchItems((item)=>item.isDefault&&item.type!=="favorite"&&!isDisabledOptionalSearchMenuType(item.type));return JSON.stringify(defaultSearchItems)===JSON.stringify(activeSearchItems);}
async _loadData(config,reload=false){let onlyRoots=false;let domain=config.domain;const resIds=reload?this.resIds:config.resIds;if(resIds?.length>0){domain=[["id","in",resIds]];}else if(this.isSearchDefaultOrEmpty()){onlyRoots=true;domain=!domain.length?this.defaultDomain:Domain.and([this.defaultDomain,domain]).toList({});}
const fieldsSpec=this._getFieldsSpec(config.context);const hierarchyRead=async()=>{return await this.orm.call(this.resModel,"hierarchy_read",[domain,fieldsSpec,this.parentFieldName,this.childFieldName,orderByToString(config.orderBy),],{context:this.context});};let result=await hierarchyRead();if(!result.length&&onlyRoots){domain=config.domain;result=await hierarchyRead();}
return this._formatData(result);}
_formatData(data){const dataStringified=JSON.stringify(data);const recordsPerParentId={};const recordPerId={};for(const record of data){recordPerId[record.id]=record;const parentId=getIdOfMany2oneField(record[this.parentFieldName]);if(!(parentId.toString()in recordsPerParentId)){recordsPerParentId[parentId]=[];}
recordsPerParentId[parentId].push(record);}
const formattedData=[];const recordIds=[];for(let[parentId,records]of Object.entries(recordsPerParentId)){records=[...new Map(records.map((record)=>[record.id,record])).values()];if(!parentId||!(parentId in recordPerId)){formattedData.push(...records);}else{const parentRecord=recordPerId[parentId];if(recordIds.includes(parentRecord.id)){return JSON.parse(dataStringified);}
const ancestorId=getIdOfMany2oneField(parentRecord[this.parentFieldName]);if(ancestorId in recordsPerParentId){recordIds.push(...recordsPerParentId[ancestorId].map((r)=>r.id));}
parentRecord[this.childFieldName||this.defaultChildFieldName]=records;}}
if(!formattedData.length&&data?.length){formattedData.push(recordPerId[Object.keys(recordsPerParentId)[0]]);}
return formattedData;}
_createRoot(config,data){return new HierarchyForest(this,config,data);}
async _fetchManager(node,exclude_node=true){let domain=new Domain(["|",["id","=",node.parentResId],[this.parentFieldName,"=",node.parentResId],]);if(exclude_node){domain=Domain.and([domain,[["id","!=",node.resId]]]);}
const result=await this.orm.webSearchRead(this.resModel,domain.toList({}),{context:this.context,specification:this._getFieldsSpec(),order:orderByToString(this.config.orderBy),});let managerData={};if(result?.length){const children=[];for(const data of result.records){if(data.id===node.parentResId){managerData=data;}else{children.push(data);}}
if(!this.childFieldName){if(children.length){await this._fetchDescendants(children);}}
managerData[this.childFieldName||this.defaultChildFieldName]=children;}
return managerData;}
async _fetchSubordinates(node,excludeResIds=null){let childrenResIds=node.data[this.childFieldName||this.defaultChildFieldName];if(excludeResIds){childrenResIds=childrenResIds.filter((childResId)=>!excludeResIds.includes(childResId));}
if(!childrenResIds.length){return[];}
const{records}=await this.orm.webSearchRead(this.resModel,[["id","in",childrenResIds]],{specification:this._getFieldsSpec(),context:this.context,order:orderByToString(this.config.orderBy),});if(!this.childFieldName){await this._fetchDescendants(records);}
return records;}
async _fetchDescendants(childrenData){const resIds=childrenData.map((d)=>d.id);if(resIds.length){const fetchChildren=await this.orm.formattedReadGroup(this.resModel,[[this.parentFieldName,"in",resIds]],[this.parentFieldName],["id:array_agg"],{context:this.context||{},order:orderByToString(this.config.orderBy),},);const childIdsPerId=Object.fromEntries(fetchChildren.map((g)=>[g[this.parentFieldName][0],g["id:array_agg"]]));for(const d of childrenData){if(d.id.toString()in childIdsPerId){d[this.defaultChildFieldName]=childIdsPerId[d.id.toString()];}}}}
async updateParentId(node,parentResId=false){return this.orm.write(this.resModel,[node.resId],{[this.parentFieldName]:parentResId},{context:this.context});}
async updateParentNode(nodeId,{parentNodeId,parentResId}){const node=this.root.nodePerNodeId[nodeId];const resId=node.resId;if(!node){return;}
const parentNode=parentNodeId?this.root.nodePerNodeId[parentNodeId]:null;parentResId=parentResId||parentNode?.resId||false;const oldParentNode=node.parentNode;if((parentNode&&!this.validateUpdateParentNode(node,parentNode))||parentNode?.resId===oldParentNode?.resId){return;}
node.hidden=true;this.notify({scrollTarget:"none"});await this.mutex.exec(async()=>{try{await this.updateParentId(node,parentResId);}catch(error){node.hidden=false;this.notify({scrollTarget:"none"});throw error;}});const domain=this.computeUpdateParentNodeDomain(node,parentResId,parentNode);const data=await this.orm.webSearchRead(this.resModel,domain,{specification:this._getFieldsSpec(),context:this.context,order:orderByToString(this.config.orderBy),});if(!data.length){return this.reload();}
const formattedData=this._formatData(data.records);for(const record of formattedData){if(getIdOfMany2oneField(record[this.parentFieldName])!==parentResId){node.hidden=false;this.notify({scrollTarget:"none"});this.notification.add(_t(`The parent of "%s" was successfully updated. Reloading records to account for other changes.`,node.data.display_name||node.data.name),{type:"success"});return this.reload();}}
let nodeToCollapse;const treeExpanded=this._findTreeExpanded();const expandedParentNodeIds=treeExpanded?.root.descendantsParentNodes.map((node)=>node.id)||[];if(!node.isLeaf||!expandedParentNodeIds.includes(parentNode?.id)){const depth=expandedParentNodeIds.findIndex((id)=>id===parentNode?.parentNode?.id);if(depth===-1){nodeToCollapse=treeExpanded?.root;}else{const nodeIdToCollapse=expandedParentNodeIds.at(depth+1);if(nodeIdToCollapse){nodeToCollapse=treeExpanded?.nodePerNodeId[nodeIdToCollapse];}}}else{nodeToCollapse=parentNode;}
if(oldParentNode){oldParentNode.removeChildNode(node);}else{node.tree.removeNodes([node]);}
nodeToCollapse?.collapseChildNodes();if(!parentNode){nodeId=forestId=treeId=0;this.root=this._createRoot(this.config,formattedData);}else{parentNode.data[this.childFieldName||this.defaultChildFieldName]=formattedData;parentNode.populateChildNodes();}
const newNodeId=Object.keys(this.root.nodePerNodeId).find((key)=>{return this.root.nodePerNodeId[key].resId===resId;});this.notify({scrollTarget:newNodeId});}
validateUpdateParentNode(node,parentNode){if(parentNode.resId===node.resId){this.notification.add(_t("The parent record cannot be the record dragged."),{type:"danger",});return false;}else if(node.allSubsidiaryResIds.includes(parentNode.resId)){this.notification.add(_t("Cannot change the parent because it will cause a cyclic."),{type:"danger",});return false;}
return true;}
computeUpdateParentNodeDomain(node,parentResId,parentNode){const domainsOr=[[["id","=",node.resId]]];domainsOr.push([[this.parentFieldName,"=",parentResId]]);if(!node.isLeaf){const expandedTreeParentResIds=node.descendantsParentNodes.map((node)=>node.resId);domainsOr.push([[this.parentFieldName,"in",expandedTreeParentResIds]]);}else if(!parentNode){const expandedTreeParentResIds=node.tree.root.descendantsParentNodes.map((node)=>node.resId);domainsOr.push([[this.parentFieldName,"in",expandedTreeParentResIds]]);}else if(!parentNode.isLeaf){const expandedTreeParentResIds=parentNode.descendantsParentNodes.map((node)=>node.resId);domainsOr.push([[this.parentFieldName,"in",expandedTreeParentResIds]]);}
let domain=Domain.or(domainsOr);const globalDomain=this.globalDomain;if(globalDomain.length){domain=Domain.and([domain,globalDomain]);}
return domain.toList({});}}
return __exports;});;

/* /web_hierarchy/static/src/hierarchy_node_draggable.js */
odoo.define('@web_hierarchy/hierarchy_node_draggable',['@odoo/owl','@web/core/utils/timing','@web/core/utils/objects','@web/core/utils/draggable_hook_builder'],function(require){'use strict';let __exports={};const{onWillUnmount,reactive,useEffect,useExternalListener}=require("@odoo/owl");const{useThrottleForAnimation}=require("@web/core/utils/timing");const{pick}=require("@web/core/utils/objects");const{makeDraggableHook}=require("@web/core/utils/draggable_hook_builder");const hookParams={name:"useHierarchyNodeDraggable",acceptedParams:{rows:[String],},defaultParams:{edgeScrolling:{speed:20,threshold:60},rows:null,},onComputeParams({ctx,params}){ctx.rowSelector=params.rows||null;if(ctx.rowSelector){ctx.fullSelector=`${ctx.rowSelector} ${ctx.fullSelector}`;}},onDragStart(params){const{ctx,addListener,callHandler}=params;const onElementPointerEnter=(ev)=>{const element=ev.currentTarget;current.hierarchyElement=element;callHandler("onElementEnter",{element});};const onElementPointerLeave=(ev)=>{const element=ev.currentTarget;current.hierarchyElement=null;callHandler("onElementLeave",{element});};const onRowPointerEnter=(ev)=>{const row=ev.currentTarget;current.hierarchyRow=row;callHandler("onRowEnter",{row});};const onRowPointerLeave=(ev)=>{const row=ev.currentTarget;current.hierarchyRow=null;callHandler("onRowLeave",{row});};const{ref,current,elementSelector,rowSelector}=ctx;for(const rowEl of ref.el.querySelectorAll(rowSelector)){addListener(rowEl,"pointerenter",onRowPointerEnter);addListener(rowEl,"pointerleave",onRowPointerLeave);}
for(const siblingEl of ref.el.querySelectorAll(elementSelector)){if(siblingEl!==current.element){addListener(siblingEl,"pointerenter",onElementPointerEnter);addListener(siblingEl,"pointerleave",onElementPointerLeave);}}
return pick(current,"element","row");},onDragEnd({ctx}){return pick(ctx.current,"element","row","hierarchyRow");},onDrop({ctx}){const{current}=ctx;const rowElement=current.hierarchyRow;const element=current.hierarchyElement;if((rowElement&&rowElement!==current.row)||element){return{element:current.element,row:current.row,nextRow:rowElement&&current.row!==rowElement?rowElement:null,newParentNode:element,};}},onWillStartDrag({ctx}){const{current,rowSelector}=ctx;if(rowSelector){current.row=current.element.closest(rowSelector);}
return pick(current,"element","row");},};__exports.useHierarchyNodeDraggable=useHierarchyNodeDraggable;function useHierarchyNodeDraggable(params){const setupHooks={addListener:useExternalListener,setup:useEffect,teardown:onWillUnmount,throttle:useThrottleForAnimation,wrapState:reactive,}
return makeDraggableHook({...hookParams,setupHooks})(params);}
return __exports;});;

/* /web_hierarchy/static/src/hierarchy_renderer.js */
odoo.define('@web_hierarchy/hierarchy_renderer',['@odoo/owl','@web/core/l10n/translation','@web/core/utils/hooks','@web/core/utils/scrolling','@web_hierarchy/hierarchy_card','@web_hierarchy/hierarchy_node_draggable'],function(require){'use strict';let __exports={};const{Component,useRef,onPatched}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_hierarchy",...args);const{useBus,useService}=require("@web/core/utils/hooks");const{scrollTo}=require("@web/core/utils/scrolling");const{HierarchyCard}=require("@web_hierarchy/hierarchy_card");const{useHierarchyNodeDraggable}=require("@web_hierarchy/hierarchy_node_draggable");const HierarchyRenderer=__exports.HierarchyRenderer=class HierarchyRenderer extends Component{static components={HierarchyCard,};static props={model:Object,openRecord:Function,archInfo:Object,};static template="web_hierarchy.HierarchyRenderer";setup(){this.rendererRef=useRef("renderer");this.notification=useService("notification");if(this.canDragAndDropRecord){useHierarchyNodeDraggable({ref:this.rendererRef,enable:this.draggable,elements:".o_hierarchy_node_container",handle:".o_hierarchy_node",rows:".o_hierarchy_row",ignore:"button",onDragStart:({addClass,element})=>{addClass(element,"o_hierarchy_dragged");addClass(element.querySelector(".o_hierarchy_node"),"shadow");},onDragEnd:({removeClass,element,row,hierarchyRow})=>{removeClass(element,"o_hierarchy_dragged");if(row){removeClass(row,"o_hierarchy_hover");}
if(hierarchyRow){removeClass(hierarchyRow,"o_hierarchy_hover");}},onDrop:(params)=>{this.nodeDrop(params);},onElementEnter:({addClass,element})=>{addClass(element,"o_hierarchy_hover");},onElementLeave:({removeClass,element})=>{removeClass(element,"o_hierarchy_hover");},onRowEnter:({addClass,row})=>{addClass(row,"o_hierarchy_hover");},onRowLeave:({removeClass,row})=>{removeClass(row,"o_hierarchy_hover");},});}
this.scrollTarget="none";useBus(this.props.model.bus,"hierarchyScrollTarget",(ev)=>{this.scrollTarget=ev.detail?.scrollTarget||"none";});onPatched(this.onPatched);}
onPatched(){let row;switch(this.scrollTarget){case"none":return;case"bottom":row=this.rendererRef.el.querySelector(":scope .o_hierarchy_row:last-child");break;case"up":row=this.rendererRef.el.querySelector(":scope .o_hierarchy_row:first-child");break;default:row=this.rendererRef.el.querySelector(`:scope .o_hierarchy_node[data-node-id="${this.scrollTarget}"]`)?.closest(".o_hierarchy_row");}
this.scrollTarget="none";if(!row){return;}
scrollTo(row,{behavior:"smooth"});}
get canDragAndDropRecord(){return this.draggable&&!this.env.isSmall;}
get draggable(){return this.props.archInfo.draggable;}
get rows(){const rootNodes=this.props.model.root.rootNodes;const rows=[{nodes:rootNodes}];const processNode=(node,rootNode)=>{const subNodes=node.nodes;if(subNodes.length&&!subNodes.includes(rootNode)){rows.push({parentNode:node,nodes:subNodes});for(const subNode of subNodes){processNode(subNode,rootNode);}}};for(const node of rootNodes){processNode(node,node);}
return rows;}
async nodeDrop({element,row,nextRow,newParentNode}){let parentNodeId,parentResId;if(newParentNode){parentNodeId=newParentNode.dataset.nodeId;}else if(nextRow?.dataset.rowId!==row.dataset.rowId){parentNodeId=nextRow.dataset.parentNodeId;if(!parentNodeId){const nodes=this.rows[nextRow.dataset.rowId].nodes||[];if(nodes){parentNodeId=nodes[0].parentNode?.id;if(!parentNodeId){parentResId=nodes[0].parentResId;if(!nodes.every((node)=>node.parentResId===parentResId)){this.notification.add(_t("Impossible to update the parent node of the dragged node because no parent has been found."),{type:"danger",});return;}}}}}
await this.props.model.updateParentNode(element.dataset.nodeId,{parentResId,parentNodeId});}}
return __exports;});;

/* /web_hierarchy/static/src/hierarchy_view.js */
odoo.define('@web_hierarchy/hierarchy_view',['@web/core/registry','@web_hierarchy/hierarchy_arch_parser','@web_hierarchy/hierarchy_controller','@web_hierarchy/hierarchy_model','@web_hierarchy/hierarchy_renderer'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{HierarchyArchParser}=require("@web_hierarchy/hierarchy_arch_parser");const{HierarchyController}=require("@web_hierarchy/hierarchy_controller");const{HierarchyModel}=require("@web_hierarchy/hierarchy_model");const{HierarchyRenderer}=require("@web_hierarchy/hierarchy_renderer");const hierarchyView=__exports.hierarchyView={type:"hierarchy",ArchParser:HierarchyArchParser,Controller:HierarchyController,Model:HierarchyModel,Renderer:HierarchyRenderer,buttonTemplate:"web_hierarchy.HierarchyButtons",searchMenuTypes:["filter"],props:(genericProps,view)=>{const{ArchParser,Model,Renderer,buttonTemplate:viewButtonTemplate}=view;const{arch,relatedModels,resModel,buttonTemplate}=genericProps;return{...genericProps,archInfo:new ArchParser().parse(arch,relatedModels,resModel),buttonTemplate:buttonTemplate||viewButtonTemplate,Model,Renderer,};}}
registry.category("views").add("hierarchy",hierarchyView);return __exports;});;

/* /esg/static/src/views/esg_carbon_emission_graph/esg_carbon_emission_graph_controller.js */
odoo.define('@esg/views/esg_carbon_emission_graph/esg_carbon_emission_graph_controller',['@odoo/owl','@web/core/l10n/translation','@web/core/utils/hooks','@web/views/graph/graph_controller'],function(require){'use strict';let __exports={};const{onWillStart}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"esg",...args);const{useService}=require("@web/core/utils/hooks");const{GraphController}=require("@web/views/graph/graph_controller");const EsgCarbonEmissionGraphController=__exports.EsgCarbonEmissionGraphController=class EsgCarbonEmissionGraphController extends GraphController{static template="esg.carbonEmissionGraphView";setup(){super.setup(...arguments);this.orm=useService("orm");this.title=_t("Carbon Analytics");onWillStart(async()=>{this.accountantInstalled=(await this.orm.searchCount("ir.module.module",[["name","=","accountant"],["state","=","installed"],]))>0;});}}
return __exports;});;

/* /esg/static/src/views/esg_carbon_emission_graph/esg_carbon_emission_graph_view.js */
odoo.define('@esg/views/esg_carbon_emission_graph/esg_carbon_emission_graph_view',['@web/core/registry','@web/views/graph/graph_view','@esg/views/esg_carbon_emission_graph/esg_carbon_emission_graph_controller'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{graphView}=require("@web/views/graph/graph_view");const{EsgCarbonEmissionGraphController}=require("@esg/views/esg_carbon_emission_graph/esg_carbon_emission_graph_controller");const EsgCarbonEmissionGraphView=__exports.EsgCarbonEmissionGraphView={...graphView,Controller:EsgCarbonEmissionGraphController,};registry.category("views").add("esg_carbon_emission_graph",EsgCarbonEmissionGraphView);return __exports;});;

/* /esg/static/src/views/esg_carbon_emission_pivot/esg_carbon_emission_pivot_controller.js */
odoo.define('@esg/views/esg_carbon_emission_pivot/esg_carbon_emission_pivot_controller',['@odoo/owl','@web/core/l10n/translation','@web/core/utils/hooks','@web/views/pivot/pivot_controller'],function(require){'use strict';let __exports={};const{onWillStart}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"esg",...args);const{useService}=require("@web/core/utils/hooks");const{PivotController}=require("@web/views/pivot/pivot_controller");const EsgCarbonEmissionPivotController=__exports.EsgCarbonEmissionPivotController=class EsgCarbonEmissionPivotController extends PivotController{static template="esg.carbonEmissionPivotView";static components={...PivotController.components};setup(){super.setup(...arguments);this.orm=useService("orm");this.title=_t("Carbon Analytics");onWillStart(async()=>{this.accountantInstalled=(await this.orm.searchCount("ir.module.module",[["name","=","accountant"],["state","=","installed"],]))>0;});}}
return __exports;});;

/* /esg/static/src/views/esg_carbon_emission_pivot/esg_carbon_emission_pivot_view.js */
odoo.define('@esg/views/esg_carbon_emission_pivot/esg_carbon_emission_pivot_view',['@web/core/registry','@web/views/pivot/pivot_view','@esg/views/esg_carbon_emission_pivot/esg_carbon_emission_pivot_controller'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{pivotView}=require("@web/views/pivot/pivot_view");const{EsgCarbonEmissionPivotController}=require("@esg/views/esg_carbon_emission_pivot/esg_carbon_emission_pivot_controller");const EsgCarbonEmissionPivotView=__exports.EsgCarbonEmissionPivotView={...pivotView,Controller:EsgCarbonEmissionPivotController,};registry.category("views").add("esg_carbon_emission_pivot",EsgCarbonEmissionPivotView);return __exports;});;

/* /im_livechat/static/src/views/lazy/im_livechat_agent_history_graph.js */
odoo.define('@im_livechat/views/lazy/im_livechat_agent_history_graph',['@im_livechat/views/lazy/im_livechat_graph_renderer_mixin','@web/core/registry','@web/views/graph/graph_view'],function(require){'use strict';let __exports={};const{LivechatGraphRendererMixin}=require("@im_livechat/views/lazy/im_livechat_graph_renderer_mixin");const{registry}=require("@web/core/registry");const{graphView}=require("@web/views/graph/graph_view");registry.category("views").add("im_livechat.agent_history_graph",{...graphView,Renderer:LivechatGraphRendererMixin("im_livechat.channel.member.history"),});return __exports;});;

/* /im_livechat/static/src/views/lazy/im_livechat_agent_history_pivot.js */
odoo.define('@im_livechat/views/lazy/im_livechat_agent_history_pivot',['@web/core/registry','@web/views/pivot/pivot_view','@im_livechat/views/lazy/im_livechat_pivot_renderer_mixin'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{pivotView}=require("@web/views/pivot/pivot_view");const{LivechatPivotRendererMixin}=require("@im_livechat/views/lazy/im_livechat_pivot_renderer_mixin");registry.category("views").add("im_livechat.agent_history_pivot",{...pivotView,Renderer:LivechatPivotRendererMixin("im_livechat.channel.member.history"),});return __exports;});;

/* /im_livechat/static/src/views/lazy/im_livechat_channel_report_graph_view.js */
odoo.define('@im_livechat/views/lazy/im_livechat_channel_report_graph_view',['@im_livechat/views/lazy/im_livechat_graph_renderer_mixin','@web/core/registry','@web/views/graph/graph_view'],function(require){'use strict';let __exports={};const{LivechatGraphRendererMixin}=require("@im_livechat/views/lazy/im_livechat_graph_renderer_mixin");const{registry}=require("@web/core/registry");const{graphView}=require("@web/views/graph/graph_view");registry.category("views").add("im_livechat.channel_report_graph_views",{...graphView,Renderer:LivechatGraphRendererMixin("im_livechat.report.channel"),});return __exports;});;

/* /im_livechat/static/src/views/lazy/im_livechat_channel_report_pivot.js */
odoo.define('@im_livechat/views/lazy/im_livechat_channel_report_pivot',['@web/core/registry','@web/views/pivot/pivot_view','@im_livechat/views/lazy/im_livechat_pivot_renderer_mixin'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{pivotView}=require("@web/views/pivot/pivot_view");const{LivechatPivotRendererMixin}=require("@im_livechat/views/lazy/im_livechat_pivot_renderer_mixin");registry.category("views").add("im_livechat.report_channel_pivot",{...pivotView,Renderer:LivechatPivotRendererMixin("im_livechat.report.channel"),});return __exports;});;

/* /im_livechat/static/src/views/lazy/im_livechat_graph_renderer_mixin.js */
odoo.define('@im_livechat/views/lazy/im_livechat_graph_renderer_mixin',['@web/views/graph/graph_renderer'],function(require){'use strict';let __exports={};const{GraphRenderer}=require("@web/views/graph/graph_renderer");const LivechatGraphRendererMixin=__exports.LivechatGraphRendererMixin=(model)=>class extends GraphRenderer{async onGraphClickedFinal(domain){const action=this.env.services.orm.call(model,"action_open_discuss_channel_view",[],{domain});this.env.services.action.doAction(action);}};return __exports;});;

/* /im_livechat/static/src/views/lazy/im_livechat_pivot_renderer_mixin.js */
odoo.define('@im_livechat/views/lazy/im_livechat_pivot_renderer_mixin',['@web/views/pivot/pivot_renderer'],function(require){'use strict';let __exports={};const{PivotRenderer}=require("@web/views/pivot/pivot_renderer");const LivechatPivotRendererMixin=__exports.LivechatPivotRendererMixin=(model)=>class extends PivotRenderer{async openView(domain){const action=this.env.services.orm.call(model,"action_open_discuss_channel_view",[],{domain});this.env.services.action.doAction(action);}};return __exports;});;

/* /hr_skills/static/src/views/skills_graph.js */
odoo.define('@hr_skills/views/skills_graph',['@web/core/registry','@web/views/graph/graph_renderer','@web/views/graph/graph_view'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{GraphRenderer}=require("@web/views/graph/graph_renderer");const{graphView}=require("@web/views/graph/graph_view");const SkillsGraphRenderer=__exports.SkillsGraphRenderer=class SkillsGraphRenderer extends GraphRenderer{getScaleOptions(){const scaleOptions=super.getScaleOptions();if('y'in scaleOptions){scaleOptions.y.suggestedMax=100;}
return scaleOptions;}}
const skillsGraphView=__exports.skillsGraphView={...graphView,Renderer:SkillsGraphRenderer,};registry.category("views").add("skills_graph",skillsGraphView);return __exports;});;

/* /ai_documents/static/src/views/activity/documents_activity_controller.js */
odoo.define('@ai_documents/views/activity/documents_activity_controller',['@web/core/utils/patch','@documents/views/activity/documents_activity_controller','@ai_documents/views/documents_controller_mixin'],function(require){'use strict';let __exports={};const{patch}=require("@web/core/utils/patch");const{DocumentsActivityController}=require("@documents/views/activity/documents_activity_controller");const{AiDocumentsControllerMixin}=require("@ai_documents/views/documents_controller_mixin");patch(DocumentsActivityController.prototype,AiDocumentsControllerMixin());return __exports;});;

/* /documents_account/static/src/views/activity/documents_activity_model.js */
odoo.define('@documents_account/views/activity/documents_activity_model',['@documents/views/activity/documents_activity_model','@web/core/utils/patch','@documents_account/views/documents_model_mixin'],function(require){'use strict';let __exports={};const{DocumentsActivityModel}=require("@documents/views/activity/documents_activity_model");const{patch}=require("@web/core/utils/patch");const{AccountIsViewablePatch}=require("@documents_account/views/documents_model_mixin");patch(DocumentsActivityModel.Record.prototype,AccountIsViewablePatch);return __exports;});;

/* /web_grid/static/src/components/float_factor_grid_cell.js */
odoo.define('@web_grid/components/float_factor_grid_cell',['@web/core/registry','@web/views/fields/formatters','@web_grid/components/grid_cell'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{formatFloatFactor}=require("@web/views/fields/formatters");const{GridCell}=require("@web_grid/components/grid_cell");function formatter(value,options={}){return formatFloatFactor(value,options);}
const FloatFactorGridCell=__exports.FloatFactorGridCell=class FloatFactorGridCell extends GridCell{static props={...GridCell.props,factor:{type:Number,optional:true},};parse(value){const factorValue=value/this.factor;return super.parse(factorValue.toString());}
get factor(){return this.props.factor||this.props.fieldInfo.options?.factor||1;}
get value(){return super.value*this.factor;}
get formattedValue(){return formatter(this.value);}}
const floatFactorGridCell=__exports.floatFactorGridCell={component:FloatFactorGridCell,formatter,};registry.category("grid_components").add("float_factor",floatFactorGridCell);return __exports;});;

/* /web_grid/static/src/components/float_time_grid_cell.js */
odoo.define('@web_grid/components/float_time_grid_cell',['@web/core/registry','@web/views/fields/parsers','@web/views/fields/formatters','@web_grid/components/grid_cell'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{parseFloatTime}=require("@web/views/fields/parsers");const{formatFloatTime}=require("@web/views/fields/formatters");const{GridCell}=require("@web_grid/components/grid_cell");function formatter(value,options={}){return formatFloatTime(value,{...options,noLeadingZeroHour:true});}
const FloatTimeGridCell=__exports.FloatTimeGridCell=class FloatTimeGridCell extends GridCell{get formattedValue(){return formatter(this.value);}
get inputMode(){return"text";}
parse(value){return parseFloatTime(value);}}
const floatTimeGridCell=__exports.floatTimeGridCell={component:FloatTimeGridCell,formatter,};registry.category("grid_components").add("float_time",floatTimeGridCell);return __exports;});;

/* /web_grid/static/src/components/float_toggle_grid_cell.js */
odoo.define('@web_grid/components/float_toggle_grid_cell',['@web/core/registry','@web/views/fields/formatters','@web_grid/hooks/grid_cell_hook','@web_grid/components/grid_cell','@odoo/owl'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{formatFloatFactor}=require("@web/views/fields/formatters");const{useGridCell,useMagnifierGlass}=require("@web_grid/hooks/grid_cell_hook");const{standardGridCellProps}=require("@web_grid/components/grid_cell");const{Component,useRef,useState,useEffect}=require("@odoo/owl");function formatter(value,options={}){return formatFloatFactor(value,options);}
const FloatToggleGridCell=__exports.FloatToggleGridCell=class FloatToggleGridCell extends Component{static props={...standardGridCellProps,factor:{type:Number,optional:true},};static template="web_grid.FloatToggleGridCell";setup(){this.rootRef=useRef("root");this.buttonRef=useRef("toggleButton");this.magnifierGlassHook=useMagnifierGlass();this.state=useState({edit:this.props.editMode,invalid:false,cell:null,});useGridCell();useEffect((buttonEl)=>{if(buttonEl){buttonEl.focus();}},()=>[this.buttonRef.el]);}
get factor(){return this.props.factor||this.props.fieldInfo.options?.factor||1;}
get range(){return this.props.fieldInfo.options?.range||[0.0,0.5,1.0];}
get value(){return(this.state.cell.value||0)*this.factor;}
get formattedValue(){return formatter(this.state.cell.value||0,{digits:this.props.fieldInfo.attrs?.digits||2,factor:this.factor,});}
isEditable(props=this.props){return(!props.readonly&&this.state.cell?.readonly===false&&!this.state.cell.row.isSection);}
onChange(){let currentIndex=this.range.indexOf(this.value);currentIndex++;if(currentIndex>this.range.length-1){currentIndex=0;}
this.update(this.range[currentIndex]/this.factor);}
update(value){this.state.cell.update(value);}
onCellClick(ev){if(this.isEditable()&&!this.state.edit&&!ev.target.closest(".o_grid_search_btn")){this.onChange();this.props.onEdit(true);}}
onKeyDown(ev){this.props.onKeyDown(ev,this.state.cell);}}
const floatToggleGridCell=__exports.floatToggleGridCell={component:FloatToggleGridCell,formatter,};registry.category("grid_components").add("float_toggle",floatToggleGridCell);return __exports;});;

/* /web_grid/static/src/components/grid_cell.js */
odoo.define('@web_grid/components/grid_cell',['@web/core/registry','@web/views/fields/numpad_decimal_hook','@web/views/fields/formatters','@web/core/utils/numbers','@web/views/fields/parsers','@web_grid/hooks/input_hook','@odoo/owl','@web_grid/hooks/grid_cell_hook'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{useNumpadDecimal}=require("@web/views/fields/numpad_decimal_hook");const{formatInteger}=require("@web/views/fields/formatters");const{formatFloat}=require("@web/core/utils/numbers");const{parseInteger,parseFloat}=require("@web/views/fields/parsers");const{useInputHook}=require("@web_grid/hooks/input_hook");const{Component,useEffect,useRef,useState}=require("@odoo/owl");const{useGridCell,useMagnifierGlass}=require("@web_grid/hooks/grid_cell_hook");const standardGridCellProps=__exports.standardGridCellProps={name:String,classNames:String,fieldInfo:Object,readonly:{type:Boolean,optional:true},editMode:{type:Boolean,optional:true},reactive:{type:Object,shape:{cell:[HTMLElement,{value:null}],},},openRecords:Function,onEdit:Function,getCell:Function,onKeyDown:{type:Function,optional:true},};const GridCell=__exports.GridCell=class GridCell extends Component{static template="web_grid.Cell";static props=standardGridCellProps;static defaultProps={readonly:true,editMode:false,};setup(){this.rootRef=useRef("root");this.state=useState({edit:this.props.editMode,invalid:false,cell:null,});this.discardChanges=false;this.magnifierGlassHook=useMagnifierGlass();this.inputRef=useInputHook({getValue:()=>this.formattedValue,refName:"numpadDecimal",parse:this.parse.bind(this),notifyChange:this.onChange.bind(this),commitChanges:this.saveEdition.bind(this),onKeyDown:(ev)=>this.props.onKeyDown(ev,this.state.cell),discard:this.discard.bind(this),setInvalid:()=>{this.state.invalid=true;},setDirty:()=>{this.state.invalid=false;},isInvalid:()=>this.state.invalid,});useNumpadDecimal();useGridCell();useEffect((edit,inputEl,cellEl)=>{if(inputEl){inputEl.value=this.formattedValue;}
if(edit&&inputEl){inputEl.focus();if(inputEl.type==="text"){if(inputEl.selectionStart===null){return;}
if(inputEl.selectionStart===inputEl.selectionEnd){inputEl.selectionStart=0;inputEl.selectionEnd=inputEl.value.length;}}}
this.discardChanges=false;},()=>[this.state.edit,this.inputRef.el,this.props.reactive.cell]);}
get value(){return this.state.cell?.value||0;}
get section(){return this.row.getSection();}
get row(){return this.state.cell?.row;}
get formattedValue(){const{type,digits}=this.props.fieldInfo;if(type==="integer"){return formatInteger(this.value);}
return formatFloat(this.value,{digits:digits||2});}
get inputMode(){return"numeric";}
isEditable(props=this.props){return(!props.readonly&&this.state.cell?.readonly===false&&!this.state.cell.row.isSection);}
parse(value){if(this.props.fieldInfo.type==="integer"){return parseInteger(value);}
return parseFloat(value);}
onChange(value){if(!this.discardChanges){this.update(value);}}
update(value){this.state.cell.update(value);}
saveEdition(value){const changesCommitted=(value||false)!==(this.state.cell.value||false);if((value||false)!==(this.state.cell?.value||false)){this.update(value);}
this.props.onEdit(false);return changesCommitted;}
discard(){this.discardChanges=true;this.props.onEdit(false);}
onCellClick(ev){if(this.isEditable()&&!this.state.edit){this.discardChanges=false;this.props.onEdit(true);}}}
const integerGridCell=__exports.integerGridCell={component:GridCell,formatter:formatInteger,};registry.category("grid_components").add("integer",integerGridCell);const floatGridCell=__exports.floatGridCell={component:GridCell,formatter:formatFloat,};registry.category("grid_components").add("float",floatGridCell);return __exports;});;

/* /web_grid/static/src/components/grid_component/grid_component.js */
odoo.define('@web_grid/components/grid_component/grid_component',['@odoo/owl','@web/core/registry','@web_grid/components/grid_cell','@web_grid/components/grid_row/grid_row'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{registry}=require("@web/core/registry");const{GridCell}=require("@web_grid/components/grid_cell");const{GridRow}=require("@web_grid/components/grid_row/grid_row");const gridComponentRegistry=registry.category("grid_components");const GridComponent=__exports.GridComponent=class GridComponent extends Component{static props=["name","type","isMeasure?","component?","*"];static template="web_grid.GridComponent"
get gridComponent(){if(this.props.component){return this.props.component;}
if(gridComponentRegistry.contains(this.props.type)){return gridComponentRegistry.get(this.props.type).component;}
if(this.props.isMeasure){console.warn(`Missing widget: ${this.props.type} for grid component`);return GridCell;}
return GridRow;}
get gridComponentProps(){const gridComponentProps=Object.fromEntries(Object.entries(this.props).filter(([key,])=>key in this.gridComponent.props));gridComponentProps.classNames=`o_grid_component o_grid_component_${this.props.type} ${gridComponentProps.classNames || ""}`;return gridComponentProps;}}
return __exports;});;

/* /web_grid/static/src/components/grid_row/grid_row.js */
odoo.define('@web_grid/components/grid_row/grid_row',['@odoo/owl','@web/core/registry'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{registry}=require("@web/core/registry");const GridRow=__exports.GridRow=class GridRow extends Component{static template="web_grid.GridRow";static props={name:String,model:Object,row:Object,classNames:{type:String,optional:true},context:{type:Object,optional:true},style:{type:String,optional:true},value:{optional:true},};static defaultProps={classNames:"",context:{},style:"",};get value(){let value='value'in this.props?this.props.value:this.props.row.initialRecordValues[this.props.name];const fieldInfo=this.props.model.fieldsInfo[this.props.name];if(fieldInfo.type==="selection"){value=fieldInfo.selection.find(([key,])=>key===value)?.[1];}
return value;}}
const gridRow=__exports.gridRow={component:GridRow,};registry.category("grid_components").add("selection",gridRow).add("char",gridRow);return __exports;});;

/* /web_grid/static/src/components/many2one_grid_row/many2one_grid_row.js */
odoo.define('@web_grid/components/many2one_grid_row/many2one_grid_row',['@web/core/registry','@web/core/utils/hooks','@web_grid/components/grid_row/grid_row'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{GridRow,gridRow}=require("@web_grid/components/grid_row/grid_row");const Many2OneGridRow=__exports.Many2OneGridRow=class Many2OneGridRow extends GridRow{static template="web_grid.Many2OneGridRow";static props={...GridRow.props,relation:{type:String,optional:true},canOpen:{type:Boolean,optional:true},}
static defaultProps={...GridRow.defaultProps,canOpen:true,};setup(){this.orm=useService("orm");this.actionService=useService("action");}
get relation(){return this.props.relation||this.props.model.fieldsInfo[this.props.name].relation;}
get urlRelation(){if(!this.relation.includes(".")){return"m-"+this.relation;}
return this.relation;}
get displayName(){return this.value&&this.value[1].split("\n",1)[0];}
get extraLines(){return this.value?this.value[1].split("\n").map((line)=>line.trim()).slice(1):[];}
get resId(){return this.value&&this.value[0];}
async openAction(){const action=await this.orm.call(this.relation,"get_formview_action",[[this.resId]],{context:this.props.context,});await this.actionService.doAction(action);}
onClick(ev){if(this.props.canOpen){ev.stopPropagation();this.openAction();}}}
const many2OneGridRow=__exports.many2OneGridRow={...gridRow,component:Many2OneGridRow,};registry.category("grid_components").add("many2one",many2OneGridRow);return __exports;});;

/* /web_grid/static/src/hooks/grid_cell_hook.js */
odoo.define('@web_grid/hooks/grid_cell_hook',['@odoo/owl'],function(require){'use strict';let __exports={};const{useComponent,useEffect}=require("@odoo/owl");__exports.useMagnifierGlass=useMagnifierGlass;function useMagnifierGlass(){const component=useComponent();return{onMagnifierGlassClick(){const{context,domain,title}=component.state.cell;component.props.openRecords(title,domain.toList(),context);},};}
__exports.useGridCell=useGridCell;function useGridCell(){const component=useComponent();useEffect((cellEl)=>{if(!cellEl){component.state.cell=null;return;}
component.state.cell=component.props.getCell(cellEl.dataset.row,cellEl.dataset.column);Object.assign(component.rootRef.el.style,{"grid-row":cellEl.style["grid-row"],"grid-column":cellEl.style["grid-column"],"z-index":1,});component.rootRef.el.dataset.gridRow=cellEl.dataset.gridRow;component.rootRef.el.dataset.gridColumn=cellEl.dataset.gridColumn;cellEl.querySelector(".o_grid_cell_readonly").classList.add("d-none");component.rootRef.el.classList.toggle("o_field_cursor_disabled",!component.state.cell.row.isSection&&!component.isEditable());component.rootRef.el.classList.toggle("fw-bold",Boolean(component.state.cell.row.isSection));},()=>[component.props.reactive.cell]);}
return __exports;});;

/* /web_grid/static/src/hooks/input_hook.js */
odoo.define('@web_grid/hooks/input_hook',['@web/core/hotkeys/hotkey_service','@odoo/owl'],function(require){'use strict';let __exports={};const{getActiveHotkey}=require("@web/core/hotkeys/hotkey_service");const{useEffect,useRef}=require("@odoo/owl");__exports.useInputHook=useInputHook;function useInputHook(params){const inputRef=params.ref||useRef(params.refName||"input");let isDirty=false;let lastSetValue=null;function onInput(ev){isDirty=ev.target.value!==lastSetValue;if(params.setDirty){params.setDirty(isDirty);}}
function onChange(ev){if(isDirty){isDirty=false;let isInvalid=false;let val=ev.target.value;if(params.parse){try{val=params.parse(val);}catch{if(params.setInvalid){params.setInvalid();}
isInvalid=true;}}
if(!isInvalid){params.notifyChange(val);lastSetValue=ev.target.value;}
if(params.setDirty){params.setDirty(isDirty);}}}
function onKeydown(ev){const hotkey=getActiveHotkey(ev);if(params.discard&&hotkey==="escape"){params.discard();}else if(params.commitChanges&&["enter","tab","shift+tab"].includes(hotkey)){commitChanges();}
if(params.onKeyDown){params.onKeyDown(ev);}}
useEffect((inputEl)=>{if(inputEl){inputEl.addEventListener("input",onInput);inputEl.addEventListener("change",onChange);inputEl.addEventListener("keydown",onKeydown);return()=>{inputEl.removeEventListener("input",onInput);inputEl.removeEventListener("change",onChange);inputEl.removeEventListener("keydown",onKeydown);};}},()=>[inputRef.el]);useEffect(()=>{const isInvalid=params.isInvalid?params.isInvalid():false;if(inputRef.el&&!isDirty&&!isInvalid){inputRef.el.value=params.getValue();lastSetValue=inputRef.el.value;}});function isUrgentSaved(urgent){if(params.isUrgentSaved){return params.isUrgentSaved(urgent);}
return urgent;}
async function commitChanges(urgent){if(!inputRef.el){return;}
isDirty=inputRef.el.value!==lastSetValue;if(isDirty||isUrgentSaved(urgent)){let isInvalid=false;isDirty=false;let val=inputRef.el.value;if(params.parse){try{val=params.parse(val);}catch{isInvalid=true;if(urgent){return;}else{params.setInvalid();}}}
if(isInvalid){return;}
const result=params.commitChanges(val);if(result){lastSetValue=inputRef.el.value;if(params.setDirty){params.setDirty(isDirty);}}}}
return inputRef;}
return __exports;});;

/* /web_grid/static/src/views/grid_arch_parser.js */
odoo.define('@web_grid/views/grid_arch_parser',['@web/core/l10n/translation','@web/core/utils/strings','@web/core/utils/xml','@web/views/utils'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_grid",...args);const{exprToBoolean}=require("@web/core/utils/strings");const{visitXML}=require("@web/core/utils/xml");const{getActiveActions,processButton}=require("@web/views/utils");const GridArchParser=__exports.GridArchParser=class GridArchParser{parse(xmlDoc,models,modelName){const archInfo={activeActions:getActiveActions(xmlDoc),hideLineTotal:false,hideColumnTotal:false,hasBarChartTotal:false,createInline:false,displayEmpty:false,buttons:[],activeRangeName:"",ranges:{},sectionField:null,rowFields:[],columnFieldName:"",measureField:{name:"__count",aggregator:"sum",readonly:true,string:_t("Count"),},readonlyField:null,widgetPerFieldName:{},editable:false,formViewId:false,};let buttonId=0;visitXML(xmlDoc,(node)=>{if(node.tagName==="grid"){if(node.hasAttribute("hide_line_total")){archInfo.hideLineTotal=exprToBoolean(node.getAttribute("hide_line_total"));}
if(node.hasAttribute("hide_column_total")){archInfo.hideColumnTotal=exprToBoolean(node.getAttribute("hide_column_total"));}
if(node.hasAttribute("barchart_total")){archInfo.hasBarChartTotal=exprToBoolean(node.getAttribute("barchart_total"));}
if(node.hasAttribute("create_inline")){archInfo.createInline=exprToBoolean(node.getAttribute("create_inline"));}
if(node.hasAttribute("display_empty")){archInfo.displayEmpty=exprToBoolean(node.getAttribute("display_empty"));}
if(node.hasAttribute("action")&&node.hasAttribute("type")){archInfo.openAction={name:node.getAttribute("action"),type:node.getAttribute("type"),};}
if(node.hasAttribute("editable")){archInfo.editable=exprToBoolean(node.getAttribute("editable"));}
if(node.hasAttribute("form_view_id")){archInfo.formViewId=parseInt(node.getAttribute("form_view_id"),10);}}else if(node.tagName==="field"){const fieldName=node.getAttribute("name");const fieldInfo=models[modelName].fields[fieldName];const type=node.getAttribute("type")||"row";const string=node.getAttribute("string")||fieldInfo.string;let invisible=node.getAttribute("invisible")||'False';switch(type){case"row":if(node.hasAttribute("widget")){archInfo.widgetPerFieldName[fieldName]=node.getAttribute("widget");}
if(node.hasAttribute("section")&&exprToBoolean(node.getAttribute("section"))&&!archInfo.sectionField){archInfo.sectionField={name:fieldName,invisible,};}else{archInfo.rowFields.push({name:fieldName,invisible,});}
break;case"col":archInfo.columnFieldName=fieldName;const{ranges,activeRangeName}=this._extractRanges(node);archInfo.ranges=ranges;archInfo.activeRangeName=activeRangeName;break;case"measure":if(node.hasAttribute("widget")){archInfo.widgetPerFieldName[fieldName]=node.getAttribute("widget");}
archInfo.measureField={name:fieldName,aggregator:node.getAttribute("operator")||fieldInfo.aggregator,string,readonly:exprToBoolean(node.getAttribute("readonly"))||fieldInfo.readonly,};break;case"readonly":let groupOperator=fieldInfo.aggregator;if(node.hasAttribute("operator")){groupOperator=node.getAttribute("operator");}
archInfo.readonlyField={name:fieldName,aggregator:groupOperator,string,};break;}}else if(node.tagName==="button"){archInfo.buttons.push({...processButton(node),type:"button",id:buttonId++,});}});archInfo.editable=archInfo.editable&&archInfo.measureField&&!archInfo.measureField.readonly&&archInfo.measureField.aggregator==="sum";return archInfo;}
_extractRanges(colNode){const ranges={};let activeRangeName;let firstRangeName="";for(const rangeNode of colNode.children){const rangeName=rangeNode.getAttribute("name");if(!firstRangeName.length){firstRangeName=rangeName;}
ranges[rangeName]={name:rangeName,description:rangeNode.getAttribute("string"),span:rangeNode.getAttribute("span"),step:rangeNode.getAttribute("step"),hotkey:rangeNode.getAttribute("hotkey"),default:exprToBoolean(rangeNode.getAttribute("default")),};if(ranges[rangeName].default){activeRangeName=rangeName;}}
return{ranges:ranges,activeRangeName:activeRangeName||firstRangeName};}}
return __exports;});;

/* /web_grid/static/src/views/grid_controller.js */
odoo.define('@web_grid/views/grid_controller',['@web/core/l10n/translation','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@web/core/l10n/dates','@web/core/utils/hooks','@web/search/layout','@web/model/model','@web/views/standard_view_props','@web/views/view_button/view_button_hook','@web/views/view_dialogs/form_view_dialog','@web/views/view_button/view_button','@web/search/action_hook','@web/search/cog_menu/cog_menu','@web/search/search_bar/search_bar','@web/search/search_bar/search_bar_toggler','@web/core/browser/browser','@web/views/action_helper','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_grid",...args);const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{serializeDate,deserializeDate}=require("@web/core/l10n/dates");const{useService}=require("@web/core/utils/hooks");const{Layout}=require("@web/search/layout");const{useModelWithSampleData}=require("@web/model/model");const{standardViewProps}=require("@web/views/standard_view_props");const{useViewButtons}=require("@web/views/view_button/view_button_hook");const{FormViewDialog}=require("@web/views/view_dialogs/form_view_dialog");const{ViewButton}=require("@web/views/view_button/view_button");const{useSetupAction}=require("@web/search/action_hook");const{CogMenu}=require("@web/search/cog_menu/cog_menu");const{SearchBar}=require("@web/search/search_bar/search_bar");const{useSearchBarToggler}=require("@web/search/search_bar/search_bar_toggler");const{browser}=require("@web/core/browser/browser");const{ActionHelper}=require("@web/views/action_helper");const{Component,useState,onWillUnmount,useRef}=require("@odoo/owl");const{DateTime}=luxon;const GridController=__exports.GridController=class GridController extends Component{static components={Layout,Dropdown,DropdownItem,ViewButton,CogMenu,SearchBar,ActionHelper,};static props={...standardViewProps,archInfo:Object,buttonTemplate:String,Model:Function,Renderer:Function,};static template="web_grid.GridView";setup(){const state=this.props.state||{};let activeRangeName=this.props.archInfo.activeRangeName;let defaultAnchor;if(state.activeRangeName){activeRangeName=state.activeRangeName;}else if(this.isMobile&&"day"in this.props.archInfo.ranges){activeRangeName="day";}
if(state.anchor){defaultAnchor=state.anchor;}else if(this.props.context.grid_anchor){defaultAnchor=deserializeDate(this.props.context.grid_anchor);}
this.dialogService=useService("dialog");this.model=useModelWithSampleData(this.props.Model,{resModel:this.props.resModel,sectionField:this.props.archInfo.sectionField,rowFields:this.props.archInfo.rowFields,columnFieldName:this.props.archInfo.columnFieldName,measureField:this.props.archInfo.measureField,readonlyField:this.props.archInfo.readonlyField,fieldsInfo:this.props.relatedModels[this.props.resModel].fields,activeRangeName,ranges:this.props.archInfo.ranges,defaultAnchor,});const rootRef=useRef("root");useSetupAction({rootRef:rootRef,getLocalState:()=>{const{anchor,range}=this.model.navigationInfo;return{anchor,activeRangeName:range?.name,};}})
const isWeekendVisible=browser.localStorage.getItem("grid.isWeekendVisible");this.state=useState({activeRangeName:this.model.navigationInfo.range?.name,isWeekendVisible:isWeekendVisible!==null&&isWeekendVisible!==undefined?JSON.parse(isWeekendVisible):true,});useViewButtons(rootRef,{beforeExecuteAction:this.beforeExecuteActionButton.bind(this),afterExecuteAction:this.afterExecuteActionButton.bind(this),reload:this.reload.bind(this),});onWillUnmount(()=>this.closeDialog?.());this.searchBarToggler=useSearchBarToggler();}
get isMobile(){return this.env.isSmall;}
get isEditable(){return(this.props.archInfo.activeActions.edit&&this.props.archInfo.editable);}
get displayNoContent(){return(!(this.props.archInfo.displayEmpty||this.model.hasData())||this.model.useSampleModel);}
get displayAddALine(){return this.props.archInfo.activeActions.create;}
get hasDisplayableData(){return true;}
get options(){const{hideLineTotal,hideColumnTotal,hasBarChartTotal,createInline}=this.props.archInfo;return{hideLineTotal,hideColumnTotal,hasBarChartTotal,createInline,};}
createRecord(params){const columnContext=this.model.columnFieldIsDate?{[`default_${this.model.columnFieldName}`]:serializeDate(this.model.navigationInfo.anchor),}:{};const context={...this.props.context,...columnContext,...(params?.context||{}),};this.closeDialog=this.dialogService.add(FormViewDialog,{title:_t("New Record"),resModel:this.model.resModel,viewId:this.props.archInfo.formViewId,onRecordSaved:this.onRecordSaved.bind(this),...(params||{}),context,},{onClose:()=>{this.closeDialog=null;},});}
async beforeExecuteActionButton(){}
async afterExecuteActionButton(){}
async reload(){await this.model.reload();}
async onRecordSaved(record){await this.reload();}
get columns(){return this.state.isWeekendVisible||["day","year"].includes(this.state.activeRangeName)?this.model.columnsArray:this.model.columnsArray.filter((column)=>DateTime.fromISO(column.value).weekday<6);}
toggleWeekendVisibility(){this.state.isWeekendVisible=!this.state.isWeekendVisible;browser.localStorage.setItem("grid.isWeekendVisible",this.state.isWeekendVisible);}}
return __exports;});;

/* /web_grid/static/src/views/grid_model.js */
odoo.define('@web_grid/views/grid_model',['@web/core/utils/concurrency','@web/core/utils/hooks','@web/core/domain','@web/core/l10n/dates','@web/core/l10n/localization','@web/core/l10n/translation','@web/core/l10n/utils','@web/model/model','@web/core/browser/browser'],function(require){'use strict';let __exports={};const{KeepLast,Mutex}=require("@web/core/utils/concurrency");const{useService}=require("@web/core/utils/hooks");const{Domain}=require("@web/core/domain");const{serializeDate}=require("@web/core/l10n/dates");const{localization}=require("@web/core/l10n/localization");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_grid",...args);const{pyToJsLocale}=require("@web/core/l10n/utils");const{Model}=require("@web/model/model");const{browser}=require("@web/core/browser/browser");const{DateTime,Interval}=luxon;const GridCell=__exports.GridCell=class GridCell{constructor(model,row,column,value=0,isHovered=false){this.row=row;this.column=column;this.model=model;this.value=value;this.isHovered=isHovered;this._readonly=false;this.column.addCell(this);}
get readonly(){return this._readonly||this.column.readonly;}
get domain(){const domains=[this.model.searchParams.domain,this.row.domain,this.column.domain];return Domain.and(domains);}
get context(){return{...(this.model.searchParams.context||{}),...this.row.section?.context,...this.row.context,...this.column.context,};}
get title(){const rowTitle=!this.row.section||this.row.section.isFake?this.row.title:`${this.row.section.title} / ${this.row.title}`;const columnTitle=this.column.title;return`${rowTitle} (${columnTitle})`;}
async update(value){return this.model.mutex.exec(async()=>{await this._update(value);});}
async _update(value){const oldValue=this.value;const result=await this.model.orm.call(this.model.resModel,"grid_update_cell",[this.domain.toList({}),this.model.measureFieldName,value-oldValue],{context:this.context});if(result){this.model.actionService.doAction(result);return;}
this.row.updateCell(this.column,value,this.model.data);this.model.notify();}}
const GridRow=__exports.GridRow=class GridRow{constructor(data,domain,valuePerFieldName,model,section,isAdditionalRow=false){this._domain=domain;this.model=model;this.cells={};this.valuePerFieldName=valuePerFieldName;this.id=model.rowId++;this.section=section;if(section){this.section.addRow(this);}
this.grandTotal=0;this.grandTotalWeekendHidden=0;this.isAdditionalRow=isAdditionalRow;this._generateCells(data);}
get initialRecordValues(){return this.valuePerFieldName;}
get title(){const labelArray=[];for(const rowField of this.model.rowFields){let title=this.valuePerFieldName[rowField.name];if(this.model.fieldsInfo[rowField.name].type==="many2one"){if(title){title=title[1];}else if(labelArray.length){title="";}else{title="None";}}
if(title){labelArray.push(title);}}
return labelArray.join(" / ");}
get domain(){if(this.section.isFake){return this._domain;}
return Domain.and([this.section.domain,this._domain]);}
get context(){const context={};const getValue=(fieldName,value)=>this.model.fieldsInfo[fieldName].type==="many2one"?value&&value[0]:value;for(const[key,value]of Object.entries(this.valuePerFieldName)){context[`default_${key}`]=getValue(key,value);}
return context;}
getSection(){return!this.section.isFake&&this.section;}
_generateCells(data){for(const column of Object.values(data.columns)){this.cells[column.id]=new this.model.constructor.Cell(this.model,this,column,0);}}
_ensureColumnExist(column,data){if(!(column.id in data.columns)){throw new Error("Unbound index: the columnId is not in the row columns");}
return true;}
updateCell(column,value,data){this._ensureColumnExist(column,data);const cell=this.cells[column.id];const oldValue=cell.value;cell.value=value;const delta=value-oldValue;this.section.updateGrandTotal(column,delta);this.grandTotal+=delta;this.grandTotalWeekendHidden+=column.isWeekDay?delta:0;column.grandTotal+=delta;if(this.isAdditionalRow&&delta>0){this.isAdditionalRow=false;}}
setReadonlyCell(column,readonly,data){this._ensureColumnExist(column,data);if(readonly instanceof Array){readonly=readonly.length>0;}else if(!(readonly instanceof Boolean)){readonly=Boolean(readonly);}
this.cells[column.id]._readonly=readonly;}
getGrandTotal(showWeekend){return showWeekend?this.grandTotal:this.grandTotalWeekendHidden;}}
const GridSection=__exports.GridSection=class GridSection extends GridRow{constructor(){super(...arguments);this.sectionId=this.model.sectionId++;this.rows={};this.isSection=true;this.lastRow=null;}
get value(){return this.valuePerFieldName&&this.valuePerFieldName[this.model.sectionField.name];}
get domain(){let value=this.value;if(this.model.fieldsInfo[this.model.sectionField.name].type==="many2one"){value=value&&value[0];}
return new Domain([[this.model.sectionField.name,"=",value]]);}
get title(){let title=this.value;if(this.model.sectionField&&this.model.fieldsInfo[this.model.sectionField.name].type==="many2one"){title=(title&&title[1])||"None";}
return title;}
get initialRecordValues(){return{[this.model.sectionField.name]:this.value};}
get isFake(){return this.value==null;}
get context(){const context={};const getValue=(fieldName,value)=>this.model.fieldsInfo[fieldName].type==="many2one"?value&&value[0]:value;if(!this.isFake){const sectionFieldName=this.model.sectionField.name;context[`default_${sectionFieldName}`]=getValue(sectionFieldName,this.value);}
return context;}
getSection(){return!this.isFake&&this;}
addRow(row){if(row.id in this.rows){throw new Error("Row already added in section");}
this.rows[row.id]=row;this.lastRow=row;}
updateGrandTotal(column,delta){this.cells[column.id].value+=delta;this.grandTotal+=delta;this.grandTotalWeekendHidden+=column.isWeekDay?delta:0;}}
const GridColumn=__exports.GridColumn=class GridColumn{constructor(model,title,value,readonly=false){this.model=model;this.title=title;this.value=value;this.cells=[];this.id=model.columnId++;this.grandTotal=0;this.readonly=readonly;}
addCell(cell){if(cell.id in this.cells){throw new Error("Cell already added in column");}
this.cells.push(cell);this.grandTotal+=cell.value;}
get domain(){return new Domain([[this.model.columnFieldName,"=",this.value]]);}
get context(){return{[`default_${this.model.columnFieldName}`]:this.value};}}
const DateGridColumn=__exports.DateGridColumn=class DateGridColumn extends GridColumn{constructor(model,title,dateStart,dateEnd,isToday,isWeekDay,readonly=false){super(model,title,dateStart,readonly);this.dateEnd=dateEnd;this.isToday=isToday;this.isWeekDay=isWeekDay;}
get domain(){return new Domain(["&",[this.model.columnFieldName,">=",this.value],[this.model.columnFieldName,"<",this.dateEnd],]);}}
const GridNavigationInfo=__exports.GridNavigationInfo=class GridNavigationInfo{constructor(anchor,model){this.anchor=anchor;this.model=model;}
get _targetWeekday(){const firstDayOfWeek=localization.weekStart;return this.anchor.weekday<firstDayOfWeek?firstDayOfWeek-7:firstDayOfWeek;}
get periodStart(){if(this.range.span!=="week"){return this.anchor.startOf(this.range.span);}
return this.anchor.set({weekday:this._targetWeekday}).startOf("day");}
get periodEnd(){if(this.range.span!=="week"){return this.anchor.endOf(this.range.span);}
return this.anchor.set({weekday:this._targetWeekday}).plus({weeks:1,days:-1}).endOf("day");}
get interval(){return Interval.fromDateTimes(this.periodStart,this.periodEnd);}
contains(date){return this.interval.contains(date.startOf("day"));}}
const GridModel=__exports.GridModel=class GridModel extends Model{static Cell=GridCell;static Column=GridColumn;static DateColumn=DateGridColumn;static Row=GridRow;static Section=GridSection;static NavigationInfo=GridNavigationInfo;setup(params){this.notificationService=useService("notification");this.actionService=useService("action");this.keepLast=new KeepLast();this.mutex=new Mutex();this.defaultSectionField=params.sectionField;this.defaultRowFields=params.rowFields;this.sectionField=undefined;this.rowFields=[];this.searchParams={};this.resModel=params.resModel;this.fieldsInfo=params.fieldsInfo;this.columnFieldName=params.columnFieldName;this.columnFieldIsDate=this.fieldsInfo[params.columnFieldName].type==="date";this.measureField=params.measureField;this.readonlyField=params.readonlyField;this.ranges=params.ranges;this.defaultAnchor=params.defaultAnchor||this.today;this.navigationInfo=new this.constructor.NavigationInfo(this.defaultAnchor,this);this.data=undefined;this.record=undefined;const activeRangeName=browser.localStorage.getItem(this.storageKey)||params.activeRangeName;if(Object.keys(this.ranges).length&&activeRangeName){this.navigationInfo.range=this.ranges[activeRangeName];}
this._resetGridComponentsId();}
get aggregates(){const aggregates=[this.measureGroupByFieldName,"id:array_agg"];if(this.readonlyField){aggregates.push(`${this.readonlyField.name}:${this.readonlyField.aggregator}`);}
return aggregates;}
get today(){return DateTime.local().startOf("day");}
get sectionsArray(){return Object.values(this.data.sections);}
get rowsArray(){return Object.values(this.data.rows);}
get columnsArray(){return Object.values(this.data.columns);}
get itemsArray(){return this.data.items;}
get maxColumnsTotal(){return Math.max(...this.columnsArray.map((c)=>c.grandTotal));}
get measureFieldName(){return this.measureField.name;}
get measureGroupByFieldName(){if(this.measureField.aggregator){return`${this.measureFieldName}:${this.measureField.aggregator}`;}
return this.measureFieldName;}
get storageKey(){return`scaleOf-viewId-${this.env.config.viewId}`;}
get columnGroupByFieldName(){let columnGroupByFieldName=this.columnFieldName;if(this.columnFieldIsDate){columnGroupByFieldName+=`:${this.navigationInfo.range.step}`;}
return columnGroupByFieldName;}
isToday(date){return date.startOf("day").equals(this.today.startOf("day"));}
_getGroupByFields({rowFields,sectionField}=this.metaData){const fields=[this.columnGroupByFieldName,...rowFields.map((r)=>r.name)];if(sectionField){fields.push(sectionField.name);}
return fields;}
_getDateColumnTitle(date){const granularity=this.navigationInfo.range.step;if(!["day","month"].includes(granularity)){return serializeDate(date);}
const locale=pyToJsLocale(this.navigationInfo.anchor.locale);const options={day:{weekday:"short",month:"short",day:"numeric"},month:{month:"long",year:"numeric"},}[granularity];const parts=new Intl.DateTimeFormat(locale,options).formatToParts(date);const splitAfter=granularity==="day"?"weekday":"month";let splitIndex=parts.findIndex((p)=>p.type===splitAfter);if(splitIndex===-1){return parts.map((p)=>p.value).join("");}
while(++splitIndex<parts.length){if(parts[splitIndex].type==="literal"){break;}}
const firstLineParts=parts.slice(0,splitIndex+1);const secondLineParts=parts.slice(splitIndex+1);const firstLine=firstLineParts.map((p)=>p.value).join("").trim();const secondLine=secondLineParts.map((p)=>p.value).join("").trim();return`${firstLine}\n${secondLine}`;}
hasData(){return this.sectionsArray.length;}
async setRange(rangeName){this.navigationInfo.range=this.ranges[rangeName];browser.localStorage.setItem(this.storageKey,rangeName);await this.reload();}
async setAnchor(anchor){this.navigationInfo.anchor=anchor;await this.reload();}
async setTodayAnchor(){await this.setAnchor(this.today);}
generateNavigationDomain(){if(this.columnFieldIsDate){const{periodStart,periodEnd}=this.navigationInfo;return new Domain(["&",[this.columnFieldName,">=",serializeDate(periodStart)],[this.columnFieldName,"<=",serializeDate(periodEnd)],]);}else{return Domain.TRUE;}}
async resetAnchor(){await this.setAnchor(this.defaultAnchor);}
async moveAnchor(direction){if(direction=="forward"){this.navigationInfo.anchor=this.navigationInfo.anchor.plus({[this.navigationInfo.range.span]:1,});}else if(direction=="backward"){this.navigationInfo.anchor=this.navigationInfo.anchor.minus({[this.navigationInfo.range.span]:1,});}else{throw Error("Invalid argument");}
if(this.navigationInfo.contains(this.today)&&this.navigationInfo.anchor.startOf("day").equals(this.today.startOf("day"))){this.navigationInfo.anchor=this.today;}
await this.reload();}
async loadData(metaData){this._resetGridComponentsId();Object.assign(metaData,await this._getInitialData(metaData));const{data,sectionField}=metaData;const mergeAdditionalData=(fetchedData)=>{const additionalData={};for(const fetchedDatum of fetchedData){for(const[sectionKey,sectionInfo]of Object.entries(fetchedDatum)){if(!(sectionKey in additionalData)){additionalData[sectionKey]=sectionInfo;}else{for(const[rowKey,rowInfo]of Object.entries(sectionInfo.rows)){if(!(rowKey in additionalData[sectionKey].rows)){additionalData[sectionKey].rows[rowKey]=rowInfo;}}}}}
return additionalData;};const appendAdditionData=(additionalData)=>{for(const[sectionKey,sectionInfo]of Object.entries(additionalData)){if(!(sectionKey in data.sectionsKeyToIdMapping)){if(sectionField){const newSection=new this.constructor.Section(data,null,{[sectionField.name]:sectionInfo.value},this,null);data.sections[newSection.id]=newSection;data.sectionsKeyToIdMapping[sectionKey]=newSection.id;data.rows[newSection.id]=newSection;data.rowsKeyToIdMapping[sectionKey]=newSection.id;}else{this._generateFakeSection(data);}}
const section=data.sections[data.sectionsKeyToIdMapping[sectionKey]];for(const[rowKey,rowInfo]of Object.entries(sectionInfo.rows)){if(!(rowKey in data.rowsKeyToIdMapping)){const newRow=new this.constructor.Row(data,rowInfo.domain,rowInfo.values,this,section,true);data.rows[newRow.id]=newRow;data.rowsKeyToIdMapping[rowKey]=newRow.id;for(const column of Object.values(data.columns)){newRow.updateCell(column,0,data);}}}}};const[dataFetched,additionalDataFetched]=await Promise.all([this.fetchData(metaData),Promise.all(this._fetchAdditionalData(metaData)),]);this._generateData(dataFetched,metaData);appendAdditionData(mergeAdditionalData(additionalDataFetched));if(!this.orm.isSample){const[,postFetchAdditionalData]=await Promise.all([Promise.all(this._getAdditionalPromises(metaData)),Promise.all(this._postFetchAdditionalData(metaData)),]);appendAdditionData(mergeAdditionalData(postFetchAdditionalData));}
const{items}=data;for(const section of Object.values(data.sections)){items.push(section);this._itemsPostProcess(section,metaData);for(const rowId in section.rows){const row=section.rows[rowId];this._itemsPostProcess(row,metaData);items.push(row);}}}
async load(params={}){const searchParams={...this.searchParams,...params,};const groupBys=[];let notificationDisplayed=false;for(const groupBy of searchParams.groupBy){if(groupBy.startsWith(this.columnFieldName)){if(!notificationDisplayed){this.notificationService.add(_t("Grouping by the field used in the column of the grid view is not possible."),{type:"warning"});notificationDisplayed=true;}}else{groupBys.push(groupBy);}}
if(searchParams.length!==groupBys.length){searchParams.groupBy=groupBys;}
let rowFields=[];let sectionField;if(searchParams.groupBy.length){if(this.defaultSectionField&&searchParams.groupBy.length>1&&searchParams.groupBy[0]===this.defaultSectionField.name){sectionField=this.defaultSectionField;}
const rowFieldPerFieldName=Object.fromEntries(this.defaultRowFields.map((r)=>[r.name,r]));for(const groupBy of searchParams.groupBy){if(sectionField&&groupBy===sectionField.name){continue;}
if(groupBy in rowFieldPerFieldName){rowFields.push({...rowFieldPerFieldName[groupBy],invisible:"False",});}else{rowFields.push({name:groupBy});}}}else{if(this.defaultSectionField&&this.defaultSectionField.invisible!=="True"&&this.defaultSectionField.invisible!=="1"){sectionField=this.defaultSectionField;}
rowFields=this.defaultRowFields.filter((r)=>r.invisible!=="True"&&r.invisible!=="1");}
const metaData={searchParams,rowFields,sectionField,};await this.keepLast.add(this.loadData(metaData));Object.assign(this,{...metaData,});}
async reload(params={}){await this.load(params);this.useSampleModel=false;this.notify();}
_generateDateColumns({data}){const generateNext=(dateStart)=>dateStart.plus({[`${this.navigationInfo.range.step}s`]:1});for(let currentDate=this.navigationInfo.periodStart;currentDate<this.navigationInfo.periodEnd;currentDate=generateNext(currentDate)){const domainStart=currentDate;const domainStop=generateNext(currentDate);const domainStartSerialized=serializeDate(domainStart);const isWeekDay=currentDate.weekday<6;const column=new this.constructor.DateColumn(this,this._getDateColumnTitle(currentDate),domainStartSerialized,serializeDate(domainStop),currentDate.startOf("day").equals(this.today.startOf("day")),isWeekDay);data.columns[column.id]=column;data.columnsKeyToIdMapping[domainStartSerialized]=column.id;}}
async _searchMany2oneColumns(domain,readonlyField){const fieldsToFetch=["id","display_name"];if(readonlyField){fieldsToFetch.push(readonlyField);}
const columnField=this.fieldsInfo[this.columnFieldName];const columnRecords=await this.orm.searchRead(columnField.relation,domain||[],fieldsToFetch);return columnRecords.map((read)=>Object.values(read));}
async _getInitialData(metaData){const initialData={data:{columnsKeyToIdMapping:{},columns:{},rows:{},rowsKeyToIdMapping:{},fieldsInfo:this.fieldsInfo,sections:{},sectionsKeyToIdMapping:{},items:[],},record:{context:{},resModel:this.resModel,resIds:[],},};let columnRecords=[];const columnField=this.fieldsInfo[this.columnFieldName];if(this.columnFieldIsDate){this._generateDateColumns(initialData);}else{if(columnField.type==="selection"){const selectionFieldValues=await this.orm.call("ir.model.fields","get_field_selection",[this.resModel,this.columnFieldName]);columnRecords=selectionFieldValues;}else if(columnField.type==="many2one"){columnRecords=await this._searchMany2oneColumns();}else{throw new Error("Unmanaged column type. Supported types are date, selection and many2one.");}
for(const record of columnRecords){let readonly=false;let key,value;if(record.length===2){[key,value]=record;}else{[key,value,readonly]=record;}
const column=new this.constructor.Column(this,value,key,Boolean(readonly));initialData.data.columns[column.id]=column;initialData.data.columnsKeyToIdMapping[key]=column.id;}}
return initialData;}
async fetchData(metaData){const{searchParams}=metaData;let dataFetched=await this.orm.formattedReadGroup(this.resModel,Domain.and([searchParams.domain,this.generateNavigationDomain()]).toList({}),this._getGroupByFields(metaData),this.aggregates,);if(this.orm.isSample){dataFetched=dataFetched.filter((group)=>{const date=DateTime.fromISO(group[this.columnGroupByFieldName][0]);const{periodStart,periodEnd}=this.navigationInfo;return date>=periodStart&&date<=periodEnd;});}
return dataFetched;}
_fetchAdditionalData(metaData){return[];}
_postFetchAdditionalData(metaData){return[];}
_getAdditionalPromises(metaData){return[this._fetchUnavailabilityDays(metaData)];}
async _fetchUnavailabilityDays(metaData,args={}){if(!this.columnFieldIsDate){return{};}
const result=await this.orm.call(this.resModel,"grid_unavailability",[serializeDate(this.navigationInfo.periodStart),serializeDate(this.navigationInfo.periodEnd),],{...args,});this._processUnavailabilityDays(result);}
_processUnavailabilityDays(result){return;}
_generateRowKey(readGroupResult,{sectionField,rowFields}){let key="";const sectionKey=(sectionField&&this._generateSectionKey(readGroupResult,sectionField))||false;for(const rowField of rowFields){let value=rowField.name in readGroupResult&&readGroupResult[rowField.name];if(this.fieldsInfo[rowField.name].type==="many2one"){value=value&&value[0];}
key+=`${value}\\|/`;}
return`${sectionKey}@|@${key}`;}
_generateSectionKey(readGroupResult,sectionField){let value=readGroupResult[sectionField.name];if(this.fieldsInfo[sectionField.name].type==="many2one"){value=value&&value[0];}
return`/|\\${value.toString()}`;}
_generateRowDomainAndValues(readGroupResult,rowFields){let domain=new Domain();const values={};for(const rowField of rowFields){const result=rowField.name in readGroupResult&&readGroupResult[rowField.name];let value=result;if(this.fieldsInfo[rowField.name].type==="many2one"){value=value&&value[0];}
values[rowField.name]=result;domain=Domain.and([domain,[[rowField.name,"=",value]]]);}
return{domain,values};}
_generateFakeSection(data){const section=new this.constructor.Section(data,null,null,this,null);data.sections[section.id]=section;data.sectionsKeyToIdMapping["false"]=section.id;data.rows[section.id]=section;data.rowsKeyToIdMapping["false"]=section.id;return section;}
async _generateData(readGroupResults,metaData){const{data,record,sectionField,rowFields}=metaData;let section;for(const readGroupResult of readGroupResults){if(!this.orm.isSample){record.resIds.push(...readGroupResult['id:array_agg']);}
const rowKey=this._generateRowKey(readGroupResult,metaData);if(sectionField){const sectionKey=this._generateSectionKey(readGroupResult,sectionField);if(!(sectionKey in data.sectionsKeyToIdMapping)){const newSection=new this.constructor.Section(data,null,{[sectionField.name]:readGroupResult[sectionField.name]},this,null);data.sections[newSection.id]=newSection;data.sectionsKeyToIdMapping[sectionKey]=newSection.id;data.rows[newSection.id]=newSection;data.rowsKeyToIdMapping[sectionKey]=newSection.id;}
section=data.sections[data.sectionsKeyToIdMapping[sectionKey]];}else if(Object.keys(data.sections).length===0){section=this._generateFakeSection(data);}
let row;if(!(rowKey in data.rowsKeyToIdMapping)){const{domain,values}=this._generateRowDomainAndValues(readGroupResult,rowFields);row=new this.constructor.Row(data,domain,values,this,section);data.rows[row.id]=row;data.rowsKeyToIdMapping[rowKey]=row.id;}else{row=data.rows[data.rowsKeyToIdMapping[rowKey]];}
let columnKey;const columnField=this.fieldsInfo[this.columnFieldName];if(this.columnFieldIsDate||columnField.type==="many2one"){columnKey=readGroupResult[this.columnGroupByFieldName][0];}else if(columnField.type==="selection"){columnKey=readGroupResult[this.columnGroupByFieldName];}else{throw new Error("Unmanaged column type. Supported types are date, selection and many2one.");}
if(data.columnsKeyToIdMapping[columnKey]in data.columns){const column=data.columns[data.columnsKeyToIdMapping[columnKey]];row.updateCell(column,readGroupResult[this.measureGroupByFieldName],data);const readonlyFieldAggregator=this.readonlyField&&`${this.readonlyField.name}:${this.readonlyField.aggregator}`;if(readonlyFieldAggregator&&readonlyFieldAggregator in readGroupResult){row.setReadonlyCell(column,readGroupResult[readonlyFieldAggregator],data);}}}}
_itemsPostProcess(item,metaData){}
_resetGridComponentsId(){this.columnId=0;this.rowId=0;this.sectionId=0;}}
return __exports;});;

/* /web_grid/static/src/views/grid_renderer.js */
odoo.define('@web_grid/views/grid_renderer',['@web/core/l10n/translation','@web/core/domain','@web/core/registry','@web/core/utils/hooks','@web/core/utils/timing','@web/core/virtual_grid_hook','@web/views/fields/field','@web/core/hotkeys/hotkey_service','@web/views/view_components/view_scale_selector','@web_grid/components/grid_component/grid_component','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_grid",...args);const{Domain}=require("@web/core/domain");const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{useDebounced}=require("@web/core/utils/timing");const{useVirtualGrid}=require("@web/core/virtual_grid_hook");const{Field}=require("@web/views/fields/field");const{getActiveHotkey}=require("@web/core/hotkeys/hotkey_service");const{ViewScaleSelector}=require("@web/views/view_components/view_scale_selector");const{GridComponent}=require("@web_grid/components/grid_component/grid_component");const{Component,markup,useState,onWillUpdateProps,onMounted,onPatched,reactive,useRef,useExternalListener,}=require("@odoo/owl");const GridRenderer=__exports.GridRenderer=class GridRenderer extends Component{static components={Field,GridComponent,ViewScaleSelector,};static template="web_grid.Renderer";static props={sections:{type:Array,optional:true},columns:{type:Array,optional:true},rows:{type:Array,optional:true},model:{type:Object,optional:true},options:Object,sectionField:{type:Object,optional:true},rowFields:Array,measureField:Object,isEditable:Boolean,widgetPerFieldName:Object,openAction:{type:Object,optional:true},contentRef:Object,createInline:Boolean,createRecord:Function,ranges:{type:Object,optional:true},state:Object,toggleWeekendVisibility:Function,};static defaultProps={sections:[],columns:[],rows:[],model:{},ranges:{},};setup(){this.rendererRef=useRef("renderer");this.actionService=useService("action");this.editionState=useState({hoveredCellInfo:false,editedCellInfo:false,});this.hoveredElement=null;const measureFieldName=this.props.model.measureFieldName;const fieldInfo=this.props.model.fieldsInfo[measureFieldName];const measureFieldWidget=this.props.widgetPerFieldName[measureFieldName];const widgetName=measureFieldWidget||fieldInfo.type;this.gridCell=registry.category("grid_components").get(widgetName);this.hoveredCellProps={name:measureFieldName,type:widgetName,component:this.gridCell.component,reactive:reactive({cell:null}),fieldInfo,readonly:!this.props.isEditable,openRecords:this.openRecords.bind(this),editMode:false,onEdit:this.onEditCell.bind(this),getCell:this.getCell.bind(this),isMeasure:true,};this.editCellProps={name:measureFieldName,type:widgetName,component:this.gridCell.component,reactive:reactive({cell:null}),fieldInfo,readonly:!this.props.isEditable,openRecords:this.openRecords.bind(this),editMode:true,onEdit:this.onEditCell.bind(this),getCell:this.getCell.bind(this),onKeyDown:this.onCellKeydown.bind(this),isMeasure:true,};this.isEditing=false;onWillUpdateProps(this.onWillUpdateProps);onMounted(this._focusOnToday);onPatched(this._focusOnToday);this.shouldFocusOnToday=true;this.onMouseOver=useDebounced(this._onMouseOver,10);this.onMouseOut=useDebounced(this._onMouseOut,10);this.virtualGrid=useVirtualGrid({scrollableRef:this.props.contentRef,initialScroll:{top:60},});useExternalListener(window,"click",this.onClick);useExternalListener(window,"keydown",this.onKeyDown);}
getCell(rowId,columnId){return this.props.model.data.rows[rowId]?.cells[columnId];}
getItemHeight(item){let height=this.rowHeight;if(item.isSection&&item.isFake){return 0;}
if(this.props.createInline&&!item.isSection&&item.section.lastRow.id===item.id){height*=2;}
return height;}
get isMobile(){return this.env.isSmall;}
get rowHeight(){const baseHeight=this.isMobile?48:32;const extraHeight=this.isMobile?Math.max(0,this.props.model.rowFields.length-2)*20:0;return baseHeight+extraHeight;}
get virtualRows(){this.virtualGrid.setRowsHeights(this.props.rows.map((row)=>this.getItemHeight(row)));const[start,end]=this.virtualGrid.rowsIndexes;return this.props.rows.slice(start,end+1);}
getRowPosition(row,isCreateInlineRow=false){const rowIndex=row?this.props.rows.findIndex((r)=>r.id===row.id):0;const section=row&&row.getSection();const sectionDisplayed=Boolean(section&&(section.value||this.props.sections.length>1));let rowPosition=this.rowsGap+rowIndex+1+(sectionDisplayed?section.sectionId:0);if(isCreateInlineRow){rowPosition+=1;}
if(!sectionDisplayed){rowPosition-=1;}
return rowPosition;}
getTotalRowPosition(){let sectionIndex=0;if(this.props.model.sectionField&&this.props.sections.length){if(this.props.sections.length>1||this.props.sections[0].value){sectionIndex=this.props.sections.length;}}
return((this.props.rows.length||1)+
sectionIndex+
(this.props.createInline?1:0)+
this.rowsGap);}
onWillUpdateProps(nextProps){}
formatValue(value){return this.gridCell.formatter(value);}
getDefaultState(data){return{};}
get rowsCount(){const addLineRows=this.props.createInline?this.props.sections.length||1:0;return this.props.rows.length-(this.props.model.sectionField?0:1)+addLineRows;}
get gridTemplateRows(){let totalRows=0;if(!this.props.options.hideColumnTotal){totalRows+=1;if(this.props.options.hasBarChartTotal){totalRows+=1;}}
return`auto repeat(${this.rowsCount + totalRows}, ${this.rowHeight}px)`;}
get gridTemplateColumns(){return`auto repeat(${this.props.columns.length}, ${
            this.props.columns.length > 7 ? "minmax(8ch, auto)" : "minmax(10ch, 1fr)"
        }) minmax(10ch, 10em)`;}
get measureLabel(){const measureFieldName=this.props.model.measureFieldName;if(measureFieldName==="__count"){return _t("Total");}
return(this.props.measureField.string||this.props.model.fieldsInfo[measureFieldName].string);}
get rowsGap(){return 1;}
get columnsGap(){return 1;}
get displayAddLine(){return this.props.createInline&&this.row.id===this.row.section.lastRow.id;}
getCellColorClass(column,section){return"text-900";}
getSectionColumnsClasses(column,row){const isToday=column.isToday;return{"bg-info bg-opacity-50":isToday,"bg-200 border-top":!isToday,"bg-opacity-75":this.getUnavailableClass(column)==="o_grid_unavailable"&&row.cells[column.id].value===0,};}
getSectionCellsClasses(column,row){return{"text-opacity-25":row.cells[column.id].value===0||this.getUnavailableClass(column)==="o_grid_unavailable",};}
isTextDanger(){return false;}
getTextColorClasses(column,row,isEven){const value=row.cells[column.id].value;const isTextDanger=this.isTextDanger(row,column);return{"text-bg-view":isEven&&value>=0&&!isTextDanger,"text-900":!isEven&&value>=0&&!isTextDanger,"text-danger":value<0||isTextDanger,};}
getCellsClasses(column,row,section,isEven){return{...this.getTextColorClasses(column,row,isEven),o_grid_cell_today:column.isToday,"fst-italic":row.isAdditionalRow,};}
_getTotalCellBgColor(section){return"text-bg-800";}
getSectionTotalRowClass(section,grandTotal){return{[this._getTotalCellBgColor(section)]:true,"text-opacity-25":grandTotal===0,};}
getColumnBarChartHeightStyle(column){let heightPercentage=0;if(this.props.model.maxColumnsTotal!==0){heightPercentage=(column.grandTotal/this.props.model.maxColumnsTotal)*100;}
return`height: ${heightPercentage}%; bottom: 0;`;}
getFooterTotalCellClasses(grandTotal){if(grandTotal<0){return"bg-danger text-bg-danger";}
return"bg-400";}
getUnavailableClass(column,section=undefined){return"";}
getFieldAdditionalProps(fieldName){return{name:fieldName,type:this.props.widgetPerFieldName[fieldName]||this.props.model.fieldsInfo[fieldName].type,};}
getCellsTextClasses(column,row){return{"text-900 text-opacity-25":row.cells[column.id].value===0,};}
getTotalCellsTextClasses(row,grandTotal){return{"fst-italic":row.isAdditionalRow,"text-bg-200":grandTotal>=0,"bg-danger text-bg-danger":grandTotal<0,"text-opacity-50":grandTotal===0,};}
onCreateInlineClick(section){const context={...(section?.context||{}),};const title=_t("Add a Line");this.props.createRecord({context,title});}
_focusOnToday(){if(!this.shouldFocusOnToday){return;}
this.shouldFocusOnToday=false;const{navigationInfo,columnFieldIsDate}=this.props.model;if(this.isMobile||!columnFieldIsDate||navigationInfo.range.name!="month"){return;}
const rendererEl=this.rendererRef.el;const todayEl=rendererEl.querySelector("div.o_grid_column_title.fw-bolder");if(todayEl){rendererEl.parentElement.scrollLeft=todayEl.offsetLeft-rendererEl.offsetWidth/2+todayEl.offsetWidth/2;}}
_onMouseOver(ev){if(this.hoveredElement||ev.fromElement?.classList.contains("dropdown-item")){return;}
const highlightableElement=ev.target.closest(".o_grid_highlightable");if(!highlightableElement){return;}
const{column,gridRow,gridColumn,row}=highlightableElement.dataset;const isCellInColumnTotalHighlighted=highlightableElement.classList.contains("o_grid_row_total");const elementsToHighlight=this.rendererRef.el.querySelectorAll(`.o_grid_highlightable[data-grid-row="${gridRow}"]:not(.o_grid_add_line):not(.o_grid_column_title), .o_grid_highlightable[data-grid-column="${gridColumn}"]:not(.o_grid_row_timer):not(.o_grid_section_title):not(.o_grid_row_title${
                isCellInColumnTotalHighlighted ? ",.o_grid_row_total" : ""
            })`);for(const node of elementsToHighlight){if(node.classList.contains("o_grid_bar_chart_container")){node.classList.add("o_grid_highlighted");}
if(node.dataset.gridRow===gridRow){node.classList.add("o_grid_highlighted");if(node.dataset.gridColumn===gridColumn){node.classList.add("o_grid_cell_highlighted");}else{node.classList.add("o_grid_row_highlighted");}}}
this.hoveredElement=highlightableElement;const cell=this.editCellProps.reactive.cell;if(row&&column&&!(cell&&cell.dataset.row===row&&cell.dataset.column===column)){this.hoveredCellProps.reactive.cell=highlightableElement;}}
_onMouseOut(ev){if(!this.hoveredElement){return;}
let relatedTarget=ev.relatedTarget;const gridCell=relatedTarget?.closest(".o_grid_cell");if(gridCell&&gridCell.dataset.gridRow===this.hoveredElement.dataset.gridRow&&gridCell.dataset.gridColumn===this.hoveredElement.dataset.gridColumn&&gridCell!==this.editCellProps.reactive.cell){return;}
while(relatedTarget){if(relatedTarget===this.hoveredElement){return;}
relatedTarget=relatedTarget.parentElement;}
const{gridRow,gridColumn}=this.hoveredElement.dataset;const elementsHighlighted=this.rendererRef.el.querySelectorAll(`.o_grid_highlightable[data-grid-row="${gridRow}"], .o_grid_highlightable[data-grid-column="${gridColumn}"]`);for(const node of elementsHighlighted){node.classList.remove("o_grid_highlighted","o_grid_row_highlighted","o_grid_cell_highlighted");}
this.hoveredElement=null;if(this.hoveredCellProps.reactive.cell){this.hoveredCellProps.reactive.cell.querySelector(".o_grid_cell_readonly").classList.remove("d-none");this.hoveredCellProps.reactive.cell=null;}}
onEditCell(value){if(this.editCellProps.reactive.cell){this.editCellProps.reactive.cell.querySelector(".o_grid_cell_readonly").classList.remove("d-none");}
if(value){this.editCellProps.reactive.cell=this.hoveredCellProps.reactive.cell;this.hoveredCellProps.reactive.cell=null;}else{this.editCellProps.reactive.cell=null;}}
_onKeyDown(ev){const hotkey=getActiveHotkey(ev);if(hotkey==="escape"&&this.editCellProps.reactive.cell){this.onEditCell(false);}}
onClick(ev){if(!this.editCellProps.reactive.cell||ev.target.closest(".o_grid_highlighted")||ev.target.closest(".o_grid_cell")){return;}
this.onEditCell(false);}
onKeyDown(ev){this._onKeyDown(ev);}
onCellClick(ev){ev.stopPropagation();const cell=ev.target.closest(".o_grid_highlightable");const{row,column}=cell.dataset;if(row&&column){if(this.editCellProps.reactive.cell){this.editCellProps.reactive.cell.querySelector(".o_grid_cell_readonly").classList.remove("d-none");}
this.editCellProps.reactive.cell=cell;}}
onCellKeydown(ev,cell){const hotkey=getActiveHotkey(ev);if(!this.rendererRef.el||!cell||!["tab","shift+tab","enter"].includes(hotkey)){this._onKeyDown(ev);return;}
ev.preventDefault();ev.stopImmediatePropagation();let rowId=cell.row.id;let columnId=cell.column.id;const columnIds=this.props.columns.map((c)=>c.id);const rowIds=[];for(const item of this.props.rows){if(!item.isSection){rowIds.push(item.id);}}
let columnIndex=columnIds.indexOf(columnId);let rowIndex=rowIds.indexOf(rowId);if(hotkey==="tab"){columnIndex+=1;rowIndex+=1;if(columnIndex<columnIds.length){columnId=columnIds[columnIndex];}else{columnId=columnIds[0];if(rowIndex<rowIds.length){rowId=rowIds[rowIndex];}else{rowId=rowIds[0];}}}else if(hotkey==="shift+tab"){columnIndex-=1;rowIndex-=1;if(columnIndex>=0){columnId=columnIds[columnIndex];}else{columnId=columnIds[columnIds.length-1];if(rowIndex>=0){rowId=rowIds[rowIndex];}else{rowId=rowIds[rowIds.length-1];}}}else if(hotkey==="enter"){rowIndex+=1;if(rowIndex>=rowIds.length){columnIndex=(columnIndex+1)%columnIds.length;columnId=columnIds[columnIndex];}
rowIndex=rowIndex%rowIds.length;rowId=rowIds[rowIndex];}
this.onEditCell(false);this.hoveredCellProps.reactive.cell=this.rendererRef.el.querySelector(`.o_grid_highlightable[data-row="${rowId}"][data-column="${columnId}"]`);this.onEditCell(true);}
async openRecords(actionTitle,domain,context){const resModel=this.props.model.resModel;if(this.props.openAction){const resIds=await this.props.model.orm.search(resModel,domain);this.actionService.doActionButton({...this.props.openAction,resModel,resIds,context,});}else{const{views=[]}=this.env.config;const openRecordsViews=["list","form"].map((viewType)=>{const view=views.find((view)=>view[1]===viewType);return[view?view[0]:false,viewType];});this.actionService.doAction({type:"ir.actions.act_window",name:actionTitle,res_model:resModel,views:openRecordsViews,domain,context,help:this._getNoContentHelper(),});}}
_getNoContentHelper(){const noActivitiesFound=_t("No activities found");return markup`<p class='o_view_nocontent_smiling_face'>${noActivitiesFound}</p>`;}
onMagnifierGlassClick(section,column){const title=`${section.title} (${column.title})`;const domain=Domain.and([section.domain,column.domain]).toList();this.openRecords(title,domain,section.context);}
get rangesArray(){return Object.values(this.props.ranges);}
async onRangeClick(name){await this.props.model.setRange(name);this.props.state.activeRangeName=name;this.shouldFocusOnToday=true;}
async onTodayButtonClick(){await this.props.model.setTodayAnchor();this.shouldFocusOnToday=true;}
async onPreviousButtonClick(){await this.props.model.moveAnchor("backward");this.shouldFocusOnToday=true;}
async onNextButtonClick(){await this.props.model.moveAnchor("forward");this.shouldFocusOnToday=true;}}
return __exports;});;

/* /web_grid/static/src/views/grid_view.js */
odoo.define('@web_grid/views/grid_view',['@web/core/registry','@web_grid/views/grid_arch_parser','@web_grid/views/grid_controller','@web_grid/views/grid_model','@web_grid/views/grid_renderer'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{GridArchParser}=require("@web_grid/views/grid_arch_parser");const{GridController}=require("@web_grid/views/grid_controller");const{GridModel}=require("@web_grid/views/grid_model");const{GridRenderer}=require("@web_grid/views/grid_renderer");const gridView=__exports.gridView={type:"grid",ArchParser:GridArchParser,Controller:GridController,Model:GridModel,Renderer:GridRenderer,buttonTemplate:"web_grid.Buttons",props:(genericProps,view)=>{const{ArchParser,Model,Renderer,buttonTemplate:viewButtonTemplate}=view;const{arch,relatedModels,resModel,buttonTemplate}=genericProps;return{...genericProps,archInfo:new ArchParser().parse(arch,relatedModels,resModel),buttonTemplate:buttonTemplate||viewButtonTemplate,Model,Renderer,};}};registry.category('views').add('grid',gridView);return __exports;});;

/* /analytic_enterprise/static/src/analytic_line_grid/analytic_line_grid_model.js */
odoo.define('@analytic_enterprise/analytic_line_grid/analytic_line_grid_model',['@web/core/l10n/dates','@web_grid/views/grid_model'],function(require){'use strict';let __exports={};const{serializeDate,deserializeDate}=require("@web/core/l10n/dates");const{GridNavigationInfo,GridModel}=require("@web_grid/views/grid_model");const AnalyticLineGridNavigationInfo=__exports.AnalyticLineGridNavigationInfo=class AnalyticLineGridNavigationInfo extends GridNavigationInfo{get periodStart(){if(this.range.span!=="year"||!this._periodStart){return super.periodStart;}
return this._periodStart;}
get periodEnd(){if(this.range.span!=="year"||!this._periodEnd){return super.periodEnd;}
return this._periodEnd;}
async fetchPeriod(){const{date_from,date_to}=await this.model.orm.call(this.model.resModel,"grid_compute_year_range",[serializeDate(this.anchor)]);this._periodStart=deserializeDate(date_from);this._periodEnd=deserializeDate(date_to);}}
const AnalyticLineGridModel=__exports.AnalyticLineGridModel=class AnalyticLineGridModel extends GridModel{static NavigationInfo=AnalyticLineGridNavigationInfo;async loadData(metaData){if(this.navigationInfo.range.span==="year"){await this.navigationInfo.fetchPeriod();}
return await super.loadData(metaData);}}
return __exports;});;

/* /analytic_enterprise/static/src/analytic_line_grid/analytic_line_grid_view.js */
odoo.define('@analytic_enterprise/analytic_line_grid/analytic_line_grid_view',['@web/core/registry','@web_grid/views/grid_view','@analytic_enterprise/analytic_line_grid/analytic_line_grid_model'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{gridView}=require("@web_grid/views/grid_view");const{AnalyticLineGridModel}=require("@analytic_enterprise/analytic_line_grid/analytic_line_grid_model");const analyticLineGridView=__exports.analyticLineGridView={...gridView,Model:AnalyticLineGridModel,}
registry.category("views").add("analytic_line_grid",analyticLineGridView)
return __exports;});;

/* /spreadsheet_edition/static/src/assets/graph_view/graph_view.js */
odoo.define('@spreadsheet_edition/assets/graph_view/graph_view',['@web/views/graph/graph_renderer','@web/core/user','@web/session','@web/core/utils/patch','@web/core/utils/hooks','@spreadsheet_edition/assets/components/spreadsheet_selector_dialog/spreadsheet_selector_dialog','@web/core/utils/objects'],function(require){'use strict';let __exports={};const{GraphRenderer}=require("@web/views/graph/graph_renderer");const{user}=require("@web/core/user");const{session}=require("@web/session");const{patch}=require("@web/core/utils/patch");const{useService}=require("@web/core/utils/hooks");const{SpreadsheetSelectorDialog}=require("@spreadsheet_edition/assets/components/spreadsheet_selector_dialog/spreadsheet_selector_dialog");const{omit}=require("@web/core/utils/objects");patch(GraphRenderer.prototype,{setup(){super.setup(...arguments);this.notification=useService("notification");this.actionService=useService("action");this.menu=useService("menu");this.canInsertChart=session.can_insert_in_spreadsheet;},async onInsertInSpreadsheet(){const{actionId}=this.env.config;const{xml_id}=actionId?await this.actionService.loadAction(actionId,this.env.searchModel.context):{};const actionOptions={preProcessingAsyncAction:"insertChart",preProcessingAsyncActionData:{metaData:{...this.model.metaData,axisType:this.chart.scales.x?.type,},searchParams:{...this.model.searchParams,domain:this.env.searchModel.domainString,context:omit(this.model.searchParams.context,...Object.keys(user.context),"graph_measure","graph_order"),},actionXmlId:xml_id,},};const params={type:"GRAPH",name:this.model.metaData.title,actionOptions,};this.env.services.dialog.add(SpreadsheetSelectorDialog,params);},});return __exports;});;

/* /spreadsheet_edition/static/src/assets/pivot_view/pivot_view.js */
odoo.define('@spreadsheet_edition/assets/pivot_view/pivot_view',['@web/views/pivot/pivot_renderer','@web/core/user','@web/core/utils/arrays','@web/core/utils/patch','@web/core/utils/hooks','@web/core/utils/objects','@web/core/l10n/translation','@spreadsheet_edition/assets/components/spreadsheet_selector_dialog/spreadsheet_selector_dialog','@web/session'],function(require){'use strict';let __exports={};const{PivotRenderer}=require("@web/views/pivot/pivot_renderer");const{user}=require("@web/core/user");const{intersection,unique}=require("@web/core/utils/arrays");const{patch}=require("@web/core/utils/patch");const{useService}=require("@web/core/utils/hooks");const{omit}=require("@web/core/utils/objects");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"spreadsheet_edition",...args);const{SpreadsheetSelectorDialog}=require("@spreadsheet_edition/assets/components/spreadsheet_selector_dialog/spreadsheet_selector_dialog");const{session}=require("@web/session");const ALL_PERIODS={quarter:_t("Quarter & Year"),month:_t("Month & Year"),week:_t("Week & Year"),day:_t("Day"),year:_t("Year"),quarter_number:_t("Quarter"),month_number:_t("Month"),iso_week_number:_t("Week"),day_of_month:_t("Day of Month"),};patch(PivotRenderer.prototype,{setup(){super.setup(...arguments);this.notification=useService("notification");this.actionService=useService("action");this.canInsertPivot=session.can_insert_in_spreadsheet;},async onInsertInSpreadsheet(){let name=this.model.metaData.title;const groupBy=this.model.metaData.fullColGroupBys[0]||this.model.metaData.fullRowGroupBys[0];if(groupBy){let[field,period]=groupBy.split(":");period=ALL_PERIODS[period];if(period){name=_t("%(pivot_title)s by %(group_by)s (%(granularity)s)",{pivot_title:name,group_by:this.model.metaData.fields[field].string,granularity:period,});}else{name=_t("%(pivot_title)s by %(group_by)s",{pivot_title:name,group_by:this.model.metaData.fields[field].string,});}}
const{actionId}=this.env.config;const{xml_id}=actionId?await this.actionService.loadAction(actionId,this.env.searchModel.context):{};const actionOptions={preProcessingAsyncAction:"insertPivot",preProcessingAsyncActionData:{metaData:this.model.metaData,searchParams:{...this.model.searchParams,domain:this.env.searchModel.domainString,context:omit(this.model.searchParams.context,...Object.keys(user.context),"pivot_measures","pivot_row_groupby","pivot_column_groupby"),},name,actionXmlId:xml_id,},};const params={type:"PIVOT",name,actionOptions,};this.env.services.dialog.add(SpreadsheetSelectorDialog,params);},hasDuplicatedGroupbys(){const fullColGroupBys=this.model.metaData.fullColGroupBys;const fullRowGroupBys=this.model.metaData.fullRowGroupBys;const colGroupBys=fullColGroupBys.map((el)=>el.split(":")[0]);const rowGroupBys=fullRowGroupBys.map((el)=>el.split(":")[0]);return(unique([...fullColGroupBys,...fullRowGroupBys]).length<fullColGroupBys.length+fullRowGroupBys.length||intersection(colGroupBys,rowGroupBys).length);},isInsertButtonDisabled(){return(!this.model.hasData()||this.model.metaData.activeMeasures.length===0||this.model.useSampleModel||this.hasDuplicatedGroupbys());},getInsertButtonTooltip(){return this.hasDuplicatedGroupbys()?_t("Pivot contains duplicate groupbys"):undefined;},});return __exports;});;

/* /documents_spreadsheet/static/src/documents_view/activity/documents_activity_controller.js */
odoo.define('@documents_spreadsheet/documents_view/activity/documents_activity_controller',['@web/core/utils/patch','@documents/views/activity/documents_activity_controller','@documents_spreadsheet/documents_view/documents_spreadsheet_controller_mixin'],function(require){'use strict';let __exports={};const{patch}=require("@web/core/utils/patch");const{DocumentsActivityController}=require("@documents/views/activity/documents_activity_controller");const{DocumentsSpreadsheetControllerMixin}=require("@documents_spreadsheet/documents_view/documents_spreadsheet_controller_mixin");patch(DocumentsActivityController.prototype,DocumentsSpreadsheetControllerMixin());return __exports;});;

/* /documents_spreadsheet/static/src/documents_view/activity/documents_activity_model.js */
odoo.define('@documents_spreadsheet/documents_view/activity/documents_activity_model',['@web/core/utils/patch','@documents/views/activity/documents_activity_model','@documents_spreadsheet/helpers'],function(require){'use strict';let __exports={};const{patch}=require("@web/core/utils/patch");const{DocumentsActivityModel}=require("@documents/views/activity/documents_activity_model");const{XLSX_MIME_TYPE}=require("@documents_spreadsheet/helpers");patch(DocumentsActivityModel.Record.prototype,{isViewable(){return(["spreadsheet","frozen_spreadsheet"].includes(this.data.handler)||this.data.mimetype===XLSX_MIME_TYPE||super.isViewable(...arguments));},});return __exports;});;

/* /project_enterprise/static/src/views/project_task_map/project_task_map_model.js */
odoo.define('@project_enterprise/views/project_task_map/project_task_map_model',['@project/views/project_task_model_mixin','@web_map/map_view/map_model'],function(require){'use strict';let __exports={};const{ProjectTaskModelMixin}=require("@project/views/project_task_model_mixin");const{MapModel}=require("@web_map/map_view/map_model");const ProjectTaskMapModel=__exports.ProjectTaskMapModel=class ProjectTaskMapModel extends ProjectTaskModelMixin(MapModel){async load(params){const domain=params.domain||this.metaData.domain;params.domain=this._processSearchDomain(domain);return super.load(params);}}
return __exports;});;

/* /project_enterprise/static/src/views/project_task_map/project_task_map_renderer.js */
odoo.define('@project_enterprise/views/project_task_map/project_task_map_renderer',['@odoo/owl','@web_map/map_view/map_renderer','@web/core/user'],function(require){'use strict';let __exports={};const{onWillStart}=require("@odoo/owl");const{MapRenderer}=require("@web_map/map_view/map_renderer");const{user}=require("@web/core/user");const ProjectTaskMapRenderer=__exports.ProjectTaskMapRenderer=class ProjectTaskMapRenderer extends MapRenderer{static template="project_enterprise.ProjectTaskMapRenderer";static subTemplates={...MapRenderer.subTemplates,PinListItems:"project_enterprise.ProjectTaskMapRenderer.PinListItems",};setup(){super.setup()
onWillStart(async()=>{this.isProjectManager=await user.hasGroup('project.group_project_manager');});}}
return __exports;});;

/* /project_enterprise/static/src/views/project_task_map/project_task_map_view.js */
odoo.define('@project_enterprise/views/project_task_map/project_task_map_view',['@project/views/project_task_control_panel/project_task_control_panel','@web/core/registry','@web_map/map_view/map_view','@project_enterprise/views/project_task_map/project_task_map_model','@project_enterprise/views/project_task_map/project_task_map_renderer','@project_enterprise/views/highlight_project_task_search_model'],function(require){'use strict';let __exports={};const{ProjectTaskControlPanel}=require("@project/views/project_task_control_panel/project_task_control_panel");const{registry}=require("@web/core/registry");const{mapView}=require("@web_map/map_view/map_view");const{ProjectTaskMapModel}=require("@project_enterprise/views/project_task_map/project_task_map_model");const{ProjectTaskMapRenderer}=require("@project_enterprise/views/project_task_map/project_task_map_renderer");const{HighlightProjectTaskSearchModel}=require("@project_enterprise/views/highlight_project_task_search_model");const projectTaskMapView=__exports.projectTaskMapView={...mapView,ControlPanel:ProjectTaskControlPanel,Model:ProjectTaskMapModel,Renderer:ProjectTaskMapRenderer,SearchModel:HighlightProjectTaskSearchModel,};registry.category("views").add("project_task_map",projectTaskMapView);return __exports;});;

/* /project_enterprise/static/src/views/project_task_graph/project_task_graph_view.js */
odoo.define('@project_enterprise/views/project_task_graph/project_task_graph_view',['@project_enterprise/views/highlight_project_task_search_model','@project/views/project_task_graph/project_task_graph_view'],function(require){'use strict';let __exports={};const{HighlightProjectTaskSearchModel}=require("@project_enterprise/views/highlight_project_task_search_model");const{projectTaskGraphView}=require("@project/views/project_task_graph/project_task_graph_view");projectTaskGraphView.SearchModel=HighlightProjectTaskSearchModel;return __exports;});;

/* /project_enterprise/static/src/views/project_task_pivot/project_task_pivot_view.js */
odoo.define('@project_enterprise/views/project_task_pivot/project_task_pivot_view',['@project/views/project_task_pivot/project_task_pivot_view','@project_enterprise/views/highlight_project_task_search_model'],function(require){'use strict';let __exports={};const{projectTaskPivotView}=require("@project/views/project_task_pivot/project_task_pivot_view");const{HighlightProjectTaskSearchModel}=require("@project_enterprise/views/highlight_project_task_search_model");projectTaskPivotView.SearchModel=HighlightProjectTaskSearchModel;return __exports;});;

/* /project_enterprise/static/src/views/project_task_activity/project_task_activity_view.js */
odoo.define('@project_enterprise/views/project_task_activity/project_task_activity_view',['@project/views/project_task_activity/project_task_activity_view','@project_enterprise/views/highlight_project_task_search_model'],function(require){'use strict';let __exports={};const{projectTaskActivityView}=require("@project/views/project_task_activity/project_task_activity_view");const{HighlightProjectTaskSearchModel}=require("@project_enterprise/views/highlight_project_task_search_model");projectTaskActivityView.SearchModel=HighlightProjectTaskSearchModel;return __exports;});;

/* /project_enterprise/static/src/views/project_task_common/milestones_popover.js */
odoo.define('@project_enterprise/views/project_task_common/milestones_popover',['@odoo/owl','@web/core/l10n/dates'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{formatDate}=require("@web/core/l10n/dates");const MilestonesPopover=__exports.MilestonesPopover=class MilestonesPopover extends Component{static template="project_enterprise.MilestonesPopover";static props=["close","displayMilestoneDates","displayProjectName","projects"];getDeadline(milestone){if(!milestone.deadline){return;}
return formatDate(milestone.deadline);}}
return __exports;});;

/* /project_enterprise/static/src/views/project_task_common/task_gantt_arch_parser_common.js */
odoo.define('@project_enterprise/views/project_task_common/task_gantt_arch_parser_common',['@web_gantt/gantt_arch_parser'],function(require){'use strict';let __exports={};const{GanttArchParser}=require("@web_gantt/gantt_arch_parser");const TaskGanttArchParserCommon=__exports.TaskGanttArchParserCommon=class TaskGanttArchParserCommon extends GanttArchParser{parse(){const archInfo=super.parse(...arguments);const decorationFields=new Set([...archInfo.decorationFields,"project_id"]);if(archInfo.dependencyEnabled){decorationFields.add("allow_task_dependencies");}
return{...archInfo,decorationFields:[...decorationFields],};}}
return __exports;});;

/* /project_enterprise/static/src/views/project_task_common/task_gantt_model_common.js */
odoo.define('@project_enterprise/views/project_task_common/task_gantt_model_common',['@web/core/l10n/dates','@web/core/utils/arrays','@web_gantt/gantt_model','@project/views/project_task_model_mixin'],function(require){'use strict';let __exports={};const{deserializeDate}=require("@web/core/l10n/dates");const{sortBy}=require("@web/core/utils/arrays");const{GanttModel}=require("@web_gantt/gantt_model");const{ProjectTaskModelMixin}=require("@project/views/project_task_model_mixin");const TaskGanttModelCommon=__exports.TaskGanttModelCommon=class TaskGanttModelCommon extends ProjectTaskModelMixin(GanttModel){setup(){super.setup(...arguments);this.getHighlightIds=()=>[];}
async unscheduleTask(id){await this.orm.call("project.task","action_unschedule_task",[id]);this.fetchData();}
async _fetchData(metaData,additionalContext){const globalStart=metaData.globalStart.toISODate();const globalStop=metaData.globalStop.toISODate();const scale=metaData.scale.unit;additionalContext={...(additionalContext||{}),gantt_start_date:globalStart,gantt_scale:scale,};const proms=[this.getHighlightIds(),super._fetchData(metaData,additionalContext)];let milestones=[];const projectDeadlines=[];const projectStartDates=[];if(!this.orm.isSample&&!this.env.isSmall){const prom=this.orm.call("project.task","get_all_deadlines",[globalStart,globalStop],{context:this.searchParams.context,}).then(({milestone_id,project_id})=>{milestones=milestone_id.map((m)=>({...m,deadline:deserializeDate(m.deadline),}));for(const project of project_id){const dateEnd=project.date;const dateStart=project.date_start;if(dateEnd>=globalStart&&dateEnd<=globalStop){projectDeadlines.push({...project,date:deserializeDate(dateEnd),});}
if(dateStart>=globalStart&&dateStart<=globalStop){projectStartDates.push({...project,date:deserializeDate(dateStart),});}}});proms.push(prom);}
this.highlightIds=(await Promise.all(proms))[0];this.data.milestones=sortBy(milestones,(m)=>m.deadline);this.data.projectDeadlines=sortBy(projectDeadlines,(d)=>d.date);this.data.projectStartDates=sortBy(projectStartDates,(d)=>d.date);}
_generateRows(metaData,params){const{groupedBy,groups,parentGroup}=params;if(groupedBy.length){const groupedByField=groupedBy[0];if(groupedByField==="user_ids"){const fakeGroup=Object.assign({},...parentGroup);groups.push(fakeGroup);}}
const rows=super._generateRows(...arguments);if(!["stage_id","personal_stage_type_ids"].includes(groupedBy[0])){rows.sort((a,b)=>{if(a.resId&&!b.resId){return 1;}else if(!a.resId&&b.resId){return-1;}else{return a.name.localeCompare(b.name);}});}
return rows;}
_getFields(metaData){const result=super._getFields(...arguments);result.push("is_closed");return result;}}
return __exports;});;

/* /project_enterprise/static/src/views/project_task_common/task_gantt_renderer_common.js */
odoo.define('@project_enterprise/views/project_task_common/task_gantt_renderer_common',['@odoo/owl','@web/core/l10n/localization','@web/core/popover/popover_hook','@web_gantt/gantt_renderer','@project_enterprise/views/project_task_common/milestones_popover'],function(require){'use strict';let __exports={};const{useEffect}=require("@odoo/owl");const{localization}=require("@web/core/l10n/localization");const{usePopover}=require("@web/core/popover/popover_hook");const{GanttRenderer}=require("@web_gantt/gantt_renderer");const{MilestonesPopover}=require("@project_enterprise/views/project_task_common/milestones_popover");const TaskGanttRendererCommon=__exports.TaskGanttRendererCommon=class TaskGanttRendererCommon extends GanttRenderer{static headerTemplate="project_enterprise.TaskGanttRenderer.Header";static rowContentTemplate="project_enterprise.TaskGanttRenderer.RowContent";static totalRowTemplate="project_enterprise.TaskGanttRenderer.TotalRow";static pillTemplate="project_enterprise.TaskGanttRenderer.Pill";setup(){super.setup(...arguments);useEffect((el)=>el.classList.add("o_project_gantt"),()=>[this.gridRef.el]);const position=localization.direction==="rtl"?"bottom":"right";this.milestonePopover=usePopover(MilestonesPopover,{position});}
enrichPill(pill){const enrichedPill=super.enrichPill(pill);if(enrichedPill.record.is_closed){pill.className+=" opacity-50";}
return enrichedPill;}
computeVisibleColumns(){super.computeVisibleColumns();this.columnMilestones={};for(const column of this.columns){this.columnMilestones[column.index]={hasDeadLineExceeded:false,allReached:true,projects:{},hasMilestone:false,hasDeadline:false,hasStartDate:false,};}
this.columnMilestones[this.columns[0].index].edge={projects:{},hasStartDate:false,};const projectStartDates=[...this.model.data.projectStartDates];const projectDeadlines=[...this.model.data.projectDeadlines];const milestones=[...this.model.data.milestones];let project=projectStartDates.shift();let projectDeadline=projectDeadlines.shift();let milestone=milestones.shift();let i=0;while(i<this.columns.length&&(project||projectDeadline||milestone)){const column=this.columns[i];const nextColumn=this.columns[i+1];const info=this.columnMilestones[column.index];if(i==0&&project&&column&&column.stop>project.date){if(!info.edge.projects[project.id]){info.edge.projects[project.id]={milestones:[],id:project.id,name:project.name,};}
info.edge.projects[project.id].isStartDate=true;info.edge.hasStartDate=true;project=projectStartDates.shift();}else if(project&&nextColumn?.stop>project.date){if(!info.projects[project.id]){info.projects[project.id]={milestones:[],id:project.id,name:project.name,};}
info.projects[project.id].isStartDate=true;info.hasStartDate=true;project=projectStartDates.shift();}
if(projectDeadline&&column.stop>projectDeadline.date){if(!info.projects[projectDeadline.id]){info.projects[projectDeadline.id]={milestones:[],id:projectDeadline.id,name:projectDeadline.name,};}
info.projects[projectDeadline.id].isDeadline=true;info.hasDeadline=true;projectDeadline=projectDeadlines.shift();}
if(milestone&&column.stop>milestone.deadline){const[projectId,projectName]=milestone.project_id;if(!info.projects[projectId]){info.projects[projectId]={milestones:[],id:projectId,name:projectName,};}
const{is_deadline_exceeded,is_reached}=milestone;info.projects[projectId].milestones.push(milestone);info.hasMilestone=true;milestone=milestones.shift();if(is_deadline_exceeded){info.hasDeadLineExceeded=true;}
if(!is_reached){info.allReached=false;}}
if((!project||!nextColumn||nextColumn?.stop<project.date)&&(!projectDeadline||column.stop<projectDeadline.date)&&(!milestone||column.stop<milestone.deadline)){i++;}}}
async getPopoverProps(pill){const props=await super.getPopoverProps(...arguments);props.actionContext.is_form_gantt=true;return props;}
shouldRenderRecordConnectors(record){if(record.allow_task_dependencies){return super.shouldRenderRecordConnectors(...arguments);}
return false;}
onMilestoneMouseEnter(ev,projects){this.milestonePopover.open(ev.target,{displayMilestoneDates:this.model.metaData.scale.id==="year",displayProjectName:!this.model.searchParams.context.default_project_id,projects,});}
onMilestoneMouseLeave(){this.milestonePopover.close();}
shouldConnectorBeDashed(sourcePill){if(sourcePill.record.is_closed){return true;}
return super.shouldConnectorBeDashed(sourcePill);}}
return __exports;});;

/* /project_enterprise/static/src/views/task_gantt/task_gantt_arch_parser.js */
odoo.define('@project_enterprise/views/task_gantt/task_gantt_arch_parser',['@project_enterprise/views/project_task_common/task_gantt_arch_parser_common'],function(require){'use strict';let __exports={};const{TaskGanttArchParserCommon}=require("@project_enterprise/views/project_task_common/task_gantt_arch_parser_common");const TaskGanttArchParser=__exports.TaskGanttArchParser=class TaskGanttArchParser extends TaskGanttArchParserCommon{parse(){const archInfo=super.parse(...arguments);if(archInfo.dependencyEnabled){archInfo.decorationFields.push('display_warning_dependency_in_gantt');}
return archInfo;}}
return __exports;});;

/* /project_enterprise/static/src/views/task_gantt/task_gantt_controller.js */
odoo.define('@project_enterprise/views/task_gantt/task_gantt_controller',['@web_gantt/gantt_controller','@project/views/components/project_task_template_dropdown'],function(require){'use strict';let __exports={};const{GanttController}=require("@web_gantt/gantt_controller");const{ProjectTaskTemplateDropdown}=require("@project/views/components/project_task_template_dropdown");const TaskGanttController=__exports.TaskGanttController=class TaskGanttController extends GanttController{static template="project_enterprise.TaskGanttController";static components={...GanttController.components,ProjectTaskTemplateDropdown,};}
return __exports;});;

/* /project_enterprise/static/src/views/task_gantt/task_gantt_model.js */
odoo.define('@project_enterprise/views/task_gantt/task_gantt_model',['@web/core/l10n/dates','@web/core/domain','@project_enterprise/views/project_task_common/task_gantt_model_common','@project_enterprise/views/project_highlight_tasks'],function(require){'use strict';let __exports={};const{deserializeDateTime,serializeDateTime}=require("@web/core/l10n/dates");const{Domain}=require("@web/core/domain");const{TaskGanttModelCommon}=require("@project_enterprise/views/project_task_common/task_gantt_model_common");const{useProjectModelActions}=require("@project_enterprise/views/project_highlight_tasks");const MAP_MANY_2_MANY_FIELDS=[{many2many_field:"personal_stage_type_ids",many2one_field:"personal_stage_type_id",},];const TaskGanttModel=__exports.TaskGanttModel=class TaskGanttModel extends TaskGanttModelCommon{setup(){super.setup(...arguments);this.getHighlightIds=useProjectModelActions({getContext:()=>this.env.searchModel._context,}).getHighlightIds;}
getDialogContext(){const context=super.getDialogContext(...arguments);this._replaceSpecialMany2manyKeys(context);if("user_ids"in context&&!context.user_ids){delete context.user_ids;}
return{...context,search_default_open_tasks:true};}
reschedule(ids,schedule,callback){if(!schedule.smart_task_scheduling){return super.reschedule(...arguments);}
if(!Array.isArray(ids)){ids=[ids];}
const allData=this._scheduleToData(schedule);const endDateTime=deserializeDateTime(allData.date_deadline).endOf(this.metaData.scale.id);const data=this.removeRedundantData(allData,ids);delete data.name;return this.mutex.exec(async()=>{try{const result=await this.orm.call(this.metaData.resModel,"schedule_tasks",[ids,data],{context:{...this.searchParams.context,last_date_view:serializeDateTime(endDateTime),cell_part:this.metaData.scale.cellPart,},});if(callback){callback(result);}}finally{this.fetchData();}});}
_reschedule(ids,data,context){return this.orm.call(this.metaData.resModel,"web_gantt_write",[ids,data],{context,});}
_replaceSpecialMany2manyKeys(object){for(const{many2many_field,many2one_field}of MAP_MANY_2_MANY_FIELDS){if(many2many_field in object){object[many2one_field]=object[many2many_field][0];delete object[many2many_field];}}}
_scheduleToData(){const data=super._scheduleToData(...arguments);this._replaceSpecialMany2manyKeys(data);return data;}
load(searchParams){let domain=searchParams?.domain||[];const{context,groupBy}=searchParams;let displayUnassigned=false;if(groupBy.length===0||groupBy[groupBy.length-1]==="user_ids"){for(const node of domain){if(node.length===3&&node[0]==="user_ids.name"&&node[1]==="ilike"){displayUnassigned=true;}}}
if(displayUnassigned){domain=Domain.or([domain,"[('user_ids', '=', false)]"]).toList();}
searchParams.domain=this._processSearchDomain(domain);return super.load({...searchParams,context:{...context},displayUnassigned});}
_getFields(metaData){const result=super._getFields(...arguments);result.push("is_closed");return result;}}
return __exports;});;

/* /project_enterprise/static/src/views/task_gantt/task_gantt_renderer.js */
odoo.define('@project_enterprise/views/task_gantt/task_gantt_renderer',['@project_enterprise/views/view_dialogs/select_auto_plan_create_dialog','@web/core/l10n/translation','@mail/views/web/fields/avatar/avatar','@odoo/owl','@web/core/utils/hooks','@web/views/view_dialogs/form_view_dialog','@project_enterprise/views/project_task_common/task_gantt_renderer_common','@project_enterprise/views/task_gantt/task_gantt_renderer_controls'],function(require){'use strict';let __exports={};const{SelectCreateAutoPlanDialog}=require("@project_enterprise/views/view_dialogs/select_auto_plan_create_dialog");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"project_enterprise",...args);const{Avatar}=require("@mail/views/web/fields/avatar/avatar");const{markup,useEffect}=require("@odoo/owl");const{useService}=require("@web/core/utils/hooks");const{FormViewDialog}=require("@web/views/view_dialogs/form_view_dialog");const{TaskGanttRendererCommon}=require("@project_enterprise/views/project_task_common/task_gantt_renderer_common");const{TaskGanttRendererControls}=require("@project_enterprise/views/task_gantt/task_gantt_renderer_controls");const TaskGanttRenderer=__exports.TaskGanttRenderer=class TaskGanttRenderer extends TaskGanttRendererCommon{static components={...TaskGanttRendererCommon.components,GanttRendererControls:TaskGanttRendererControls,Avatar,};static rowHeaderTemplate="project_enterprise.TaskGanttRenderer.RowHeader";setup(){super.setup(...arguments);this.notificationService=useService("notification");this.orm=useService("orm");useEffect((el)=>el.classList.add("o_project_gantt"),()=>[this.gridRef.el]);}
enrichPill(pill){const enrichedPill=super.enrichPill(pill);if(enrichedPill?.record){if(this.props.model.highlightIds&&!this.props.model.highlightIds.includes(enrichedPill.record.id)){pill.className+=" opacity-25";}}
return enrichedPill;}
computeDerivedParams(){this.rowsWithAvatar={};super.computeDerivedParams();}
getConnectorAlert(masterRecord,slaveRecord){if(masterRecord.display_warning_dependency_in_gantt&&slaveRecord.display_warning_dependency_in_gantt){return super.getConnectorAlert(...arguments);}}
getAvatarProps(row){return this.rowsWithAvatar[row.id];}
getSelectCreateDialogProps(){const props=super.getSelectCreateDialogProps(...arguments);const onCreateEdit=()=>{this.dialogService.add(FormViewDialog,{context:props.context,resModel:props.resModel,onRecordSaved:async(record)=>{await record.save({reload:false});await this.model.fetchData();},});};const onSelectedAutoPlan=(resIds)=>{props.context.smart_task_scheduling=true;if(resIds.length){this.model.reschedule(resIds,props.context,this.openPlanDialogCallback.bind(this));}};props.onSelectedNoSmartSchedule=props.onSelected;props.onSelected=onSelectedAutoPlan;props.onCreateEdit=onCreateEdit;return props;}
hasAvatar(row){return row.id in this.rowsWithAvatar;}
getNotificationOnSmartSchedule(notifText,old_vals_per_task_id,type){this.closeNotificationFn?.();this.closeNotificationFn=this.notificationService.add(markup`<i class="fa btn-link fa-check"></i><span class="ms-1">${notifText}</span>`,{type:type,sticky:true,buttons:[{name:"Undo",icon:"fa-undo",onClick:async()=>{const ids=Object.keys(old_vals_per_task_id).map(Number);await this.orm.call("project.task","action_rollback_auto_scheduling",[ids,old_vals_per_task_id,]);this.model.toggleHighlightPlannedFilter(false);this.closeNotificationFn();await this.model.fetchData();},},],});}
openPlanDialogCallback(res){if(res&&Array.isArray(res)){const warnings=Object.entries(res[0]);const old_vals_per_task_id=res[1];const has_tasks_planned=Object.keys(old_vals_per_task_id).length>0;const has_warnings=warnings.length>0
if(!has_warnings&&!has_tasks_planned){return;}
for(const warning of warnings){this.notificationService.add(warning[1],{type:"warning",sticky:true,});}
if(has_tasks_planned){const notif_text=has_warnings?_t("Some tasks have been successfully scheduled for the upcoming periods. Some warnings were generated. Please review them for details."):_t("Tasks have been successfully scheduled for the upcoming periods.");const type=has_warnings?"warning":"success";this.getNotificationOnSmartSchedule(notif_text,old_vals_per_task_id,type,);}}}
processRow(row){const{groupedByField,name,resId}=row;if(groupedByField==="user_ids"&&Boolean(resId)){const{fields}=this.model.metaData;const resModel=fields.user_ids.relation;this.rowsWithAvatar[row.id]={resModel,resId,displayName:name};}
return super.processRow(...arguments);}
highlightPill(pillId,highlighted){if(!this.connectorDragState.dragging){return super.highlightPill(pillId,highlighted);}
const pill=this.pills[pillId];if(!pill){return;}
const{record}=pill;if(!this.shouldRenderRecordConnectors(record)){return super.highlightPill(pillId,false);}
return super.highlightPill(pillId,highlighted);}
onConnectorHover(){return!this.connectorDragState.dragging;}
onPlan(rowId,columnStart,columnStop){let{start,stop}=this.getColumnStartStop(columnStart,columnStop);({start,stop}=this.normalizeTimeRange(start,stop));this.dialogService.add(SelectCreateAutoPlanDialog,this.getSelectCreateDialogProps({rowId,start,stop,withDefault:true}));}
getUndoAfterDragMessages(dragAction){if(dragAction==="copy"){return{success:_t("Task duplicated"),undo:_t("Task removed"),failure:_t("Task could not be removed"),};}
return{success:_t("Task rescheduled"),undo:_t("Task reschedule undone"),failure:_t("Failed to undo reschedule"),};}
onRemoveButtonClick(connectorId){const{sourcePillId,targetPillId}=this.mappingConnectorToPills[connectorId];this.highlightPill(sourcePillId,false);this.highlightPill(targetPillId,false);super.onRemoveButtonClick(connectorId);}}
return __exports;});;

/* /project_enterprise/static/src/views/task_gantt/task_gantt_renderer_controls.js */
odoo.define('@project_enterprise/views/task_gantt/task_gantt_renderer_controls',['@web_gantt/gantt_renderer_controls','@odoo/owl','@web/core/user'],function(require){'use strict';let __exports={};const{GanttRendererControls}=require("@web_gantt/gantt_renderer_controls");const{onWillStart}=require("@odoo/owl");const{user}=require("@web/core/user");const TaskGanttRendererControls=__exports.TaskGanttRendererControls=class TaskGanttRendererControls extends GanttRendererControls{setup(){super.setup();onWillStart(async()=>{this.dependenciesActive=await user.hasGroup('project.group_project_task_dependencies');});}
get displayRescheduleMethods(){return super.displayRescheduleMethods&&this.dependenciesActive;}}
return __exports;});;

/* /project_enterprise/static/src/views/task_gantt/task_gantt_view.js */
odoo.define('@project_enterprise/views/task_gantt/task_gantt_view',['@project/views/project_task_control_panel/project_task_control_panel','@web_gantt/gantt_view','@project_enterprise/views/task_gantt/task_gantt_controller','@web/core/registry','@project_enterprise/views/task_gantt/task_gantt_arch_parser','@project_enterprise/views/task_gantt/task_gantt_model','@project_enterprise/views/task_gantt/task_gantt_renderer'],function(require){'use strict';let __exports={};const{ProjectTaskControlPanel}=require("@project/views/project_task_control_panel/project_task_control_panel");const{ganttView}=require("@web_gantt/gantt_view");const{TaskGanttController}=require("@project_enterprise/views/task_gantt/task_gantt_controller");const{registry}=require("@web/core/registry");const{TaskGanttArchParser}=require("@project_enterprise/views/task_gantt/task_gantt_arch_parser");const{TaskGanttModel}=require("@project_enterprise/views/task_gantt/task_gantt_model");const{TaskGanttRenderer}=require("@project_enterprise/views/task_gantt/task_gantt_renderer");const viewRegistry=registry.category("views");const taskGanttView=__exports.taskGanttView={...ganttView,ControlPanel:ProjectTaskControlPanel,Controller:TaskGanttController,ArchParser:TaskGanttArchParser,Model:TaskGanttModel,Renderer:TaskGanttRenderer,};viewRegistry.add("task_gantt",taskGanttView);return __exports;});;

/* /project_enterprise/static/src/views/project_gantt/project_gantt_controller.js */
odoo.define('@project_enterprise/views/project_gantt/project_gantt_controller',['@web_gantt/gantt_controller','@project/views/components/project_template_dropdown'],function(require){'use strict';let __exports={};const{GanttController}=require("@web_gantt/gantt_controller");const{ProjectTemplateDropdown}=require("@project/views/components/project_template_dropdown");const ProjectGanttController=__exports.ProjectGanttController=class ProjectGanttController extends GanttController{static template="project_enterprise.ProjectGanttController";static components={...GanttController.components,ProjectTemplateDropdown,};}
return __exports;});;

/* /project_enterprise/static/src/views/project_gantt/project_gantt_model.js */
odoo.define('@project_enterprise/views/project_gantt/project_gantt_model',['@web/core/user','@web_gantt/gantt_model','@project/views/project_model_mixin'],function(require){'use strict';let __exports={};const{user}=require("@web/core/user");const{GanttModel}=require("@web_gantt/gantt_model");const{ProjectModelMixin}=require("@project/views/project_model_mixin");const COLOR_FIELD="stage_id";const ProjectGanttModel=__exports.ProjectGanttModel=class ProjectGanttModel extends ProjectModelMixin(GanttModel){async load(searchParams){const stagesEnabled=await user.hasGroup("project.group_project_stages");if(stagesEnabled&&!this.metaData.colorField){this.metaData.colorField=COLOR_FIELD;}
searchParams.domain=this._processSearchDomain(searchParams?.domain||[]);await super.load(searchParams);}
_reschedule(ids,data,context){return this.orm.call(this.metaData.resModel,"web_gantt_write",[ids,data],{context,});}
_generateRows(metaData,params){const{groupedBy,groups,parentGroup}=params;if(groupedBy.length){const groupedByField=groupedBy[0];if(groupedByField==="user_id"){const fakeGroup=Object.assign({},...parentGroup);groups.push(fakeGroup);}}
const rows=super._generateRows(...arguments);if("stage_id"!=groupedBy[0]){rows.sort((a,b)=>{if(a.resId&&!b.resId){return 1;}else if(!a.resId&&b.resId){return-1;}else{return a.name.localeCompare(b.name);}});}
return rows;}}
return __exports;});;

/* /project_enterprise/static/src/views/project_gantt/project_gantt_renderer.js */
odoo.define('@project_enterprise/views/project_gantt/project_gantt_renderer',['@mail/views/web/fields/avatar/avatar','@web_gantt/gantt_renderer'],function(require){'use strict';let __exports={};const{Avatar}=require("@mail/views/web/fields/avatar/avatar");const{GanttRenderer}=require("@web_gantt/gantt_renderer");const ProjectGanttRenderer=__exports.ProjectGanttRenderer=class ProjectGanttRenderer extends GanttRenderer{static components={...GanttRenderer.components,Avatar,};static rowHeaderTemplate="project_enterprise.ProjectGanttRenderer.RowHeader";computeDerivedParams(){this.rowsWithAvatar={};super.computeDerivedParams();}
processRow(row){const{groupedByField,name,resId}=row;if(groupedByField==="user_id"&&Boolean(resId)){const{fields}=this.model.metaData;const resModel=fields.user_id.relation;this.rowsWithAvatar[row.id]={resModel,resId,displayName:name};}
return super.processRow(...arguments);}
getAvatarProps(row){return this.rowsWithAvatar[row.id];}
hasAvatar(row){return row.id in this.rowsWithAvatar;}}
return __exports;});;

/* /project_enterprise/static/src/views/project_gantt/project_gantt_view.js */
odoo.define('@project_enterprise/views/project_gantt/project_gantt_view',['@web_gantt/gantt_view','@web/core/registry','@project_enterprise/views/project_gantt/project_gantt_controller','@project_enterprise/views/project_gantt/project_gantt_renderer','@project_enterprise/views/project_gantt/project_gantt_model'],function(require){'use strict';let __exports={};const{ganttView}=require("@web_gantt/gantt_view");const{registry}=require("@web/core/registry");const{ProjectGanttController}=require("@project_enterprise/views/project_gantt/project_gantt_controller");const{ProjectGanttRenderer}=require("@project_enterprise/views/project_gantt/project_gantt_renderer");const{ProjectGanttModel}=require("@project_enterprise/views/project_gantt/project_gantt_model");const projectGanttView=__exports.projectGanttView={...ganttView,Controller:ProjectGanttController,Renderer:ProjectGanttRenderer,Model:ProjectGanttModel,};registry.category("views").add("project_gantt",projectGanttView);return __exports;});;

/* /hr_gantt/static/src/hr_gantt_employee_avatar.js */
odoo.define('@hr_gantt/hr_gantt_employee_avatar',['@mail/views/web/fields/avatar/avatar','@hr/components/avatar_card_employee/avatar_card_employee_popover','@web/core/popover/popover_hook'],function(require){'use strict';let __exports={};const{Avatar}=require("@mail/views/web/fields/avatar/avatar");const{AvatarCardEmployeePopover}=require("@hr/components/avatar_card_employee/avatar_card_employee_popover");const{usePopover}=require("@web/core/popover/popover_hook");const GanttEmployeeAvatar=__exports.GanttEmployeeAvatar=class GanttEmployeeAvatar extends Avatar{static template="hr.GanttEmployeeAvatar";setup(){super.setup();this.avatarCard=usePopover(AvatarCardEmployeePopover);}
openCard(ev){if(this.env.isSmall||!this.props.resId){return;}
const target=ev.currentTarget;if(!this.avatarCard.isOpen){this.avatarCard.open(target,{id:this.props.resId,recordModel:this.props.resModel,});}}}
return __exports;});;

/* /hr_gantt/static/src/hr_gantt_renderer.js */
odoo.define('@hr_gantt/hr_gantt_renderer',['@hr_gantt/hr_gantt_employee_avatar','@web_gantt/gantt_renderer'],function(require){'use strict';let __exports={};const{GanttEmployeeAvatar}=require("@hr_gantt/hr_gantt_employee_avatar");const{GanttRenderer}=require("@web_gantt/gantt_renderer");const{DateTime}=luxon;const HrGanttRenderer=__exports.HrGanttRenderer=class HrGanttRenderer extends GanttRenderer{static rowHeaderTemplate="hr.HrGanttRenderer.RowHeader";static components={...GanttRenderer.components,Avatar:GanttEmployeeAvatar};computeDerivedParams(){this.rowsWithAvatar={};super.computeDerivedParams();}
getAvatarProps(row){return this.rowsWithAvatar[row.id];}
hasAvatar(row){return row.id in this.rowsWithAvatar;}
processRow(row){const{groupedByField,name,resId}=row;if(groupedByField==="employee_id"&&Boolean(resId)){const{fields}=this.model.metaData;const relation=fields.employee_id.relation;const resModel=relation==='hr.employee'?'hr.employee.public':relation;this.rowsWithAvatar[row.id]={resModel,resId,displayName:name};}
return super.processRow(...arguments);}
getPill(record){const pill=super.getPill(record);const{unit}=this.model.metaData.scale;const[startIndex,endIndex]=pill.grid.column;if(["week","month"].includes(unit)&&(endIndex-startIndex===2)){const{dateStartField,dateStopField,globalStart,globalStop,}=this.model.metaData;const start=DateTime.max(globalStart,record[dateStartField]);const stop=DateTime.min(globalStop,record[dateStopField]);if(start.day===stop.day){const startTime=start.hour+(start.minute/60);const stopTime=stop.hour+(stop.minute/60);const closestToNoon=12-startTime<stopTime-12?startTime:stopTime;if(startTime>=11&&startTime===closestToNoon){pill.grid.column=[startIndex+1,endIndex];}else if(stopTime<=14){pill.grid.column=[startIndex,endIndex-1];}}}
return pill;}}
return __exports;});;

/* /hr_gantt/static/src/hr_gantt_view.js */
odoo.define('@hr_gantt/hr_gantt_view',['@web_gantt/gantt_view','@hr_gantt/hr_gantt_renderer','@web/core/registry'],function(require){'use strict';let __exports={};const{ganttView}=require("@web_gantt/gantt_view");const{HrGanttRenderer}=require("@hr_gantt/hr_gantt_renderer");const{registry}=require("@web/core/registry");const viewRegistry=registry.category("views");const hrGanttView=__exports.hrGanttView={...ganttView,Renderer:HrGanttRenderer,};viewRegistry.add("hr_gantt",hrGanttView);return __exports;});;

/* /hr_attendance_gantt/static/src/attendance_gantt/attendance_gantt_model.js */
odoo.define('@hr_attendance_gantt/attendance_gantt/attendance_gantt_model',['@web/core/l10n/dates','@web_gantt/gantt_model','@web/core/domain','@web_gantt/gantt_helpers'],function(require){'use strict';let __exports={};const{serializeDateTime}=require("@web/core/l10n/dates");const{GanttModel,parseServerValues}=require("@web_gantt/gantt_model");const{Domain}=require("@web/core/domain");const{localStartOf}=require("@web_gantt/gantt_helpers");const AttendanceGanttModel=__exports.AttendanceGanttModel=class AttendanceGanttModel extends GanttModel{_getDomain(metaData){const{dateStartField,dateStopField,globalStart,globalStop}=metaData;const dateNow=luxon.DateTime.now();if(dateNow>=globalStart){const domain=Domain.and([this.searchParams.domain,["&",[dateStartField,"<",serializeDateTime(globalStop)],"|","&",[dateStartField,"<",serializeDateTime(dateNow)],[dateStopField,"=",false],[dateStopField,">",serializeDateTime(globalStart)],],]);return domain.toList();}else{return super._getDomain(...arguments);}}
async _fetchData(metaData){const startDate=metaData.globalStart.toISODate();let activeDomain=[];if(!this.searchParams.domain.some((index)=>Array.isArray(index)&&index[0]=="employee_id.active")){activeDomain.push(["employee_id.active","=",true]);}
const context={gantt_start_date:startDate,user_domain:this.searchParams.domain,active_domain:activeDomain};await super._fetchData(metaData,context);}
_parseServerData(metaData,records){const{dateStartField,dateStopField,fields}=metaData;const parsedRecords=super._parseServerData(...arguments);for(const record of records){const parsedRecord=parseServerValues(fields,record);const dateStart=parsedRecord[dateStartField];const dateStop=parsedRecord[dateStopField];if(dateStart&&!dateStop){parsedRecord[dateStopField]=luxon.DateTime.now();parsedRecords.push(parsedRecord);}}
return parsedRecords;}
getRangeFromDate(rangeId,date){const startDate=localStartOf(date,rangeId);const stopDate=startDate.plus({[rangeId]:1}).minus({day:1});return{focusDate:date,startDate,stopDate,rangeId};}}
return __exports;});;

/* /hr_attendance_gantt/static/src/attendance_gantt/attendance_gantt_renderer.js */
odoo.define('@hr_attendance_gantt/attendance_gantt/attendance_gantt_renderer',['@hr_gantt/hr_gantt_renderer','@hr_attendance_gantt/attendance_gantt/attendance_row_progress_bar'],function(require){'use strict';let __exports={};const{HrGanttRenderer}=require("@hr_gantt/hr_gantt_renderer");const{AttendanceGanttRowProgressBar}=require("@hr_attendance_gantt/attendance_gantt/attendance_row_progress_bar");const AttendanceGanttRenderer=__exports.AttendanceGanttRenderer=class AttendanceGanttRenderer extends HrGanttRenderer{static components={...HrGanttRenderer.components,GanttRowProgressBar:AttendanceGanttRowProgressBar,};onPillClicked(ev,pill){this.model.mutex.exec(()=>this.props.openDialog({resId:pill.record.id}))}}
return __exports;});;

/* /hr_attendance_gantt/static/src/attendance_gantt/attendance_gantt_view.js */
odoo.define('@hr_attendance_gantt/attendance_gantt/attendance_gantt_view',['@odoo/owl','@web_gantt/gantt_view','@web/core/registry','@hr_attendance_gantt/attendance_gantt/attendance_gantt_model','@hr_attendance_gantt/attendance_gantt/attendance_gantt_renderer','@web_gantt/gantt_controller','@hr_attendance/views/attendance_helper_view'],function(require){'use strict';let __exports={};const{onRendered}=require("@odoo/owl");const{ganttView}=require("@web_gantt/gantt_view");const{registry}=require("@web/core/registry");const{AttendanceGanttModel}=require("@hr_attendance_gantt/attendance_gantt/attendance_gantt_model");const{AttendanceGanttRenderer}=require("@hr_attendance_gantt/attendance_gantt/attendance_gantt_renderer");const{GanttController}=require("@web_gantt/gantt_controller");const{AttendanceActionHelper}=require("@hr_attendance/views/attendance_helper_view");const HrAttendanceGanttController=__exports.HrAttendanceGanttController=class HrAttendanceGanttController extends GanttController{static template="hr_attendance.AttendanceGanttController";static components={...GanttController.components,AttendanceActionHelper,}
setup(){super.setup();this.loadHelper=true;onRendered(()=>{this.loadHelper=false;});}
get showNoContentHelp(){return this.model.data.rows.length<2&&this.model.data.rows[0].recordIds.length===0;}}
const viewRegistry=registry.category("views");const attendanceGanttView=__exports.attendanceGanttView={...ganttView,Controller:HrAttendanceGanttController,Model:AttendanceGanttModel,Renderer:AttendanceGanttRenderer,};viewRegistry.add("attendance_gantt",attendanceGanttView);return __exports;});;

/* /hr_attendance_gantt/static/src/attendance_gantt/attendance_row_progress_bar.js */
odoo.define('@hr_attendance_gantt/attendance_gantt/attendance_row_progress_bar',['@web_gantt/gantt_row_progress_bar'],function(require){'use strict';let __exports={};const{GanttRowProgressBar}=require("@web_gantt/gantt_row_progress_bar");const AttendanceGanttRowProgressBar=__exports.AttendanceGanttRowProgressBar=class AttendanceGanttRowProgressBar extends GanttRowProgressBar{static template="hr_attendance.AttendanceGanttRowProgressBar";static props={...GanttRowProgressBar.props,progressBar:{...GanttRowProgressBar.props.progressBar,shape:{...GanttRowProgressBar.props.progressBar.shape,is_fully_flexible_hours:{type:Boolean,optional:true},},},};get status(){const{max_value,value}=this.props.progressBar;if(value>max_value){return"danger"}else{return"success"}}}
return __exports;});;

/* /hr_org_chart/static/src/views/hr_employee_hierarchy/hr_employee_hierarchy_card.js */
odoo.define('@hr_org_chart/views/hr_employee_hierarchy/hr_employee_hierarchy_card',['@web_hierarchy/hierarchy_card'],function(require){'use strict';let __exports={};const{HierarchyCard}=require("@web_hierarchy/hierarchy_card");const HrEmployeeHierarchyCard=__exports.HrEmployeeHierarchyCard=class HrEmployeeHierarchyCard extends HierarchyCard{static template="hr_org_chart.HrEmployeeHierarchyCard";}
return __exports;});;

/* /hr_org_chart/static/src/views/hr_employee_hierarchy/hr_employee_hierarchy_renderer.js */
odoo.define('@hr_org_chart/views/hr_employee_hierarchy/hr_employee_hierarchy_renderer',['@mail/views/web/fields/avatar/avatar','@web_hierarchy/hierarchy_renderer','@hr_org_chart/views/hr_employee_hierarchy/hr_employee_hierarchy_card'],function(require){'use strict';let __exports={};const{Avatar}=require("@mail/views/web/fields/avatar/avatar");const{HierarchyRenderer}=require("@web_hierarchy/hierarchy_renderer");const{HrEmployeeHierarchyCard}=require("@hr_org_chart/views/hr_employee_hierarchy/hr_employee_hierarchy_card");const HrEmployeeHierarchyRenderer=__exports.HrEmployeeHierarchyRenderer=class HrEmployeeHierarchyRenderer extends HierarchyRenderer{static template="hr_org_chart.HrEmployeeHierarchyRenderer";static components={...HierarchyRenderer.components,HierarchyCard:HrEmployeeHierarchyCard,Avatar,};}
return __exports;});;

/* /hr_org_chart/static/src/views/hr_employee_hierarchy/hr_employee_hierarchy_view.js */
odoo.define('@hr_org_chart/views/hr_employee_hierarchy/hr_employee_hierarchy_view',['@web/core/registry','@web_hierarchy/hierarchy_view','@hr_org_chart/views/hr_employee_hierarchy/hr_employee_hierarchy_renderer'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{hierarchyView}=require("@web_hierarchy/hierarchy_view");const{HrEmployeeHierarchyRenderer}=require("@hr_org_chart/views/hr_employee_hierarchy/hr_employee_hierarchy_renderer");const hrEmployeeHierarchyView=__exports.hrEmployeeHierarchyView={...hierarchyView,Renderer:HrEmployeeHierarchyRenderer,};registry.category("views").add("hr_employee_hierarchy",hrEmployeeHierarchyView);return __exports;});;

/* /hr_recruitment_reports/static/src/js/recruitment_report_pivot.js */
odoo.define('@hr_recruitment_reports/js/recruitment_report_pivot',['@web/views/pivot/pivot_view','@web/core/registry','@web/views/pivot/pivot_renderer'],function(require){'use strict';let __exports={};const{pivotView}=require("@web/views/pivot/pivot_view");const{registry}=require("@web/core/registry");const{PivotRenderer}=require("@web/views/pivot/pivot_renderer");const viewRegistry=registry.category("views");const RecruitmentReportPivotRenderer=__exports.RecruitmentReportPivotRenderer=class RecruitmentReportPivotRenderer extends PivotRenderer{onOpenView(cell){if(cell.value===undefined||this.model.metaData.disableLinking){return;}
const context=Object.assign({},this.model.searchParams.context);Object.keys(context).forEach((x)=>{if(x==="group_by"||x.startsWith("search_default_")){delete context[x];}});const{views=[]}=this.env.config;this.views=["list","form"].map((viewType)=>{const view=views.find((view)=>view[1]===viewType);return[view?view[0]:false,viewType];});const group={rowValues:cell.groupId[0],colValues:cell.groupId[1]};const domain=this.model.getGroupDomain(group);if(this.model.metaData.measures[cell.measure].aggregator==="sum"){domain.unshift("&");domain.push([cell.measure,"=",true]);}
this.openView(domain,this.views,context);}}
viewRegistry.add("recruitment_report_pivot",{...pivotView,Renderer:RecruitmentReportPivotRenderer,});return __exports;});;

/* /hr_recruitment_reports/static/src/js/recruitment_report_view_graph.js */
odoo.define('@hr_recruitment_reports/js/recruitment_report_view_graph',['@web/views/graph/graph_renderer','@web/views/graph/graph_view','@web/core/registry'],function(require){'use strict';let __exports={};const{GraphRenderer}=require("@web/views/graph/graph_renderer");const{graphView}=require("@web/views/graph/graph_view");const{registry}=require("@web/core/registry");const RecruitmentGraphRenderer=__exports.RecruitmentGraphRenderer=class RecruitmentGraphRenderer extends GraphRenderer{getScaleOptions(){const scaleOptions=super.getScaleOptions();if('yAxes'in scaleOptions){scaleOptions.yAxes.suggestedMax=7;}
return scaleOptions;}}
registry.category("views").add('recruitment_report_view_graph',{...graphView,Renderer:RecruitmentGraphRenderer,});return __exports;});;

/* /stock_enterprise/static/src/map_view/map_model.js */
odoo.define('@stock_enterprise/map_view/map_model',['@web_map/map_view/map_model'],function(require){'use strict';let __exports={};const{MapModel}=require("@web_map/map_view/map_model");const StockMapModel=__exports.StockMapModel=class StockMapModel extends MapModel{_getRecordSpecification(metaData,data){return{...super._getRecordSpecification(metaData,data),warehouse_address_id:{fields:{display_name:{},contact_address_complete:{},}}}}}
return __exports;});;

/* /stock_enterprise/static/src/map_view/map_renderer.js */
odoo.define('@stock_enterprise/map_view/map_renderer',['@web_map/map_view/map_renderer'],function(require){'use strict';let __exports={};const{MapRenderer}=require("@web_map/map_view/map_renderer");const StockMapRenderer=__exports.StockMapRenderer=class StockMapRenderer extends MapRenderer{static markerPopupTemplate="stock_enterprise.markerPopup";get googleMapUrl(){let url=super.googleMapUrl;if(this.props.model.data.records.length){const warehouseAddress=this.props.model.data.records[0].warehouse_address_id;let multiAddresses=false;for(const record of this.props.model.data.records){if(record.warehouse_address_id.id!==warehouseAddress.id){multiAddresses=true;break;}}
if(multiAddresses){return url;}
url+=`&origin=${warehouseAddress.contact_address_complete}`;url+=`&destination=${warehouseAddress.contact_address_complete}`;}
return url;}
getMarkerPopupData(markerInfo){const records=markerInfo.relatedRecords.concat(markerInfo.record);const recordsView=[];for(const record of records){recordsView.push({fields:this.getMarkerPopupRecordData(record),id:record.id});}
return recordsView;}}
return __exports;});;

/* /stock_enterprise/static/src/map_view/map_view.js */
odoo.define('@stock_enterprise/map_view/map_view',['@web/core/registry','@web_map/map_view/map_view','@stock_enterprise/map_view/map_model','@stock_enterprise/map_view/map_renderer'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{mapView}=require("@web_map/map_view/map_view");const{StockMapModel}=require("@stock_enterprise/map_view/map_model");const{StockMapRenderer}=require("@stock_enterprise/map_view/map_renderer");const stockMapView=__exports.stockMapView={...mapView,Model:StockMapModel,Renderer:StockMapRenderer,};registry.category("views").add("stock_map",stockMapView);return __exports;});;

/* /web_studio/static/src/client_action/action_editor/action_editor.js */
odoo.define('@web_studio/client_action/action_editor/action_editor',['@odoo/owl','@web/core/utils/hooks','@web/core/network/rpc','@web/core/user','@web/core/registry','@web/core/l10n/translation','@web/core/utils/arrays','@web/core/dropdown/dropdown_item','@web/core/confirmation_dialog/confirmation_dialog','@web/webclient/actions/action_service','@web/model/record','@web/views/fields/many2many_tags/many2many_tags_field','@web/views/fields/char/char_field','@web/views/fields/text/text_field','@web_studio/client_action/components/thumbnail_item/thumbnail_item','@web_studio/studio_service','@web_studio/client_action/editor/new_view_dialogs/new_view_dialog','@web_studio/client_action/editor/new_view_dialogs/map_new_view_dialog'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{useOwnedDialogs,useService}=require("@web/core/utils/hooks");const{rpc}=require("@web/core/network/rpc");const{user}=require("@web/core/user");const{registry}=require("@web/core/registry");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{sortBy}=require("@web/core/utils/arrays");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{AlertDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{standardActionServiceProps}=require("@web/webclient/actions/action_service");const{Record}=require("@web/model/record");const{Many2ManyTagsField,many2ManyTagsField,}=require("@web/views/fields/many2many_tags/many2many_tags_field");const{CharField}=require("@web/views/fields/char/char_field");const{TextField}=require("@web/views/fields/text/text_field");const{ThumbnailItem}=require("@web_studio/client_action/components/thumbnail_item/thumbnail_item");const{viewTypeToString,useStudioServiceAsReactive}=require("@web_studio/studio_service");const{NewViewDialog}=require("@web_studio/client_action/editor/new_view_dialogs/new_view_dialog");const{MapNewViewDialog}=require("@web_studio/client_action/editor/new_view_dialogs/map_new_view_dialog");function getViewCategories(){return{general:{title:_t("General views"),viewTypes:["form","search","activity"],},multiple:{title:_t("Multiple records views"),viewTypes:["list","kanban","map"],},timeline:{title:_t("Timeline views"),viewTypes:["calendar","gantt"],},reporting:{title:_t("Reporting views"),viewTypes:["graph","pivot","cohort"],},};}
const actionFieldsGet={id:{type:"integer"},name:{type:"char"},help:{type:"text"},group_ids:{type:"many2many",relation:"res.groups",string:"Groups"},};function getActionActiveFields(){const activeFields={};for(const fName of Object.keys(actionFieldsGet)){activeFields[fName]={};}
const groups_idRelated=Object.fromEntries(many2ManyTagsField.relatedFields({options:{}}).map((f)=>[f.name,f]));activeFields.group_ids.related={activeFields:groups_idRelated,fields:groups_idRelated};return activeFields;}
function getActionValues(action){const values={};for(const fName of Object.keys(actionFieldsGet)){values[fName]=action[fName];}
return values;}
class ActionEditor extends Component{static template="web_studio.ActionEditor";static props={...standardActionServiceProps};static components={ThumbnailItem,DropdownItem,Record,CharField,TextField,Many2ManyTagsField,};setup(){this.studio=useStudioServiceAsReactive();this.action=useService("action");this.notification=useService("notification");this.viewCategories=getViewCategories();this.addDialog=useOwnedDialogs();this.actionFieldsGet={...actionFieldsGet};}
get isActionEditable(){return!!this.studio.editedAction.id;}
get actionRecordProps(){const values=getActionValues(this.studio.editedAction);return{fields:this.actionFieldsGet,resModel:"ir.actions.act_window",resId:values.id,mode:"edit",values,activeFields:getActionActiveFields(),hooks:{onRecordChanged:(record,changes)=>this.editAction(changes),},};}
get activeViews(){return this.studio.editedAction.views.map(([,name])=>name);}
getOrderedViewTypes(viewTypes){const activeViews=this.activeViews;const currentDefaultView=activeViews[0];const viewInfos=viewTypes.map((viewType)=>({name:viewType,title:viewTypeToString(viewType),isActive:activeViews.includes(viewType),isDefault:currentDefaultView===viewType,imgUrl:`/web_studio/static/src/img/view_type/${viewType}.png`,canBeDefault:!["form","search"].includes(viewType),canBeDisabled:viewType!=="search",}));return sortBy(viewInfos,({isDefault,isActive})=>(isDefault?2:isActive?1:0),"desc");}
setDefaultView(viewType){let viewModes=this.studio.editedAction.view_mode.split(",");viewModes=viewModes.filter((m)=>m!==viewType);viewModes.unshift(viewType);return this.editAction({view_mode:viewModes.join(",")});}
disableView(viewType){const viewMode=this.studio.editedAction.view_mode.split(",").filter((m)=>m!==viewType);if(!viewMode.length){this.addDialog(AlertDialog,{body:_t("You cannot deactivate this view as it is the last one active."),});}else{return this.editAction({view_mode:viewMode.join(",")});}}
restoreDefaultView(viewType){return this.env.editionFlow.restoreDefaultView(null,viewType);}
async addViewType(viewType){const action=this.studio.editedAction;const viewMode=action.view_mode.split(",");viewMode.push(viewType);let viewAdded=await rpc("/web_studio/add_view_type",{action_type:action.type,action_id:action.id,res_model:action.res_model,view_type:viewType,args:{view_mode:viewMode.join(",")},context:user.context,});if(viewAdded!==true){viewAdded=await new Promise((resolve)=>{let DialogClass;const dialogProps={confirm:async()=>{resolve(true);},cancel:()=>resolve(false),};if(["gantt","calendar","cohort"].includes(viewType)){DialogClass=NewViewDialog;dialogProps.viewType=viewType;}else if(viewType==="map"){DialogClass=MapNewViewDialog;}else{this.addDialog(AlertDialog,{body:_t("Creating this type of view is not currently supported in Studio."),});resolve(false);}
this.addDialog(DialogClass,dialogProps);});}
if(viewAdded){await this.editAction({view_mode:viewMode.join(",")});}
return viewAdded;}
editView(viewType){this.studio.setParams({viewType,editorTab:"views"});}
async onThumbnailClicked(viewType){if(this.activeViews.includes(viewType)){return this.editView(viewType);}
const resModel=this.studio.editedAction.res_model;if(viewType==="activity"){const modelInfo=await this.studio.IrModelInfo.read(resModel);const activityAllowed=modelInfo.is_mail_activity||modelInfo.state==="manual";if(!activityAllowed){this.notification.add(_t("Activity view unavailable on this model"),{title:false,type:"danger",});return;}}
if(await this.addViewType(viewType)){return this.editView(viewType);}}
openFormAction(){return this.action.doAction({type:"ir.actions.act_window",res_model:"ir.actions.act_window",res_id:this.studio.editedAction.id,views:[[false,"form"]],target:"current",},{stackPosition:"replacePreviousAction",});}
async editAction(changes){await rpc("/web_studio/edit_action",{action_id:this.studio.editedAction.id,action_type:"ir.actions.act_window",args:changes,});return this.studio.reload({},false);}}
registry.category("actions").add("web_studio.action_editor",ActionEditor);return __exports;});;

/* /web_studio/static/src/client_action/app_creator/app_creator.js */
odoo.define('@web_studio/client_action/app_creator/app_creator',['@odoo/owl','@web/core/network/rpc','@web/core/user','@web/core/utils/hooks','@web_studio/client_action/model_configurator/model_configurator','@web_studio/client_action/icon_creator/icon_creator','@web_studio/client_action/menu_creator/menu_creator'],function(require){'use strict';let __exports={};const{Component,reactive,useExternalListener,useState}=require("@odoo/owl");const{rpc}=require("@web/core/network/rpc");const{user}=require("@web/core/user");const{useAutofocus,useService}=require("@web/core/utils/hooks");const{ModelConfigurator}=require("@web_studio/client_action/model_configurator/model_configurator");const{DEFAULT_ICON,IconCreator}=require("@web_studio/client_action/icon_creator/icon_creator");const{MenuCreator,MenuCreatorModel}=require("@web_studio/client_action/menu_creator/menu_creator");class AppCreatorState{constructor({onFinished}){this._onFinished=onFinished;this.step="welcome";this.fieldsValidators={appName:()=>!!this.data.appName,menu:(_this)=>_this.menuCreatorModel.isValid,};this.menuCreatorModel=reactive(new MenuCreatorModel());this.data={appName:"",iconData:DEFAULT_ICON,menu:this.menuCreatorModel.data,modelOptions:[],};this._steps={welcome:{next:()=>"app",},app:{previous:"welcome",next:()=>"model",fields:["appName"],},model:{previous:"app",next:(data)=>{return data.menu.modelChoice==="new"?"model_configuration":"";},fields:["menu"],},model_configuration:{previous:"model",},};}
get step(){return this._step;}
set step(step){this._step=step;this.showValidation=false;}
get nextStep(){return this._stepInvalidFields.length?false:this._next;}
get hasPrevious(){return"previous"in this._currentStep;}
isFieldValid(fieldName){return this.showValidation?this.fieldsValidators[fieldName](this):true;}
next(){this.showValidation=true;const invalidFields=this._stepInvalidFields;if(invalidFields.length){return;}
const next=this._next;if(next){this.step=next;}else{return this._onFinished();}}
previous(){if(this._currentStep.previous){this.step=this._currentStep.previous;}}
get _currentStep(){return this._steps[this._step];}
get _next(){return this._currentStep.next?this._currentStep.next(this.data):"";}
get _stepInvalidFields(){return(this._currentStep.fields||[]).filter((fName)=>{return!this.fieldsValidators[fName](this);});}}
const AppCreator=__exports.AppCreator=class AppCreator extends Component{static template="web_studio.AppCreator";static components={IconCreator,ModelConfigurator,MenuCreator};static props={onNewAppCreated:{type:Function},};setup(){this.state=useState(new AppCreatorState({onFinished:this.createNewApp.bind(this),}));this.uiService=useService("ui");useAutofocus();useExternalListener(window,"keydown",this.onKeydown);}
async createNewApp(){this.uiService.block();const data=this.state.data;const iconData=data.iconData;const iconValue=iconData.type==="custom_icon"?[iconData.iconClass,iconData.color,iconData.backgroundColor]:iconData.uploaded_attachment_id;try{const result=await rpc("/web_studio/create_new_app",{app_name:data.appName,menu_name:data.menu.menuName,model_choice:data.menu.modelChoice,model_id:data.menu.modelChoice&&data.menu.modelId&&data.menu.modelId[0],model_options:data.modelOptions,icon:iconValue,context:user.context,});await this.props.onNewAppCreated(result);}finally{this.uiService.unblock();}}
onKeydown(ev){if(ev.key==="Enter"&&!(ev.target.classList&&ev.target.classList.contains("o_web_studio_app_creator_previous"))){ev.preventDefault();this.state.next();}}
onConfirmOptions(options){this.state.data.modelOptions=options;return this.state.next();}}
return __exports;});;

/* /web_studio/static/src/client_action/components/font_awesome_icon_selector/font_awesome_icon_selector.js */
odoo.define('@web_studio/client_action/components/font_awesome_icon_selector/font_awesome_icon_selector',['@odoo/owl','@web/core/select_menu/select_menu','@web_studio/utils'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{SelectMenu}=require("@web/core/select_menu/select_menu");const{getFontAwesomeIcons}=require("@web_studio/utils");const FontAwesomeIconSelector=__exports.FontAwesomeIconSelector=class FontAwesomeIconSelector extends Component{static defaultProps={className:"",menuClassName:"",};static template="web_studio.FontAwesomeIconSelector";static props={className:{type:String,optional:true},menuClassName:{type:String,optional:true},value:{type:String},onSelect:{type:Function,optional:true},slots:true,};static components={SelectMenu};setup(){this.ICONS=getFontAwesomeIcons();}
get iconChoices(){return this.ICONS.map((icon)=>{return{label:icon.searchTerms.join(" "),value:icon.className,};});}
getIconTooltip(value){return this.ICONS.find((icon)=>icon.className===value).tooltip;}}
return __exports;});;

/* /web_studio/static/src/client_action/components/sidebar_draggable_item/sidebar_draggable_item.js */
odoo.define('@web_studio/client_action/components/sidebar_draggable_item/sidebar_draggable_item',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const SidebarDraggableItem=__exports.SidebarDraggableItem=class SidebarDraggableItem extends Component{static template="web_studio.SidebarDraggableItem";static props={className:{type:String,optional:true},description:{type:String,optional:true},dropData:{optional:true},string:{type:String},structure:{type:String},};}
return __exports;});;

/* /web_studio/static/src/client_action/components/thumbnail_item/thumbnail_item.js */
odoo.define('@web_studio/client_action/components/thumbnail_item/thumbnail_item',['@odoo/owl','@web/core/dropdown/dropdown'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{Dropdown}=require("@web/core/dropdown/dropdown");const ThumbnailItem=__exports.ThumbnailItem=class ThumbnailItem extends Component{static defaultProps={showMoreMenu:true,onClick:()=>{},canClick:true,};static template="web_studio.ThumbnailItem";static props={className:{type:String,optional:true},showMoreMenu:{type:Boolean,optional:true},icon:{type:Object},onClick:{type:Function,optional:true},canClick:{type:Boolean,optional:true},slots:true,};static components={Dropdown};get hasDropdown(){return this.props.showMoreMenu&&this.props.slots&&this.props.slots.dropdown;}}
return __exports;});;

/* /web_studio/static/src/client_action/editor/app_menu_editor/app_menu_editor.js */
odoo.define('@web_studio/client_action/editor/app_menu_editor/app_menu_editor',['@odoo/owl','@web/core/network/rpc','@web/core/utils/hooks','@web/core/dialog/dialog','@web/core/user','@web/core/utils/nested_sortable','@web/views/view_dialogs/form_view_dialog','@web_studio/client_action/menu_creator/menu_creator','@web_studio/client_action/utils'],function(require){'use strict';let __exports={};const{Component,useRef,useState}=require("@odoo/owl");const{rpc,rpcBus}=require("@web/core/network/rpc");const{useBus,useService,useOwnedDialogs}=require("@web/core/utils/hooks");const{Dialog}=require("@web/core/dialog/dialog");const{user}=require("@web/core/user");const{useNestedSortable}=require("@web/core/utils/nested_sortable");const{FormViewDialog}=require("@web/views/view_dialogs/form_view_dialog");const{MenuCreatorDialog}=require("@web_studio/client_action/menu_creator/menu_creator");const{useDialogConfirmation,useSubEnvAndServices}=require("@web_studio/client_action/utils");const EditMenuDialogProps={...Dialog.props};EditMenuDialogProps.close={type:Function};delete EditMenuDialogProps.slots;class EditMenuDialog extends Component{static components={Dialog};static template="web_studio.AppMenuEditor.EditMenuDialog";static props=EditMenuDialogProps;setup(){const originalBus=this.env.bus;useBus(originalBus,"MENUS:APP-CHANGED",()=>(this.state.tree=this.getTree()));this.menus=useService("menu");this.addDialog=useOwnedDialogs();this.orm=useService("orm");useBus(this.env.bus,"ACTION_MANAGER:UPDATE",()=>this.cancel());this.state=useState({tree:{},flatMenus:{}});this.state.tree=this.getTree();this.toMove={};this.toDelete=[];const root=useRef("root");useNestedSortable({ref:root,handle:".o-draggable-handle",nest:true,maxLevels:5,useElementSize:true,onDrop:this.moveMenu.bind(this),});const{confirm,cancel}=useDialogConfirmation({confirm:async()=>{await this.saveChanges();},});this.confirm=confirm;this.cancel=cancel;}
get flatMenus(){return this.state.flatMenus;}
get mainItem(){return this.state.tree;}
getTree(){let currentApp=this.menus.getCurrentApp();if(!currentApp){return null;}
currentApp=this.menus.getMenuAsTree(currentApp.id);const item=this._getItemFromMenu(currentApp,null);item.isDraggable=false;item.isRemovable=false;return item;}
_getItemFromMenu(menu,parentId){const item={id:menu.id,name:menu.name,isDraggable:true,isRemovable:true,parentId,};item.children=menu.childrenTree.map((menu)=>this._getItemFromMenu(menu,item.id));this.flatMenus[item.id]=item;return item;}
moveMenu({element,parent,previous}){const menuId=parseInt(element.dataset.itemId);const menu=this.flatMenus[menuId];let parentMenu=this.flatMenus[menu.parentId];parentMenu.children=parentMenu.children.filter((m)=>m.id!==menuId);const parentLi=parent?.closest("li");const parentMenuId=parentLi?parseInt(parentLi.dataset.itemId):this.mainItem.id;if(parentMenuId!==parentMenu.id){parentMenu=this.flatMenus[parentMenuId];menu.parentId=parentMenu.id;}
if(previous){const previousMenu=this.flatMenus[previous.dataset.itemId];const index=parentMenu.children.findIndex((child)=>child===previousMenu);parentMenu.children.splice(index+1,0,menu);}else{parentMenu.children.unshift(menu);}
this.toMove[menuId]={parent_menu_id:menu.parentId,};parentMenu.children.forEach((m,index)=>{this.toMove[m.id]=this.toMove[m.id]||{};this.toMove[m.id].sequence=index+1;});}
removeItem(menu){const parentMenu=this.flatMenus[menu.parentId];if(!parentMenu){return;}
parentMenu.children=parentMenu.children.filter((m)=>m.id!==menu.id);this.toDelete.push(menu.id);}
editItem(menu){this.addDialog(FormViewDialog,{resModel:"ir.ui.menu",resId:menu.id,onRecordSaved:async()=>{await this.saveChanges(true);},});}
async saveChanges(reload=false){if(Object.keys(this.toMove).length||this.toDelete.length){await this.orm.call("ir.ui.menu","customize",[],{to_move:this.toMove,to_delete:this.toDelete,});reload=true;}
if(reload){await this.menus.reload();}}
onNewMenu(){this.addDialog(MenuCreatorDialog,{confirm:async(data)=>{await rpc("/web_studio/create_new_menu",{menu_name:data.menuName,model_id:data.modelId[0],model_choice:data.modelChoice,model_options:data.modelOptions||{},parent_menu_id:this.mainItem.id,context:user.context,});rpcBus.trigger("CLEAR-CACHES");this.menus.reload();},});}}
const AppMenuEditor=__exports.AppMenuEditor=class AppMenuEditor extends Component{static props={env:{type:Object},};static template="web_studio.AppMenuEditor";setup(){this.menus=useService("menu");const bus=this.env.bus;useSubEnvAndServices(this.props.env);this.addDialog=useOwnedDialogs();useBus(bus,"MENUS:APP-CHANGED",()=>this.render());}
onClick(ev){ev.preventDefault();this.addDialog(EditMenuDialog);}}
return __exports;});;

/* /web_studio/static/src/client_action/editor/edition_flow.js */
odoo.define('@web_studio/client_action/editor/edition_flow',['@web/core/l10n/translation','@web/core/network/rpc','@odoo/owl','@web_studio/client_action/utils','@web/core/confirmation_dialog/confirmation_dialog','@web/core/utils/concurrency'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{rpc,rpcBus}=require("@web/core/network/rpc");const{toRaw,useState,useEnv,reactive,onMounted,onWillUnmount,markRaw}=require("@odoo/owl");const{Reactive}=require("@web_studio/client_action/utils");const{ConfirmationDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{KeepLast}=require("@web/core/utils/concurrency");const EditionFlow=__exports.EditionFlow=class EditionFlow extends Reactive{constructor(env,services){super();this.env=env;for(const[servName,serv]of Object.entries(services)){this[servName]=serv;}
this.setup();}
setup(){let requestId;const updateBreadcrumbs=(studio)=>{if(studio.requestId!==requestId){this.breadcrumbs=[];}
requestId=studio.requestId;};const studio=reactive(this.studio,()=>updateBreadcrumbs(studio));this.studio=studio;this.breadcrumbs=[];updateBreadcrumbs(studio);}
pushBreadcrumb(crumb){const bcLength=this.breadcrumbs.length;const handler=()=>{this.breadcrumbs.length=bcLength+1;this.studio.setParams({},false);};this.breadcrumbs.push({data:crumb,handler});}
async loadViews({forceSearch=false}={}){const editedAction=this.studio.editedAction;const{context,res_model,id}=editedAction;const views=[...editedAction.views];if(forceSearch&&!views.some((tuple)=>tuple[1]==="search")){views.push([false,"search"]);}
const newContext={...context,lang:false};const options={loadIrFilters:true,loadActionMenus:false,id,studio:true};const res=await this.view.loadViews({resModel:res_model,views,context:newContext},options);return JSON.parse(JSON.stringify(res));}
restoreDefaultView(viewId,viewType){return new Promise((resolve)=>{const confirm=async()=>{if(!viewId&&viewType){const result=await this.loadViews();viewId=result.views[viewType].id;}
const res=await rpc("/web_studio/restore_default_view",{view_id:viewId,});rpcBus.trigger("CLEAR-CACHES");resolve(res);};this.dialog.add(ConfirmationDialog,{body:_t("Are you sure you want to restore the default view?\r\nAll customization done with studio on this view will be lost."),confirm,cancel:()=>resolve(false),});});}}
__exports.useEditorBreadcrumbs=useEditorBreadcrumbs;function useEditorBreadcrumbs(initialCrumb){const env=useEnv();const editionFlow=env.editionFlow;if(initialCrumb&&!editionFlow.breadcrumbs.length){onMounted(()=>editionFlow.pushBreadcrumb(initialCrumb));}
const crumbs=useState(editionFlow.breadcrumbs);const push=(crumb)=>editionFlow.pushBreadcrumb(crumb);return{crumbs,push};}
__exports.useEditorMenuItem=useEditorMenuItem;function useEditorMenuItem(MenuItem){const editionFlow=useEnv().editionFlow;onMounted(()=>{editionFlow.MenuItem=MenuItem;});onWillUnmount(()=>{if(toRaw(editionFlow).MenuItem===MenuItem){editionFlow.MenuItem=null;}});}
const SnackbarIndicator=__exports.SnackbarIndicator=class SnackbarIndicator extends Reactive{constructor(){super();this.state="";this.keepLast=markRaw(new KeepLast());}
add(prom){this.state="loading";const raw=this.raw();this.pending=Promise.all([raw.pending,prom]);this.keepLast.add(raw.pending).then(()=>(this.state="loaded")).catch(()=>{this.state="error";}).finally(()=>{this.pending=null;});return prom;}}
const EditorOperations=__exports.EditorOperations=class EditorOperations extends Reactive{constructor(params){super();this.operations=[];this.undone=[];this._lock="";this._keepLast=markRaw(new KeepLast());this._callbacks={do:params.do,onError:params.onError,onDone:params.onDone,};}
get canUndo(){return this.operations.length||(this.pending&&this.pending.length);}
get canRedo(){return this.undone.length||(this.pendingUndone&&this.pendingUndone.length);}
_wrapPromise(prom){return this._keepLast.add(prom);}
_prepare(mode){const raw=this.raw();const lock=raw._lock;if(lock&&lock!==mode){this._wrapPromise(Promise.resolve());this._close();return false;}
this._lock=mode;const pending=raw.pending;if(!pending){this.pending=[...raw.operations];this.pendingUndone=[...raw.undone];}
return true;}
async _do(mode,pending,lastOp){let result;let error;try{result=await this._wrapPromise(this._callbacks.do({mode,operations:pending,lastOp}));}catch(e){error=e;}
if(error){return{error};}
return{result};}
_close(done=null){const raw=this.raw();const mode=raw._lock;this._lock=null;const pending=raw.pending;const pendingUndone=raw.pendingUndone;this.pending=null;this.pendingUndone=null;if(!done){return;}
if("result"in done){this.operations=pending;this.undone=pendingUndone;if(typeof done.result!=="boolean"){return this._callbacks.onDone({mode,pending,pendingUndone,result:done.result,});}}
if("error"in done){return this._callbacks.onError({mode,pending,error:done.error});}}
async undo(canRedo=true){if(!this._prepare("undo")){this._close();return;}
const ops=this.raw().pending;if(!ops||!ops.length){this._close();return;}
const op=ops.pop();if(canRedo){this.pendingUndone.push(op);}
const done=await this._do("undo",this.raw().pending,op);this._close(done);}
pushOp(op){this.operations.push(op);}
async redo(){if(!this._prepare("redo")){this._close();return;}
const ops=this.raw().pendingUndone;if(!ops||!ops.length){this._close();return;}
const op=ops.pop();this.pending.push(op);const done=await this._do("do",this.raw().pending,op);this._close(done);}
async doMulti(ops=[]){if(!ops.length){return;}
let prom;for(let i=0;i<ops.length;i++){let silent=true;if(i===ops.length-1){silent=false;}
prom=this.do(ops[i],silent);}
return prom;}
async do(op,silent=false){if(!this._prepare("do")||!op){this._close();return;}
this.pending.push(op);this.pendingUndone=[];let done={};if(!silent){done=await this._do("do",this.raw().pending,op);}else{done={result:true};}
this._close(done);}
clear(all=true){this.operations=[];if(all){this.undone=[];}}}
return __exports;});;

/* /web_studio/static/src/client_action/editor/editor.js */
odoo.define('@web_studio/client_action/editor/editor',['@odoo/owl','@web/core/registry','@web/webclient/actions/action_service','@web/core/utils/hooks','@web_studio/client_action/editor/studio_action_container','@web_studio/client_action/editor/editor_menu/editor_menu','@web_studio/client_action/editor/app_menu_editor/app_menu_editor','@web_studio/client_action/editor/new_model_item/new_model_item','@web_studio/client_action/editor/edition_flow','@web_studio/studio_service','@web_studio/client_action/utils','@web/core/utils/objects'],function(require){'use strict';let __exports={};const{Component,EventBus,onWillDestroy,useState,useSubEnv,xml}=require("@odoo/owl");const{registry}=require("@web/core/registry");const{makeActionManager}=require("@web/webclient/actions/action_service");const{useBus,useService}=require("@web/core/utils/hooks");const{StudioActionContainer}=require("@web_studio/client_action/editor/studio_action_container");const{EditorMenu}=require("@web_studio/client_action/editor/editor_menu/editor_menu");const{AppMenuEditor}=require("@web_studio/client_action/editor/app_menu_editor/app_menu_editor");const{NewModelItem}=require("@web_studio/client_action/editor/new_model_item/new_model_item");const{EditionFlow}=require("@web_studio/client_action/editor/edition_flow");const{useStudioServiceAsReactive}=require("@web_studio/studio_service");const{useSubEnvAndServices,useServicesOverrides}=require("@web_studio/client_action/utils");const{omit}=require("@web/core/utils/objects");class DialogWithEnv extends Component{static template=xml`<t t-component="props.Component" t-props="componentProps" />`;static props=["*"];setup(){useSubEnvAndServices(this.props.env);}
get componentProps(){const additionalProps=omit(this.props,"Component","env","componentProps");return{...this.props.componentProps,...additionalProps};}}
const dialogService={dependencies:["dialog"],start(env,{dialog}){function addDialog(Component,_props,options){const props={env,Component,componentProps:_props};return dialog.add(DialogWithEnv,props,options);}
return{...dialog,add:addDialog};},};const actionServiceStudio={dependencies:["studio","dialog"],start(env,{studio}){const router={current:{hash:{}},pushState(){},stateToUrl(){},hideKeyFromUrl:()=>{},};const action=makeActionManager(env,router);const _doAction=action.doAction;async function doAction(actionRequest,options){if(actionRequest==="web_studio.action_edit_report"){return studio.setParams({editedReport:options.report,});}
return _doAction(...arguments);}
return Object.assign(action,{doAction});},};const menuButtonsRegistry=registry.category("studio_navbar_menubuttons");const Editor=__exports.Editor=class Editor extends Component{static template="web_studio.Editor";static props={};static components={EditorMenu,StudioActionContainer,};static menuButtonsId=1;setup(){const globalBus=this.env.bus;const newBus=new EventBus();useBus(globalBus,"CLEAR-UNCOMMITTED-CHANGES",(ev)=>newBus.trigger("CLEAR-UNCOMMITTED-CHANGES",ev.detail));useBus(globalBus,"MENUS:APP-CHANGED",(ev)=>newBus.trigger("MENUS:APP-CHANGED",ev.detail));useSubEnv({bus:newBus,});useServicesOverrides({dialog:dialogService,action:actionServiceStudio,});this.studio=useService("studio");const editionFlow=new EditionFlow(this.env,{dialog:useService("dialog"),studio:useStudioServiceAsReactive(),view:useService("view"),});useSubEnv({editionFlow,});this.actionService=useService("action");this.state=useState({actionContainerId:1});useBus(this.studio.bus,"UPDATE",async()=>{this.state.actionContainerId++;});menuButtonsRegistry.getEntries().forEach(([name])=>{if(name.startsWith("app_menu_editor_")||name.startsWith("new_model_item_")){menuButtonsRegistry.remove(name);}});const menuButtonsId=this.constructor.menuButtonsId++;menuButtonsRegistry.add(`app_menu_editor_${menuButtonsId}`,{Component:AppMenuEditor,props:{env:this.env},});menuButtonsRegistry.add(`new_model_item_${menuButtonsId}`,{Component:NewModelItem});onWillDestroy(()=>{menuButtonsRegistry.remove(`app_menu_editor_${menuButtonsId}`);menuButtonsRegistry.remove(`new_model_item_${menuButtonsId}`);});}
switchView({viewType}){this.studio.setParams({viewType,editorTab:"views"});}
switchViewLegacy(ev){this.studio.setParams({viewType:ev.detail.view_type});}
switchTab({tab}){this.studio.setParams({editorTab:tab});}}
return __exports;});;

/* /web_studio/static/src/client_action/editor/editor_menu/editor_menu.js */
odoo.define('@web_studio/client_action/editor/editor_menu/editor_menu',['@web/core/l10n/translation','@web/core/l10n/localization','@web/core/registry','@odoo/owl','@web_studio/studio_service'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{localization}=require("@web/core/l10n/localization");const{registry}=require("@web/core/registry");const{Component,useState}=require("@odoo/owl");const{useStudioServiceAsReactive}=require("@web_studio/studio_service");const editorTabRegistry=registry.category("web_studio.editor_tabs");class Breadcrumbs extends Component{static template="web_studio.EditorMenu.Breadcrumbs";static props={currentTab:{type:Object},switchTab:Function,};setup(){this.editionFlow=useState(this.env.editionFlow);this.nextCrumbId=1;}
get breadcrumbs(){const currentTab=this.props.currentTab;const crumbs=[{data:{name:currentTab.name,},handler:()=>this.props.switchTab({tab:currentTab.id}),},];const breadcrumbs=this.editionFlow.breadcrumbs;breadcrumbs.forEach((crumb)=>{crumbs.push(crumb);});for(const crumb of crumbs){crumb.id=this.nextCrumbId++;}
return crumbs;}}
const EditorMenu=__exports.EditorMenu=class EditorMenu extends Component{static props={switchTab:Function,switchView:Function,};static template="web_studio.EditorMenu";static viewTypes=[{title:_t("Form"),type:"form",iconClasses:"fa fa-address-card",},{title:_t("List"),type:"list",iconClasses:"oi oi-view-list",},{title:_t("Kanban"),type:"kanban",iconClasses:"oi oi-view-kanban",},{title:_t("Map"),type:"map",iconClasses:"fa fa-map-marker",},{title:_t("Calendar"),type:"calendar",iconClasses:"fa fa-calendar",},{title:_t("Graph"),type:"graph",iconClasses:"fa fa-area-chart",},{title:_t("Pivot"),type:"pivot",iconClasses:"oi oi-view-pivot",},{title:_t("Gantt"),type:"gantt",iconClasses:"fa fa-tasks",},{title:_t("Cohort"),type:"cohort",iconClasses:"oi oi-view-cohort",},{title:_t("Activity"),type:"activity",iconClasses:"fa fa-clock-o",},{title:_t("Search"),type:"search",iconClasses:"oi oi-search",},];static components={Breadcrumbs};setup(){this.l10n=localization;this.studio=useStudioServiceAsReactive();this.editionFlow=useState(this.env.editionFlow);}
get activeViews(){const action=this.studio.editedAction;const viewTypes=(action._views||action.views).map(([,type])=>type);return this.constructor.viewTypes.filter((vt)=>viewTypes.includes(vt.type));}
get editorTabs(){const entries=editorTabRegistry.getEntries();return entries.map((entry)=>Object.assign({},entry[1],{id:entry[0]}));}
get currentTab(){return this.editorTabs.find((tab)=>tab.id===this.studio.editorTab);}
openTab(tab){this.props.switchTab({tab});}}
editorTabRegistry.add("views",{name:_t("Views"),action:"web_studio.action_editor"},{sequence:10}).add("automations",{name:_t("Automations")},{sequence:20}).add("actions_server",{name:_t("Actions")},{sequence:30}).add("automation_webhooks",{name:_t("Webhooks")},{sequence:40}).add("acl",{name:_t("Access Control")},{sequence:50}).add("filters",{name:_t("Filter Rules")},{sequence:60});return __exports;});;

/* /web_studio/static/src/client_action/editor/new_model_item/new_model_item.js */
odoo.define('@web_studio/client_action/editor/new_model_item/new_model_item',['@odoo/owl','@web/core/l10n/translation','@web/core/network/rpc','@web/core/user','@web/core/utils/hooks','@web/core/dialog/dialog','@web_studio/client_action/model_configurator/model_configurator','@web_studio/client_action/utils'],function(require){'use strict';let __exports={};const{Component,useState}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{rpc}=require("@web/core/network/rpc");const{user}=require("@web/core/user");const{useBus,useService,useOwnedDialogs}=require("@web/core/utils/hooks");const{Dialog}=require("@web/core/dialog/dialog");const{ModelConfiguratorDialog}=require("@web_studio/client_action/model_configurator/model_configurator");const{useDialogConfirmation}=require("@web_studio/client_action/utils");class SimpleNewModelDialog extends Component{static template="web_studio.SimpleNewModelDialog";static components={Dialog};static props={close:{type:Function}};setup(){this.addDialog=useOwnedDialogs();this.menus=useService("menu");this.action=useService("action");this.studio=useService("studio");this.state=useState({modelName:"",showValidation:false});const{confirm,cancel}=useDialogConfirmation({confirm:async(data)=>{const{menu_id,action_id}=await rpc("/web_studio/create_new_menu",{menu_name:this.state.modelName,model_id:false,model_choice:"new",model_options:data.modelOptions,parent_menu_id:this.menus.getCurrentApp().id,context:user.context,});await this.menus.reload();const action=await this.action.loadAction(action_id);this.menus.setCurrentMenu(menu_id);this.studio.setParams({action,viewType:"form"});},});this._confirm=confirm;this._cancel=cancel;}
confirm(data={}){this.props.close();return this._confirm(data);}
onConfigureModel(){if(!this.state.modelName){this.state.showValidation=true;return;}
this.addDialog(ModelConfiguratorDialog,{confirmLabel:_t("Create Model"),confirm:(data)=>{this.confirm({modelOptions:data});},});}}
const NewModelItem=__exports.NewModelItem=class NewModelItem extends Component{static props={};static template="web_studio.NewModelItem";setup(){this.addDialog=useOwnedDialogs();this.menus=useService("menu");this.studio=useService("studio");this.action=useService("action");useBus(this.env.bus,"MENUS:APP-CHANGED",()=>this.render());}
onClick(ev){ev.preventDefault();this.addDialog(SimpleNewModelDialog);}}
return __exports;});;

/* /web_studio/static/src/client_action/editor/new_view_dialogs/map_new_view_dialog.js */
odoo.define('@web_studio/client_action/editor/new_view_dialogs/map_new_view_dialog',['@web/core/l10n/translation','@web_studio/client_action/editor/new_view_dialogs/new_view_dialog','@web/core/utils/hooks','@web/core/confirmation_dialog/confirmation_dialog'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{NewViewDialog}=require("@web_studio/client_action/editor/new_view_dialogs/new_view_dialog");const{useService}=require("@web/core/utils/hooks");const{AlertDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const MapNewViewDialog=__exports.MapNewViewDialog=class MapNewViewDialog extends NewViewDialog{static template="web_studio.MapNewViewDialog";static props={...NewViewDialog.props,};setup(){super.setup();this.dialog=useService("dialog");this.fieldsChoice={res_partner:null,};}
get viewType(){return"map";}
computeSpecificFields(fields){this.partnerFields=fields.filter((field)=>field.type==="many2one"&&field.relation==="res.partner");if(!this.partnerFields.length){this.dialog.add(AlertDialog,{title:_t("Contact Field Required"),body:_t("Map views are based on the address of a linked Contact. You need to have a Many2one field linked to the res.partner model in order to create a map view."),contentClass:"o_web_studio_preserve_space",});this.props.close();}else{this.fieldsChoice.res_partner=this.partnerFields[0].name;}}}
delete MapNewViewDialog.props.viewType;return __exports;});;

/* /web_studio/static/src/client_action/editor/new_view_dialogs/new_view_dialog.js */
odoo.define('@web_studio/client_action/editor/new_view_dialogs/new_view_dialog',['@web/core/l10n/translation','@web/core/network/rpc','@web/core/utils/hooks','@web/core/confirmation_dialog/confirmation_dialog','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{rpc}=require("@web/core/network/rpc");const{useService}=require("@web/core/utils/hooks");const{ConfirmationDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{onWillStart}=require("@odoo/owl");const NewViewDialog=__exports.NewViewDialog=class NewViewDialog extends ConfirmationDialog{static template="web_studio.NewViewDialog";static GROUPABLE_TYPES=["many2one","char","boolean","selection","date","datetime"];static MEASURABLE_TYPES=["integer","float"];static props={...ConfirmationDialog.props,viewType:String,};setup(){super.setup();this.orm=useService("orm");this.studio=useService("studio");this.mandatoryStopDate=["gantt","cohort"].includes(this.viewType);this.title=_t("Generate %s View",this.viewType);this.fieldsChoice={date_start:null,date_stop:null,};onWillStart(async()=>{const fieldsGet=await this.orm.call(this.studio.editedAction.res_model,"fields_get");const fields=Object.entries(fieldsGet).map(([fName,field])=>{field.name=fName;return field;});fields.sort((first,second)=>{if(first.string===second.string){return 0;}
if(first.string<second.string){return-1;}
if(first.string>second.string){return 1;}});this.computeSpecificFields(fields);});}
get viewType(){return this.props.viewType;}
computeSpecificFields(fields){this.dateFields=[];this.rowFields=[];this.measureFields=[];fields.forEach((field)=>{if(field.store){if(field.type==="date"||field.type==="datetime"){this.dateFields.push(field);}
if(this.constructor.GROUPABLE_TYPES.includes(field.type)){this.rowFields.push(field);}
if(this.constructor.MEASURABLE_TYPES.includes(field.type)){if(field.name!=="id"&&field.name!=="sequence"){this.measureFields.push(field);}}}});if(this.dateFields.length){this.fieldsChoice.date_start=this.dateFields[0].name;this.fieldsChoice.date_stop=this.dateFields[0].name;}}
async _confirm(){await rpc("/web_studio/create_default_view",{model:this.studio.editedAction.res_model,view_type:this.viewType,attrs:this.fieldsChoice,});super._confirm();}}
delete NewViewDialog.props.body;return __exports;});;

/* /web_studio/static/src/client_action/editor/studio_action_container.js */
odoo.define('@web_studio/client_action/editor/studio_action_container',['@web/webclient/actions/action_container','@web/core/utils/hooks','@web/core/registry','@web/core/network/rpc','@web/core/utils/concurrency','@odoo/owl','@web_studio/studio_service','@web/views/view_compiler'],function(require){'use strict';let __exports={};const{ActionContainer}=require("@web/webclient/actions/action_container");const{useService}=require("@web/core/utils/hooks");const{registry}=require("@web/core/registry");const{rpc}=require("@web/core/network/rpc");const{KeepLast}=require("@web/core/utils/concurrency");const{Component,markup,onWillStart,onWillUnmount,onWillUpdateProps,xml}=require("@odoo/owl");const{useStudioServiceAsReactive}=require("@web_studio/studio_service");const{resetViewCompilerCache}=require("@web/views/view_compiler");const editorTabRegistry=registry.category("web_studio.editor_tabs");const StudioActionContainer=__exports.StudioActionContainer=class StudioActionContainer extends Component{static props={...ActionContainer.props,reloadId:{type:Number},};static template=xml`
        <t t-name="web.ActionContainer">
        <div class="o_action_manager">
            <t t-if="info.Component" t-component="info.Component" className="'o_action'" t-props="info.componentProps" t-key="info.id"/>
        </div>
        </t>`;setup(){this.actionService=useService("action");this.studio=useStudioServiceAsReactive();this.info={};let actionKey=1;const onUiUpdate=({detail:info})=>{this.info=info;actionKey++;this.render();};this.env.bus.addEventListener("ACTION_MANAGER:UPDATE",onUiUpdate);onWillUnmount(()=>this.env.bus.removeEventListener("ACTION_MANAGER:UPDATE",onUiUpdate));const doAction=async(action,options)=>{try{await this.actionService.doAction(action,options);this.actionKey=actionKey;}catch(e){if(action!=="web_studio.action_editor"){this.studio.setParams({editorTab:"views"});}
throw e;}};onWillStart(async()=>{const action=await this.getStudioAction();this.studioKey=this.studio.requestId;doAction(action);await Promise.resolve();});const willUpdateKeepLast=new KeepLast();onWillUpdateProps(async()=>{if(this.studio.requestId!==this.studioKey||this.actionKey!==actionKey){const action=await willUpdateKeepLast.add(this.getStudioAction());resetViewCompilerCache();return new Promise((_resolve)=>{const resolve=()=>{this.env.bus.removeEventListener("ACTION_MANAGER:UPDATE",resolve);_resolve();};this.studioKey=this.studio.requestId;doAction(action,{clearBreadcrumbs:true,noEmptyTransition:true}).finally(()=>{this.env.bus.removeEventListener("ACTION_MANAGER:UPDATE",resolve);});this.env.bus.addEventListener("ACTION_MANAGER:UPDATE",resolve);});}});}
async getStudioAction(){const{editorTab,editedAction,editedReport,editedViewType}=this.studio;const tab=editorTabRegistry.get(editorTab);if(editorTab==="views"){if(editedViewType){return"web_studio.view_editor";}
return tab.action;}
if(tab.action){const action=tab.action;return action instanceof Function?action(this.env):action;}else if(editorTab==="reports"&&editedReport){return"web_studio.report_editor";}else{const action=await rpc("/web_studio/get_studio_action",{action_name:editorTab,model:editedAction.res_model,view_id:editedAction.view_id&&editedAction.view_id[0],});action.help=action.help&&markup(action.help);return action;}}}
return __exports;});;

/* /web_studio/static/src/client_action/icon_creator/icon_creator.js */
odoo.define('@web_studio/client_action/icon_creator/icon_creator',['@web_studio/utils','@web/core/dropdown/dropdown','@web/core/select_menu/select_menu','@web/core/file_input/file_input','@web/core/user','@web/core/utils/hooks','@web_studio/client_action/components/font_awesome_icon_selector/font_awesome_icon_selector','@odoo/owl'],function(require){'use strict';let __exports={};const{COLORS,BG_COLORS}=require("@web_studio/utils");const{Dropdown}=require("@web/core/dropdown/dropdown");const{SelectMenu}=require("@web/core/select_menu/select_menu");const{FileInput}=require("@web/core/file_input/file_input");const{user}=require("@web/core/user");const{useService}=require("@web/core/utils/hooks");const{FontAwesomeIconSelector}=require("@web_studio/client_action/components/font_awesome_icon_selector/font_awesome_icon_selector");const{Component}=require("@odoo/owl");const DEFAULT_ICON=__exports.DEFAULT_ICON={backgroundColor:BG_COLORS[0],color:COLORS[10],iconClass:"fa fa-home",type:"custom_icon",};const IconCreator=__exports.IconCreator=class IconCreator extends Component{static components={Dropdown,FileInput,FontAwesomeIconSelector,SelectMenu,};static defaultProps=DEFAULT_ICON;static props={backgroundColor:{type:String,optional:1},color:{type:String,optional:1},editable:{type:Boolean,optional:1},iconClass:{type:String,optional:1},type:{validate:(t)=>["base64","custom_icon"].includes(t),optional:1},uploaded_attachment_id:{type:Number,optional:1},webIconData:{type:String,optional:1},onIconChange:Function,};static template="web_studio.IconCreator";setup(){this.orm=useService("orm");this.fileInputProps={acceptedFileExtensions:"image/png",resModel:"res.users",resId:user.userId,};}
get backgroundColorChoices(){return this.getChoices(BG_COLORS);}
get colorChoices(){return this.getChoices(COLORS);}
getChoices(object){return object.map((color)=>{return{label:color,value:color,};});}
onDesignIconClick(){this.props.onIconChange(DEFAULT_ICON);}
async onFileUploaded([file]){if(!file){return;}
const res=await this.orm.read("ir.attachment",[file.id],["datas"]);this.props.onIconChange({type:"base64",uploaded_attachment_id:file.id,webIconData:"data:image/png;base64,"+res[0].datas.replace(/\s/g,""),});}
onPaletteItemClick(palette,value){if(this.props[palette]===value){return;}
this.props.onIconChange({backgroundColor:this.props.backgroundColor,color:this.props.color,iconClass:this.props.iconClass,type:"custom_icon",[palette]:value,});}}
return __exports;});;

/* /web_studio/static/src/client_action/menu_creator/menu_creator.js */
odoo.define('@web_studio/client_action/menu_creator/menu_creator',['@odoo/owl','@web/core/utils/hooks','@web/core/dialog/dialog','@web/core/l10n/translation','@web_studio/client_action/utils','@web_studio/client_action/model_configurator/model_configurator','@web/core/record_selectors/record_selector'],function(require){'use strict';let __exports={};const{Component,useState}=require("@odoo/owl");const{useOwnedDialogs,useAutofocus}=require("@web/core/utils/hooks");const{Dialog}=require("@web/core/dialog/dialog");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{useDialogConfirmation}=require("@web_studio/client_action/utils");const{ModelConfiguratorDialog}=require("@web_studio/client_action/model_configurator/model_configurator");const{RecordSelector}=require("@web/core/record_selectors/record_selector");const MenuCreatorModel=__exports.MenuCreatorModel=class MenuCreatorModel{constructor({allowNoModel}={}){this.data={modelId:false,menuName:"",modelChoice:"new",};this.modelChoiceSelection={new:_t("New Model"),existing:_t("Existing Model"),};if(allowNoModel){this.modelChoiceSelection.parent=_t("Parent Menu");}}
validateField(fieldName){if(fieldName==="menuName"){return!!this.data.menuName;}else if(fieldName==="modelId"){return this.data.modelChoice==="existing"?!!this.data.modelId:true;}}
get isValid(){return["menuName","modelId"].every((fName)=>this.validateField(fName));}}
const MenuCreator=__exports.MenuCreator=class MenuCreator extends Component{static template="web_studio.MenuCreator";static components={RecordSelector};static props={menuCreatorModel:{type:Object},showValidation:{type:Boolean,optional:true},};static defaultProps={showValidation:false,};get multiRecordSelectorProps(){return{resModel:"ir.model",resId:this.state.data.modelId&&this.state.data.modelId[0],update:(resId)=>(this.state.data.modelId=[resId]),domain:[["transient","=",false],["abstract","=",false],],};}
setup(){useAutofocus();this.state=useState(this.props.menuCreatorModel);}
isValid(fieldName){return this.props.showValidation?this.state.validateField(fieldName):true;}}
const MenuCreatorDialog=__exports.MenuCreatorDialog=class MenuCreatorDialog extends Component{static template="web_studio.MenuCreatorDialog";static components={Dialog,MenuCreator};static props={confirm:{type:Function},close:{type:Function}};setup(){this.addDialog=useOwnedDialogs();this.menuCreatorModel=useState(new MenuCreatorModel({allowNoModel:true}));this.state=useState({showValidation:false});const{confirm,cancel}=useDialogConfirmation({confirm:async(data={})=>{if(!this.menuCreatorModel.isValid){this.state.showValidation=true;return false;}
await this.props.confirm(data);},});this._confirm=confirm;this._cancel=cancel;}
confirm(data={}){this._confirm({...this.menuCreatorModel.data,...data});}
onCreateNewModel(){if(!this.menuCreatorModel.isValid){this.state.showValidation=true;return;}
this.addDialog(ModelConfiguratorDialog,{confirmLabel:_t("Create Menu"),confirm:(data)=>{this.confirm({modelOptions:data});},});}}
return __exports;});;

/* /web_studio/static/src/client_action/model_configurator/model_configurator.js */
odoo.define('@web_studio/client_action/model_configurator/model_configurator',['@web/core/dialog/dialog','@odoo/owl','@web/core/user','@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{Component,useState}=require("@odoo/owl");const{user}=require("@web/core/user");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);function getModelOptions(isMultiCompany){const modelOptions={use_partner:{label:_t("Contact details"),help:_t("Get contact, phone and email fields on records"),value:false,},use_responsible:{label:_t("User assignment"),help:_t("Assign a responsible to each record"),value:false,},use_date:{label:_t("Date & Calendar"),help:_t("Assign dates and visualize records in a calendar"),value:false,},use_double_dates:{label:_t("Date range & Gantt"),help:_t("Define start/end dates and visualize records in a Gantt chart"),value:false,},use_stages:{label:_t("Pipeline stages"),help:_t("Stage and visualize records in a custom pipeline"),value:false,},use_tags:{label:_t("Tags"),help:_t("Categorize records with custom tags"),value:false,},use_image:{label:_t("Picture"),help:_t("Attach a picture to a record"),value:false,},lines:{label:_t("Lines"),help:_t("Add details to your records with an embedded list view"),value:false,},use_notes:{label:_t("Notes"),help:_t("Write additional notes or comments"),value:false,},use_value:{label:_t("Monetary value"),help:_t("Set a price or cost on records"),value:false,},use_company:{label:_t("Company"),help:_t("Restrict a record to a specific company"),value:false,},use_sequence:{label:_t("Custom Sorting"),help:_t("Manually sort records in the kanban and list view"),value:true,},use_mail:{label:_t("Chatter"),help:_t("Send messages, log notes and schedule activities"),value:true,},use_active:{label:_t("Archiving"),help:_t("Archive deprecated records"),value:true,},};if(!isMultiCompany){delete modelOptions.use_company;}
return modelOptions;}
const ModelConfigurator=__exports.ModelConfigurator=class ModelConfigurator extends Component{static template="web_studio.ModelConfigurator";static components={};static props={embed:{type:Boolean,optional:true},label:{type:String},onConfirmOptions:Function,onPrevious:Function,};setup(){this.state=useState({saving:false});this.options=useState(getModelOptions(user.allowedCompanies.length>1));}
async onConfirm(){try{this.state.saving=true;const mappedOptions=Object.entries(this.options).filter((opt)=>opt[1].value).map((opt)=>opt[0]);await this.props.onConfirmOptions(mappedOptions);}finally{this.state.saving=false;}}}
const ModelConfiguratorDialog=__exports.ModelConfiguratorDialog=class ModelConfiguratorDialog extends Component{static components={Dialog,ModelConfigurator};static template="web_studio.ModelConfiguratorDialog";static props={confirm:{type:Function},close:{type:Function},confirmLabel:{type:String,optional:true},};async onConfirm(data){await this.props.confirm(data);this.props.close();}
onPrevious(){this.props.close();}}
return __exports;});;

/* /web_studio/static/src/client_action/navbar/home_menu_customizer/home_menu_customizer.js */
odoo.define('@web_studio/client_action/navbar/home_menu_customizer/home_menu_customizer',['@web/core/l10n/translation','@web/core/network/rpc','@web/core/user','@web/core/utils/hooks','@web/core/browser/browser','@web/core/confirmation_dialog/confirmation_dialog','@web/core/file_input/file_input','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{rpc}=require("@web/core/network/rpc");const{user}=require("@web/core/user");const{useService}=require("@web/core/utils/hooks");const{browser}=require("@web/core/browser/browser");const{ConfirmationDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{FileInput}=require("@web/core/file_input/file_input");const{Component}=require("@odoo/owl");const HomeMenuCustomizer=__exports.HomeMenuCustomizer=class HomeMenuCustomizer extends Component{static template="web_studio.HomeMenuCustomizer";static props={};static components={FileInput};setup(){this.ui=useService("ui");this.notification=useService("notification");this.actionManager=useService("action");this.menus=useService("menu");this.dialogManager=useService("dialog");this.user=user;}
setBackgroundImage(attachment_id){return rpc("/web_studio/set_background_image",{attachment_id:attachment_id,context:user.context,});}
exportCusto(){this.actionManager.doAction("web_studio.action_studio_export_wizard");}
importCusto(){const action={name:"Import modules",res_model:"base.import.module",views:[[false,"form"]],type:"ir.actions.act_window",target:"new",context:{dialog_size:"medium",},};const options={onClose:()=>this.menus.reload(),};this.actionManager.doAction(action,options);}
async confirmReset(){this.ui.block();try{await rpc("/web_studio/reset_background_image",{context:user.context,});browser.location.reload();}finally{this.ui.unblock();}}
resetBackground(){this.dialogManager.add(ConfirmationDialog,{body:_t("Are you sure you want to reset the background image?"),title:_t("Confirmation"),confirm:()=>this.confirmReset(),});}
async onBackgroundUpload([file]){if(!file){this.notification.add(_t("Could not change the background"),{sticky:true,type:"warning",});}else{this.ui.block();try{await this.setBackgroundImage(file.id);browser.location.reload();}finally{this.ui.unblock();}}}}
return __exports;});;

/* /web_studio/static/src/client_action/navbar/navbar.js */
odoo.define('@web_studio/client_action/navbar/navbar',['@web/core/l10n/translation','@odoo/owl','@web/core/registry','@web/core/utils/hooks','@web_enterprise/webclient/navbar/navbar','@web_studio/client_action/navbar/home_menu_customizer/home_menu_customizer','@web_studio/studio_service'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{onMounted,onWillUnmount}=require("@odoo/owl");const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{EnterpriseNavBar}=require("@web_enterprise/webclient/navbar/navbar");const{HomeMenuCustomizer}=require("@web_studio/client_action/navbar/home_menu_customizer/home_menu_customizer");const{useStudioServiceAsReactive,NotEditableActionError}=require("@web_studio/studio_service");const menuButtonsRegistry=registry.category("studio_navbar_menubuttons");const StudioNavbar=__exports.StudioNavbar=class StudioNavbar extends EnterpriseNavBar{static template="web_studio.StudioNavbar";static components={...EnterpriseNavBar.components,HomeMenuCustomizer,};setup(){super.setup();this.studio=useStudioServiceAsReactive();this.actionManager=useService("action");this.dialogManager=useService("dialog");this.notification=useService("notification");onMounted(()=>{this.env.bus.removeEventListener("HOME-MENU:TOGGLED",this._busToggledCallback);this._updateMenuAppsIcon();});const onMenuButtonsUpdate=()=>this.render();menuButtonsRegistry.addEventListener("UPDATE",onMenuButtonsUpdate);onWillUnmount(()=>menuButtonsRegistry.removeEventListener("UPDATE",onMenuButtonsUpdate));}
onMenuToggle(){this.studio.toggleHomeMenu();}
closeStudio(){this.studio.leave();}
async onNavBarDropdownItemSelection(menu){if(menu.actionID){try{await this.studio.open(this.studio.MODES.EDITOR,menu.actionID);}catch(e){if(e instanceof NotEditableActionError){const options={type:"danger"};this.notification.add(_t("This action is not editable by Studio"),options);return;}
throw e;}}}
get hasBackgroundAction(){return this.studio.editedAction||this.studio.MODES.APP_CREATOR===this.studio.mode;}
get isInApp(){return this.studio.mode===this.studio.MODES.EDITOR;}
get menuButtons(){return Object.fromEntries(menuButtonsRegistry.getEntries());}
_updateMenuAppsIcon(){super._updateMenuAppsIcon();const menuAppsEl=this.menuAppsRef.el;menuAppsEl.classList.toggle("o_menu_toggle_studio_app_creator_back",this.studio.MODES.APP_CREATOR===this.studio.mode);}}
return __exports;});;

/* /web_studio/static/src/client_action/report_editor/error_display.js */
odoo.define('@web_studio/client_action/report_editor/error_display',['@odoo/owl','@web/core/browser/router','@web/core/utils/hooks','@web_studio/client_action/report_editor/utils'],function(require){'use strict';let __exports={};const{Component,onWillRender,useState}=require("@odoo/owl");const{router}=require("@web/core/browser/router");const{useService}=require("@web/core/utils/hooks");const{humanReadableError}=require("@web_studio/client_action/report_editor/utils");const ErrorDisplay=__exports.ErrorDisplay=class ErrorDisplay extends Component{static template="web_studio.ErrorDisplay";static props={error:Object};setup(){this.state=useState({showTrace:false});this.action=useService("action");onWillRender(()=>{this.error=humanReadableError(this.props.error);});}
openRecord(resModel,resId){const action={type:"ir.actions.act_window",target:"new",res_model:resModel,res_id:resId,views:[[false,"form"]],context:{studio:"0",},};this.action.doAction(action);}
urlFor(model,resId,viewType="form"){return router.stateToUrl({action:"base.action_ui_view",model,resId});}}
return __exports;});;

/* /web_studio/static/src/client_action/report_editor/report_editor.js */
odoo.define('@web_studio/client_action/report_editor/report_editor',['@odoo/owl','@web/core/registry','@web_studio/client_action/report_editor/report_editor_model','@web_studio/client_action/report_editor/report_editor_wysiwyg/report_editor_wysiwyg','@web_studio/client_action/report_editor/report_editor_xml/report_editor_xml','@web_studio/client_action/report_editor/utils','@web/webclient/actions/action_service','@web/core/utils/hooks','@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{Component,onWillStart,onWillUpdateProps}=require("@odoo/owl");const{registry}=require("@web/core/registry");const{useReportEditorModel}=require("@web_studio/client_action/report_editor/report_editor_model");const{ReportEditorWysiwyg}=require("@web_studio/client_action/report_editor/report_editor_wysiwyg/report_editor_wysiwyg");const{ReportEditorXml}=require("@web_studio/client_action/report_editor/report_editor_xml/report_editor_xml");const{getCssFromPaperFormat}=require("@web_studio/client_action/report_editor/utils");const{standardActionServiceProps}=require("@web/webclient/actions/action_service");const{useService}=require("@web/core/utils/hooks");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);class ReportEditor extends Component{static template="web_studio.ReportEditor";static components={ReportEditorWysiwyg,ReportEditorXml};static props={...standardActionServiceProps};setup(){this.reportEditorModel=useReportEditorModel();}
get paperFormatStyle(){const{margin_top,margin_left,margin_right,print_page_height,print_page_width,header_spacing,}=this.reportEditorModel.paperFormat;const marginTop=Math.max(0,(margin_top||0)-(header_spacing||0));return getCssFromPaperFormat({margin_top:marginTop,margin_left,margin_right,print_page_height,print_page_width,});}}
registry.category("actions").add("web_studio.report_editor",ReportEditor);class ReportsTab extends Component{static template="web_studio.ReportEditor.ReportsTab";static props={tab:Object,editedAction:Object,openTab:Function,};setup(){this.studio=useService("studio");onWillStart(()=>this.updateFromModel(this.props.editedAction.res_model));onWillUpdateProps((next)=>this.updateFromModel(next.editedAction.res_model));}
onClick(){if(this.isDisabled){return;}
this.props.openTab(this.props.tab.id);}
get isDisabled(){return!this.modelInfo.record_ids.length;}
get tooltip(){if(!this.isDisabled){return false;}
return _t("You cannot edit a report while there is no %(model_name)s (%(model)s)",{model_name:this.modelInfo.name,model:this.modelInfo.model,});}
async updateFromModel(resModel){this.modelInfo=await this.studio.IrModelInfo.read(resModel);}}
registry.category("web_studio.editor_tabs").add("reports",{name:_t("Reports"),Component:ReportsTab},{sequence:15});return __exports;});;

/* /web_studio/static/src/client_action/report_editor/report_editor_iframe.js */
odoo.define('@web_studio/client_action/report_editor/report_editor_iframe',['@odoo/owl','@web_studio/client_action/report_editor/utils','@web/core/utils/timing','@web_studio/client_action/report_editor/error_display'],function(require){'use strict';let __exports={};const{Component,useRef,useState}=require("@odoo/owl");const{getCssFromPaperFormat}=require("@web_studio/client_action/report_editor/utils");const{useThrottleForAnimation}=require("@web/core/utils/timing");const{ErrorDisplay}=require("@web_studio/client_action/report_editor/error_display");const ReportEditorIframe=__exports.ReportEditorIframe=class ReportEditorIframe extends Component{static components={ErrorDisplay};static template="web_studio.ReportEditor.Iframe";static props={iframeKey:String,iframeSource:String,onIframeLoaded:Function,};setup(){this.reportEditorModel=useState(this.env.reportEditorModel);this.iframeRef=useRef("iframeRef");this.onContainerScroll=useThrottleForAnimation(()=>{if(this.iframeRef.el?.contentDocument){this.iframeRef.el.contentDocument.dispatchEvent(new Event("scroll"));}});}
get paperFormatStyle(){const{margin_top,margin_left,margin_right,print_page_height,print_page_width,header_spacing,}=this.reportEditorModel.paperFormat;const marginTop=Math.max(0,(margin_top||0)-(header_spacing||0));return getCssFromPaperFormat({margin_top:marginTop,margin_left,margin_right,print_page_height,print_page_width,});}
get iframeStyle(){const{print_page_height}=this.reportEditorModel.paperFormat;return getCssFromPaperFormat({print_page_height});}
get iframeSource(){return this.props.iframeSource;}
get iframeKey(){return this.reportEditorModel.renderKey+"_"+(this.props.iframeKey||"");}
async onIframeLoaded(){await this.resizeIframeContent({iframeRef:this.iframeRef});this.props.onIframeLoaded({iframeRef:this.iframeRef});}
async resizeIframeContent({iframeRef}){const paperFormat=this.reportEditorModel.paperFormat;const iframeEl=iframeRef.el;const iframeContent=iframeEl.contentDocument;const zoom=96/paperFormat.dpi;Array.from(iframeContent.querySelector("main")?.children||[]).forEach((el)=>{let sectionZoom=zoom;if(!paperFormat.disable_shrinking){const{width}=el.getBoundingClientRect();sectionZoom=Math.min(zoom,width/el.scrollWidth);}
el.setAttribute("oe-origin-style",el.getAttribute("style")||"");el.style.setProperty("zoom",sectionZoom);});const computeIframeHeight=()=>(iframeEl.style.height=iframeContent.body.scrollHeight+"px");const footer=iframeContent.querySelector(".footer");const footerStyle=footer?.style;if(footerStyle){const{width}=iframeContent.querySelector(".page")?.getBoundingClientRect()||{};if(!footer.hasAttribute("oe-origin-style")){footer.setAttribute("oe-origin-style",footer.getAttribute("style")||"");}
if(width){footerStyle.setProperty("width",`${width}px`);}}
iframeContent.querySelector("html").style.overflow="hidden";const proms=[];Array.from(iframeContent.querySelectorAll("img[src]")||[]).forEach((img)=>{if(img.complete){return;}
const prom=new Promise((resolve)=>{img.onload=resolve;});proms.push(prom);});await Promise.all(proms);computeIframeHeight();}}
return __exports;});;

/* /web_studio/static/src/client_action/report_editor/report_editor_model.js */
odoo.define('@web_studio/client_action/report_editor/report_editor_model',['@web_studio/client_action/utils','@odoo/owl','@web/core/network/rpc','@web/core/utils/hooks','@web/core/utils/objects','@web/core/l10n/translation','@web/core/user','@web_studio/client_action/editor/edition_flow','@web/core/utils/concurrency','@web/core/utils/render','@web/model/relational_model/utils','@web_studio/client_action/report_editor/utils'],function(require){'use strict';let __exports={};const{Reactive}=require("@web_studio/client_action/utils");const{EventBus,markRaw,onWillStart,reactive,toRaw,useEnv,useState,useSubEnv,onWillDestroy,}=require("@odoo/owl");const{rpc}=require("@web/core/network/rpc");const{useService}=require("@web/core/utils/hooks");const{omit,pick}=require("@web/core/utils/objects");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{user}=require("@web/core/user");const{useEditorBreadcrumbs}=require("@web_studio/client_action/editor/edition_flow");const{KeepLast}=require("@web/core/utils/concurrency");const{renderToMarkup}=require("@web/core/utils/render");const{makeActiveField}=require("@web/model/relational_model/utils");const{humanReadableError}=require("@web_studio/client_action/report_editor/utils");const notificationErrorTemplate="web_studio.ReportEditor.NotificationError";const errorQweb=`<html><div>The report could not be rendered due to an error</div><html>`;const ReportEditorModel=__exports.ReportEditorModel=class ReportEditorModel extends Reactive{constructor({services,debug}){super();this.debug=debug;this.bus=markRaw(new EventBus());this._inPreview=false;this.mode="wysiwyg";this.warningMessage="";this._isDirty=false;this._isInEdition=false;this._services=markRaw(services);this._errorMessage=false;this.paperFormat={margin_top:0,margin_left:0,margin_right:0,print_page_width:210,print_page_height:297,};this.reportFields=markRaw({id:{name:"id",type:"number"},name:{name:"name",type:"char"},model:{name:"model",type:"char"},report_name:{name:"report_name",type:"char"},group_ids:{name:"group_ids",type:"many2many",relation:"res.groups",relatedFields:{display_name:{type:"char"},},},paperformat_id:{name:"paperformat_id",type:"many2one",relation:"report.paperformat",},binding_model_id:{name:"binding_model_id",type:"many2one",relation:"ir.model"},attachment_use:{name:"attachment_use",type:"boolean"},attachment:{name:"attachment",type:"char"},display_in_print_menu:{name:"display_in_print_menu",type:"boolean"},});this.reportActiveFields=markRaw({id:makeActiveField(),name:makeActiveField(),model:makeActiveField(),report_name:makeActiveField(),group_ids:{...makeActiveField(),related:{fields:{display_name:{name:"display_name",type:"char"}},activeFields:{display_name:makeActiveField()},},},paperformat_id:makeActiveField(),binding_model_id:makeActiveField(),attachment_use:makeActiveField(),attachment:makeActiveField(),display_in_print_menu:makeActiveField(),});this.reportEnv={};this.loadHtmlKeepLast=markRaw(new KeepLast());this._reportArchs={};this.renderKey=1;this.routesContext=pick(user.context,"allowed_company_ids");}
get reportData(){return this._reportChanges||this._reportData;}
set reportData(_data){const fields=this.reportFields;const data={..._data};for(const[fName,value]of Object.entries(data)){const field=fields[fName];if(field.type==="many2one"){data[fName]=value&&[value.id,value.display_name];}
if(field.type==="many2many"){data[fName]=[...value.currentIds];}}
this._reportChanges=data;}
get reportResModel(){return this._reportData.model;}
get recordToDisplay(){return this.reportEnv.currentId||this.reportEnv.ids.find((i)=>!!i)||false;}
get editedReportId(){return this._services.studio.editedReport.res_id;}
get reportQweb(){return this._reportArchs.reportQweb;}
get reportHtml(){return this._reportArchs.reportHtml;}
get isDirty(){return this._reportChanges||this._isDirty;}
set isDirty(bool){this._isDirty=bool;}
get isInEdition(){return this._isInEdition;}
get inPreview(){return this._inPreview||this.mode==="xml";}
set inPreview(bool){this._inPreview=bool;}
get fullErrorDisplay(){return this.debug?this._errorMessage:false;}
setInEdition(value){value=!!value;if(reactive(this)._isInEdition===value){return;}
this._isInEdition=value;if(value){this._services.ui.block();}else{this._services.ui.unblock();}}
_resetInternalArchs(){toRaw(this)._reportArchs={};}
async loadReportEditor(){const loaders=[this.loadReportData.bind(this),this.loadModelEnv.bind(this)];for(const loader of loaders){if(this.isDestroyed){break;}
await loader();}}
async loadReportData(){const data=await rpc("/web_studio/load_report_editor",{report_id:this.editedReportId,fields:Object.keys(omit(this.reportActiveFields,"display_in_print_menu")),context:this.routesContext,});this._reportData=this._parseFakeFields(data.report_data);Object.assign(this.paperFormat,data.paperformat);this._errorMessage=data.qweb_error;this._reportArchs.reportQweb=data.report_qweb||errorQweb;this._isLoaded=true;}
async loadReportQweb(){if(!this._isLoaded){return;}
if(this._reportArchs.reportQweb){return;}
try{const reportQweb=await this.loadHtmlKeepLast.add(rpc("/web_studio/get_report_qweb",{report_id:this.editedReportId,context:this.routesContext,}));this._errorMessage=false;this._reportArchs.reportQweb=reportQweb;}catch(e){this._errorMessage=e;this._reportArchs.reportQweb=errorQweb;}
this.setInEdition(false);}
async loadReportHtml({resId}={}){if(!this._isLoaded){return;}
if(resId===undefined&&this._reportArchs.reportHtml){return;}
this.reportEnv.currentId=resId!==undefined?resId:this.reportEnv.currentId;try{const reportHtml=await this.loadHtmlKeepLast.add(rpc("/web_studio/get_report_html",{report_id:this.editedReportId,record_id:this.reportEnv.currentId||0,context:this.routesContext,}));this._errorMessage=false;this._reportArchs.reportHtml=reportHtml;}catch(e){this._errorMessage=e;this._reportArchs.reportHtml=errorQweb;}
this.setInEdition(false);}
async saveReport({htmlParts,urgent,xmlVerbatim}={}){const hasPartsToSave=htmlParts&&Object.keys(htmlParts).length;const hasVerbatimToSave=xmlVerbatim&&Object.keys(xmlVerbatim).length;const hasDataToSave=this.isDirty;this.warningMessage="";if(hasVerbatimToSave&&hasPartsToSave){throw new Error(_t("Saving both some report's parts and full xml is not permitted."));}
if(this._errorMessage&&hasPartsToSave){throw new Error(_t("The report is in error. Only editing the XML sources is permitted"));}
if(!hasVerbatimToSave&&!hasPartsToSave&&!hasDataToSave){return false;}
if(!urgent){this.setInEdition(true);}
let result;try{result=await rpc("/web_studio/save_report",{report_id:this.editedReportId,report_changes:this._reportChanges||null,html_parts:htmlParts||null,xml_verbatim:xmlVerbatim||null,record_id:this.reportEnv.currentId||null,context:this.routesContext,},{silent:urgent});this._errorMessage=false;}catch(e){this.setInEdition(false);const message=renderToMarkup(notificationErrorTemplate,{reportName:this._reportData.name,recordId:this.reportEnv.currentId,error:humanReadableError(e),});this._services.unProtectedNotification.add(message,{type:"warning",title:_t("Report edition failed"),});this.warningMessage=_t("Report edition failed");if(this._errorMessage){this._errorMessage=e;}
return false;}
if(hasPartsToSave||hasVerbatimToSave){this._resetInternalArchs();}
const{report_data,paperformat,report_html,report_qweb}=result||{};if(!urgent&&report_data){this._reportData=this._parseFakeFields(report_data);this._reportChanges=null;this.paperFormat=paperformat;}
this.isDirty=false;if(!urgent){this._reportArchs.reportHtml=report_html;this._reportArchs.reportQweb=report_qweb;}
this.setInEdition(false);}
discardReport(){this.setInEdition(true);this.warningMessage="";this.isDirty=false;this.renderKey++;}
async loadModelEnv(){if(this.reportEnv.ids){return;}
const modelName=this.reportResModel;const result=await this._services.studio.IrModelInfo.read(modelName);this.reportEnv={domain:result.domain,ids:result.record_ids,currentId:result.record_ids[0]||false,};}
getModelDomain(){return this.reportEnv.domain;}
async resetReport(includeHeaderFooter=true){this.setInEdition(true);await rpc("/web_studio/reset_report_archs",{report_id:this.editedReportId,include_web_layout:includeHeaderFooter,});this._resetInternalArchs();await this.loadReportQweb();}
_parseFakeFields(reportData){reportData.display_in_print_menu=!!reportData.binding_model_id;return reportData;}}
__exports.useReportEditorModel=useReportEditorModel;function useReportEditorModel(){const services=Object.fromEntries(["orm","ui"].map((name)=>[name,useService(name)]));const env=useEnv();services.studio={...env.services.studio};services.unProtectedNotification=env.services.notification;const reportEditorModel=new ReportEditorModel({services,debug:env.debug});useSubEnv({reportEditorModel});function getName(rem){return rem.reportData?.name;}
const crumb=reactive({});const rem=reactive(reportEditorModel,()=>{crumb.name=getName(rem);});crumb.name=getName(rem);useEditorBreadcrumbs(crumb);onWillStart(()=>reportEditorModel.loadReportEditor());onWillDestroy(()=>(reportEditorModel.isDestroyed=true));return useState(reportEditorModel);}
return __exports;});;

/* /web_studio/static/src/client_action/report_editor/report_editor_snackbar.js */
odoo.define('@web_studio/client_action/report_editor/report_editor_snackbar',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const ReportEditorSnackbar=__exports.ReportEditorSnackbar=class ReportEditorSnackbar extends Component{static template="web_studio.ReportEditor.SnackBar";static props={onSave:Function,state:Object,onDiscard:{type:Function,optional:true},};}
return __exports;});;

/* /web_studio/static/src/client_action/report_editor/report_editor_wysiwyg/editor_plugins/editor_plugins.js */
odoo.define('@web_studio/client_action/report_editor/report_editor_wysiwyg/editor_plugins/editor_plugins',['@html_editor/utils/position','@html_editor/utils/dom_info','@html_editor/main/table/table_plugin','@html_editor/others/qweb_plugin','@html_editor/utils/dom_traversal','@html_editor/main/toolbar/toolbar_plugin','@web_studio/client_action/report_editor/utils'],function(require){'use strict';let __exports={};const{leftPos,rightPos}=require("@html_editor/utils/position");const{isContentEditable}=require("@html_editor/utils/dom_info");const{TablePlugin:_TablePlugin}=require("@html_editor/main/table/table_plugin");const{QWebPlugin:_QWebPlugin}=require("@html_editor/others/qweb_plugin");const{closestElement}=require("@html_editor/utils/dom_traversal");const{ToolbarPlugin:_ToolbarPlugin}=require("@html_editor/main/toolbar/toolbar_plugin");const{visitNode}=require("@web_studio/client_action/report_editor/utils");function extendLists(...args){return args.flat().filter(Boolean);}
const TablePlugin=__exports.TablePlugin=class TablePlugin extends _TablePlugin{_insertTable(){const table=super._insertTable(...arguments);if(closestElement(table,"[t-call='web.external_layout']")){table.removeAttribute("class");table.classList.add("table","o_table","table-borderless");}
return table;}}
const QWEB_STYLING=["class","style"].map((attr)=>[`t-att-${attr}`,`t-attf-${attr}`]).flat();const QWEB_T_OUT=["t-field","t-out","t-esc"];const QWebPlugin=__exports.QWebPlugin=class QWebPlugin extends _QWebPlugin{static shared=["normalizeExpressions"];resources={...this.resources,selectionchange_handlers:extendLists(this.resources.selectionchange_handlers,this.fullExpressionSelectionChanged.bind(this)),clipboard_content_processors:extendLists(this.resources.clipboard_content_processors,this.cleanExpressionsForCopy.bind(this)),normalize_handlers:extendLists(this.resources.normalize_handlers,this.normalizeExpressions.bind(this)),clean_for_save_handlers:extendLists(this.resources.clean_for_save_handlers,this.cleanExpressionsForSave.bind(this)),};onClick(ev){if(ev.detail===1){if(this.setFullSelection(ev.srcElement)){return;}}
super.onClick(ev);}
DUMMY_CONTENT_ATTRS=["data-oe-demo","data-oe-expression-readable"];normalizeExpressions(node){const doc=this.document;visitNode(node,(el)=>{if(!QWEB_T_OUT.some((att)=>el.hasAttribute(att))){return true;}
for(const dummyAttr of this.DUMMY_CONTENT_ATTRS){if(!el.textContent.trim()&&el.hasAttribute(dummyAttr)){el.appendChild(doc.createTextNode(el.getAttribute(dummyAttr)));}}
return false;});}
cleanExpressionsForCopy(node){Array.from(node.querySelectorAll("[data-oe-expression-readable],[data-oe-demo]")).forEach((el)=>{if(QWEB_T_OUT.some((attr)=>el.hasAttribute(attr))){el.replaceChildren();}});}
cleanExpressionsForSave({root}){visitNode(root,(el)=>{let doChildren=true;for(const dummyAttr of this.DUMMY_CONTENT_ATTRS){if(el.hasAttribute(dummyAttr)){if(el.textContent.trim()===el.getAttribute(dummyAttr)){el.replaceChildren();}
doChildren=false;}}
return doChildren;});}
fullExpressionSelectionChanged(selectionData){const selection=selectionData.documentSelection;if(!selection){return;}
const node=selection.anchorNode;const parent=closestElement(node,"[data-oe-expression-readable]");if(parent&&parent!==node){this.setFullSelection(parent);}}
setFullSelection(qwebNode){if(qwebNode.getAttribute("data-oe-expression-readable")&&!isContentEditable(qwebNode)&&this.editable.contains(qwebNode)){const[anchorNode,anchorOffset]=leftPos(qwebNode);const[focusNode,focusOffset]=rightPos(qwebNode);this.dependencies.selection.setSelection({anchorNode,anchorOffset,focusNode,focusOffset,});return true;}
return false;}}
const ToolbarPlugin=__exports.ToolbarPlugin=class ToolbarPlugin extends _ToolbarPlugin{getButtons(){const IDS=["forecolor","backcolor","bold","italic","underline","strikethrough","remove_format","font","font-size","font-family","link",];const buttons=super.getButtons(arguments);for(const btn of buttons){if(IDS.includes(btn.id)){const originIsDisabled=btn.isDisabled;btn.isDisabled=(...args)=>originIsDisabled?.(...args)||this.isButtonDisabled(...args);}}
return buttons;}
isButtonDisabled(sel,targetedNodes){return targetedNodes.some((el)=>el.nodeType===Node.ELEMENT_NODE&&QWEB_STYLING.some((att)=>el.hasAttribute(att)));}}
return __exports;});;

/* /web_studio/static/src/client_action/report_editor/report_editor_wysiwyg/editor_plugins/qweb_table_plugin.js */
odoo.define('@web_studio/client_action/report_editor/report_editor_wysiwyg/editor_plugins/qweb_table_plugin',['@html_editor/plugin','@html_editor/utils/dom_traversal','@odoo/owl','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@web/core/l10n/translation','@web_studio/client_action/report_editor/utils'],function(require){'use strict';let __exports={};const{Plugin}=require("@html_editor/plugin");const{closestElement}=require("@html_editor/utils/dom_traversal");const{Component,reactive}=require("@odoo/owl");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{visitNode}=require("@web_studio/client_action/report_editor/utils");class TableMenu extends Component{static template="html_editor.TableMenu";static props={type:String,overlay:Object,dropdownState:Object,target:{validate:(el)=>el.nodeType===Node.ELEMENT_NODE},editable:{validate:(el)=>el.nodeType===Node.ELEMENT_NODE},addColumn:Function,removeColumn:Function,};static components={Dropdown,DropdownItem};setup(){this.items=this.props.type==="column"?this.colItems():[];}
colItems(){return[{name:"insert_left",icon:"fa-plus",text:_t("Insert left"),action:this.insertColumn.bind(this,"before"),},{name:"insert_right",icon:"fa-plus",text:_t("Insert right"),action:this.insertColumn.bind(this,"after"),},{name:"delete",icon:"fa-trash",text:_t("Delete"),action:this.deleteColumn.bind(this),},];}
insertColumn(position,target){this.props.addColumn({position,reference:target});this.props.editable.focus();}
deleteColumn(target){this.props.removeColumn({cell:target});this.props.editable.focus();}
onSelected(item){item.action(this.props.target);this.props.overlay.close();}}
function setColspan(cell,colspan){if(colspan<1){return;}
if(colspan===1){cell.removeAttribute("colspan");}else{cell.setAttribute("colspan",`${colspan}`);}}
function setStyleProperty(element,name,value){const style=element.style;if(value===undefined){style.removeProperty(name);if(!style.length){element.removeAttribute("style");}}else{style.setProperty(name,value);}}
function*getAllConditionalBlocks(el){const previousBlocks=[...iterConditionalSiblings(el,true)];for(let index=previousBlocks.length-1;index>=0;index--){const _el=previousBlocks[index];if(_el!==el){yield _el;}}
yield*iterConditionalSiblings(el);}
function*iterConditionalSiblings(el,reverse=false){const condition=["t-if","t-elif","t-else"].find((attr)=>el.hasAttribute(attr));if(!condition){return;}
const next=reverse?"previousElementSibling":"nextElementSibling";let includeTif=reverse?true:condition==="t-if";while(el){if(el.hasAttribute("t-if")){if(includeTif&&reverse){yield el;return;}
if(!includeTif){return;}
if(includeTif){yield el;includeTif=false;}}else{yield el;}
const sibl=el[next];el=sibl&&["t-if","t-elif","t-else"].some((attr)=>sibl.hasAttribute(attr))?sibl:null;}}
const CELL_TAGS=["Q-TH","Q-TD"];const CSS_COL_COUNT_PROP="--q-table-col-count";const CSS_COL_SIZE_PROP="--q-cell-col-size";const QWebTablePlugin=__exports.QWebTablePlugin=class QWebTablePlugin extends Plugin{static id="qweb_table_plugin";static dependencies=["baseContainer","overlay","selection","history"];resources={clean_for_save_handlers:({root})=>this.clean(root),normalize_handlers:this.normalize.bind(this),};setup(){for(const table of this.editable.querySelectorAll("q-table")){visitNode(table,(node)=>{if(node.tagName!=="T"){node.classList.add("oe_unbreakable");}
return!CELL_TAGS.includes(node.tagName);});}
this.colMenu=this.dependencies.overlay.createOverlay(TableMenu,{positionOptions:{position:"top-fit",offsetY:0,},},{sequence:30});this.isMenuOpened=false;const closeMenus=()=>{if(this.isMenuOpened){this.isMenuOpened=false;this.colMenu.close();}};this.addDomListener(this.document,"scroll",closeMenus,true);this.addDomListener(this.document,"pointermove",this.onMouseMove);}
onMouseMove(ev){const target=ev.target;if(this.isMenuOpened){return;}
if(CELL_TAGS.includes(target.tagName)&&target!==this.activeTd&&this.editable.contains(target)){if(ev.target.isContentEditable){this.setActiveTd(target);}}else if(this.activeTd){const isOverlay=target.closest(".o-overlay-container");if(isOverlay){return;}
const parentTd=closestElement(target,(el)=>CELL_TAGS.includes(el.tagName));if(!parentTd){this.setActiveTd(null);}}}
setActiveTd(td){this.activeTd=td;this.colMenu.close();if(!td){return;}
const table=closestElement(td,"q-table");if(table.querySelector("q-tr").contains(td)){this.colMenu.open({target:td,props:{editable:this.editable,type:"column",overlay:this.colMenu,target:td,dropdownState:this.createDropdownState(),addColumn:this.addColumn.bind(this),removeColumn:this.removeColumn.bind(this),},});}}
createDropdownState(menuToClose){const dropdownState=reactive({isOpen:false,open:()=>{dropdownState.isOpen=true;menuToClose?.close();this.isMenuOpened=true;},close:()=>{dropdownState.isOpen=false;this.isMenuOpened=false;},});return dropdownState;}
addColumn(payload){const insertedCells=this._addColumn(payload);this.dependencies.selection.setCursorStart(insertedCells[0]);this.dependencies.history.addStep();}
_addColumn({position,reference}){const table=closestElement(reference,"q-table");const{cells}=new TableSizeComputer().compute(table);const{cellIndex,length}=cells.get(reference);const insertedCells=[];const done=new Set();for(const cellEl of cells.keys()){let target=cellEl;for(const condition of iterConditionalSiblings(target,position==="before")){target=condition;}
if(done.has(target)){continue;}
done.add(target);const cellInfo=cells.get(target);if(cellInfo.cellIndex===cellIndex&&cellInfo.length===length){const newTd=this.createElementFrom(cellEl);target.insertAdjacentElement(position==="before"?"beforebegin":"afterend",newTd);insertedCells.push(newTd);continue;}
if(TableSizeComputer.areOverlappingCellInfo(cellInfo,{cellIndex,length})){const colspan=parseInt(target.getAttribute("colspan")||"1")+1;setColspan(target,colspan);continue;}}
this._normalize(table);return insertedCells;}
clean(element){const cleanTableNode=(node)=>{if(node.tagName==="Q-TABLE"){setStyleProperty(node,CSS_COL_COUNT_PROP,undefined);}
const isCell=CELL_TAGS.includes(node.tagName);if(isCell){setStyleProperty(node,CSS_COL_SIZE_PROP,undefined);}
node.classList.remove("oe_unbreakable");if(node.classList.length===0){node.removeAttribute("class");}
return!isCell;};for(const table of element.querySelectorAll("q-table")){visitNode(table,cleanTableNode);}}
removeColumn(payload){const table=closestElement(payload.cell,"q-table");this._removeColumn(payload);const firstCell=table.querySelector(CELL_TAGS.join(","));this.dependencies.selection.setCursorEnd(firstCell);this.dependencies.history.addStep();}
_removeColumn({cell}){const table=closestElement(cell,"q-table");const{cells}=new TableSizeComputer().compute(table);const{cellIndex,length}=cells.get(cell);const removedCells=[];const done=new Set();for(const cellEl of cells.keys()){if(done.has(cellEl)){continue;}
const cellInfo=cells.get(cellEl);if(cellIndex===cellInfo.cellIndex&&length===cellInfo.length){for(const removed of this._removeCell(cellEl)){removedCells.push(removed);done.add(removed);}
continue;}
if(TableSizeComputer.areOverlappingCellInfo(cellInfo,{length,cellIndex})){const colspan=parseInt(cellEl.getAttribute("colspan")||"1")-1;if(colspan===0){for(const removed of this._removeCell(cellEl)){removedCells.push(removed);done.add(removed);}
continue;}
setColspan(cellEl,colspan);}}
this._normalize(table);return removedCells;}
_removeCell(cellEl){const toRemove=[...getAllConditionalBlocks(cellEl)];if(!toRemove.length){toRemove.push(cellEl);}
for(const _el of toRemove){_el.remove();}
return toRemove;}
createElementFrom(fromElement){const tagName=fromElement.tagName.toLowerCase();const newElement=this.document.createElement(tagName);const baseContainer=this.dependencies.baseContainer.createBaseContainer("DIV");baseContainer.append(this.document.createElement("br"));newElement.append(baseContainer);newElement.classList.add("oe_unbreakable");return newElement;}
normalize(el){for(const table of el.querySelectorAll("q-table")){this._normalize(table);}}
_normalize(table){const{cells,baseLineRow}=new TableSizeComputer().compute(table);setStyleProperty(table,CSS_COL_COUNT_PROP,`${baseLineRow.length}`);for(const[cellEl,info]of cells.entries()){setStyleProperty(cellEl,CSS_COL_SIZE_PROP,info.length===1?undefined:`${info.length}`);}}}
class TableSizeComputer{static areOverlappingCellInfo(info1,info2){if(info1.cellIndex<=info2.cellIndex){return info1.cellIndex+info1.length>info2.cellIndex;}
if(info1.cellIndex>info2.cellIndex){return info2.cellIndex+info2.length>info1.cellIndex;}}
compute(table){this.cells=new Map();this.rows=new Map();this.rowIndex=0;this.cellIndex=0;this.cellCount=0;this.maxCellLength=0;this.processChildren(table);return{rows:this.rows,cells:this.cells,maxCellLength:this.maxCellLength,baseLineRow:this.baseLineRow,};}
processCell(cell,params){const cellLength=parseInt(cell.getAttribute("colspan")||"1");const cellIndex=this.cellIndex;this.cellCount++;this.cellIndex=this.cellIndex+cellLength;this.cells.set(cell,{length:cellLength,cellEl:cell,rowEl:params.rowEl,cellIndex});}
processRow(el,params){const row={rowIndex:this.rowIndex++};this.rows.set(el,row);for(const child of el.children){this.processElement(child,{...params,rowEl:el});}
if(!this.baseLineRow){this.baseLineRow=row;}
row.length=this.cellIndex;row.cellCount=this.cellCount;this.maxCellLength=Math.max(this.cellIndex,this.maxCellLength);this.cellIndex=0;this.cellCount=0;}
processConditions(el,params){const cellIndex=this.cellIndex;let maxCellIndex=cellIndex;const cellCount=this.cellCount;let maxCellCount=cellCount;for(const conditional of iterConditionalSiblings(el)){this.processElement(conditional,params,false);maxCellIndex=Math.max(maxCellIndex,this.cellIndex);maxCellCount=Math.max(maxCellCount,this.cellCount);this.cellIndex=cellIndex;this.cellCount=cellCount;}
this.cellIndex=maxCellIndex;this.cellCount=maxCellCount;}
processChildren(el,params={}){for(const child of el.children){this.processElement(child,params);}}
processElement(el,params={},processConditions=true){if(el.hasAttribute("t-set")){return;}
if(processConditions){const directive=["t-if","t-elif","t-else"].find((attr)=>el.hasAttribute(attr));if(directive==="t-if"){return this.processConditions(el,params);}else if(directive&&el.tagName==="T"){return;}}
if(CELL_TAGS.includes(el.tagName)){return this.processCell(el,params);}
if(el.tagName==="Q-TR"){return this.processRow(el,params);}
return this.processChildren(el,params);}}
return __exports;});;

/* /web_studio/static/src/client_action/report_editor/report_editor_wysiwyg/editor_plugins/report_editor_plugin.js */
odoo.define('@web_studio/client_action/report_editor/report_editor_wysiwyg/editor_plugins/report_editor_plugin',['@web/core/l10n/translation','@html_editor/plugin','@html_editor/utils/dom_traversal','@html_editor/utils/resource','@html_editor/plugin_sets','@html_editor/utils/position','@html_editor/core/selection_plugin','@web_studio/client_action/report_editor/report_editor_wysiwyg/editor_plugins/studio_dynamic_placeholder_popover','@web_studio/client_action/report_editor/utils','@web_studio/client_action/report_editor/report_editor_wysiwyg/editor_plugins/editor_plugins','@web_studio/client_action/report_editor/report_editor_wysiwyg/editor_plugins/qweb_table_plugin'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{Plugin}=require("@html_editor/plugin");const{closestElement}=require("@html_editor/utils/dom_traversal");const{withSequence}=require("@html_editor/utils/resource");const{MAIN_PLUGINS}=require("@html_editor/plugin_sets");const{nodeSize}=require("@html_editor/utils/position");const{isHtmlContentSupported}=require("@html_editor/core/selection_plugin");const{StudioDynamicPlaceholderPopover}=require("@web_studio/client_action/report_editor/report_editor_wysiwyg/editor_plugins/studio_dynamic_placeholder_popover");const{visitNode}=require("@web_studio/client_action/report_editor/utils");const{QWebPlugin,TablePlugin,ToolbarPlugin}=require("@web_studio/client_action/report_editor/report_editor_wysiwyg/editor_plugins/editor_plugins");const{QWebTablePlugin}=require("@web_studio/client_action/report_editor/report_editor_wysiwyg/editor_plugins/qweb_table_plugin");const ReportEditorPlugin=__exports.ReportEditorPlugin=class ReportEditorPlugin extends Plugin{static id="report_editor_main";static dependencies=["selection","history","overlay","dom",QWebPlugin.id];resources={handleNewRecords:this.handleMutations.bind(this),unsplittable_node_predicates:(node)=>node.nodeType===Node.ELEMENT_NODE&&node.matches(".page, .header, .footer"),toolbar_groups:withSequence(9,{id:"report_editor"}),toolbar_items:[{id:"editDynamicField",groupId:"report_editor",namespaces:["compact","expanded"],commandId:"editDynamicField",},],user_commands:[{id:"insertField",title:_t("Field"),description:_t("Insert a field"),icon:"fa-magic",run:this.insertField.bind(this),isAvailable:this.isInsertAvailable.bind(this),},{id:"insertDynamicTable",title:_t("Dynamic Table"),description:_t("Insert a table based on a relational field."),icon:"fa-magic",run:this.insertTableX2Many.bind(this),isAvailable:this.isInsertAvailable.bind(this),},{id:"editDynamicField",title:_t("Edit field"),description:_t("Change the placeholder or the expression for an existing field"),icon:"fa-pencil",run:this.editTField.bind(this),isAvailable:()=>!!this.getTargetedTField(),},],powerbox_categories:withSequence(1,{id:"report_tools",name:_t("Report Tools"),}),powerbox_items:[withSequence(20,{categoryId:"report_tools",commandId:"insertField",}),withSequence(25,{categoryId:"report_tools",commandId:"insertDynamicTable",}),],};CUSTOM_BRANDING_ATTR=["ws-view-id","ws-call-key","ws-call-group-key","ws-real-children","o-diff-key",];setup(){this.fieldPopover=this.dependencies.overlay.createOverlay(StudioDynamicPlaceholderPopover,{hasAutofocus:true,editable:this.editable,className:"bg-light",});}
isInsertAvailable(selection){if(!isHtmlContentSupported(selection)){return;}
const{anchorNode}=selection;const{availableQwebVariables}=this.getQwebVariables(anchorNode.nodeType===1?anchorNode:anchorNode.parentElement);return Object.keys(availableQwebVariables||{}).length>0;}
getTargetedTField(){const elements=this.dependencies.selection.getTargetedNodes().filter((n)=>n.nodeType===Node.ELEMENT_NODE);if(elements.length===1&&elements[0].hasAttribute("t-field")){if(elements[0].getAttribute("t-field").includes("(")){return;}
return elements[0];}}
async editTField(){const tfield=this.getTargetedTField();if(!tfield){return;}
const popoverAnchor=tfield;const{availableQwebVariables,initialQwebVar:defaultQwebVar,isInHeaderFooter,}=this.getQwebVariables(popoverAnchor);let initialPath=popoverAnchor.getAttribute("t-field").split(".");let initialQwebVar=initialPath[0];initialPath=initialPath.slice(1).join(".");let resModel=availableQwebVariables[initialQwebVar]?.model;if(!resModel){resModel=this.config.reportResModel;initialQwebVar=defaultQwebVar;initialPath=false;}
const initialLabelValue=popoverAnchor.innerText||popoverAnchor.getAttribute("data-oe-demo")||popoverAnchor.getAttribute("data-oe-expression-readable")||false;await this.fieldPopover.open({target:popoverAnchor,props:{close:()=>this.fieldPopover.close(),availableQwebVariables,initialQwebVar,isEditingFooterHeader:!!isInHeaderFooter,resModel,initialPath,initialLabelValue,showOnlyX2ManyFields:false,validate:(qwebVar,fieldNameChain,defaultValue="",is_image,relation,fieldString)=>{let isDirty=false;if(qwebVar!==initialQwebVar||initialPath!==fieldNameChain){isDirty=true;popoverAnchor.setAttribute("data-oe-expression-readable",fieldString||`field: "${qwebVar}.${fieldNameChain}"`);popoverAnchor.setAttribute("t-field",`${qwebVar}.${fieldNameChain}`);if(odoo.debug){popoverAnchor.setAttribute("title",`${qwebVar}.${fieldNameChain}`);}
if(is_image){popoverAnchor.setAttribute("t-options-widget","'image'");popoverAnchor.setAttribute("t-options-qweb_img_raw_data",1);}else{popoverAnchor.removeAttribute("t-options-widget"),popoverAnchor.removeAttribute("t-options-qweb_img_raw_data");}}
if(initialLabelValue!==defaultValue){isDirty=true;popoverAnchor.setAttribute("data-oe-demo",defaultValue);const prevText=popoverAnchor.textContent;this.dependencies.history.applyCustomMutation({apply:()=>{popoverAnchor.textContent="";this.dependencies.qweb.normalizeExpressions(popoverAnchor);const parentView=popoverAnchor.closest(`[ws-view-id]`);if(!parentView.classList.contains("o_dirty")){parentView.classList.add("o_dirty");}},revert:()=>{popoverAnchor.textContent=prevText;},});}
if(isDirty){this.dependencies.history.addStep();}},},});}
getQwebVariables(element){if(!element){return{};}
const nodeOeContext=element.closest("[oe-context]");let availableQwebVariables=nodeOeContext&&JSON.parse(nodeOeContext.getAttribute("oe-context"));const isInHeaderFooter=closestElement(element,".header,.footer");let initialQwebVar;if(isInHeaderFooter){const companyVars=Object.entries(availableQwebVariables).filter(([k,v])=>v.model==="res.company");initialQwebVar=companyVars[0]?.[0];availableQwebVariables=Object.fromEntries(companyVars);}else{initialQwebVar=this.getOrderedTAs(element)[0]||"";}
return{isInHeaderFooter,availableQwebVariables,initialQwebVar,};}
getOrderedTAs(node){const results=[];while(node){const closest=node.closest("[t-foreach]");if(closest){results.push(closest.getAttribute("t-as"));node=closest.parentElement;}else{node=null;}}
return results;}
async insertTableX2Many(){const{popoverAnchor,props}=this.getFieldPopoverParams();await this.fieldPopover.open({target:popoverAnchor,props:{...props,showOnlyX2ManyFields:true,validate:(qwebVar,fieldNameChain,defaultValue="",is_image,relation,relationName)=>{const doc=this.document;this.editable.focus();const table=doc.createElement("table");table.classList.add("table","table-sm");const tBody=table.createTBody();const topRow=tBody.insertRow();topRow.classList.add("border-bottom","border-top-0","border-start-0","border-end-0","border-2","border-dark","fw-bold");const topTd=doc.createElement("td");topTd.appendChild(doc.createTextNode(defaultValue||"Column name"));topRow.appendChild(topTd);const tr=doc.createElement("tr");tr.setAttribute("t-foreach",`${qwebVar}.${fieldNameChain}`);tr.setAttribute("t-as","x2many_record");tr.setAttribute("oe-context",JSON.stringify({x2many_record:{model:relation,in_foreach:true,name:relationName,},...props.availableQwebVariables,}));tBody.appendChild(tr);const td=doc.createElement("td");td.textContent=_t("Insert a field...");tr.appendChild(td);this.dependencies.dom.insert(table);this.dependencies.selection.setSelection({anchorNode:td,focusOffset:nodeSize(td),});this.dependencies.history.addStep();},},});}
async insertField(){const{popoverAnchor,props}=this.getFieldPopoverParams();await this.fieldPopover.open({target:popoverAnchor,props:{...props,showOnlyX2ManyFields:false,validate:(qwebVar,fieldNameChain,defaultValue="",is_image,relation,fieldString)=>{const doc=this.document;const span=doc.createElement("span");span.setAttribute("data-oe-expression-readable",fieldString||`field: "${qwebVar}.${fieldNameChain}"`);span.setAttribute("data-oe-demo",defaultValue);span.setAttribute("t-field",`${qwebVar}.${fieldNameChain}`);if(odoo.debug){span.setAttribute("title",`${qwebVar}.${fieldNameChain}`);}
if(is_image){span.setAttribute("t-options-widget","'image'");span.setAttribute("t-options-qweb_img_raw_data",1);}
this.dependencies.dom.insert(span);this.editable.focus();this.dependencies.history.addStep();},},});}
getFieldPopoverParams(){const resModel=this.config.reportResModel;const{anchorNode}=this.dependencies.selection.getEditableSelection();const popoverAnchor=anchorNode.nodeType===1?anchorNode:anchorNode.parentElement;const{availableQwebVariables,initialQwebVar,isInHeaderFooter}=this.getQwebVariables(popoverAnchor);return{popoverAnchor,props:{close:()=>this.fieldPopover.close(),availableQwebVariables,initialQwebVar,isEditingFooterHeader:!!isInHeaderFooter,resModel,},};}
handleMutations(records){for(const record of records){if(record.type==="attributes"){if(record.attributeName==="contenteditable"){continue;}
if(record.attributeName.startsWith("data-oe-t")){continue;}}
if(record.type==="childList"){record.addedTrees.map((tree)=>tree.node).forEach((el)=>{if(el.nodeType!==1){return;}
visitNode(el,(node)=>{this.CUSTOM_BRANDING_ATTR.forEach((attr)=>{node.removeAttribute(attr);});node.classList.remove("o_dirty");});});const realRemoved=record.removedTrees.map((tree)=>tree.node).filter((n)=>n.nodeType!==Node.COMMENT_NODE);if(!realRemoved.length&&!record.addedTrees.length){continue;}}
let target=record.target;if(!target.isConnected){continue;}
if(target.nodeType!==Node.ELEMENT_NODE){target=target.parentElement;}
if(!target){continue;}
target=target.closest(`[ws-view-id]`);if(!target){continue;}
if(!target.classList.contains("o_dirty")){target.classList.add("o_dirty");}}}}
const REPORT_EDITOR_PLUGINS_MAP=Object.fromEntries(MAIN_PLUGINS.map((cls)=>[cls.id,cls]));Object.assign(REPORT_EDITOR_PLUGINS_MAP,{[QWebPlugin.id]:QWebPlugin,[QWebTablePlugin.id]:QWebTablePlugin,[TablePlugin.id]:TablePlugin,[ToolbarPlugin.id]:ToolbarPlugin,[ReportEditorPlugin.id]:ReportEditorPlugin,});__exports.getReportEditorPlugins=getReportEditorPlugins;function getReportEditorPlugins(){return Object.values(REPORT_EDITOR_PLUGINS_MAP);}
return __exports;});;

/* /web_studio/static/src/client_action/report_editor/report_editor_wysiwyg/editor_plugins/studio_dynamic_placeholder_popover.js */
odoo.define('@web_studio/client_action/report_editor/report_editor_wysiwyg/editor_plugins/studio_dynamic_placeholder_popover',['@odoo/owl','@web/core/utils/hooks','@web/core/hotkeys/hotkey_hook','@web/core/model_field_selector/model_field_selector','@web/core/utils/arrays'],function(require){'use strict';let __exports={};const{Component,onWillStart,useState}=require("@odoo/owl");const{useService,useAutofocus}=require("@web/core/utils/hooks");const{useHotkey}=require("@web/core/hotkeys/hotkey_hook");const{ModelFieldSelector}=require("@web/core/model_field_selector/model_field_selector");const{sortBy}=require("@web/core/utils/arrays");const StudioDynamicPlaceholderPopover=__exports.StudioDynamicPlaceholderPopover=class StudioDynamicPlaceholderPopover extends Component{static template="web_studio.StudioDynamicPlaceholderPopover";static components={ModelFieldSelector};static props={resModel:String,availableQwebVariables:Object,close:Function,validate:Function,isEditingFooterHeader:Boolean,initialQwebVar:{optional:true,type:String},showOnlyX2ManyFields:Boolean,initialPath:{optional:true},initialLabelValue:{optional:true},};static defaultProps={initialQwebVar:"",initialPath:false,initialLabelValue:false,};setup(){useAutofocus();this.state=useState({currentVar:this.getDefaultVariable(),path:this.props.initialPath||"",isPathSelected:false,labelValue:this.props.initialLabelValue||null,});this.fieldService=useService("field");useHotkey("Enter",()=>this.validate(),{bypassEditableProtection:true});useHotkey("Escape",()=>this.props.close(),{bypassEditableProtection:true});onWillStart(async()=>{if(this.state.path){const fieldInfo=(await this.fieldService.loadFieldInfo(this.currentResModel,this.state.path)).fieldDef;this.fieldType=fieldInfo.type;this.state.fieldName=fieldInfo.string;}});}
get labelValueInput(){const state=this.state;const lv=state.labelValue;return(lv!==null?lv:state.fieldName)||"";}
onLabelInput(ev){const val=ev.target.value;this.state.labelValue=val;}
filter(fieldDef){if(this.props.showOnlyX2ManyFields){return["one2many","many2many"].includes(fieldDef.type);}else{return!["one2many","boolean","many2many"].includes(fieldDef.type);}}
async validate(){const resModel=this.currentResModel;const fieldInfo=(await this.fieldService.loadFieldInfo(resModel,this.state.path)).fieldDef;if(!fieldInfo){return;}
const filename_exists=(await this.fieldService.loadFieldInfo(resModel,this.state.path+"_filename")).fieldDef;const is_image=fieldInfo.type=="binary"&&!filename_exists;this.props.validate(this.state.currentVar,this.state.path,this.labelValueInput,is_image,fieldInfo.relation,fieldInfo.string);this.props.close();}
setPath(path,{fieldDef}){this.state.path=path;this.state.fieldName=fieldDef?.string;this.fieldType=fieldDef?.type;}
get currentModel(){const currentVar=this.state.currentVar;const model=currentVar&&this.props.availableQwebVariables[currentVar];return model||{};}
get currentResModel(){const resModel=this.currentModel.model;return resModel||this.props.resModel;}
get sortedVariables(){const entries=Object.entries(this.props.availableQwebVariables).filter(([k,v])=>v.in_foreach&&!this.props.isEditingFooterHeader);const resModel=this.props.resModel;const sortFn=([k,v])=>{let score=0;if(k==="doc"){score+=2;}
if(k==="docs"){score-=2;}
if(k==="o"){score++;}
if(v.model===resModel){score++;}
return score;};const mapFn=([k,v])=>({value:k,label:`${k} (${v.name})`,});return sortBy(entries,sortFn,"desc").map((e)=>mapFn(e));}
getDefaultVariable(){const initialQwebVar=this.props.initialQwebVar;if(initialQwebVar&&initialQwebVar in this.props.availableQwebVariables){return initialQwebVar;}
if(this.props.isEditingFooterHeader){const companyVar=Object.entries(this.props.availableQwebVariables).find(([k,v])=>v.model==="res.company");return companyVar&&companyVar[0];}
let defaultVar=this.sortedVariables.find((v)=>["doc","o"].includes(v.value));defaultVar=defaultVar||this.sortedVariables.find((v)=>this.props.availableQwebVariables[v.value].model===this.props.resModel);return defaultVar&&defaultVar.value;}}
return __exports;});;

/* /web_studio/static/src/client_action/report_editor/report_editor_wysiwyg/report_editor_wysiwyg.js */
odoo.define('@web_studio/client_action/report_editor/report_editor_wysiwyg/report_editor_wysiwyg',['@odoo/owl','@web/core/l10n/translation','@web/core/utils/objects','@web/core/utils/hooks','@web/views/fields/many2many_tags/many2many_tags_field','@web/views/fields/char/char_field','@web/model/record','@web/views/fields/many2one/many2one_field','@web/views/fields/boolean/boolean_field','@web/core/confirmation_dialog/confirmation_dialog','@web_studio/client_action/report_editor/report_editor_snackbar','@web_studio/client_action/editor/edition_flow','@web_studio/client_action/utils','@web_studio/client_action/report_editor/report_editor_iframe','@html_editor/editor','@html_editor/utils/dom_traversal','@web_studio/client_action/report_editor/report_editor_xml/report_record_navigation','@web/core/checkbox/checkbox','@web_studio/client_action/report_editor/report_editor_wysiwyg/editor_plugins/report_editor_plugin'],function(require){'use strict';let __exports={};const{Component,onWillStart,onMounted,onWillDestroy,onWillUnmount,reactive,useState,}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{omit}=require("@web/core/utils/objects");const{useOwnedDialogs,useService}=require("@web/core/utils/hooks");const{Many2ManyTagsField}=require("@web/views/fields/many2many_tags/many2many_tags_field");const{CharField}=require("@web/views/fields/char/char_field");const{Record:_Record}=require("@web/model/record");const{Many2OneField}=require("@web/views/fields/many2one/many2one_field");const{BooleanField}=require("@web/views/fields/boolean/boolean_field");const{ConfirmationDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{ReportEditorSnackbar}=require("@web_studio/client_action/report_editor/report_editor_snackbar");const{useEditorMenuItem}=require("@web_studio/client_action/editor/edition_flow");const{memoizeOnce}=require("@web_studio/client_action/utils");const{ReportEditorIframe}=require("@web_studio/client_action/report_editor/report_editor_iframe");const{Editor}=require("@html_editor/editor");const{closestElement}=require("@html_editor/utils/dom_traversal");const{ReportRecordNavigation}=require("@web_studio/client_action/report_editor/report_editor_xml/report_record_navigation");const{CheckBox}=require("@web/core/checkbox/checkbox");const{getReportEditorPlugins}=require("@web_studio/client_action/report_editor/report_editor_wysiwyg/editor_plugins/report_editor_plugin");class __Record extends _Record.components._Record{setup(){super.setup();const willSaveUrgently=()=>this.model.bus.trigger("WILL_SAVE_URGENTLY");onMounted(()=>{this.env.reportEditorModel.bus.addEventListener("WILL_SAVE_URGENTLY",willSaveUrgently);});onWillDestroy(()=>this.env.reportEditorModel.bus.removeEventListener("WILL_SAVE_URGENTLY",willSaveUrgently));}}
class Record extends _Record{static components={..._Record.components,_Record:__Record};}
class UndoRedo extends Component{static template="web_studio.ReportEditorWysiwyg.UndoRedo";static props={state:Object,className:{type:String,optional:true},};}
class ResetConfirmationPopup extends ConfirmationDialog{static template="web_studio.ReportEditorWysiwyg.ResetConfirmationPopup";static props={...omit(ConfirmationDialog.props,"body"),state:Object,};}
const ReportEditorWysiwyg=__exports.ReportEditorWysiwyg=class ReportEditorWysiwyg extends Component{static components={CharField,Record,Many2ManyTagsField,Many2OneField,BooleanField,UndoRedo,ReportEditorIframe,ReportRecordNavigation,CheckBox,};static props={paperFormatStyle:String,};static template="web_studio.ReportEditorWysiwyg";setup(){this.action=useService("action");this.addDialog=useOwnedDialogs();this.notification=useService("notification");this._getReportQweb=memoizeOnce(()=>{const tree=new DOMParser().parseFromString(this.reportEditorModel.reportQweb,"text/html");return tree.firstElementChild;});const reportEditorModel=(this.reportEditorModel=useState(this.env.reportEditorModel));this.reportRecordHooks={onRecordChanged:(rec)=>(this.reportEditorModel.reportData=rec.data),};useEditorMenuItem({component:ReportEditorSnackbar,props:{state:reportEditorModel,onSave:this.save.bind(this),onDiscard:this.discard.bind(this),},});this.undoRedoState=reactive({canUndo:false,canRedo:false,undo:()=>this.editor?.shared.history.undo(),redo:()=>this.editor?.shared.history.redo(),});onWillStart(()=>this.reportEditorModel.loadReportQweb());onWillUnmount(()=>{this.reportEditorModel.bus.trigger("WILL_SAVE_URGENTLY");this.save({urgent:true});if(this.editor){this.editor.destroy(true);}});}
instantiateEditor({editable}={}){this.undoRedoState.canUndo=false;this.undoRedoState.canRedo=false;const onEditorChange=()=>{const canUndo=this.editor.shared.history.canUndo();this.reportEditorModel.isDirty=canUndo;Object.assign(this.undoRedoState,{canUndo:canUndo,canRedo:this.editor.shared.history.canRedo(),});};editable.querySelectorAll("[ws-view-id]").forEach((el)=>{el.setAttribute("contenteditable","true");});const editor=new Editor({Plugins:getReportEditorPlugins(),onChange:onEditorChange,getRecordInfo:()=>{const{anchorNode}=this.editor.shared.selection.getEditableSelection();if(!anchorNode){return{};}
const lastViewParent=closestElement(anchorNode,"[ws-view-id]");if(!lastViewParent){return{};}
return{resModel:"ir.ui.view",resId:parseInt(lastViewParent.getAttribute("ws-view-id")),field:"arch",};},reportResModel:this.reportEditorModel.reportResModel,allowVideo:false,allowImageTransform:false,},this.env.services);editor.attachTo(editable);editable.classList.remove("odoo-editor-qweb");return editor;}
onIframeLoaded({iframeRef}){if(this.editor){this.editor.destroy(true);this.editor=null;}
this.iframeRef=iframeRef;const doc=iframeRef.el.contentDocument;doc.body.classList.remove("container");if(odoo.debug){["t-esc","t-out","t-field"].forEach((tAtt)=>{doc.querySelectorAll(`*[${tAtt}]`).forEach((e)=>{if(e.hasAttribute("title")){e.setAttribute("data-oe-title",e.getAttribute("title"));}
e.setAttribute("title",e.getAttribute(tAtt));});});}
if(!this.reportEditorModel._errorMessage&&!this.reportEditorModel.inPreview){this.editor=this.instantiateEditor({editable:doc.querySelector("#wrapwrap")});}
this.reportEditorModel.setInEdition(false);}
get reportQweb(){const model=this.reportEditorModel;return this._getReportQweb(`${model.renderKey}_${model.reportQweb}`).outerHTML;}
get reportRecordProps(){const model=this.reportEditorModel;return{fields:model.reportFields,activeFields:model.reportActiveFields,values:model.reportData,};}
async save({urgent=false}={}){if(!this.editor){await this.reportEditorModel.saveReport({urgent});return;}
const htmlParts={};const editable=this.editor.getElContent();if(odoo.debug){editable.querySelectorAll("*[t-field],*[t-out],*[t-esc]").forEach((e)=>{if(e.hasAttribute("data-oe-title")){e.setAttribute("title",e.getAttribute("data-oe-title"));e.removeAttribute("data-oe-title");}else{e.removeAttribute("title");}});}
editable.querySelectorAll("[ws-view-id].o_dirty").forEach((el)=>{el.classList.remove("o_dirty");el.removeAttribute("contenteditable");const viewId=el.getAttribute("ws-view-id");if(!viewId){return;}
Array.from(el.querySelectorAll("[t-call]")).forEach((el)=>{el.removeAttribute("contenteditable");el.replaceChildren();});Array.from(el.querySelectorAll("[oe-origin-t-out]")).forEach((el)=>{el.replaceChildren();});if(!el.hasAttribute("oe-origin-class")&&el.getAttribute("class")===""){el.removeAttribute("class");}
const callGroupKey=el.getAttribute("ws-call-group-key");const type=callGroupKey?"in_t_call":"full";const escaped_html=el.outerHTML;htmlParts[viewId]=htmlParts[viewId]||[];htmlParts[viewId].push({call_key:el.getAttribute("ws-call-key"),call_group_key:callGroupKey,type,html:escaped_html,});});await this.reportEditorModel.saveReport({htmlParts,urgent});}
async discard(){if(this.editor){const selection=this.editor.document.getSelection();if(selection){selection.removeAllRanges();}}
this.env.services.dialog.add(ConfirmationDialog,{body:_t("If you discard the current edits, all unsaved changes will be lost. You can cancel to return to edit mode."),confirm:()=>this.reportEditorModel.discardReport(),cancel:()=>{},});}
async resetReport(){const state=reactive({includeHeaderFooter:true});this.addDialog(ResetConfirmationPopup,{title:_t("Reset report"),confirmLabel:_t("Reset report"),confirmClass:"btn-danger",cancelLabel:_t("Go back"),state,cancel:()=>{},confirm:async()=>{await this.reportEditorModel.saveReport();try{await this.reportEditorModel.resetReport(state.includeHeaderFooter);}finally{this.reportEditorModel.renderKey++;}},});}
async openReportFormView(){await this.save();return this.action.doAction({type:"ir.actions.act_window",res_model:"ir.actions.report",res_id:this.reportEditorModel.editedReportId,views:[[false,"form"]],target:"current",},{clearBreadcrumbs:true});}
async editSources(){await this.save();this.reportEditorModel.mode="xml";}
async togglePreview(toValue){if(toValue){const saved=await this.save();if(!saved){await this.reportEditorModel.loadReportHtml();}}
this.reportEditorModel.inPreview=toValue;}}
return __exports;});;

/* /web_studio/static/src/client_action/report_editor/report_editor_xml/report_editor_xml.js */
odoo.define('@web_studio/client_action/report_editor/report_editor_xml/report_editor_xml',['@odoo/owl','@web_studio/client_action/xml_resource_editor/xml_resource_editor','@web_studio/client_action/editor/edition_flow','@web_studio/client_action/report_editor/report_editor_snackbar','@web_studio/client_action/report_editor/report_editor_xml/report_record_navigation','@web/core/user','@web/core/utils/hooks','@web_studio/client_action/report_editor/report_editor_iframe','@web/core/l10n/localization','@web/views/fields/translation_dialog','@web/views/view','@web/core/checkbox/checkbox'],function(require){'use strict';let __exports={};const{Component,onWillStart,onWillUnmount,toRaw,useState}=require("@odoo/owl");const{XmlResourceEditor}=require("@web_studio/client_action/xml_resource_editor/xml_resource_editor");const{useEditorMenuItem}=require("@web_studio/client_action/editor/edition_flow");const{ReportEditorSnackbar}=require("@web_studio/client_action/report_editor/report_editor_snackbar");const{ReportRecordNavigation}=require("@web_studio/client_action/report_editor/report_editor_xml/report_record_navigation");const{user}=require("@web/core/user");const{useBus,useOwnedDialogs}=require("@web/core/utils/hooks");const{ReportEditorIframe}=require("@web_studio/client_action/report_editor/report_editor_iframe");const{localization}=require("@web/core/l10n/localization");const{TranslationDialog}=require("@web/views/fields/translation_dialog");const{View}=require("@web/views/view");const{CheckBox}=require("@web/core/checkbox/checkbox");class ReportResourceEditor extends XmlResourceEditor{static props={...XmlResourceEditor.props,slots:Object};setup(){super.setup();useBus(this.env.reportEditorModel.bus,"node-clicked",(ev)=>{const{viewId}=ev.detail;const nextResource=this.state.resourcesOptions.find((opt)=>opt.value===viewId);if(nextResource){this.state.currentResourceId=nextResource.value;}});}}
class TranslationButton extends Component{static template="web.TranslationButton";static props={resourceId:Number,};setup(){this.addDialog=useOwnedDialogs();}
get isMultiLang(){return localization.multiLang;}
get lang(){return new Intl.Locale(user.lang).language.toUpperCase();}
onClick(){this.addDialog(TranslationDialog,{fieldName:"arch_db",resModel:"ir.ui.view",resId:this.props.resourceId,onSave:()=>{const model=this.env.reportEditorModel;model.loadReportHtml({resId:model.reportEnv.currentId});},});}}
class _View extends View{async loadView(){const res=await super.loadView(...arguments);const Controller=this.Controller;if(!("afterExecuteActionButton"in Controller.props)&&"afterExecuteActionButton"in Controller.prototype){class _Controller extends Controller{afterExecuteActionButton(clickParams){const res=super.afterExecuteActionButton(...arguments);this.props.afterExecuteActionButton(this.model,...arguments);return res;}}
_Controller.props={...Controller.props,afterExecuteActionButton:{type:Function},};this.Controller=_Controller;}
return res;}}
const ReportEditorXml=__exports.ReportEditorXml=class ReportEditorXml extends Component{static components={XmlResourceEditor:ReportResourceEditor,ReportRecordNavigation,ReportEditorIframe,TranslationButton,View:_View,CheckBox,};static template="web_studio.ReportEditorXml";static props={paperFormatStyle:String,};setup(){this.reportEditorModel=useState(this.env.reportEditorModel);this.state=useState({xmlChanges:null,reloadSources:1,viewIdToDiff:false,warningMessage:"",get isDirty(){return!!this.xmlChanges;},});useEditorMenuItem({component:ReportEditorSnackbar,props:{state:this.state,onSave:this.save.bind(this),onDiscard:this.discardChanges.bind(this),},});onWillStart(()=>this.reportEditorModel.loadReportHtml());onWillUnmount(()=>{this.save({urgent:true});});}
get minWidth(){const factor=this.state.viewIdToDiff?0.2:0.4;return Math.floor(document.documentElement.clientWidth*factor);}
async onCloseXmlEditor(){await this.save();this.reportEditorModel.mode="wysiwyg";}
onXmlChanged(changes){this.state.xmlChanges=changes;}
getDefaultResource(resourcesOptions,mainKey){let mainResource;if(mainKey){mainResource=resourcesOptions.find((opt)=>opt.resource.key===mainKey);}
if(mainResource){const studioExtension=resourcesOptions.find((opt)=>{const key=opt.resource.key;const parentId=opt.resource.inherit_id&&opt.resource.inherit_id[0];return(key.includes("web_studio.report_editor_customization")&&parentId===mainResource.resource.id);});return studioExtension||mainResource;}}
async save({urgent=false}={}){const changes={...toRaw(this.state.xmlChanges)};const result=await this.reportEditorModel.saveReport({urgent,xmlVerbatim:changes,});this.state.warningMessage=this.reportEditorModel.warningMessage;if(result!==false){this.state.xmlChanges=null;if(!urgent&&Object.keys(changes).length){this.state.reloadSources++;}}}
async discardChanges(){this.state.xmlChanges=null;this.state.reloadSources++;}
onIframeLoaded({iframeRef}){iframeRef.el.contentWindow.document.addEventListener("click",(ev)=>{const target=ev.target;const brandingTarget=target.closest(`[data-oe-model="ir.ui.view"][data-oe-field="arch"]`);if(!brandingTarget){return;}
const viewId=parseInt(brandingTarget.getAttribute("data-oe-id"));this.reportEditorModel.bus.trigger("node-clicked",{viewId});});this.reportEditorModel.setInEdition(false);}
async switchToDiff(viewId){await this.save();this.state.viewIdToDiff=viewId;}
get diffProps(){return{type:"form",resModel:"reset.view.arch.wizard",context:{studio:false,studio_report_diff:true,active_ids:[this.state.viewIdToDiff],active_model:"ir.ui.view",},afterExecuteActionButton:(model,clickParams)=>{if(model.root.resModel==="reset.view.arch.wizard"&&clickParams.name==="reset_view_button"){this.state.reloadSources++;this.reportEditorModel._resetInternalArchs();this.reportEditorModel.loadReportHtml();}},preventCreate:true,};}
onResourceChanged(resource){if(this.state.viewIdToDiff){this.state.viewIdToDiff=resource.id;}}}
return __exports;});;

/* /web_studio/static/src/client_action/report_editor/report_editor_xml/report_record_navigation.js */
odoo.define('@web_studio/client_action/report_editor/report_editor_xml/report_record_navigation',['@odoo/owl','@web/core/l10n/translation','@web/core/network/rpc','@web/core/pager/pager','@web/core/record_selectors/record_selector','@web/core/utils/hooks'],function(require){'use strict';let __exports={};const{Component,useState}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{rpc}=require("@web/core/network/rpc");const{Pager}=require("@web/core/pager/pager");const{RecordSelector}=require("@web/core/record_selectors/record_selector");const{useService}=require("@web/core/utils/hooks");const ReportRecordNavigation=__exports.ReportRecordNavigation=class ReportRecordNavigation extends Component{static components={RecordSelector,Pager};static template="web_studio.ReportEditor.ReportRecordNavigation";static props={onWillPrint:{type:Function,optional:true},};setup(){this.reportEditorModel=useState(this.env.reportEditorModel);this.action=useService("action");this.notification=useService("notification");}
get multiRecordSelectorProps(){const currentId=this.reportEditorModel.reportEnv.currentId;return{resModel:this.reportEditorModel.reportResModel,update:(resId)=>{this.reportEditorModel.loadReportHtml({resId});},resId:currentId,domain:this.reportEditorModel.getModelDomain(),context:{studio:false},};}
get pagerProps(){const{reportEnv}=this.reportEditorModel;const{ids,currentId}=reportEnv;return{limit:1,offset:ids.indexOf(currentId),total:ids.length,};}
updatePager({offset}){const ids=this.reportEditorModel.reportEnv.ids;const resId=ids[offset];this.reportEditorModel.loadReportHtml({resId});}
async printPreview(){const model=this.reportEditorModel;await this.props.onWillPrint?.();const recordId=model.reportEnv.currentId||model.reportEnv.ids.find((i)=>!!i)||false;if(!recordId){this.notification.add(_t("There is no record on which this report can be previewed. Create at least one record to preview the report."),{type:"danger",title:_t("Report preview not available"),});return;}
const action=await rpc("/web_studio/print_report",{record_id:recordId,report_id:model.editedReportId,});this.reportEditorModel.renderKey++;return this.action.doAction(action,{clearBreadcrumbs:true});}}
return __exports;});;

/* /web_studio/static/src/client_action/report_editor/utils.js */
odoo.define('@web_studio/client_action/report_editor/utils',[],function(require){'use strict';let __exports={};const PAPER_TO_CSS={margin_top:"padding-top",margin_left:"padding-left",margin_right:"padding-right",print_page_width:"width",print_page_height:"min-height",};__exports.getCssFromPaperFormat=getCssFromPaperFormat;function getCssFromPaperFormat(paperFormat,unit="mm"){return Object.entries(paperFormat).map((f)=>`${PAPER_TO_CSS[f[0]]}:${f[1]}${unit}`).join(";");}
const RECORDSET_RE=/(?<resModel>(\w+.?)*)\((?<resIds>(\d*,?)*)\)/;function recordSetReprToData(string){const{resModel,resIds}=string.match(RECORDSET_RE).groups;return{resModel,resIds:resIds.split(",").flatMap((id)=>(id?parseInt(id):[])),};}
__exports.humanReadableError=humanReadableError;function humanReadableError(error){if(error.data){error=error.data;}
let viewError;if(error.context?.view){const{resIds,resModel}=recordSetReprToData(error.context.view);const{resIds:parentIds}=recordSetReprToData(error.context["view.parent"]);const viewName=error.context.name;viewError={viewModel:resModel,completeName:error.context.xml_id?`${viewName} (${error.context.xml_id})`:viewName,resIds,resModel:error.context["view.model"],parentIds,};}
return{...error,traceback:error.debug,viewError,};}
__exports.visitNode=visitNode;function visitNode(el,callback){const iterators=[[el]];while(iterators.length){const it=iterators.pop();for(const _el of it){const doChildren=callback(_el);if(doChildren===false){continue;}
iterators.push(_el.children);}}}
return __exports;});;

/* /web_studio/static/src/client_action/studio_client_action.js */
odoo.define('@web_studio/client_action/studio_client_action',['@web/core/registry','@web/core/user','@web/core/utils/hooks','@web/webclient/actions/action_service','@web/webclient/menus/menu_helpers','@web_studio/client_action/app_creator/app_creator','@web_studio/client_action/editor/editor','@web_studio/client_action/navbar/navbar','@web_studio/client_action/studio_home_menu/studio_home_menu','@odoo/owl'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{user:originalUser}=require("@web/core/user");const{useBus,useService}=require("@web/core/utils/hooks");const{standardActionServiceProps}=require("@web/webclient/actions/action_service");const{computeAppsAndMenuItems,reorderApps}=require("@web/webclient/menus/menu_helpers");const{AppCreator}=require("@web_studio/client_action/app_creator/app_creator");const{Editor}=require("@web_studio/client_action/editor/editor");const{StudioNavbar}=require("@web_studio/client_action/navbar/navbar");const{StudioHomeMenu}=require("@web_studio/client_action/studio_home_menu/studio_home_menu");const{Component,onWillStart,onMounted,onPatched,onWillUnmount}=require("@odoo/owl");const StudioClientAction=__exports.StudioClientAction=class StudioClientAction extends Component{static template="web_studio.StudioClientAction";static target="fullscreen";static props={...standardActionServiceProps};static components={StudioNavbar,StudioHomeMenu,Editor,AppCreator,};setup(){const homemenuConfig=JSON.parse(originalUser.settings?.homemenu_config||"null");this.studio=useService("studio");useBus(this.studio.bus,"UPDATE",()=>{this.render();});this.menus=useService("menu");this.actionService=useService("action");let apps=computeAppsAndMenuItems(this.menus.getMenuAsTree("root")).apps;if(homemenuConfig){reorderApps(apps,homemenuConfig);}
this.homeMenuProps={apps:apps,};useBus(this.env.bus,"MENUS:APP-CHANGED",()=>{apps=computeAppsAndMenuItems(this.menus.getMenuAsTree("root")).apps;if(homemenuConfig){reorderApps(apps,homemenuConfig);}
this.homeMenuProps={apps:apps,};this.render();});onWillStart(()=>this.studio.ready);onMounted(()=>{document.body.classList.add("o_in_studio");this.studio.pushState();});onPatched(()=>this.studio.pushState());onWillUnmount(()=>document.body.classList.remove("o_in_studio"));}
async onNewAppCreated({action_id,menu_id}){await this.menus.reload();this.menus.setCurrentMenu(menu_id);const action=await this.actionService.loadAction(action_id);let initViewType="form";if(!action.views.some((vTuple)=>vTuple[1]===initViewType)){initViewType=action.views[0][1];}
this.studio.setParams({mode:this.studio.MODES.EDITOR,editorTab:"views",action,viewType:initViewType,});}}
registry.category("lazy_components").add("StudioClientAction",StudioClientAction);registry.category("actions").add("studio",StudioClientAction,{force:true});return __exports;});;

/* /web_studio/static/src/client_action/studio_home_menu/icon_creator_dialog/icon_creator_dialog.js */
odoo.define('@web_studio/client_action/studio_home_menu/icon_creator_dialog/icon_creator_dialog',['@web/core/dialog/dialog','@web/core/network/rpc','@web/core/user','@web/core/utils/hooks','@web_studio/client_action/icon_creator/icon_creator','@odoo/owl'],function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{rpc}=require("@web/core/network/rpc");const{user}=require("@web/core/user");const{useService}=require("@web/core/utils/hooks");const{IconCreator}=require("@web_studio/client_action/icon_creator/icon_creator");const{Component,useState}=require("@odoo/owl");const IconCreatorDialog=__exports.IconCreatorDialog=class IconCreatorDialog extends Component{static props={editedAppData:Object,appId:Number,close:Function,};static template="web_studio.IconCreatorDialog";static components={Dialog,IconCreator};setup(){this.menus=useService("menu");this.initialAppData={...this.props.editedAppData};this.editedAppData=useState(this.props.editedAppData);}
onIconChanged(icon){for(const key in this.editedAppData){delete this.editedAppData[key];}
for(const key in icon){this.editedAppData[key]=icon[key];}}
async saveIcon(){const{type}=this.initialAppData;const appId=this.props.appId;let iconValue;if(this.editedAppData.type!==type){if(this.editedAppData.type==="base64"){iconValue=this.editedAppData.uploaded_attachment_id;}else{const{iconClass,color,backgroundColor}=this.editedAppData;iconValue=[iconClass,color,backgroundColor];}}else if(this.editedAppData.type==="custom_icon"){const{iconClass,color,backgroundColor}=this.editedAppData;if(this.initialAppData.iconClass!==iconClass||this.initialAppData.color!==color||this.initialAppData.backgroundColor!==backgroundColor){iconValue=[iconClass,color,backgroundColor];}}else if(this.editedAppData.uploaded_attachment_id){iconValue=this.editedAppData.uploaded_attachment_id;}
if(iconValue){await rpc("/web_studio/edit_menu_icon",{context:user.context,icon:iconValue,menu_id:appId,});await this.menus.reload();}
this.props.close();}}
return __exports;});;

/* /web_studio/static/src/client_action/studio_home_menu/studio_home_menu.js */
odoo.define('@web_studio/client_action/studio_home_menu/studio_home_menu',['@web/core/l10n/translation','@web_enterprise/webclient/home_menu/home_menu','@web/core/utils/hooks','@web_studio/studio_service','@web_studio/client_action/studio_home_menu/icon_creator_dialog/icon_creator_dialog','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{HomeMenu}=require("@web_enterprise/webclient/home_menu/home_menu");const{useService}=require("@web/core/utils/hooks");const{NotEditableActionError}=require("@web_studio/studio_service");const{IconCreatorDialog}=require("@web_studio/client_action/studio_home_menu/icon_creator_dialog/icon_creator_dialog");const{onMounted,onWillUnmount,useRef}=require("@odoo/owl");const NEW_APP_BUTTON={isNewAppButton:true,label:_t("New App"),webIconData:"/web_studio/static/src/img/default_icon_app.png",};const StudioHomeMenu=__exports.StudioHomeMenu=class StudioHomeMenu extends HomeMenu{static props={apps:HomeMenu.props.apps};static template="web_studio.StudioHomeMenu";setup(){super.setup(...arguments);this.studio=useService("studio");this.notifications=useService("notification");this.dialog=useService("dialog");this.root=useRef("root");onMounted(()=>{this.canEditIcons=true;document.body.classList.add("o_home_menu_background");document.body.classList.toggle("o_home_menu_background_custom",this.menus.getMenu("root").backgroundImage);});onWillUnmount(()=>{document.body.classList.remove("o_home_menu_background","o_home_menu_background_custom");});}
get displayedApps(){return[...super.displayedApps,NEW_APP_BUTTON];}
async _openMenu(menu){if(menu.isNewAppButton){this.canEditIcons=false;return this.studio.setParams({mode:this.studio.MODES.APP_CREATOR});}else{try{await this.studio.open(this.studio.MODES.EDITOR,menu.actionID);this.menus.setCurrentMenu(menu);}catch(e){if(e instanceof NotEditableActionError){const options={type:"danger"};this.notifications.add(_t("This action is not editable by Studio"),options);return;}
throw e;}}}
_enableAppsSorting(){return false;}
onEditIconClick(app){if(!this.canEditIcons){return;}
const editedAppData={};if(app.webIconData){Object.assign(editedAppData,{webIconData:app.webIconData,type:"base64",});}else{Object.assign(editedAppData,{backgroundColor:app.webIcon.backgroundColor,color:app.webIcon.color,iconClass:app.webIcon.iconClass,type:"custom_icon",});}
const dialogProps={editedAppData,appId:app.id,};this.dialog.add(IconCreatorDialog,dialogProps);}}
return __exports;});;

/* /web_studio/static/src/client_action/utils.js */
odoo.define('@web_studio/client_action/utils',['@odoo/owl'],function(require){'use strict';let __exports={};const{reactive,useComponent,useEnv,useSubEnv}=require("@odoo/owl");__exports.getFieldsInArch=getFieldsInArch;function getFieldsInArch(xmlDoc){const res=[];const isInvisible=["True","1","true"];xmlDoc.querySelectorAll("field").forEach((el)=>{if(!el.parentElement.closest("field,groupby")){const invisible=el.getAttribute("invisible")||el.getAttribute("column_invisible");const dataUsedBy=el.getAttribute("data-used-by");if(dataUsedBy){return;}
if(!invisible||!isInvisible.includes(invisible)){res.push(el.getAttribute("name"));}}});return res;}
__exports.useDialogConfirmation=useDialogConfirmation;function useDialogConfirmation({confirm,cancel,before,close}){before=before||(()=>{});confirm=confirm||(()=>{});cancel=cancel||(()=>{});if(!close){const component=useComponent();close=()=>component.props.close();}
let isProtected=false;async function canExecute(){if(isProtected){return false;}
isProtected=true;await before();return true;}
async function execute(cb,...args){let succeeded=false;try{succeeded=await cb(...args);}catch(e){close();throw e;}
if(succeeded===undefined||succeeded){return close();}
isProtected=false;}
async function _confirm(...args){if(!(await canExecute())){return;}
return execute(confirm,...args);}
async function _cancel(...args){if(!(await canExecute())){return;}
return execute(cancel,...args);}
const env=useEnv();env.dialogData.dismiss=()=>_cancel();return{confirm:_confirm,cancel:_cancel};}
const Reactive=__exports.Reactive=class Reactive{constructor(){const raw=this;this.raw=()=>{return raw;};return reactive(this);}}
__exports.memoizeOnce=memoizeOnce;function memoizeOnce(callback){let key,value;return function(...args){if(key===args[0]){return value;}
key=args[0];value=callback.call(this,...args);return value;};}
__exports.useSubEnvAndServices=useSubEnvAndServices;function useSubEnvAndServices(env){const services=env.services;const bus=env.bus;useSubEnv(env);useSubEnv({services,bus});}
function topologicalSort(elems,getDependencies){const result=[];const visited=new Set();function visit(n){if(visited.has(n)){return;}
visited.add(n);if(!elems.includes(n)){return;}
for(const dep of getDependencies(n)){visit(dep);}
result.push(n);}
for(const el of elems){visit(el);}
return result;}
__exports.useServicesOverrides=useServicesOverrides;function useServicesOverrides(overrides){let env=useEnv();const services=Object.create(env.services);useSubEnv({services});env=useEnv();const getDependencies=(name)=>overrides[name]?.dependencies||[];const topoSorted=topologicalSort(Object.keys(overrides),getDependencies);for(const servName of topoSorted){services[servName]=overrides[servName].start(env,services);}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/default_view_sidebar/default_view_sidebar.js */
odoo.define('@web_studio/client_action/view_editor/default_view_sidebar/default_view_sidebar',['@odoo/owl','@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar','@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox'],function(require){'use strict';let __exports={};const{Component,useState}=require("@odoo/owl");const{InteractiveEditorSidebar}=require("@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar");const{SidebarViewToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox");const DefaultViewSidebar=__exports.DefaultViewSidebar=class DefaultViewSidebar extends Component{static template="web_studio.ViewEditor.DefaultViewSidebar";static props={openViewInForm:{type:Function,optional:true},openDefaultValues:{type:Function,optional:true},};static components={InteractiveEditorSidebar,SidebarViewToolbox,};setup(){this.viewEditorModel=useState(this.env.viewEditorModel);}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/calendar/calendar_editor.js */
odoo.define('@web_studio/client_action/view_editor/editors/calendar/calendar_editor',['@web/views/calendar/calendar_view','@web/core/registry','@odoo/owl','@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox','@web_studio/client_action/view_editor/editors/utils','@web/views/calendar/calendar_controller','@web_studio/client_action/view_editor/view_editor_model'],function(require){'use strict';let __exports={};const{calendarView}=require("@web/views/calendar/calendar_view");const{registry}=require("@web/core/registry");const{Component,useState}=require("@odoo/owl");const{InteractiveEditorSidebar}=require("@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{SidebarViewToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox");const{fieldsToChoices}=require("@web_studio/client_action/view_editor/editors/utils");const{SCALE_LABELS}=require("@web/views/calendar/calendar_controller");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");const CalendarEditorSidebar=__exports.CalendarEditorSidebar=class CalendarEditorSidebar extends Component{static template="web_studio.ViewEditor.CalendarEditorSidebar";static props={openViewInForm:{type:Function,optional:true},openDefaultValues:{type:Function,optional:true},};static components={InteractiveEditorSidebar,Property,SidebarViewToolbox,};setup(){this.viewEditorModel=useState(this.env.viewEditorModel);this.editArchAttributes=useEditNodeAttributes({isRoot:true});}
get archInfo(){return this.viewEditorModel.controllerProps.archInfo;}
onViewAttributeChanged(value,name){return this.editArchAttributes({[name]:value});}
get quickCreateFields(){return fieldsToChoices(this.viewEditorModel.fields,["char"],(field)=>field.store);}
get startDateFields(){return fieldsToChoices(this.viewEditorModel.fields,["date","datetime"]);}
get delayFields(){return fieldsToChoices(this.viewEditorModel.fields,["float","integer"]);}
get colorFields(){return fieldsToChoices(this.viewEditorModel.fields,["many2one","selection","integer"]);}
get allDayFields(){return fieldsToChoices(this.viewEditorModel.fields,["boolean"]);}
get modeChoices(){return this.viewEditorModel.controllerProps.archInfo.scales.map((value)=>{return{value,label:SCALE_LABELS[value],};});}}
registry.category("studio_editors").add("calendar",{...calendarView,Sidebar:CalendarEditorSidebar,});return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/cohort/cohort_editor.js */
odoo.define('@web_studio/client_action/view_editor/editors/cohort/cohort_editor',['@odoo/owl','@web/core/l10n/translation','@web/core/registry','@web_cohort/cohort_view','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar','@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox','@web_studio/client_action/view_editor/editors/utils','@web_studio/client_action/view_editor/view_editor_model'],function(require){'use strict';let __exports={};const{Component,useState}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{registry}=require("@web/core/registry");const{cohortView}=require("@web_cohort/cohort_view");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{InteractiveEditorSidebar}=require("@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar");const{SidebarViewToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox");const{fieldsToChoices}=require("@web_studio/client_action/view_editor/editors/utils");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");const CohortEditorSidebar=__exports.CohortEditorSidebar=class CohortEditorSidebar extends Component{static template="web_studio.ViewEditor.CohortEditorSidebar";static props={openViewInForm:{type:Function,optional:true},openDefaultValues:{type:Function,optional:true},};static components={InteractiveEditorSidebar,Property,SidebarViewToolbox,};setup(){this.viewEditorModel=useState(this.env.viewEditorModel);this.editArchAttributes=useEditNodeAttributes({isRoot:true});}
onViewAttributeChanged(value,name){value=value?value:"";return this.editArchAttributes({[name]:value});}
get modelParams(){return this.env.viewEditorModel.controllerProps.modelParams;}
get dateFields(){return fieldsToChoices(this.viewEditorModel.fields,["date","datetime"],(field)=>field.store);}
get measureFields(){return fieldsToChoices(this.viewEditorModel.fields,["integer","float","monetary"],(field)=>field.name!=="id"&&field.store&&field.aggregator);}
get intervalChoices(){return[{label:_t("Day"),value:"day"},{label:_t("Week"),value:"week"},{label:_t("Month"),value:"month"},{label:_t("Quarter"),value:"quarter"},{label:_t("Year"),value:"year"},];}
get modeChoices(){return[{label:_t("Retention"),value:"retention"},{label:_t("Churn"),value:"churn"},];}
get timelineChoices(){return[{label:_t("Forward"),value:"forward"},{label:_t("Backwards"),value:"backward"},];}}
registry.category("studio_editors").add("cohort",{...cohortView,Sidebar:CohortEditorSidebar,});return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/components/field_content_overlay.js */
odoo.define('@web_studio/client_action/view_editor/editors/components/field_content_overlay',['@web/core/l10n/translation','@odoo/owl','@web_studio/studio_service'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{Component,xml}=require("@odoo/owl");const{viewTypeToString}=require("@web_studio/studio_service");const FieldContentOverlay=__exports.FieldContentOverlay=class FieldContentOverlay extends Component{static template=xml`
    <div class="position-relative">
      <t t-slot="default" />
      <div class="o-web-studio-edit-x2manys-buttons w-100 h-100 d-flex justify-content-center gap-3 position-absolute start-0 top-0 opacity-75 bg-dark" t-if="props.displayOverlay" style="z-index: 1000;">
          <button class="btn btn-primary btn-secondary o_web_studio_editX2Many align-self-center"
          t-foreach="['list', 'form']" t-as="vType" t-key="vType"
          t-on-click.stop="() => props.onEditViewType(vType)"
          t-att-data-type="vType">
          <t t-esc="getButtonText(vType)" />
          </button>
      </div>
    </div>`;static props={displayOverlay:{type:Boolean},slots:{type:Object},onEditViewType:{type:Function},};getButtonText(viewType){return _t("Edit %s view",viewTypeToString(viewType));}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/components/field_selector_dialog.js */
odoo.define('@web_studio/client_action/view_editor/editors/components/field_selector_dialog',['@web/core/dialog/dialog','@odoo/owl'],function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{Component,useRef}=require("@odoo/owl");const FieldSelectorDialog=__exports.FieldSelectorDialog=class FieldSelectorDialog extends Component{static template="web_studio.FieldSelectorDialog";static components={Dialog};static props={close:{type:Function},onConfirm:{type:Function},fields:{type:Array},showNew:{type:Boolean,optional:true},};static defaultProps={showNew:false,};setup(){this.selectRef=useRef("select");}
onConfirm(){const field=this.selectRef.el.value;this.props.onConfirm(field);this.props.close();}
onCancel(){this.props.close();}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/components/field_studio.js */
odoo.define('@web_studio/client_action/view_editor/editors/components/field_studio',['@web/views/fields/field','@web_studio/client_action/view_editor/editors/components/field_content_overlay','@web_studio/client_action/view_editor/editors/utils','@odoo/owl'],function(require){'use strict';let __exports={};const{Field}=require("@web/views/fields/field");const{FieldContentOverlay}=require("@web_studio/client_action/view_editor/editors/components/field_content_overlay");const{useStudioRef,studioIsVisible}=require("@web_studio/client_action/view_editor/editors/utils");const{useState}=require("@odoo/owl");const FieldStudio=__exports.FieldStudio=class FieldStudio extends Field{static components={...Field.components,FieldContentOverlay};static template="web_studio.Field";setup(){super.setup();this.state=useState({displayOverlay:false,});useStudioRef("rootRef",this.onClick);}
get fieldComponentProps(){const fieldComponentProps=super.fieldComponentProps;if(this.type==="kanban.many2one_avatar_user"){fieldComponentProps.readonly=false;}
delete fieldComponentProps.studioXpath;delete fieldComponentProps.hasEmptyPlaceholder;delete fieldComponentProps.hasLabel;delete fieldComponentProps.studioIsVisible;return fieldComponentProps;}
get classNames(){const classNames=super.classNames;classNames["o_web_studio_show_invisible"]=!studioIsVisible(this.props);classNames["o-web-studio-editor--element-clickable"]=!!this.props.studioXpath;if(this.studioIsEmpty()){delete classNames["o_field_empty"];classNames["o_web_studio_widget_empty"]=true;classNames["text-muted"]=true;}
return classNames;}
studioIsEmpty(){const{name,record,hasLabel}=this.props;if(hasLabel){return false;}
if(this.type==="kanban.many2one_avatar_user"){return false;}
return"isEmpty"in this.field?this.field.isEmpty(record,name):!record.data[name];}
getEmptyPlaceholder(){const{hasEmptyPlaceholder,name,record,fieldInfo}=this.props;if(!hasEmptyPlaceholder){return false;}
return this.studioIsEmpty()&&(fieldInfo.string||record.fields[name].string);}
isX2ManyEditable(props){const{name,record}=props;const field=record.fields[name];if(!["one2many","many2many"].includes(field.type)){return false;}
return!!this.props.fieldInfo.field.useSubView;}
onEditViewType(viewType){const{name,record,studioXpath}=this.props;this.env.viewEditorModel.editX2ManyView({viewType,fieldName:name,record,xpath:studioXpath,fieldContext:this.fieldComponentProps.context,});}
onClick(ev){if(ev.target.classList.contains("o_web_studio_editX2Many")){return;}
ev.stopPropagation();ev.preventDefault();this.env.config.onNodeClicked(this.props.studioXpath);this.state.displayOverlay=!this.state.displayOverlay;}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/components/studio_hook_component.js */
odoo.define('@web_studio/client_action/view_editor/editors/components/studio_hook_component',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component,xml}=require("@odoo/owl");const formGrid=xml`
    <div class="o_web_studio_hook"
        t-attf-class="g-col-sm-{{ props.colSpan }}"
        t-att-data-xpath="props.xpath"
        t-att-data-position="props.position"
        t-att-data-type="props.type">
            <span class="o_web_studio_hook_separator" />
    </div>
`;const kanbanAsideHook=xml`
    <div t-attf-class="o_web_studio_hook mx-1 o_web_studio_hook position-absolute top-0 h-100 pe-none w-0 {{ props.position === 'before' ? 'start-0' : 'end-0'}}" t-att-data-type="props.type" t-att-data-xpath="props.xpath" t-att-data-position="props.position" data-structures="aside" />
`;const kanbanRibbon=xml`
    <div class="o_web_studio_hook position-absolute top-0 start-0 h-100 overflow-hidden m-0 p-0 pe-none w-0" t-att-data-type="props.type" t-att-data-xpath="props.xpath" data-position="inside" data-structures="ribbon">
        <div class="bg-primary opacity-0 position-absolute" style="transform:rotate(45deg); height: 25px; width: 140px; top: 10px; right: -30px;" />
    </div>
`;const kanbanInline=xml`
    <span class="o_web_studio_hook" t-att-data-xpath="props.xpath" t-att-data-position="props.position" t-att-data-type="props.type" t-att-data-infos="props.infos" t-att-data-structures="props.structures" />
`;const defaultTemplate=xml`
<div class="o_web_studio_hook" t-att-data-xpath="props.xpath" t-att-data-position="props.position" t-att-data-type="props.type" t-att-data-infos="props.infos" t-att-data-structures="props.structures">
    <span class="o_web_studio_hook_separator" />
</div>
`;const StudioHook=__exports.StudioHook=class StudioHook extends Component{static template=xml`<t t-call="{{ getTemplate(props.subTemplate) }}" />`;static props=["xpath?","position?","type?","colSpan?","subTemplate?","width?","infos?","structures?",];static subTemplates={formGrid,defaultTemplate,kanbanInline,kanbanAsideHook,kanbanRibbon,};getTemplate(templateName){return this.constructor.subTemplates[templateName||"defaultTemplate"];}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/components/view_button_studio.js */
odoo.define('@web_studio/client_action/view_editor/editors/components/view_button_studio',['@web/views/view_button/view_button','@web_studio/client_action/view_editor/editors/utils','@web/core/utils/hooks'],function(require){'use strict';let __exports={};const{ViewButton}=require("@web/views/view_button/view_button");const{useStudioRef,studioIsVisible}=require("@web_studio/client_action/view_editor/editors/utils");const{useBus}=require("@web/core/utils/hooks");const ViewButtonStudio=__exports.ViewButtonStudio=class ViewButtonStudio extends ViewButton{static template="web_studio.ViewButton";static props=[...ViewButton.props,"studioIsVisible?","studioXpath?"];setup(){super.setup();useStudioRef("rootRef");useBus(this.env.viewEditorModel.env.bus,"approval-update",()=>{this.approval.fetchApprovals();});}
getClassName(){let className=super.getClassName();if(!studioIsVisible(this.props)){className+=" o_web_studio_show_invisible";}
if(this.props.studioXpath){className+=" o-web-studio-editor--element-clickable";}
return className;}
onClick(ev){if(this.props.tag==="a"){ev.preventDefault();}
const target=ev.target.classList.contains("o-web-studio-editor--element-clickable")?ev.target:ev.target.closest("o-web-studio-editor--element-clickable");this.env.config.onNodeClicked(target?.getAttribute("studioxpath")||this.props.studioXpath);}
_shouldUseApproval(){return true;}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/components/view_fields.js */
odoo.define('@web_studio/client_action/view_editor/editors/components/view_fields',['@odoo/owl','@web/core/l10n/translation','@web_studio/client_action/components/sidebar_draggable_item/sidebar_draggable_item'],function(require){'use strict';let __exports={};const{Component,useState}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{SidebarDraggableItem}=require("@web_studio/client_action/components/sidebar_draggable_item/sidebar_draggable_item");const ExistingFields=__exports.ExistingFields=class ExistingFields extends Component{static components={SidebarDraggableItem};static props={fieldsInArch:{type:Array},fields:{type:Object},filterFields:{type:Boolean,optional:true},folded:{type:Boolean,optional:true},resModel:{type:String,optional:true},};static defaultProps={folded:true,filterFields:true,resModel:"",};static template="web_studio.ViewFields.ExistingFields";setup(){this.state=useState({folded:this.props.folded,searchValue:"",});}
isMatchingSearch(field){if(!this.state.searchValue){return true;}
const search=this.state.searchValue.toLowerCase();let matches=field.string.toLowerCase().includes(search);if(!matches&&this.env.debug&&field.name){matches=field.name.toLowerCase().includes(search);}
return matches;}
get existingFields(){const fieldsInArch=this.props.fieldsInArch;const filtered=Object.entries(this.props.fields).filter(([fName,field])=>{if(!this.isMatchingSearch(field)||(this.props.filterFields&&fieldsInArch.includes(fName))){return false;}
return true;});return filtered.map(([fName,field])=>({...field,name:fName,classType:field.type,dropData:JSON.stringify({fieldName:fName}),})).sort((fieldA,fieldB)=>(fieldA.string||fieldA.name).toLowerCase().localeCompare((fieldB.string||fieldB.name).toLowerCase()));}
getDropInfo(field){return{structure:"field",fieldName:field.name,isNew:false,};}}
const newFields=[{type:"char",string:_t("Text")},{type:"text",string:_t("Multine Text")},{type:"integer",string:_t("Integer")},{type:"float",string:_t("Decimal")},{type:"html",string:_t("HTML")},{type:"monetary",string:_t("Monetary")},{type:"date",string:_t("Date")},{type:"datetime",string:_t("Datetime")},{type:"boolean",string:_t("CheckBox")},{type:"selection",string:_t("Selection")},{type:"binary",string:_t("File"),widget:"file"},{type:"one2many",string:_t("Lines"),special:"lines"},{type:"one2many",string:_t("One2Many")},{type:"many2one",string:_t("Many2One")},{type:"many2many",string:_t("Many2Many")},{type:"binary",string:_t("Image"),widget:"image",name:"picture"},{type:"many2many",string:_t("Tags"),widget:"many2many_tags",name:"tags"},{type:"selection",string:_t("Priority"),widget:"priority"},{type:"binary",string:_t("Signature"),widget:"signature"},{type:"related",string:_t("Related Field")},];const NewFields=__exports.NewFields=class NewFields extends Component{static components={SidebarDraggableItem};static props={};static template="web_studio.ViewFields.NewFields";get newFieldsComponents(){return newFields.map((f)=>{const classType=f.special||f.name||f.widget||f.type;return{...f,name:classType,classType,dropData:JSON.stringify({fieldType:f.type,widget:f.widget,name:f.name,special:f.special,string:f.string,}),};});}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/components/view_structures.js */
odoo.define('@web_studio/client_action/view_editor/editors/components/view_structures',['@web_studio/client_action/components/sidebar_draggable_item/sidebar_draggable_item','@odoo/owl'],function(require){'use strict';let __exports={};const{SidebarDraggableItem}=require("@web_studio/client_action/components/sidebar_draggable_item/sidebar_draggable_item");const{Component}=require("@odoo/owl");const ViewStructures=__exports.ViewStructures=class ViewStructures extends Component{static components={SidebarDraggableItem};static template="web_studio.ViewStructures";static props={structures:{type:Object},};get isVisible(){return Object.values(this.props.structures).filter((e)=>!e.isVisible||e.isVisible(this.env.viewEditorModel)).length;}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/components/widget_studio.js */
odoo.define('@web_studio/client_action/view_editor/editors/components/widget_studio',['@web/views/widgets/widget','@web_studio/client_action/view_editor/editors/utils'],function(require){'use strict';let __exports={};const{Widget}=require("@web/views/widgets/widget");const{studioIsVisible,useStudioRef}=require("@web_studio/client_action/view_editor/editors/utils");const WidgetStudio=__exports.WidgetStudio=class WidgetStudio extends Widget{static template="web_studio.Widget";setup(){super.setup();useStudioRef("rootRef",this.onClick);}
get classNames(){const classNames=super.classNames;classNames["o_web_studio_show_invisible"]=!studioIsVisible(this.props);classNames["o-web-studio-editor--element-clickable"]=!!this.props.studioXpath;return classNames;}
get widgetProps(){const widgetProps=super.widgetProps;delete widgetProps.studioXpath;delete widgetProps.hasEmptyPlaceholder;delete widgetProps.hasLabel;delete widgetProps.studioIsVisible;return widgetProps;}
onClick(ev){ev.stopPropagation();ev.preventDefault();this.env.config.onNodeClicked(this.props.studioXpath);}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/form/chatter_container.js */
odoo.define('@web_studio/client_action/view_editor/editors/form/chatter_container',['@mail/chatter/web_portal/chatter','@mail/chatter/web/chatter_patch','@odoo/owl'],function(require){'use strict';let __exports={};const{Chatter}=require("@mail/chatter/web_portal/chatter");require("@mail/chatter/web/chatter_patch");const{Component}=require("@odoo/owl");const ChatterContainer=__exports.ChatterContainer=class ChatterContainer extends Chatter{static template="web_studio.ChatterContainer";static props=[...Chatter.props,"studioXpath?"];onClick(ev){this.env.config.onNodeClicked(this.props.studioXpath);}}
const ChatterContainerHook=__exports.ChatterContainerHook=class ChatterContainerHook extends Component{static template="web_studio.ChatterContainerHook";static components={Chatter};static props={chatterData:Object,threadModel:String,};onClick(){this.env.viewEditorModel.doOperation({type:"chatter",model:this.env.viewEditorModel.resModel,...this.props.chatterData,});}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/form/form_editor.js */
odoo.define('@web_studio/client_action/view_editor/editors/form/form_editor',['@web/views/form/form_view','@web_studio/client_action/view_editor/editors/form/form_editor_renderer/form_editor_renderer','@web_studio/client_action/view_editor/editors/form/form_editor_controller/form_editor_controller','@web_studio/client_action/view_editor/editors/form/form_editor_compiler','@web/core/registry','@web/core/utils/objects','@web_studio/client_action/view_editor/editors/utils','@web/views/view_compiler','@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/form_editor_sidebar'],function(require){'use strict';let __exports={};const{formView}=require("@web/views/form/form_view");const{FormEditorRenderer}=require("@web_studio/client_action/view_editor/editors/form/form_editor_renderer/form_editor_renderer");const{FormEditorController}=require("@web_studio/client_action/view_editor/editors/form/form_editor_controller/form_editor_controller");const{FormEditorCompiler}=require("@web_studio/client_action/view_editor/editors/form/form_editor_compiler");const{registry}=require("@web/core/registry");const{omit}=require("@web/core/utils/objects");const{makeModelErrorResilient,randomName,}=require("@web_studio/client_action/view_editor/editors/utils");const{getModifier}=require("@web/views/view_compiler");const{FormEditorSidebar}=require("@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/form_editor_sidebar");const{getStudioNoFetchFields}=require("@web_studio/client_action/view_editor/editors/utils");class EditorArchParser extends formView.ArchParser{parse(){const archInfo=super.parse(...arguments);this.omitStudioNoFetchFields(archInfo);archInfo.disableAutofocus=true;return archInfo;}
omitStudioNoFetchFields(archInfo){const noFetch=getStudioNoFetchFields(archInfo.fieldNodes);archInfo.fieldNodes=omit(archInfo.fieldNodes,...noFetch.fieldNodes);for(const fieldNode of Object.values(archInfo.fieldNodes)){if(fieldNode.views){for(const fieldArchInfo of Object.values(fieldNode.views)){this.omitStudioNoFetchFields(fieldArchInfo);}}}}}
class Model extends formView.Model{}
Model.Record=class RecordNoEdit extends formView.Model.Record{get isInEdition(){return false;}
_save(){return true;}};const formEditor=__exports.formEditor={...formView,ArchParser:EditorArchParser,Compiler:FormEditorCompiler,Renderer:FormEditorRenderer,Controller:FormEditorController,props(genericProps,editor,config){const arch=genericProps.arch;Array.from(arch.querySelectorAll("field > list, field > form, field > kanban")).forEach((el)=>{if(getModifier(el,"invisible")){el.remove();}});const props=formView.props(genericProps,editor,config);props.Model=makeModelErrorResilient(Model,props.archInfo.activeActions);props.preventEdit=true;return props;},Sidebar:FormEditorSidebar,};registry.category("studio_editors").add("form",formEditor);const HOOK_CLASS_WHITELIST=["o_web_studio_field_signature","o_web_studio_field_html","o_web_studio_field_many2many","o_web_studio_field_one2many","o_web_studio_field_tabs","o_web_studio_field_columns","o_web_studio_field_lines",];const HOOK_TYPE_BLACKLIST=["genericTag","afterGroup","afterNotebook","insideSheet"];const isBlackListedHook=(draggedEl,hookEl)=>!HOOK_CLASS_WHITELIST.some((cls)=>draggedEl.classList.contains(cls))&&HOOK_TYPE_BLACKLIST.some((t)=>hookEl.dataset.type===t);function canDropNotebook(hookEl){if(hookEl.dataset.type==="page"){return false;}
if(hookEl.closest(".o_group")||hookEl.closest(".o_inner_group")){return false;}
return true;}
function canDropGroup(hookEl){if(hookEl.dataset.type==="insideGroup"){return false;}
if(hookEl.closest(".o_group")||hookEl.closest(".o_inner_group")){return false;}
return true;}
function isValidFormHook({hook,element}){const draggingStructure=element.dataset.structure;switch(draggingStructure){case"notebook":{if(!canDropNotebook(hook)){return false;}
break;}
case"group":{if(!canDropGroup(hook)){return false;}
break;}}
if(isBlackListedHook(element,hook)){return false;}
return true;}
formEditor.isValidHook=isValidFormHook;function addFormViewStructure(structure){switch(structure){case"notebook":case"group":{return{node:{tag:structure,attrs:{name:randomName(`studio_${structure}`),},},};}}}
formEditor.addViewStructure=addFormViewStructure;return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/form/form_editor_compiler.js */
odoo.define('@web_studio/client_action/view_editor/editors/form/form_editor_compiler',['@web/views/view_compiler','@web_studio/client_action/view_editor/editors/xml_utils','@web/core/utils/xml','@web/views/form/form_view','@web/views/form/form_compiler'],function(require){'use strict';let __exports={};const{isComponentNode}=require("@web/views/view_compiler");const{computeXpath,applyInvisible,}=require("@web_studio/client_action/view_editor/editors/xml_utils");const{createElement}=require("@web/core/utils/xml");const{formView}=require("@web/views/form/form_view");const{objectToString}=require("@web/views/form/form_compiler");const interestingSelector=[":not(field) sheet",":not(field) field:not([data-used-by])",":not(field) notebook",":not(field) page",":not(field) button",":not(field) label",":not(field) group",":not(field) group:not(:has(> group)) > *",":not(field) chatter",":not(field) .oe_avatar",":not(field) widget",].join(", ");const FormEditorCompiler=__exports.FormEditorCompiler=class FormEditorCompiler extends formView.Compiler{compile(key,params={}){const xml=this.templates[key];for(const el of xml.querySelectorAll(interestingSelector)){const xpath=computeXpath(el);el.setAttribute("studioXpath",xpath);}
this.addChatter=true;this.chatterData={remove_message_ids:false,remove_follower_ids:false,remove_activity_ids:false,};this.avatars=[];const mainSheet=xml.querySelector("sheet:not(field sheet)");const isSheetEmpty=!mainSheet||!mainSheet.firstElementChild;const compiled=super.compile(key,params);const sheetBg=compiled.querySelector(".o_form_sheet_bg");if(sheetBg){let studioHook;if(isSheetEmpty){studioHook=createElement("StudioHook",{xpath:`"${sheetBg.getAttribute("studioXpath")}"`,position:"'inside'",type:"'insideSheet'",});}else{studioHook=createElement("StudioHook",{xpath:`"${sheetBg.getAttribute("studioXpath")}/*[1]"`,position:"'before'",type:"'insideSheet'",});}
sheetBg.querySelector(".o_form_sheet").prepend(studioHook);}
if(this.addChatter){const chatterContainerHook=createElement("ChatterContainerHook",{threadModel:`__comp__.props.record.resModel`,chatterData:objectToString(this.chatterData),});const el=compiled.querySelector(".o_form_sheet")||compiled;el.after(chatterContainerHook);}else{const parent=compiled.querySelector(".o-mail-Form-chatter");parent.removeAttribute("t-attf-class");parent.removeAttribute("t-if");}
const checkStatusBarButtons=compiled.querySelector("StatusBarButtons");if(!checkStatusBarButtons){const addButtonAction=createElement("AddButtonAction");const el=compiled.querySelector(".o_form_sheet_bg")||compiled;el.prepend(addButtonAction);}
const fieldStatus=compiled.querySelector(`Field[type="'statusbar'"]`);if(!fieldStatus){const addStatusBar=!compiled.querySelector(".o_form_statusbar");const statusBarFieldHook=createElement("StatusBarFieldHook",{addStatusBar});const el=compiled.querySelector(".o_form_sheet_bg")||compiled;el.prepend(statusBarFieldHook);}
const buttonBoxXml=xml.querySelector("div[name='button_box']:not(field div)");let buttonBox;if(buttonBoxXml){for(const child of[...buttonBoxXml.children]){if(child.matches("span,field")){buttonBoxXml.removeChild(child);}}
buttonBox=this.compileNode(buttonBoxXml,params);}else{buttonBox=createElement("ButtonBox");}
const el=compiled.querySelector(".o_form_sheet_bg")||compiled;el.prepend(buttonBox);const buttonHook=createElement("t",[createElement("ButtonHook",{add_buttonbox:!buttonBoxXml})],{"t-set-slot":`slot_button_hook`});buttonBox.insertAdjacentElement("afterbegin",buttonHook);const title=compiled.querySelector(".oe_title");if(title){if(!title.querySelector(":scope > h1 > [isAvatar]")&&!title.parentElement.querySelector(":scope > [isAvatar]")){const avatarHook=createElement("AvatarHook",{fields:`__comp__.props.record.fields`,});title.before(avatarHook);}}
for(const el of this.avatars){el.removeAttribute("isAvatar");}
compiled.querySelectorAll(":not(.o_form_statusbar) Field").forEach((el)=>{el.setAttribute("hasEmptyPlaceholder","true");});compiled.querySelectorAll(`InnerGroup > t[t-set-slot][subType="'item_component'"] Field`).forEach((el)=>{el.setAttribute("hasLabel","true");});return compiled;}
applyInvisible(invisible,compiled,params){return applyInvisible(invisible,compiled,params);}
createLabelFromField(fieldId,fieldName,fieldString,label,params){const studioXpath=label.getAttribute("studioXpath");const formLabel=super.createLabelFromField(...arguments);formLabel.setAttribute("studioXpath",`"${studioXpath}"`);if(formLabel.hasAttribute("t-if")){formLabel.setAttribute("studioIsVisible",formLabel.getAttribute("t-if"));formLabel.removeAttribute("t-if");}
return formLabel;}
compileNode(node,params={},evalInvisible=true){if(node.tagName==="field"&&node.hasAttribute("data-used-by")){return;}
const nodeType=node.nodeType;const currentSlot=params.currentSlot;if(nodeType===1&&currentSlot&&!currentSlot.hasAttribute("studioXpath")){const parentElement=node.parentElement;if(parentElement&&parentElement.tagName==="page"){const xpath=computeXpath(node.parentElement);currentSlot.setAttribute("studioXpath",`"${xpath}"`);if(!parentElement.querySelector(":scope > group:last-child > group")){const pageHookProps={position:"'inside'",type:"'page'",xpath:`"${xpath}"`,};currentSlot.setAttribute("studioHookProps",objectToString(pageHookProps));}}else{const xpath=node.getAttribute("studioXpath");currentSlot.setAttribute("studioXpath",`"${xpath}"`);}}
if(nodeType===1&&node.getAttribute("studio_no_fetch")){return;}
const compiled=super.compileNode(node,{...params,compileInvisibleNodes:true},true);if(nodeType===1){if(node.hasAttribute("studioXpath")){const xpath=node.getAttribute("studioXpath");if(isComponentNode(compiled)){compiled.setAttribute("studioXpath",`"${xpath}"`);}else if(!compiled.hasAttribute("studioXpath")){compiled.setAttribute("studioXpath",xpath);}}
if(node.tagName==="notebook"){const originalChildren=Array.from(node.children).filter((e)=>e.tagName==="page");Array.from(compiled.children).forEach((elem,index)=>{if(!elem.hasAttribute("studioXpath")){const studioXpath=originalChildren[index].getAttribute("studioXpath");elem.setAttribute("studioXpath",`"${studioXpath}"`);const pageHookProps={position:"'inside'",type:"'page'",xpath:`"${studioXpath}"`,};elem.setAttribute("studioHookProps",objectToString(pageHookProps));}});}
if(node.tagName==="chatter"){this.addChatter=false;const chatterNode=compiled.querySelector("t[t-component='__comp__.mailComponents.Chatter']");const xpath=node.getAttribute("studioXpath");chatterNode.setAttribute("studioXpath",`"${xpath}"`);compiled.setAttribute("data-studio-xpath",xpath);compiled.classList.add("o-web-studio-editor--element-clickable");}
if(node.classList.contains("oe_avatar")){compiled.setAttribute("isAvatar",true);this.avatars.push(compiled);}
if(node.classList.contains("o_td_label")&&!node.children.length&&!node.textContent.trim()){compiled.classList.add("o-web-studio-editor--element-clickable");const xpath=node.getAttribute("studioXpath");compiled.setAttribute("t-on-click",`(ev) => __comp__.env.config.onNodeClicked("${xpath}")`);}
const name=node.getAttribute("name");if(name==="message_ids"){this.chatterData.remove_message_ids=true;}else if(name==="message_follower_ids"){this.chatterData.remove_follower_ids=true;}else if(name==="activity_ids"){this.chatterData.remove_activity_ids=true;}}
return compiled;}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/form/form_editor_controller/form_editor_controller.js */
odoo.define('@web_studio/client_action/view_editor/editors/form/form_editor_controller/form_editor_controller',['@odoo/owl','@web/views/form/form_view','@web_studio/client_action/view_editor/editors/utils'],function(require){'use strict';let __exports={};const{useState,onMounted,onPatched}=require("@odoo/owl");const{formView}=require("@web/views/form/form_view");const{useModelConfigFetchInvisible}=require("@web_studio/client_action/view_editor/editors/utils");function useExternalParentInModel(model,parentRecord){model._createRoot=(config,data)=>{return new model.constructor.Record(model,config,data,{parentRecord});};}
const FormEditorController=__exports.FormEditorController=class FormEditorController extends formView.Controller{static props={...formView.Controller.props,parentRecord:{type:[Object,{value:null}],optional:true},};setup(){super.setup();useModelConfigFetchInvisible(this.model);this.mailTemplate=null;this.hasFileViewerInArch=false;this.viewEditorModel=useState(this.env.viewEditorModel);if(this.props.parentRecord){useExternalParentInModel(this.model,this.props.parentRecord);}
onMounted(()=>{const xpath=this.viewEditorModel.lastActiveNodeXpath;if(xpath&&xpath.includes("notebook")){const tabXpath=xpath.match(/.*\/page\[\d+\]/)[0];const tab=document.querySelector(`[data-studio-xpath='${tabXpath}'] a`);if(tab){this.notebookElementData={xpath,restore:Boolean(this.viewEditorModel.activeNodeXpath),sidebarTab:this.viewEditorModel.sidebarTab,isTab:xpath.length===tabXpath.length,};tab.click();}}else{this.notebookElementData=null;}});onPatched(()=>{if(this.notebookElementData){if(this.notebookElementData.isTab&&this.viewEditorModel.lastActiveNodeXpath!==this.notebookElementData.xpath){return;}
if(this.notebookElementData.restore){this.env.config.onNodeClicked(this.notebookElementData.xpath);}else{this.viewEditorModel.resetSidebar(this.notebookElementData.sidebarTab);}
this.notebookElementData=null;}});}
beforeUnload(){}
_shouldUseSubEnv(){return false;}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/form/form_editor_renderer/form_editor_groups.js */
odoo.define('@web_studio/client_action/view_editor/editors/form/form_editor_renderer/form_editor_groups',['@web/views/form/form_view','@web_studio/client_action/view_editor/editors/utils','@web_studio/client_action/view_editor/editors/components/studio_hook_component','@odoo/owl'],function(require){'use strict';let __exports={};const{formView}=require("@web/views/form/form_view");const{studioIsVisible}=require("@web_studio/client_action/view_editor/editors/utils");const{StudioHook}=require("@web_studio/client_action/view_editor/editors/components/studio_hook_component");const{Component,useEffect,useRef,useState}=require("@odoo/owl");const components=formView.Renderer.components;function extendGroup(GroupClass){class Group extends GroupClass{static props=[...GroupClass.props,"studioXpath?","studioIsVisible?"];static components={...GroupClass.components,StudioHook};setup(){super.setup();this.viewEditorModel=useState(this.env.viewEditorModel);this.rootRef=useRef("rootRef");}
get allClasses(){let classes=super.allClasses;if(!studioIsVisible(this.props)){classes=`${classes || ""} o_web_studio_show_invisible`;}
if(this.props.studioXpath){classes=`${classes || ""} o-web-studio-editor--element-clickable`;}
return classes;}
_getItems(){const items=super._getItems();return items.map(([k,v])=>{v=Object.assign({},v);v.studioIsVisible=v.isVisible;v.isVisible=v.isVisible||this.viewEditorModel.showInvisible;if(v.subType==="item_component"){v.props.studioIsVisible=v.studioIsVisible;v.props.studioXpath=v.studioXpath;}
return[k,v];});}
onGroupClicked(ev){if(ev.target.closest(".o-web-studio-editor--element-clickable")!==this.rootRef.el){return;}
this.env.config.onNodeClicked(this.props.studioXpath);}}
return Group;}
class InnerGroupItemComponent extends Component{static template="web_studio.Form.InnerGroup.ItemComponent";static props={cell:{type:Object},slots:{type:Object},};setup(){const labelRef=useRef("labelRef");const fieldRef=useRef("fieldRef");this.labelRef=labelRef;useEffect((studioIsVisible,labelEl,fieldEl)=>{if(labelEl){const clickable=labelEl.querySelector(".o-web-studio-editor--element-clickable");if(clickable){clickable.classList.remove("o-web-studio-editor--element-clickable");}
labelEl.classList.add("o-web-studio-editor--element-clickable");const invisible=labelEl.querySelector(".o_web_studio_show_invisible");if(invisible){invisible.classList.remove("o_web_studio_show_invisible");}
labelEl.classList.toggle("o_web_studio_show_invisible",!studioIsVisible);labelEl.classList.add("o-draggable");}
if(fieldEl){const clickable=fieldEl.querySelector(".o-web-studio-editor--element-clickable");if(clickable){clickable.classList.remove("o-web-studio-editor--element-clickable");}
const invisible=fieldEl.querySelector(".o_web_studio_show_invisible");if(invisible){invisible.classList.remove("o_web_studio_show_invisible");}
fieldEl.classList.add("o-web-studio-element-ghost");}},()=>[this.cell.studioIsVisible,labelRef.el,fieldRef.el]);this.onMouseFieldIO=(ev)=>{labelRef.el.classList.toggle("o-web-studio-ghost-hovered",ev.type==="mouseover");};}
get cell(){return this.props.cell;}
onClicked(ev){if(ev.target.closest(".o-web-studio-element-ghost")){ev.stopPropagation();}
this.env.config.onNodeClicked(this.cell.studioXpath);}}
const _InnerGroup=extendGroup(components.InnerGroup);const InnerGroup=__exports.InnerGroup=class InnerGroup extends _InnerGroup{static template="web_studio.Form.InnerGroup";getRows(){const rows=super.getRows();if(!this.viewEditorModel.showInvisible){rows.forEach((row)=>{row.isVisible=row.some((cell)=>cell.studioIsVisible);});}
return rows;}
getStudioHooks(){const hooks=new Map();const rows=this.getRows();const hasRows=rows.length>=1&&rows[0].length;if(!hasRows){hooks.set("inside",{xpath:this.props.studioXpath,position:"inside",subTemplate:"formGrid",colSpan:this.props.maxCols,});}
for(const rowIdx in rows){const row=rows[rowIdx];const colSpan=row.reduce((acc,val)=>acc+val.itemSpan||1,0);if(!hooks.has("beforeFirst")){const cell=row[0];if(cell){hooks.set("beforeFirst",{xpath:cell.studioXpath,position:"before",subTemplate:"formGrid",width:cell.width,colSpan,});}}
if(row.every((cell)=>!cell.studioIsVisible)&&!this.viewEditorModel.showInvisible){continue;}
const cell=row[row.length-1];if(cell){hooks.set(`afterRow ${rowIdx}`,{xpath:cell.studioXpath,position:"after",subTemplate:"formGrid",width:cell.width,colSpan,});}}
return hooks;}}
InnerGroup.components.InnerGroupItemComponent=InnerGroupItemComponent;const OuterGroup=__exports.OuterGroup=extendGroup(components.OuterGroup);OuterGroup.template="web_studio.Form.OuterGroup";return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/form/form_editor_renderer/form_editor_renderer.js */
odoo.define('@web_studio/client_action/view_editor/editors/form/form_editor_renderer/form_editor_renderer',['@odoo/owl','@web/views/form/form_view','@web_studio/client_action/view_editor/editors/form/form_editor_renderer/form_editor_renderer_components','@web_studio/client_action/view_editor/editors/form/chatter_container','@web_studio/client_action/view_editor/editors/components/studio_hook_component','@web_studio/client_action/view_editor/editors/components/field_studio','@web_studio/client_action/view_editor/editors/components/widget_studio','@web_studio/client_action/view_editor/editors/components/view_button_studio','@web_studio/client_action/view_editor/editors/form/form_editor_renderer/form_editor_groups','@web_studio/client_action/view_editor/interactive_editor/action_button/action_button'],function(require){'use strict';let __exports={};const{useRef,useEffect,useState}=require("@odoo/owl");const{formView}=require("@web/views/form/form_view");const formEditorRendererComponents=require("@web_studio/client_action/view_editor/editors/form/form_editor_renderer/form_editor_renderer_components");const{ChatterContainer,ChatterContainerHook}=require("@web_studio/client_action/view_editor/editors/form/chatter_container");const{StudioHook}=require("@web_studio/client_action/view_editor/editors/components/studio_hook_component");const{FieldStudio}=require("@web_studio/client_action/view_editor/editors/components/field_studio");const{WidgetStudio}=require("@web_studio/client_action/view_editor/editors/components/widget_studio");const{ViewButtonStudio}=require("@web_studio/client_action/view_editor/editors/components/view_button_studio");const{InnerGroup,OuterGroup}=require("@web_studio/client_action/view_editor/editors/form/form_editor_renderer/form_editor_groups");const{AddButtonAction}=require("@web_studio/client_action/view_editor/interactive_editor/action_button/action_button");class Setting extends formView.Renderer.components.Setting{static props={...formView.Renderer.components.Setting.props,studioXpath:{type:String,optional:true},studioIsVisible:{type:Boolean,optional:true},};}
const FormEditorRenderer=__exports.FormEditorRenderer=class FormEditorRenderer extends formView.Renderer{static components={...formView.Renderer.components,...formEditorRendererComponents,Field:FieldStudio,Widget:WidgetStudio,ViewButton:ViewButtonStudio,ChatterContainerHook,InnerGroup,OuterGroup,StudioHook,Setting,AddButtonAction,};setup(){super.setup();const rootRef=useRef("compiled_view_root");this.rootRef=rootRef;const viewEditorModel=this.env.viewEditorModel;this.viewEditorModel=useState(viewEditorModel);this.mailComponents.Chatter=ChatterContainer;useEffect((rootEl,showInvisible)=>{if(!rootEl){return;}
rootEl.classList.add("o_web_studio_form_view_editor");if(showInvisible){rootEl.querySelectorAll(":not(.o-mail-Form-chatter) .o_invisible_modifier").forEach((el)=>{el.classList.add("o_web_studio_show_invisible");el.classList.remove("o_invisible_modifier");});}else{rootEl.querySelectorAll(":not(.o-mail-Form-chatter) .o_web_studio_show_invisible").forEach((el)=>{el.classList.remove("o_web_studio_show_invisible");el.classList.add("o_invisible_modifier");});}},()=>[rootRef.el,viewEditorModel.showInvisible]);useEffect((rootEl)=>{if(rootEl){const optCols=rootEl.querySelectorAll("i.o_optional_columns_dropdown_toggle");for(const col of optCols){col.classList.add("text-muted");}}},()=>[rootRef.el]);}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/form/form_editor_renderer/form_editor_renderer_components.js */
odoo.define('@web_studio/client_action/view_editor/editors/form/form_editor_renderer/form_editor_renderer_components',['@web/views/form/form_view','@web_studio/client_action/view_editor/editors/components/studio_hook_component','@web_studio/client_action/view_editor/interactive_editor/properties/button_properties/new_button_box_dialog','@web_studio/client_action/view_editor/editors/components/field_selector_dialog','@web_studio/client_action/view_editor/interactive_editor/field_configuration/selection_content_dialog','@web_studio/client_action/view_editor/editors/utils','@web/core/l10n/translation','@web/core/utils/hooks','@odoo/owl','@web_studio/client_action/view_editor/interactive_editor/action_button/action_button'],function(require){'use strict';let __exports={};const{formView}=require("@web/views/form/form_view");const{StudioHook}=require("@web_studio/client_action/view_editor/editors/components/studio_hook_component");const{NewButtonBoxDialog}=require("@web_studio/client_action/view_editor/interactive_editor/properties/button_properties/new_button_box_dialog");const{FieldSelectorDialog}=require("@web_studio/client_action/view_editor/editors/components/field_selector_dialog");const{SelectionContentDialog}=require("@web_studio/client_action/view_editor/interactive_editor/field_configuration/selection_content_dialog");const{randomName,studioIsVisible,useStudioRef,}=require("@web_studio/client_action/view_editor/editors/utils");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{useOwnedDialogs}=require("@web/core/utils/hooks");const{Component,useState,useRef}=require("@odoo/owl");const{AddButtonAction}=require("@web_studio/client_action/view_editor/interactive_editor/action_button/action_button");const components=formView.Renderer.components;const FormLabel=__exports.FormLabel=class FormLabel extends components.FormLabel{static template="web_studio.FormLabel";static props={...components.FormLabel.props,studioXpath:String,studioIsVisible:{type:Boolean,optional:true},};setup(){super.setup();useStudioRef("rootRef",this.onClick);}
get className(){let className=super.className;if(!studioIsVisible(this.props)){className+=" o_web_studio_show_invisible";}
className+=" o-web-studio-editor--element-clickable";return className;}
onClick(ev){ev.preventDefault();ev.stopPropagation();this.env.config.onNodeClicked(this.props.studioXpath);}}
const Notebook=__exports.Notebook=class Notebook extends components.Notebook{static template="web_studio.Notebook.Hook";static components={...components.Notebook.components,StudioHook};static props={...components.Notebook.props,studioIsVisible:{type:Boolean,optional:true},studioXpath:String,};setup(){this.viewEditorModel=useState(this.env.viewEditorModel);super.setup();}
computePages(props){const pages=super.computePages(props);pages.forEach((p)=>{p[1].studioIsVisible=p[1].isVisible;p[1].isVisible=p[1].isVisible||this.viewEditorModel.showInvisible;});return pages;}
onNewPageClicked(){const vem=this.viewEditorModel;const node={tag:"page",attrs:{string:_t("New Page"),name:randomName("studio_page"),},};vem.doOperation({type:"add",node,target:vem.getFullTarget(this.props.studioXpath),position:"inside",});}}
const StatusBarButtons=__exports.StatusBarButtons=class StatusBarButtons extends components.StatusBarButtons{static template=`web_studio.FormViewAddButtonAction`;static components={...components.StatusBarButtons.components,AddButtonAction,};}
const StatusBarFieldHook=__exports.StatusBarFieldHook=class StatusBarFieldHook extends Component{static template="web_studio.AddElementHook";static props={addStatusBar:{type:Boolean},};setup(){this.addDialog=useOwnedDialogs();}
get classNames(){return"o_web_studio_statusbar_hook";}
get title(){return _t("Add a pipeline status bar");}
onClick(){this.addDialog(SelectionContentDialog,{defaultChoices:[["status1",_t("First Status")],["status2",_t("Second Status")],["status3",_t("Third Status")],],onConfirm:(choices)=>{const viewEditorModel=this.env.viewEditorModel;if(this.props.addStatusBar){viewEditorModel.pushOperation({type:"statusbar"});}
const target={tag:"header",};const subViewXpath=viewEditorModel.getSubviewXpath();if(subViewXpath){target.subview_xpath=subViewXpath;}
viewEditorModel.doOperation({type:"add",target,position:"inside",node:{attrs:{widget:"statusbar",options:"{'clickable': '1'}",},field_description:{default_value:true,field_description:_t("Pipeline status bar"),model_name:viewEditorModel.resModel,name:randomName(`x_studio_selection_field`),selection:JSON.stringify(choices),type:"selection",},tag:"field",},});},});}}
const AvatarHook=__exports.AvatarHook=class AvatarHook extends Component{static template="web_studio.AddElementHook";static props={fields:Object};setup(){this.addDialog=useOwnedDialogs();}
get classNames(){return"oe_avatar ms-3 o_web_studio_avatar";}
get title(){return _t("Add Picture");}
onClick(){const fields=[];for(const field of Object.values(this.props.fields)){if(field.type==="binary"){fields.push(field);}}
this.addDialog(FieldSelectorDialog,{fields,showNew:true,onConfirm:(field)=>{this.env.viewEditorModel.doOperation({type:"avatar_image",field,});},});}}
const ButtonHook=__exports.ButtonHook=class ButtonHook extends Component{static template="web_studio.AddElementHook";static props={add_buttonbox:{type:Boolean,optional:true},studioIsVisible:{type:Boolean,optional:true},};setup(){this.addDialog=useOwnedDialogs();}
get classNames(){return"oe_stat_button o_web_studio_button_hook flex-grow-1 flex-lg-grow-0 fa fa-plus-square";}
get tooltip(){return _t("Add a button");}
onClick(){this.addDialog(NewButtonBoxDialog,{model:this.env.viewEditorModel,isAddingButtonBox:Boolean(this.props.add_buttonbox),});}}
const ButtonBox=__exports.ButtonBox=class ButtonBox extends components.ButtonBox{static template="web_studio.ButtonBox";static components={};static props={...components.ButtonBox.props,studioIsVisible:{type:Boolean,optional:true},};setup(){super.setup();this.togglerRef=useRef("toggleRef");this.viewEditorModel=useState(this.env.viewEditorModel);this.expanded=useState({value:false});}
toggle(){this.expanded.value=!this.expanded.value;this.togglerRef.el.classList.toggle("show",this.expanded.value);this.togglerRef.el.ariaExpanded=this.expanded.value;}
isSlotVisible(slot){if(this.viewEditorModel.isEditingSubview){return false;}
return this.viewEditorModel.showInvisible||super.isSlotVisible(slot);}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/form/form_editor_sidebar/form_editor_sidebar.js */
odoo.define('@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/form_editor_sidebar',['@odoo/owl','@web/core/utils/hooks','@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar','@web_studio/client_action/view_editor/editors/components/view_fields','@web_studio/client_action/view_editor/editors/components/view_structures','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/properties/properties','@web_studio/client_action/view_editor/interactive_editor/properties/button_properties/button_properties','@web_studio/client_action/view_editor/interactive_editor/properties/field_properties/field_properties','@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/group_properties/group_properties','@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/label_properties/label_properties','@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/page_properties/page_properties','@web/core/l10n/translation','@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox','@web_studio/client_action/view_editor/view_editor_model','@web_studio/client_action/view_editor/interactive_editor/properties/widget_properties/widget_properties','@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/o_td_label_properties/o_td_label_properties'],function(require){'use strict';let __exports={};const{Component,useState}=require("@odoo/owl");const{useService}=require("@web/core/utils/hooks");const{InteractiveEditorSidebar}=require("@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar");const{ExistingFields,NewFields,}=require("@web_studio/client_action/view_editor/editors/components/view_fields");const{ViewStructures}=require("@web_studio/client_action/view_editor/editors/components/view_structures");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{Properties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/properties");const{ButtonProperties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/button_properties/button_properties");const{FieldProperties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/field_properties/field_properties");const{GroupProperties}=require("@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/group_properties/group_properties");const{LabelProperties}=require("@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/label_properties/label_properties");const{PageProperties}=require("@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/page_properties/page_properties");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{SidebarViewToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");const{WidgetProperties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/widget_properties/widget_properties");const{OTdLabelProperties}=require("@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/o_td_label_properties/o_td_label_properties");const FormEditorSidebar=__exports.FormEditorSidebar=class FormEditorSidebar extends Component{static template="web_studio.ViewEditor.FormEditorSidebar";static props={openViewInForm:{type:Function,optional:true},openDefaultValues:{type:Function,optional:true},};static components={InteractiveEditorSidebar,NewFields,ExistingFields,Property,Properties,ViewStructures,SidebarViewToolbox,};static get viewStructures(){return{notebook:{name:_t("Tabs"),class:"o_web_studio_field_tabs",},group:{name:_t("Column"),class:"o_web_studio_field_columns",},};}
setup(){this.dialog=useService("dialog");this.viewEditorModel=useState(this.env.viewEditorModel);this.editArchAttributes=useEditNodeAttributes({isRoot:true});this.propertiesComponents={button:{component:ButtonProperties,props:{availableOptions:["invisible"],},},field:{component:FieldProperties,props:{availableOptions:["invisible","required","readonly","string","help"],},},group:{component:GroupProperties,},label:{component:LabelProperties,},page:{component:PageProperties,},widget:{component:WidgetProperties,},div:{component:OTdLabelProperties,},};}
get activeActions(){return this.viewEditorModel.controllerProps.archInfo.activeActions;}
getActiveAction(name){return this.activeActions[name]===true;}
onAttributeChanged(value,name){return this.editArchAttributes({[name]:value});}
onCanDuplicateChanged(value){return this.editArchAttributes({duplicate:value?"":false});}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/form/form_editor_sidebar/properties/group_properties/group_properties.js */
odoo.define('@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/group_properties/group_properties',['@odoo/owl','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/properties/modifiers/modifiers_properties','@web_studio/client_action/view_editor/interactive_editor/properties/view_structure_properties/view_structure_properties','@web_studio/client_action/view_editor/view_editor_model'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{ModifiersProperties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/modifiers/modifiers_properties");const{ViewStructureProperties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/view_structure_properties/view_structure_properties");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");const GroupProperties=__exports.GroupProperties=class GroupProperties extends Component{static template="web_studio.ViewEditor.InteractiveEditorProperties.Group";static components={ModifiersProperties,Property,ViewStructureProperties,};static props=["node"];setup(){this.editNodeAttributes=useEditNodeAttributes();}
onChangeAttribute(value,name){return this.editNodeAttributes({[name]:value});}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/form/form_editor_sidebar/properties/label_properties/label_properties.js */
odoo.define('@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/label_properties/label_properties',['@odoo/owl','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox','@web_studio/client_action/view_editor/view_editor_model'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{SidebarPropertiesToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");const LabelProperties=__exports.LabelProperties=class LabelProperties extends Component{static template="web_studio.ViewEditor.InteractiveEditorProperties.Label";static components={Property,SidebarPropertiesToolbox};static props=["node"];setup(){this.editNodeAttributes=useEditNodeAttributes();}
onChangeAttribute(value,name){return this.editNodeAttributes({[name]:value});}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/form/form_editor_sidebar/properties/o_td_label_properties/o_td_label_properties.js */
odoo.define('@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/o_td_label_properties/o_td_label_properties',['@odoo/owl','@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{SidebarPropertiesToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox");const OTdLabelProperties=__exports.OTdLabelProperties=class OTdLabelProperties extends Component{static template="web_studio.ViewEditor.InteractiveEditorProperties.OTdLabelProperties";static components={SidebarPropertiesToolbox};static props=["node"];}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/form/form_editor_sidebar/properties/page_properties/page_properties.js */
odoo.define('@web_studio/client_action/view_editor/editors/form/form_editor_sidebar/properties/page_properties/page_properties',['@odoo/owl','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/properties/limit_group_visibility/limit_group_visibility','@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox','@web_studio/client_action/view_editor/interactive_editor/properties/modifiers/modifiers_properties','@web_studio/client_action/view_editor/view_editor_model'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{LimitGroupVisibility}=require("@web_studio/client_action/view_editor/interactive_editor/properties/limit_group_visibility/limit_group_visibility");const{SidebarPropertiesToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox");const{ModifiersProperties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/modifiers/modifiers_properties");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");class PageNodeToolbox extends SidebarPropertiesToolbox{removeNodeFromArch(){const node=this.node;let xpathToRemove=node.xpath;if(node.arch.parentElement.children.length<=1){xpathToRemove=node.xpath.split("/").slice(0,-1).join("/");}
return super.removeNodeFromArch(xpathToRemove);}}
const PageProperties=__exports.PageProperties=class PageProperties extends Component{static template="web_studio.ViewEditor.InteractiveEditorProperties.Page";static components={Property,LimitGroupVisibility,PageNodeToolbox,ModifiersProperties,};setup(){this.editNodeAttributes=useEditNodeAttributes();}
onChangeAttribute(value,name){return this.editNodeAttributes({[name]:value});}
static props={node:{type:Object},}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/gantt/gantt_editor_sidebar.js */
odoo.define('@web_studio/client_action/view_editor/editors/gantt/gantt_editor_sidebar',['@web_gantt/gantt_view','@web/core/registry','@odoo/owl','@web/core/l10n/translation','@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox','@web_studio/client_action/view_editor/view_editor_model'],function(require){'use strict';let __exports={};const{ganttView}=require("@web_gantt/gantt_view");const{registry}=require("@web/core/registry");const{Component,useState}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{InteractiveEditorSidebar}=require("@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{SidebarViewToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");const GanttEditorSidebar=__exports.GanttEditorSidebar=class GanttEditorSidebar extends Component{static template="web_studio.ViewEditor.GanttEditorSidebar";static props={openViewInForm:{type:Function,optional:true},openDefaultValues:{type:Function,optional:true},};static components={InteractiveEditorSidebar,Property,SidebarViewToolbox,};setup(){this.viewEditorModel=useState(this.env.viewEditorModel);this.editArchAttributes=useEditNodeAttributes({isRoot:true});}
get colorChoices(){return this.modelParams.decorationFields.map((value)=>({label:this.modelParams.fields[value].string,value,}));}
get currentDayPrecision(){return this.dayPrecisionChoices.find((e)=>e.value===this.precisionValues.day)?.value;}
get currentWeekPrecision(){return this.weekAndMonthPrecisionChoices.find((e)=>e.value===this.precisionValues.week)?.value;}
get currentMonthPrecision(){return this.weekAndMonthPrecisionChoices.find((e)=>e.value===this.precisionValues.month)?.value;}
get dayPrecisionChoices(){return[{label:_t("Quarter Hour"),value:"hour:quarter"},{label:_t("Half Hour"),value:"hour:half"},{label:_t("Hour"),value:"hour:full"},];}
get defaultOrderChoices(){return[{value:"asc",label:_t("Ascending")},{value:"desc",label:_t("Descending")},];}
get defaultRangesChoices(){const allowedRanges=Object.keys(this.modelParams.ranges);return[{value:"day",label:_t("Day")},{value:"week",label:_t("Week")},{value:"month",label:_t("Month")},{value:"quarter",label:_t("Quarter")},{value:"year",label:_t("Year")},].filter((e)=>allowedRanges.includes(e.value));}
get displayModeChoices(){return[{label:_t("Dense"),value:"dense"},{label:_t("Sparse"),value:"sparse"},];}
get fieldsChoices(){return Object.values(this.modelParams.fields).filter((f)=>f.groupable&&this.viewEditorModel.GROUPABLE_TYPES.includes(f.type)).map((f)=>({label:f.string,value:f.name,}));}
get fieldsDateChoices(){return Object.values(this.modelParams.fields).filter((f)=>f.store&&["date","datetime"].includes(f.type)).map((f)=>({label:f.string,value:f.name,}));}
get modelParams(){return this.viewEditorModel.controllerProps.modelParams.metaData;}
get weekAndMonthPrecisionChoices(){return[{label:_t("Half Day"),value:"day:half"},{label:_t("Day"),value:"day:full"},];}
get precisionValues(){const precision=this.viewEditorModel.xmlDoc.querySelector("gantt").getAttribute("precision")?.replace(/'/g,'"')||"{}";return JSON.parse(precision);}
onDefaultGroupByChanged(selection){this.onViewAttributeChanged(selection.join(","),"default_group_by");}
onPrecisionChanged(value,name){const precision=this.precisionValues;precision[name]=value;this.onViewAttributeChanged(JSON.stringify(precision),"precision");}
onViewAttributeChanged(value,name){return this.editArchAttributes({[name]:value});}}
registry.category("studio_editors").add("gantt",{...ganttView,Sidebar:GanttEditorSidebar,});return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/graph/graph_editor.js */
odoo.define('@web_studio/client_action/view_editor/editors/graph/graph_editor',['@odoo/owl','@web/core/l10n/translation','@web/core/registry','@web/views/graph/graph_view','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar','@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox','@web_studio/client_action/view_editor/operations_utils','@web_studio/client_action/view_editor/editors/utils','@web_studio/client_action/view_editor/view_editor_model'],function(require){'use strict';let __exports={};const{Component,onWillPatch,useState}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{registry}=require("@web/core/registry");const{graphView}=require("@web/views/graph/graph_view");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{InteractiveEditorSidebar}=require("@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar");const{SidebarViewToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox");const operationUtils=require("@web_studio/client_action/view_editor/operations_utils");const{fieldsToChoices}=require("@web_studio/client_action/view_editor/editors/utils");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");const GraphEditorSidebar=__exports.GraphEditorSidebar=class GraphEditorSidebar extends Component{static template="web_studio.ViewEditor.GraphEditorSidebar";static props={openViewInForm:{type:Function,optional:true},openDefaultValues:{type:Function,optional:true},};static components={InteractiveEditorSidebar,Property,SidebarViewToolbox,};setup(){this.viewEditorModel=useState(this.env.viewEditorModel);this.editArchAttributes=useEditNodeAttributes({isRoot:true});onWillPatch(()=>{this.oldFieldValues={firstDimension:this.modelParams.groupBy[0],secondDimension:this.modelParams.groupBy[1],measure:this.modelParams.measure==="__count"?undefined:this.modelParams.measure,};});}
onViewAttributeChanged(value,name){value=value?value:"";return this.editArchAttributes({[name]:value});}
onGroupByChanged(type,newField,oldField){const operation=operationUtils.viewGroupByOperation("graph",type,newField,oldField);this.viewEditorModel.doOperation(operation);}
get modelParams(){return this.viewEditorModel.controllerProps.modelParams;}
get typeChoices(){return[{label:_t("Bar"),value:"bar"},{label:_t("Line"),value:"line"},{label:_t("Pie"),value:"pie"},];}
get orderChoices(){return[{label:_t("Ascending"),value:"asc"},{label:_t("Descending"),value:"desc"},];}
get firstGroupbyChoices(){return fieldsToChoices(this.viewEditorModel.fields,this.viewEditorModel.GROUPABLE_TYPES,(field)=>field.groupable&&field.name!==this.modelParams.groupBy[1]);}
get secondGroupbyChoices(){return fieldsToChoices(this.viewEditorModel.fields,this.viewEditorModel.GROUPABLE_TYPES,(field)=>field.groupable&&field.name!==this.modelParams.groupBy[0]);}
get mesureChoices(){return fieldsToChoices(this.viewEditorModel.fields,["integer","float","monetary"],(field)=>field.aggregator&&field.name!=="id");}}
registry.category("studio_editors").add("graph",{...graphView,Sidebar:GraphEditorSidebar,});return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/kanban/kanban_editor.js */
odoo.define('@web_studio/client_action/view_editor/editors/kanban/kanban_editor',['@web/core/registry','@web/core/utils/objects','@web/views/kanban/kanban_view','@web_studio/client_action/view_editor/editors/xml_utils','@web_studio/client_action/view_editor/editors/kanban/kanban_editor_compiler','@web_studio/client_action/view_editor/editors/kanban/kanban_editor_record','@web_studio/client_action/view_editor/editors/kanban/kanban_editor_renderer','@web_studio/client_action/view_editor/editors/utils','@web_studio/client_action/view_editor/editors/kanban/kanban_editor_sidebar/kanban_editor_sidebar','@web/views/kanban/kanban_arch_parser'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{omit}=require("@web/core/utils/objects");const{kanbanView}=require("@web/views/kanban/kanban_view");const{computeXpath}=require("@web_studio/client_action/view_editor/editors/xml_utils");const{KanbanEditorCompiler}=require("@web_studio/client_action/view_editor/editors/kanban/kanban_editor_compiler");const{KanbanEditorRecord}=require("@web_studio/client_action/view_editor/editors/kanban/kanban_editor_record");const{KanbanEditorRenderer}=require("@web_studio/client_action/view_editor/editors/kanban/kanban_editor_renderer");const{makeModelErrorResilient}=require("@web_studio/client_action/view_editor/editors/utils");const{KanbanEditorSidebar}=require("@web_studio/client_action/view_editor/editors/kanban/kanban_editor_sidebar/kanban_editor_sidebar");const{getStudioNoFetchFields,useModelConfigFetchInvisible}=require("@web_studio/client_action/view_editor/editors/utils");const{KANBAN_CARD_ATTRIBUTE}=require("@web/views/kanban/kanban_arch_parser");function parseStudioGroups(node){if(node.hasAttribute("studio_groups")){return node.getAttribute("studio_groups");}}
class EditorArchParser extends kanbanView.ArchParser{parse(arch,models,modelName){const parsed=super.parse(...arguments);const noFetch=getStudioNoFetchFields(parsed.fieldNodes);parsed.fieldNodes=omit(parsed.fieldNodes,...noFetch.fieldNodes);return parsed;}
processButton(node){const parsed=super.processButton(node);parsed.studioXpath=computeXpath(node,"kanban");parsed.studio_groups=parseStudioGroups(node);return parsed;}}
class OneRecordModel extends kanbanView.Model{async load(){this.progressAttributes=false;await super.load(...arguments);let list=this.root;let hasRecords;const isGrouped=list.isGrouped;if(!isGrouped){hasRecords=list.records.length;}else{hasRecords=list.groups.some((g)=>g.list.records.length);}
if(!hasRecords){if(isGrouped){const commonConfig={resModel:list.config.resModel,fields:list.config.fields,activeFields:list.config.activeFields,groupByFieldName:list.groupByField.name,context:list.context,list:{resModel:list.config.resModel,fields:list.config.fields,activeFields:list.config.activeFields,groupBy:[],context:list.context,},};const data={count:0,length:0,records:[],__domain:[],value:"fake",displayName:"Fake Group",groups:[{display_name:false,count:0,},],};list.config.groups.fake=commonConfig;const group=list._createGroupDatapoint(data);list.groups.push(group);list=group.list;}
await list.addNewRecord();}}}
class KanbanEditorController extends kanbanView.Controller{setup(){super.setup();useModelConfigFetchInvisible(this.model);}
get modelParams(){const params=super.modelParams;params.groupsLimit=1;return params;}}
function isValidKanbanHook({hook,element}){const draggingStructure=element.dataset.structure;return hook.dataset.structures.split(",").includes(draggingStructure);}
async function addKanbanViewStructure(structure){switch(structure){case"aside":{if(!this.viewEditorModel.xmlDoc.querySelector("main")){this.env.viewEditorModel.pushOperation({type:"kanban_wrap_main",wrap_type:"aside",});}
return{node:{tag:"aside",attrs:{class:"col-2",},},target:{tag:"main",},};}
case"footer":{if(!this.viewEditorModel.xmlDoc.querySelector("main")){this.env.viewEditorModel.pushOperation({type:"kanban_wrap_main",wrap_type:"footer",});}
return{node:{tag:"footer",},target:{tag:"main",},position:"inside",};}
case"t":{return{type:"kanban_menu"};}
case"ribbon":{const cardTemplate=this.viewEditorModel.xmlDoc.querySelector(`[t-name="${KANBAN_CARD_ATTRIBUTE}"]`);let ribbonTarget;if(cardTemplate.children.length){ribbonTarget=[`//kanban//t[@t-name="${KANBAN_CARD_ATTRIBUTE}"]/*[1]`,"before"];}else{ribbonTarget=[`//kanban//t[@t-name="${KANBAN_CARD_ATTRIBUTE}"]`,"inside"];}
return{node:{tag:"widget",attrs:{name:"web_ribbon",title:"Demo",},},target:this.env.viewEditorModel.getFullTarget(ribbonTarget[0],{isXpathFullAbsolute:false,}),position:ribbonTarget[1],};}
case"kanban_colorpicker":{if(!this.viewEditorModel.xmlDoc.querySelector("t[t-name=menu]")){this.env.viewEditorModel.pushOperation({type:"kanban_menu",});}
return{type:"kanban_colorpicker",view_id:this.env.viewEditorModel.mainView.id,};}}}
function prepareForKanbanDrag({element,ref}){const hooksToStylize=[...ref.el.querySelectorAll(".o_web_studio_hook")].filter((e)=>e.dataset.structures?.split(",").includes(element.dataset.structure));hooksToStylize.forEach((e)=>e.classList.add("o_web_studio_hook_visible"));return()=>{ref.el.querySelectorAll(".o_web_studio_hook_visible").forEach((el)=>el.classList.remove("o_web_studio_hook_visible"));};}
const kanbanEditor={...kanbanView,Compiler:KanbanEditorCompiler,Controller:KanbanEditorController,ArchParser:EditorArchParser,Renderer:KanbanEditorRenderer,Record:KanbanEditorRecord,Model:OneRecordModel,Sidebar:KanbanEditorSidebar,isValidHook:isValidKanbanHook,addViewStructure:addKanbanViewStructure,prepareForDrag:prepareForKanbanDrag,props(genericProps,editor,config){const props=kanbanView.props(genericProps,editor,config);props.Model=makeModelErrorResilient(OneRecordModel,props.archInfo.activeActions);props.limit=1;props.Renderer=KanbanEditorRenderer;return props;},};registry.category("studio_editors").add("kanban",kanbanEditor);return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/kanban/kanban_editor_compiler.js */
odoo.define('@web_studio/client_action/view_editor/editors/kanban/kanban_editor_compiler',['@web/views/kanban/kanban_compiler','@web_studio/client_action/view_editor/editors/xml_utils','@web/core/utils/xml','@web/views/view_compiler'],function(require){'use strict';let __exports={};const{KanbanCompiler}=require("@web/views/kanban/kanban_compiler");const{computeXpath,applyInvisible}=require("@web_studio/client_action/view_editor/editors/xml_utils");const{createElement,getTag}=require("@web/core/utils/xml");const{isComponentNode}=require("@web/views/view_compiler");const interestingSelector=["div","aside","footer","field:not([data-used-by])","main","kanban","widget","a","button",].join(", ");function getElementXpath(el){const xpath=el.getAttribute("studioXpath");if(isComponentNode(el)){return xpath;}
return`"${xpath}"`;}
function setElementXpath(el,xpath){if(isComponentNode(el)){el.setAttribute("studioXpath",`'${xpath}'`);}else{el.setAttribute("studioXpath",xpath);}}
const KanbanEditorCompiler=__exports.KanbanEditorCompiler=class KanbanEditorCompiler extends KanbanCompiler{applyInvisible(invisible,compiled,params){return applyInvisible(invisible,compiled,params);}
addStudioHook(node,type,template,{structures,wrap=false}={}){const xpath=getElementXpath(node);if(wrap){const studioHookBefore=createElement("StudioHook",{xpath,position:"'before'",type:`'${type}'`,subTemplate:`'${template}'`,structures,});node.insertAdjacentElement("beforebegin",studioHookBefore);}
const studioHookAfter=createElement("StudioHook",{xpath,position:"'after'",type:`'${type}'`,subTemplate:`'${template}'`,structures,});node.insertAdjacentElement("afterend",studioHookAfter);}
wrapNodesInMain(node){const elementsToWrap=Array.from(node.children).filter((e)=>{if(e.tagName==="widget"){return e.getAttribute("name")!=="web_ribbon";}
if(e.tagName==="t"&&e.getAttribute("t-name")==="menu"){return false;}
return!["aside"].includes(e.tagName);});return createElement("main",elementsToWrap);}
compile(key,params={}){const xml=this.templates[key];const interestingArchNodes=[...xml.querySelectorAll(interestingSelector)];for(const el of interestingArchNodes){const xpath=computeXpath(el,"kanban");setElementXpath(el,xpath);}
const compiled=super.compile(key,params);return compiled;}
compileButton(el,params){const compiled=super.compileButton(...arguments);setElementXpath(compiled,el.getAttribute("studioXpath"));return compiled;}
compileCard(node,params){const mainNode=node.querySelector("main");if(!mainNode){const mainEl=this.wrapNodesInMain(node);setElementXpath(mainEl,"kanban");node.append(mainEl);}
const asideNode=node.querySelector("aside");const ribbonNode=node.querySelector("widget[name='web_ribbon']");const compiledCard=super.compileNode(node,params);const compiledMain=compiledCard.querySelector("main");if(!ribbonNode){this.addStudioHook(compiledMain,"ribbon","kanbanRibbon");}
if(!asideNode){this.addStudioHook(compiledMain,"kanbanAsideHook","kanbanAsideHook",{wrap:true});}
return compiledCard;}
compileField(el,params){const compiled=super.compileField(...arguments);if(!el.hasAttribute("widget")){compiled.classList.add("o-web-studio-editor--element-clickable");const fieldName=el.getAttribute("name");const recordValueExpr=`__comp__.props.record.data["${fieldName}"]`;const isEmptyExpr=`__comp__.isFieldValueEmpty(${recordValueExpr})`;compiled.setAttribute("t-attf-class",`{{ ${isEmptyExpr} ? "o_web_studio_widget_empty" : "" }}`);const fieldNameExpr=`__comp__.props.record.fields["${fieldName}"].string`;const originalTOut=compiled.getAttribute("t-out");compiled.setAttribute("t-out",`${isEmptyExpr} ? ${fieldNameExpr} : ${originalTOut}`);}else{compiled.setAttribute("hasEmptyPlaceholder",true);}
return compiled;}
compileInnerSection(compiled){const interestingNodes=[...compiled.querySelectorAll("[studioXpath]")].filter((e)=>e.getAttribute("studioXpath")!=="null"&&!e.closest("ViewButton"));const otherNodes=[...compiled.querySelectorAll("div[studioXpath]")].filter((e)=>!e.getAttribute("t-out"));for(const child of otherNodes){child.classList.add("o_inner_section");child.classList.add("o-web-studio-editor--element-clickable");}
for(const child of interestingNodes){if([...child.getAttributeNames()].filter((e)=>["t-if","t-elif","t-else"].includes(e)).length){continue;}
this.addStudioHook(child,"field",child.tagName==="span"?"kanbanInline":"defaultTemplate",{structures:`'field'`,wrap:true});}
if(!interestingNodes.length){const hook=createElement("StudioHook",{xpath:`"${compiled.getAttribute("studioXpath")}"`,position:"'inside'",type:"'field'",subTemplate:"defaultTemplate",structures:`'field'`,});compiled.appendChild(hook);}}
compileNode(node,params){if(node.tagName==="field"&&node.hasAttribute("data-used-by")){return;}
let compiled;if(node.getAttribute?.("t-name")==="card"){compiled=this.compileCard(node);}else{compiled=super.compileNode(node,{...params,compileInvisibleNodes:true});}
if(["aside","footer"].includes(getTag(node))){compiled.classList.add("o_inner_section");compiled.classList.add("o-web-studio-editor--element-clickable");this.compileInnerSection(compiled);}else if(getTag(node)==="main"){this.compileInnerSection(compiled);if(!compiled.querySelector("footer")){const footerHook=createElement("StudioHook",{xpath:`"${compiled.getAttribute("studioXpath")}"`,position:"'after'",type:`'footer'`,subTemplate:`'defaultTemplate'`,structures:`'footer'`,});compiled.appendChild(footerHook);}}
if(node.nodeType===1&&compiled&&!compiled.attributes.studioXpath){setElementXpath(compiled,node.getAttribute("studioXpath"));}
return compiled;}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/kanban/kanban_editor_record.js */
odoo.define('@web_studio/client_action/view_editor/editors/kanban/kanban_editor_record',['@web/views/kanban/kanban_view','@web_studio/client_action/view_editor/editors/components/field_studio','@web_studio/client_action/view_editor/editors/components/widget_studio','@web_studio/client_action/view_editor/editors/xml_utils','@web_studio/client_action/view_editor/editors/components/view_button_studio','@web_studio/client_action/view_editor/editors/components/studio_hook_component','@web/core/utils/hooks','@odoo/owl','@web_studio/client_action/view_editor/editors/kanban/kanban_editor_compiler'],function(require){'use strict';let __exports={};const{kanbanView}=require("@web/views/kanban/kanban_view");const{FieldStudio}=require("@web_studio/client_action/view_editor/editors/components/field_studio");const{WidgetStudio}=require("@web_studio/client_action/view_editor/editors/components/widget_studio");const{computeXpath}=require("@web_studio/client_action/view_editor/editors/xml_utils");const{ViewButtonStudio}=require("@web_studio/client_action/view_editor/editors/components/view_button_studio");const{StudioHook}=require("@web_studio/client_action/view_editor/editors/components/studio_hook_component");const{useService}=require("@web/core/utils/hooks");const{Component,toRaw,useEnv,useState,xml,onError}=require("@odoo/owl");const{KanbanEditorCompiler}=require("@web_studio/client_action/view_editor/editors/kanban/kanban_editor_compiler");class FieldStudioKanbanRecord extends FieldStudio{isX2ManyEditable(){return false;}}
const KanbanRecord=kanbanView.Renderer.components.KanbanRecord;class KanbanEditorRecordMenu extends Component{static props={slots:Object,studioXpath:String,};static template="web_studio.KanbanEditorRecordMenu";}
function useSafeKanban(){const state=useState({hasError:false});const viewEditorModel=toRaw(useEnv().viewEditorModel);onError((error)=>{const hasError=state.hasError;if(hasError||viewEditorModel.isInEdition){throw error;}
state.hasError=true;});return state;}
class SafeKanbanRecord extends KanbanRecord{static template="web_studio.SafeKanbanRecord";setup(){super.setup();this.safe=useSafeKanban();}
onGlobalClick(){}}
class _KanbanEditorRecord extends KanbanRecord{static template="web_studio.SafeKanbanRecord";static menuTemplate="web_studio.SafeKanbanRecordMenu";static components={...KanbanRecord.components,Field:FieldStudioKanbanRecord,Widget:WidgetStudio,StudioHook,ViewButton:ViewButtonStudio,KanbanRecordMenu:KanbanEditorRecordMenu,};setup(){super.setup();this.viewEditorModel=useState(this.env.viewEditorModel);this.dialogService=useService("dialog");this.safe=useSafeKanban();}
onGlobalClick(ev){const el=ev.target.closest(".o-web-studio-editor--element-clickable");if(el){this.env.config.onNodeClicked(el.getAttribute("studioxpath"));}}
isFieldValueEmpty(value){if(value===null){return true;}
if(Array.isArray(value)){return!value.length;}
return!value;}
get dropdownXpath(){const compiledTemplateMenu=this.props.archInfo.templateDocs[this.constructor.KANBAN_MENU_ATTRIBUTE];return computeXpath(compiledTemplateMenu,"kanban");}}
const KanbanEditorRecord=__exports.KanbanEditorRecord=class KanbanEditorRecord extends Component{static props=[...KanbanRecord.props];static template=xml`<t t-component="KanbanRecord" t-props="kanbanRecordProps" />`;get KanbanRecord(){if(this.env.viewEditorModel.mode!=="interactive"){return SafeKanbanRecord;}else{return _KanbanEditorRecord;}}
get kanbanRecordProps(){const props={...this.props};if(this.env.viewEditorModel.mode==="interactive"){props.Compiler=KanbanEditorCompiler;}
return props;}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/kanban/kanban_editor_renderer.js */
odoo.define('@web_studio/client_action/view_editor/editors/kanban/kanban_editor_renderer',['@web/views/kanban/kanban_view','@web/views/kanban/kanban_header','@web_studio/client_action/view_editor/editors/kanban/kanban_editor_record','@odoo/owl','@web_studio/client_action/view_editor/interactive_editor/action_button/action_button'],function(require){'use strict';let __exports={};const{kanbanView}=require("@web/views/kanban/kanban_view");const{KanbanHeader}=require("@web/views/kanban/kanban_header");const{KanbanEditorRecord}=require("@web_studio/client_action/view_editor/editors/kanban/kanban_editor_record");const{useRef,useEffect}=require("@odoo/owl");const{SelectionHeaderButtons}=require("@web_studio/client_action/view_editor/interactive_editor/action_button/action_button");class KanbanEditorHeader extends KanbanHeader{static template="web_studio.KanbanEditorHeader";}
const KanbanEditorRenderer=__exports.KanbanEditorRenderer=class KanbanEditorRenderer extends kanbanView.Renderer{static template="web_studio.KanbanEditorRenderer";static components={...kanbanView.Renderer.components,KanbanRecord:KanbanEditorRecord,KanbanHeader:KanbanEditorHeader,SelectionHeaderButtons,};setup(){super.setup();const rootRef=useRef("root");useEffect((el)=>{if(!el){return;}
el.classList.add("o_web_studio_kanban_view_editor");},()=>[rootRef.el]);}
get canUseSortable(){return false;}
get showNoContentHelper(){return false;}
getGroupsOrRecords(){const{list}=this.props;const groupsOrRec=super.getGroupsOrRecords(...arguments);if(list.isGrouped){return[groupsOrRec.filter((el)=>el.group.list.records.length)[0]];}else{return[groupsOrRec[0]];}}
canCreateGroup(){return false;}
getGroupUnloadedCount(){return 0;}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/kanban/kanban_editor_sidebar/kanban_editor_sidebar.js */
odoo.define('@web_studio/client_action/view_editor/editors/kanban/kanban_editor_sidebar/kanban_editor_sidebar',['@odoo/owl','@web/core/l10n/translation','@web_studio/client_action/view_editor/editors/components/view_structures','@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar','@web_studio/client_action/view_editor/editors/components/view_fields','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox','@web_studio/client_action/view_editor/interactive_editor/properties/properties','@web_studio/client_action/view_editor/interactive_editor/properties/button_properties/button_properties','@web_studio/client_action/view_editor/interactive_editor/properties/field_properties/field_properties','@web_studio/client_action/view_editor/interactive_editor/properties/widget_properties/widget_properties','@web_studio/client_action/view_editor/view_editor_model','@web_studio/client_action/view_editor/editors/utils','@web_studio/client_action/view_editor/editors/kanban/kanban_editor_sidebar/properties/aside_properties/aside_properties','@web_studio/client_action/view_editor/editors/kanban/kanban_editor_sidebar/properties/footer_properties/footer_properties','@web_studio/client_action/view_editor/editors/kanban/kanban_editor_sidebar/properties/menu_properties/menu_properties','@web_studio/client_action/view_editor/editors/kanban/kanban_editor_sidebar/properties/div_properties/div_properties'],function(require){'use strict';let __exports={};const{Component,onWillStart,useState}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{ViewStructures}=require("@web_studio/client_action/view_editor/editors/components/view_structures");const{InteractiveEditorSidebar}=require("@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar");const{ExistingFields}=require("@web_studio/client_action/view_editor/editors/components/view_fields");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{SidebarViewToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox");const{Properties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/properties");const{ButtonProperties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/button_properties/button_properties");const{FieldProperties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/field_properties/field_properties");const{WidgetProperties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/widget_properties/widget_properties");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");const{fieldsToChoices}=require("@web_studio/client_action/view_editor/editors/utils");const{AsideProperties}=require("@web_studio/client_action/view_editor/editors/kanban/kanban_editor_sidebar/properties/aside_properties/aside_properties");const{FooterProperties}=require("@web_studio/client_action/view_editor/editors/kanban/kanban_editor_sidebar/properties/footer_properties/footer_properties");const{MenuProperties}=require("@web_studio/client_action/view_editor/editors/kanban/kanban_editor_sidebar/properties/menu_properties/menu_properties");const{DivProperties}=require("@web_studio/client_action/view_editor/editors/kanban/kanban_editor_sidebar/properties/div_properties/div_properties");class KanbanFieldProperties extends FieldProperties{onChangeAttribute(value,name){if(name==="bold"){let cls=this.props.node.attrs.class;if(value){cls=cls?`fw-bold ${cls}`:"fw-bold";}else{cls=cls.split(" ").filter((c)=>c!=="fw-bold"&&c!=="fw-bolder").join(" ");}
return this.editNodeAttributes({class:cls});}
return super.onChangeAttribute(...arguments);}}
const KanbanEditorSidebar=__exports.KanbanEditorSidebar=class KanbanEditorSidebar extends Component{static template="web_studio.ViewEditor.KanbanEditorSidebar";static props={openViewInForm:{type:Function,optional:true},openDefaultValues:{type:Function,optional:true},};static components={InteractiveEditorSidebar,ExistingFields,Property,Properties,ViewStructures,SidebarViewToolbox,};static get viewStructures(){return{aside:{name:_t("Side panel"),class:"o_web_studio_field_aside",isVisible:(vem)=>!vem.controllerProps.arch.querySelector("aside"),},footer:{name:_t("Footer"),class:"o_web_studio_field_footer",isVisible:(vem)=>!vem.controllerProps.arch.querySelector("footer"),},t:{name:_t("Menu"),class:"o_web_studio_field_menu",isVisible:(vem)=>!vem.controllerProps.arch.querySelector("t[t-name=menu]"),},ribbon:{name:_t("Ribbon"),class:"o_web_studio_field_ribbon",isVisible:(vem)=>!vem.controllerProps.arch.querySelector("widget[name=web_ribbon]"),},kanban_colorpicker:{name:_t("Color Picker"),class:"o_web_studio_field_color_picker",isVisible:(vem)=>!vem.controllerProps.arch.querySelector("field[widget=kanban_color_picker]"),},};}
setup(){this.state=useState({foldField:{id:0,fold_name:"",},groupByField:{},fieldsForFold:[],});this.viewEditorModel=useState(this.env.viewEditorModel);this.editArchAttributes=useEditNodeAttributes({isRoot:true});this.propertiesComponents={a:{component:ButtonProperties,props:{availableOptions:["invisible"],},},button:{component:ButtonProperties,props:{availableOptions:["invisible"],},},field:{component:KanbanFieldProperties,props:{availableOptions:["invisible","string","bold"],},},aside:{component:AsideProperties,},div:{component:DivProperties,},footer:{component:FooterProperties,},t:{component:MenuProperties,},widget:{component:WidgetProperties,},};onWillStart(async()=>{await this.getGroupByField();});}
get archInfo(){return this.viewEditorModel.controllerProps.archInfo;}
get colorField(){return{choices:fieldsToChoices(this.viewEditorModel.fields,["integer"]),required:false,};}
get defaultGroupBy(){return{choices:fieldsToChoices(this.viewEditorModel.fields,this.viewEditorModel.GROUPABLE_TYPES,(field)=>field.groupable),required:false,};}
get foldFields(){return{choices:this.state.fieldsForFold,required:false,};}
get defaultOrder(){if(this.archInfo.defaultOrder.length>=1){return this.archInfo.defaultOrder[0];}else{return{name:"",asc:true};}}
get sortChoices(){return fieldsToChoices(this.viewEditorModel.fields,this.viewEditorModel.GROUPABLE_TYPES.concat(this.viewEditorModel.MEASURABLE_TYPES),(field)=>field.sortable);}
get orderChoices(){return[{value:"asc",label:_t("Ascending")},{value:"desc",label:_t("Descending")},];}
get defaultGroupByIsRelational(){const field=this.viewEditorModel.studioViewProps.defaultGroupBy;return field.length&&this.viewEditorModel.fields[field[0]]?.relation;}
get canCustomFoldField(){const field=this.viewEditorModel.studioViewProps.defaultGroupBy;return(this.defaultGroupByIsRelational&&field.length&&this.viewEditorModel.fields[field[0]].relation.startsWith("x_"));}
setSortBy(value){this.onSortingChanged(value,this.defaultOrder.asc?"asc":"desc");}
setOrder(value){this.onSortingChanged(this.defaultOrder.name,value);}
onSortingChanged(sortBy,order){if(sortBy){this.editAttribute(`${sortBy} ${order}`,"default_order");}else{this.editAttribute("","default_order");}}
editAttribute(value,name){return this.editArchAttributes({[name]:value});}
async editDefaultGroupBy(value){await this.editAttribute(value||"","default_group_by");this.getGroupByField();}
async editFoldField(value){await this.viewEditorModel._services.orm.write("ir.model",[this.state.foldField.id],{fold_name:value,});this.state.foldField.fold_name=value;}
async editGroupExpand(value){await this.viewEditorModel._services.orm.write("ir.model.fields",[this.state.groupByField.id],{group_expand:value,});this.state.groupByField={...this.state.groupByField,group_expand:value,};if(value){this.fetchFieldsForFold();}}
editColor(value){if(value&&!this.viewEditorModel.fieldsInArch.includes(value)){this.viewEditorModel.doOperation({type:"add",target:{tag:"kanban",},position:"inside",node:{attrs:{name:value,invisible:"1",},tag:"field",},});}
this.editAttribute(value||"","highlight_color");}
async fetchFieldsForFold(){if(this.state.groupByField.relation){const result=await this.viewEditorModel._services.orm.call(this.state.groupByField.relation,"fields_get");this.state.fieldsForFold=Object.entries(result).filter(([_,value])=>value.type==="boolean").map((e)=>({label:e[1].string||e[1].name,value:e[0],}));const resultFold=await this.viewEditorModel._services.orm.webSearchRead("ir.model",[["model","=",this.state.groupByField.relation]],{specification:{fold_name:{},},});this.state.foldField=resultFold.length&&resultFold.records[0];}}
async getGroupByField(){if(this.canCustomFoldField){const result=await this.viewEditorModel._services.orm.webSearchRead("ir.model.fields",[["name","=",this.viewEditorModel.studioViewProps.defaultGroupBy[0]],["model","=",this.viewEditorModel.resModel],],{specification:{group_expand:false,relation:false,},});this.state.groupByField=result.length&&result.records[0];if(this.state.groupByField.group_expand){this.fetchFieldsForFold();}}}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/kanban/kanban_editor_sidebar/properties/aside_properties/aside_properties.js */
odoo.define('@web_studio/client_action/view_editor/editors/kanban/kanban_editor_sidebar/properties/aside_properties/aside_properties',['@odoo/owl','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/properties/class_attribute/class_attribute','@web_studio/client_action/view_editor/interactive_editor/properties/view_structure_properties/view_structure_properties','@web_studio/client_action/view_editor/view_editor_model'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{ClassAttribute}=require("@web_studio/client_action/view_editor/interactive_editor/properties/class_attribute/class_attribute");const{ViewStructureProperties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/view_structure_properties/view_structure_properties");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");const AsideProperties=__exports.AsideProperties=class AsideProperties extends Component{static template="web_studio.ViewEditor.InteractiveEditorProperties.Aside";static components={ClassAttribute,Property,ViewStructureProperties,};static props={node:{type:Object},};setup(){this.editNodeAttributes=useEditNodeAttributes();}
onChangeAttribute(value,name){return this.editNodeAttributes({[name]:value});}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/kanban/kanban_editor_sidebar/properties/div_properties/div_properties.js */
odoo.define('@web_studio/client_action/view_editor/editors/kanban/kanban_editor_sidebar/properties/div_properties/div_properties',['@odoo/owl','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/properties/class_attribute/class_attribute','@web_studio/client_action/view_editor/interactive_editor/properties/view_structure_properties/view_structure_properties','@web_studio/client_action/view_editor/view_editor_model','@web_studio/client_action/view_editor/interactive_editor/properties/modifiers/modifiers_properties'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{ClassAttribute}=require("@web_studio/client_action/view_editor/interactive_editor/properties/class_attribute/class_attribute");const{ViewStructureProperties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/view_structure_properties/view_structure_properties");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");const{ModifiersProperties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/modifiers/modifiers_properties");const DivProperties=__exports.DivProperties=class DivProperties extends Component{static template="web_studio.ViewEditor.InteractiveEditorProperties.Div";static components={ClassAttribute,ModifiersProperties,Property,ViewStructureProperties,};static props={node:{type:Object},};setup(){this.editNodeAttributes=useEditNodeAttributes();}
onChangeAttribute(value,name){return this.editNodeAttributes({[name]:value});}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/kanban/kanban_editor_sidebar/properties/footer_properties/footer_properties.js */
odoo.define('@web_studio/client_action/view_editor/editors/kanban/kanban_editor_sidebar/properties/footer_properties/footer_properties',['@odoo/owl','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/properties/class_attribute/class_attribute','@web_studio/client_action/view_editor/interactive_editor/properties/view_structure_properties/view_structure_properties','@web_studio/client_action/view_editor/view_editor_model'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{ClassAttribute}=require("@web_studio/client_action/view_editor/interactive_editor/properties/class_attribute/class_attribute");const{ViewStructureProperties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/view_structure_properties/view_structure_properties");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");const FooterProperties=__exports.FooterProperties=class FooterProperties extends Component{static template="web_studio.ViewEditor.InteractiveEditorProperties.Footer";static components={ClassAttribute,Property,ViewStructureProperties,};static props={node:{type:Object},};setup(){this.editNodeAttributes=useEditNodeAttributes();}
onChangeAttribute(value,name){return this.editNodeAttributes({[name]:value});}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/kanban/kanban_editor_sidebar/properties/menu_properties/menu_properties.js */
odoo.define('@web_studio/client_action/view_editor/editors/kanban/kanban_editor_sidebar/properties/menu_properties/menu_properties',['@odoo/owl','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{SidebarPropertiesToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox");const MenuProperties=__exports.MenuProperties=class MenuProperties extends Component{static template="web_studio.ViewEditor.InteractiveEditorProperties.Menu";static components={Property,SidebarPropertiesToolbox,};static props={node:{type:Object},};get colorPicker(){return this.env.viewEditorModel.controllerProps.arch.querySelector("field[widget=kanban_color_picker]");}
editColorPicker(){this.env.viewEditorModel.activeNodeXpath=this.colorPicker.getAttribute("studioXpath");}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/list/list_editor.js */
odoo.define('@web_studio/client_action/view_editor/editors/list/list_editor',['@web/views/list/list_view','@web_studio/client_action/view_editor/editors/xml_utils','@web/core/registry','@web/core/utils/objects','@web_studio/client_action/view_editor/editors/list/list_editor_renderer','@odoo/owl','@web_studio/client_action/view_editor/editors/list/list_editor_sidebar/list_editor_sidebar','@web_studio/client_action/view_editor/editors/utils'],function(require){'use strict';let __exports={};const{listView}=require("@web/views/list/list_view");const{computeXpath}=require("@web_studio/client_action/view_editor/editors/xml_utils");const{registry}=require("@web/core/registry");const{omit}=require("@web/core/utils/objects");const{ListEditorRenderer,columnsStyling}=require("@web_studio/client_action/view_editor/editors/list/list_editor_renderer");const{Component,xml}=require("@odoo/owl");const{ListEditorSidebar}=require("@web_studio/client_action/view_editor/editors/list/list_editor_sidebar/list_editor_sidebar");const{getStudioNoFetchFields,useModelConfigFetchInvisible}=require("@web_studio/client_action/view_editor/editors/utils");function parseStudioGroups(node){if(node.hasAttribute("studio_groups")){return node.getAttribute("studio_groups");}}
class EditorArchParser extends listView.ArchParser{parse(arch,models,modelName){const parsed=super.parse(...arguments);const noFetch=getStudioNoFetchFields(parsed.fieldNodes);parsed.fieldNodes=omit(parsed.fieldNodes,...noFetch.fieldNodes);const noFetchFieldNames=noFetch.fieldNames;parsed.columns=parsed.columns.filter((col)=>col.type!=="field"||!noFetchFieldNames.includes(col.name));return parsed;}
parseFieldNode(node,models,modelName){const parsed=super.parseFieldNode(...arguments);if(node.hasAttribute("data-used-by")){return parsed;}
parsed.studioXpath=computeXpath(node,"list, tree");parsed.studio_groups=parseStudioGroups(node);return parsed;}
parseWidgetNode(node,models,modelName){const parsed=super.parseWidgetNode(...arguments);parsed.studioXpath=computeXpath(node,"list, tree");parsed.studio_groups=parseStudioGroups(node);return parsed;}
processButton(node){const parsed=super.processButton(node);parsed.studioXpath=computeXpath(node,"list, tree");parsed.studio_groups=parseStudioGroups(node);return parsed;}}
function useParentedStaticList(model,parentRecord,resIds){const config=model.config;config.resIds=resIds;config.offset=0;config.limit=Math.max(7,resIds.length);model._createRoot=(config,data)=>{const options={parent:parentRecord};return new model.constructor.StaticList(model,{...config},data,options);};model._createEmptyRoot=()=>null;}
class ListEditorController extends listView.Controller{static props={...listView.Controller.props,parentRecord:{type:Object,optional:true},};setup(){super.setup();useModelConfigFetchInvisible(this.model);if(this.props.parentRecord){useParentedStaticList(this.model,this.props.parentRecord,this.props.resIds);}}}
class ControllerShadow extends Component{static props={...ListEditorController.props};static template=xml`<t t-component="Component" t-props="componentProps" />`;get Component(){return ListEditorController;}
get componentProps(){const props={...this.props};props.groupBy=[];return props;}}
const listEditor={...listView,Controller:ControllerShadow,ArchParser:EditorArchParser,Renderer:ListEditorRenderer,props(){const props=listView.props(...arguments);props.allowSelectors=false;props.readonly=true;props.showButtons=false;return props;},Sidebar:ListEditorSidebar,};registry.category("studio_editors").add("list",listEditor);const colNearestHookClass="o_web_studio_nearest_hook";listEditor.styleNearestHook=function styleNearestColumn(mainRef,nearestHook){const xpath=nearestHook.dataset.xpath;const position=nearestHook.dataset.position;columnsStyling(mainRef.el,`.o_web_studio_hook[data-xpath='${xpath}'][data-position='${position}']`,[colNearestHookClass]);};listEditor.styleClickedElement=(mainRef,params)=>{columnsStyling(mainRef.el,`[data-studio-xpath='${params.xpath}']:not(.o_web_studio_hook)`,["o-web-studio-editor--element-clicked",]);};return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/list/list_editor_renderer.js */
odoo.define('@web_studio/client_action/view_editor/editors/list/list_editor_renderer',['@web/views/list/list_view','@web/core/utils/timing','@odoo/owl','@web_studio/client_action/view_editor/interactive_editor/action_button/action_button'],function(require){'use strict';let __exports={};const{listView}=require("@web/views/list/list_view");const{useThrottleForAnimation}=require("@web/core/utils/timing");const{reactive,useEffect,useState}=require("@odoo/owl");const{SelectionHeaderButtons}=require("@web_studio/client_action/view_editor/interactive_editor/action_button/action_button");const colSelectedClass="o-web-studio-editor--element-clicked";const colHoverClass="o-web-studio--col-hovered";function cleanStyling(mainEl,classNames){mainEl.querySelectorAll(`${classNames.map((c) => `.${c}`)}`).forEach((el)=>{el.classList.remove(...classNames);});}
__exports.columnsStyling=columnsStyling;function columnsStyling(mainEl,colSelector,classNames){mainEl.querySelectorAll(`td${colSelector}, th${colSelector}`).forEach((el)=>{el.classList.add(...classNames);});}
function getSelectableCol(target,colSelector){if(target.closest("button")){return null;}
const colEl=target.closest(`td${colSelector}, th${colSelector}`);return colEl;}
const ListEditorRenderer=__exports.ListEditorRenderer=class ListEditorRenderer extends listView.Renderer{static template="web_studio.ListEditorRenderer";static recordRowTemplate="web_studio.ListEditorRenderer.RecordRow";static components={...listView.Renderer.components,SelectionHeaderButtons,};setup(){const viewEditorModel=useState(this.env.viewEditorModel);this.viewEditorModel=reactive(viewEditorModel,()=>{this.columns=this.getActiveColumns();this.render();});super.setup();this.onTableHover=useThrottleForAnimation(this.onTableHover);useEffect((rootEl)=>{rootEl.classList.add("o_web_studio_list_view_editor");},()=>[this.rootRef.el]);}
get canResequenceRows(){return false;}
getColumnClass(col){let cls=super.getColumnClass(col);if(col.studioColumnInvisible){cls+=" o_web_studio_show_invisible";}
return cls;}
getCellClass(col,record){let cls=super.getCellClass(col,record);if(col.studioColumnInvisible||super.evalInvisible(col.invisible,record)){cls+=" o_web_studio_show_invisible";}
return cls;}
getColumnHookData(col,position){let xpath;if(!col){return{xpath:"/list",position:"inside"};}
if(col.type==="button_group"){if(position==="before"){xpath=col.buttons[0].studioXpath;}else{xpath=col.buttons[col.buttons.length-1].studioXpath;}}else{xpath=col.studioXpath;}
return{xpath,position,};}
addColsHooks(_cols){const attrs={width:"4px"};const options={};const cols=[];let hookId=0;const firstCol=_cols.find((c)=>c.optional!=="hide");const{xpath,position}=this.getColumnHookData(firstCol,"before");cols.push({type:"studio_hook",position,xpath,id:`studio_hook_${hookId++}_${(firstCol && firstCol.id) || 0}`,attrs,options,});for(const col of _cols){if(col.optional==="hide"){continue;}
cols.push(col);const{xpath,position}=this.getColumnHookData(col,"after");cols.push({type:"studio_hook",position,xpath,id:`studio_hook_${hookId++}_${col.id}`,attrs,options,});}
return cols;}
get allColumns(){let cols=this._allColumns;cols=cols.filter((c)=>!c.attrs?.["data-used-by"]);if(this.viewEditorModel.showInvisible){cols=cols.map((c)=>({...c,optional:false,studioColumnInvisible:c.optional==="hide"||super.evalColumnInvisible(c.column_invisible),}));}else{cols=cols.filter((c)=>!this.evalColumnInvisible(c.column_invisible));}
return this.addColsHooks(cols);}
set allColumns(cols){this._allColumns=cols;}
evalInvisible(modifier,record){if(this.viewEditorModel.showInvisible){return false;}
return super.evalInvisible(modifier,record);}
evalColumnInvisible(columnInvisible){if(this.viewEditorModel.showInvisible){return false;}
return super.evalColumnInvisible(columnInvisible);}
onTableHover(ev){const table=this.tableRef.el;cleanStyling(table,[colHoverClass]);if(ev.type!=="mouseover"){return;}
const colEl=getSelectableCol(ev.target,"[data-studio-xpath]");if(!colEl){return;}
const xpath=colEl.dataset.studioXpath;columnsStyling(table,`[data-studio-xpath='${xpath}']:not(.o_web_studio_hook)`,[colHoverClass,]);}
onTableClicked(ev){ev.stopPropagation();ev.preventDefault();const table=ev.currentTarget;cleanStyling(table,[colSelectedClass]);const colEl=getSelectableCol(ev.target,"[data-studio-xpath]");if(!colEl){return;}
this.env.config.onNodeClicked(colEl.dataset.studioXpath);}
makeTooltipButton(button){return JSON.stringify({button:{string:button.string,type:button.clickParams?.type,name:button.clickParams?.name,},debug:true,});}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/list/list_editor_sidebar/list_editor_sidebar.js */
odoo.define('@web_studio/client_action/view_editor/editors/list/list_editor_sidebar/list_editor_sidebar',['@odoo/owl','@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar','@web_studio/client_action/view_editor/editors/components/view_fields','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox','@web_studio/client_action/view_editor/interactive_editor/properties/properties','@web_studio/client_action/view_editor/interactive_editor/properties/button_properties/button_properties','@web/core/l10n/translation','@web/core/utils/strings','@web_studio/client_action/view_editor/interactive_editor/properties/field_properties/field_properties','@web_studio/client_action/view_editor/view_editor_model','@web_studio/client_action/view_editor/editors/utils'],function(require){'use strict';let __exports={};const{Component,useState}=require("@odoo/owl");const{InteractiveEditorSidebar}=require("@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar");const{ExistingFields,NewFields,}=require("@web_studio/client_action/view_editor/editors/components/view_fields");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{SidebarViewToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox");const{Properties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/properties");const{ButtonProperties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/button_properties/button_properties");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{sprintf}=require("@web/core/utils/strings");const{FieldProperties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/field_properties/field_properties");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");const{fieldsToChoices}=require("@web_studio/client_action/view_editor/editors/utils");class ListFieldNodeProperties extends FieldProperties{onChangeAttribute(value,name){if(name!=="aggregate"){return super.onChangeAttribute(...arguments);}
const activeNode=this.env.viewEditorModel.activeNode;const newAttrs={avg:"",sum:"",};if(value&&value!=="none"){const humanName=value==="sum"?_t("Sum of %s"):_t("Average of %s");const fieldString=activeNode.attrs.string||activeNode.field.label;newAttrs[value]=sprintf(humanName,fieldString);}
return this.editNodeAttributes(newAttrs);}}
const ListEditorSidebar=__exports.ListEditorSidebar=class ListEditorSidebar extends Component{static template="web_studio.ViewEditor.ListEditorSidebar";static props={openViewInForm:{type:Function,optional:true},openDefaultValues:{type:Function,optional:true},};static components={InteractiveEditorSidebar,NewFields,ExistingFields,Property,Properties,SidebarViewToolbox,};setup(){this.viewEditorModel=useState(this.env.viewEditorModel);this.editArchAttributes=useEditNodeAttributes({isRoot:true});this.propertiesComponents={button:{component:ButtonProperties,props:{availableOptions:["invisible"],},},field:{component:ListFieldNodeProperties,props:{availableOptions:["invisible","required","readonly","string","help","optional","width",],},},};}
get archInfo(){return this.viewEditorModel.controllerProps.archInfo;}
get defaultOrder(){if(this.archInfo.defaultOrder.length>=1){return this.archInfo.defaultOrder[0];}else{return{name:"",asc:true};}}
get editableChoices(){return[{value:"",label:_t("Open form view")},{value:"top",label:_t("Add record on top")},{value:"bottom",label:_t("Add record at the bottom")},];}
get sortChoices(){const storeFieldsInArch=Object.fromEntries(Object.values(this.archInfo.fieldNodes).map((field)=>[field.name,this.viewEditorModel.fields[field.name],]));return fieldsToChoices(storeFieldsInArch,null,(field)=>!["one2many","many2many","binary"].includes(field.type)&&field.store);}
get orderChoices(){return[{value:"asc",label:_t("Ascending")},{value:"desc",label:_t("Descending")},];}
get defaultGroupbyChoices(){return fieldsToChoices(this.viewEditorModel.fields,this.viewEditorModel.GROUPABLE_TYPES,(field)=>field.groupable);}
setSortBy(value){this.onSortingChanged(value,this.defaultOrder.asc?"asc":"desc");}
setOrder(value){this.onSortingChanged(this.defaultOrder.name,value);}
onSortingChanged(sortBy,order){if(sortBy){this.onAttributeChanged(`${sortBy} ${order}`,"default_order");}else{this.onAttributeChanged("","default_order");}}
onAttributeChanged(value,name){return this.editArchAttributes({[name]:value});}
onCanDuplicateChanged(value){return this.editArchAttributes({duplicate:value?"":false});}
editDefaultGroupBy(value){this.onAttributeChanged(value.join(","),"default_group_by");}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/map/map_editor_sidebar.js */
odoo.define('@web_studio/client_action/view_editor/editors/map/map_editor_sidebar',['@web_map/map_view/map_view','@web/core/registry','@odoo/owl','@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox','@web/views/fields/many2many_tags/many2many_tags_field','@web_studio/client_action/view_editor/view_editor_model','@web/core/record_selectors/multi_record_selector','@web_studio/client_action/view_editor/editors/utils'],function(require){'use strict';let __exports={};const{mapView}=require("@web_map/map_view/map_view");const{registry}=require("@web/core/registry");const{Component,useState}=require("@odoo/owl");const{InteractiveEditorSidebar}=require("@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{SidebarViewToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox");const{Many2ManyTagsField}=require("@web/views/fields/many2many_tags/many2many_tags_field");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");const{MultiRecordSelector}=require("@web/core/record_selectors/multi_record_selector");const{fieldsToChoices}=require("@web_studio/client_action/view_editor/editors/utils");const MapEditorSidebar=__exports.MapEditorSidebar=class MapEditorSidebar extends Component{static template="web_studio.ViewEditor.MapEditorSidebar";static props={openViewInForm:{type:Function,optional:true},openDefaultValues:{type:Function,optional:true},};static components={InteractiveEditorSidebar,Property,SidebarViewToolbox,Many2ManyTagsField,MultiRecordSelector,};setup(){this.viewEditorModel=useState(this.env.viewEditorModel);this.editArchAttributes=useEditNodeAttributes({isRoot:true});}
get modelParams(){return this.viewEditorModel.controllerProps.modelParams;}
get multiRecordSelectorProps(){return{resModel:"ir.model.fields",update:this.changeAdditionalFields.bind(this),resIds:this.currentAdditionalFieldsIds,domain:[["model","=",this.viewEditorModel.resModel],["ttype","not in",["many2many","one2many","binary"]],],};}
get currentAdditionalFieldsIds(){return(JSON.parse(this.viewEditorModel.xmlDoc.firstElementChild.getAttribute("studio_map_field_ids"))||[]);}
onViewAttributeChanged(value,name){value=value?value:"";return this.editArchAttributes({[name]:value});}
get contactFieldChoices(){return Object.values(this.viewEditorModel.fields).filter((field)=>field.type==="many2one"&&field.relation==="res.partner").map((field)=>({label:`${field.string} (${field.name})`,value:field.name}));}
get defaultOrderChoices(){return Object.values(this.viewEditorModel.fields).filter((field)=>field.store&&!["one2many","many2many","binary"].includes(field.type)).map((field)=>({label:`${field.string} (${field.name})`,value:field.name}));}
get defaultGroupbyChoices(){return fieldsToChoices(this.viewEditorModel.fields,this.viewEditorModel.GROUPABLE_TYPES,(field)=>field.store);}
changeAdditionalFields(resIds){const currentFullIds=this.currentAdditionalFieldsIds;const newIds=resIds.filter((id)=>!currentFullIds.includes(id));let toRemoveIds;const operationType=newIds.length?"add":"remove";if(operationType==="remove"){toRemoveIds=currentFullIds.filter((id)=>!resIds.includes(id));}
this.viewEditorModel.doOperation({type:"map_popup_fields",target:{operation_type:operationType,field_ids:operationType==="add"?newIds:toRemoveIds,},});}
editDefaultGroupBy(value){this.editArchAttributes({default_group_by:value.join(",")});}}
registry.category("studio_editors").add("map",{...mapView,Sidebar:MapEditorSidebar,});return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/pivot/pivot_editor.js */
odoo.define('@web_studio/client_action/view_editor/editors/pivot/pivot_editor',['@odoo/owl','@web/core/registry','@web/views/pivot/pivot_view','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar','@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox','@web_studio/client_action/view_editor/operations_utils','@web_studio/client_action/view_editor/editors/utils','@web/views/fields/many2many_tags/many2many_tags_field','@web_studio/client_action/view_editor/view_editor_model','@web/views/utils','@web/core/record_selectors/multi_record_selector'],function(require){'use strict';let __exports={};const{Component,useState}=require("@odoo/owl");const{registry}=require("@web/core/registry");const{pivotView}=require("@web/views/pivot/pivot_view");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{InteractiveEditorSidebar}=require("@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar");const{SidebarViewToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox");const operationUtils=require("@web_studio/client_action/view_editor/operations_utils");const{fieldsToChoices}=require("@web_studio/client_action/view_editor/editors/utils");const{Many2ManyTagsField}=require("@web/views/fields/many2many_tags/many2many_tags_field");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");const{computeReportMeasures}=require("@web/views/utils");const{MultiRecordSelector}=require("@web/core/record_selectors/multi_record_selector");function getFieldNameFromGroupby(str){return str.split(":")[0];}
const PivotEditorSidebar=__exports.PivotEditorSidebar=class PivotEditorSidebar extends Component{static template="web_studio.ViewEditor.PivotEditorSidebar";static props={openViewInForm:{type:Function,optional:true},openDefaultValues:{type:Function,optional:true},};static components={InteractiveEditorSidebar,Property,SidebarViewToolbox,Many2ManyTagsField,MultiRecordSelector,};setup(){this.viewEditorModel=useState(this.env.viewEditorModel);this.editArchAttributes=useEditNodeAttributes({isRoot:true});}
get possibleMeasures(){const{fieldAttrs,activeMeasures}=this.archInfo;return computeReportMeasures(this.viewEditorModel.fields,fieldAttrs,activeMeasures);}
get multiRecordSelectorProps(){return{resModel:"ir.model.fields",update:this.changeMeasureFields.bind(this),resIds:this.currentMeasureFields,domain:[["model","=",this.viewEditorModel.resModel],["name","in",Object.keys(this.possibleMeasures)],],};}
get currentMeasureFields(){return(JSON.parse(this.viewEditorModel.xmlDoc.firstElementChild.getAttribute("studio_pivot_measure_field_ids"))||[]);}
get archInfo(){return this.viewEditorModel.controllerProps.modelParams.metaData;}
get rowGroupBys(){return this.archInfo.rowGroupBys.map((fName)=>getFieldNameFromGroupby(fName));}
get colGroupBys(){return this.archInfo.colGroupBys.map((fName)=>getFieldNameFromGroupby(fName));}
changeMeasureFields(resIds){const currentFullIds=this.currentMeasureFields;const newIds=resIds.filter((id)=>!currentFullIds.includes(id));let toRemoveIds;const operationType=newIds.length?"add":"remove";if(operationType==="remove"){toRemoveIds=currentFullIds.filter((id)=>!resIds.includes(id));}
this.viewEditorModel.doOperation({type:"pivot_measures_fields",target:{operation_type:operationType,field_ids:operationType==="add"?newIds:toRemoveIds,},});}
onGroupByChanged(type,newValue,oldValue){const operation=operationUtils.viewGroupByOperation("pivot",type,newValue,oldValue);this.viewEditorModel.doOperation(operation);}
onViewAttributeChanged(value,name){value=value?value:"";return this.editArchAttributes({[name]:value});}
get columnGroupbyChoices(){return fieldsToChoices(this.viewEditorModel.fields,this.viewEditorModel.GROUPABLE_TYPES,(field)=>field.groupable&&![this.archInfo.rowGroupBys[0],this.archInfo.rowGroupBys[1]].includes(field.name));}
get rowGroupbyChoices_first(){return fieldsToChoices(this.viewEditorModel.fields,this.viewEditorModel.GROUPABLE_TYPES,(field)=>field.groupable&&![this.archInfo.colGroupBys[0],this.archInfo.rowGroupBys[1]].includes(field.name));}
get rowGroupbyChoices_second(){return fieldsToChoices(this.viewEditorModel.fields,this.viewEditorModel.GROUPABLE_TYPES,(field)=>field.groupable&&![this.archInfo.colGroupBys[0],this.archInfo.rowGroupBys[0]].includes(field.name));}}
registry.category("studio_editors").add("pivot",{...pivotView,Sidebar:PivotEditorSidebar,});return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/search/search_editor.js */
odoo.define('@web_studio/client_action/view_editor/editors/search/search_editor',['@odoo/owl','@web/core/registry','@web_studio/client_action/view_editor/editors/xml_utils','@web/core/utils/xml','@web_studio/client_action/components/sidebar_draggable_item/sidebar_draggable_item','@web_studio/client_action/view_editor/editors/components/studio_hook_component','@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar','@web_studio/client_action/view_editor/editors/components/view_fields','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox','@web/core/l10n/translation','@web/core/utils/functions','@web/core/utils/hooks','@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox','@web/views/standard_view_props','@web_studio/client_action/view_editor/interactive_editor/field_configuration/field_configuration','@web_studio/client_action/view_editor/editors/utils'],function(require){'use strict';let __exports={};const{Component,useState}=require("@odoo/owl");const{registry}=require("@web/core/registry");const{computeXpath}=require("@web_studio/client_action/view_editor/editors/xml_utils");const{visitXML}=require("@web/core/utils/xml");const{SidebarDraggableItem}=require("@web_studio/client_action/components/sidebar_draggable_item/sidebar_draggable_item");const{StudioHook}=require("@web_studio/client_action/view_editor/editors/components/studio_hook_component");const{InteractiveEditorSidebar}=require("@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar");const{ExistingFields}=require("@web_studio/client_action/view_editor/editors/components/view_fields");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{SidebarViewToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{memoize}=require("@web/core/utils/functions");const{useOwnedDialogs}=require("@web/core/utils/hooks");const{SidebarPropertiesToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox");const{standardViewProps}=require("@web/views/standard_view_props");const{FieldConfigurationDialog,FilterConfiguration,}=require("@web_studio/client_action/view_editor/interactive_editor/field_configuration/field_configuration");const{randomName}=require("@web_studio/client_action/view_editor/editors/utils");function getGroupByFieldNameFromString(str){const matches=str.match(/(,\s*)?(["'])group_by\2\1(\s*:\s*)?\2(?<fieldName>.*)\2/);if(!matches){return null;}
if(!matches.groups){return null;}
return matches.groups.fieldName;}
function isFilterGroupBy(node){if(!node.hasAttribute("context")){return false;}
if(/(['"])group_by\1\s*:/.test(node.getAttribute("context"))){return true;}
return false;}
class SearchEditorArchParser{parse(xmlDoc){this.fields=[];this.filters=[];this.groupBys=[];this.currentCategory=null;this.currentItems={items:[]};visitXML(xmlDoc,this.visitNode.bind(this));this.changeCategory(null,true);return{fields:this.fields,filters:this.filters,groupBys:this.groupBys,xmlDoc,};}
visitNode(node){if(node.nodeType!==1){return;}
const nodeName=node.nodeName;const studioXpath=computeXpath(node,"search");if(nodeName==="field"){this.changeCategory("field",true);const item=this.parseNode(node);item.studioXpath=studioXpath;this.fields.push(item);return false;}
if(nodeName==="filter"){const category=isFilterGroupBy(node)?"groupBy":"filter";this.changeCategory(category);const item=this.parseNode(node);item.studioXpath=studioXpath;this.pushItem(item);return false;}
if(nodeName==="separator"){this.changeCategory("filter",true);this.currentItems.separator=studioXpath;return false;}
if(nodeName==="group"){this.changeCategory(null,true);Array.from(node.children).forEach(this.visitNode.bind(this));this.changeCategory(null,true);return false;}}
parseNode(node){const nodeName=node.nodeName;const invisible=node.getAttribute("invisible");if(nodeName==="field"){return{type:"field",name:node.getAttribute("name"),label:node.getAttribute("string"),invisible,};}
if(nodeName==="separator"){return{type:"separator"};}
if(nodeName==="filter"){const item={type:"filter",name:node.getAttribute("name"),label:node.getAttribute("string")||node.getAttribute("help"),domain:node.getAttribute("domain"),invisible,};if(node.hasAttribute("context")){const groupBy=getGroupByFieldNameFromString(node.getAttribute("context"));if(groupBy){item.groupBy=groupBy;item.type="groupBy";}}
return item;}}
pushItem(item){this.currentItems.items.push(item);}
changeCategory(category,force){if(this.currentCategory!==category||force){let itemsToPushIn;if(this.currentCategory==="filter"){itemsToPushIn=this.filters;}else if(this.currentCategory==="groupBy"){itemsToPushIn=this.groupBys;}
if(itemsToPushIn){itemsToPushIn.push(this.currentItems);this.currentItems={items:[]};}}
this.currentCategory=category||this.currentCategory;}}
class SearchEditorController extends Component{static props={...standardViewProps,archInfo:{type:Object}};static template="web_studio.SearchEditorController";static components={StudioHook};setup(){this.viewEditorModel=useState(this.env.viewEditorModel);}
get filtersGroups(){return this.props.archInfo.filters;}
hasItems(group){return group.some((g)=>this.getItems(g.items));}
get autoCompleteFields(){return this.props.archInfo.fields;}
get groupByGroups(){return this.props.archInfo.groupBys;}
getItems(items){if(!this.viewEditorModel.showInvisible){return items.filter((i)=>i.invisible!=="True"&&i.invisible!=="1");}
return items;}
getFirstHookProps(type){const xpath="/search";const position="inside";const group=type==="filter"?this.filtersGroups:this.groupByGroups;if(this.hasItems(group)){return false;}
const props={xpath,position,type,};if(type==="groupBy"){props.infos=JSON.stringify({create_group:true,});}
return props;}
getItemLabel(type,item){if(type==="filter"){return item.label;}
if(type==="groupBy"){let label=item.label||item.name;if(this.env.debug){label=`${label} (${item.groupBy})`;}
return label;}
if(type==="field"){let label=item.label||this.props.fields[item.name].string;if(this.env.debug){label=`${label} (${item.name})`;}
return label;}}
onItemClicked(ev,xpath){this.env.config.onNodeClicked(xpath);}}
class SearchComponents extends Component{static components={SidebarDraggableItem};static props={};static template="web_studio.SearchEditor.Sidebar.Components";get structures(){return{filter:{name:_t("Filter"),class:"o_web_studio_filter",},separator:{name:_t("Separator"),class:"o_web_studio_filter_separator",},};}}
class SimpleElementEditor extends Component{static props={node:{type:Object}};static components={Property,SidebarPropertiesToolbox};static template="web_studio.SearchEditor.SimpleElementEditor";setup(){this.addDialog=useOwnedDialogs();}
get viewEditorModel(){return this.env.viewEditorModel;}
get node(){return this.props.node;}
get label(){if(this.node.type==="field"&&!this.node.label){return this.env.viewEditorModel.fields[this.node.name].string;}
return this.node.label;}
get domain(){if(this.node.type==="filter"){return this.node.domain;}
return null;}
onChangeDomain(value){const operation={new_attrs:{domain:value},type:"attributes",position:"attributes",target:this.viewEditorModel.getFullTarget(this.viewEditorModel.activeNodeXpath),};this.viewEditorModel.doOperation(operation);}
onChangeLabel(value){const operation={new_attrs:{string:value},type:"attributes",position:"attributes",target:this.viewEditorModel.getFullTarget(this.viewEditorModel.activeNodeXpath),};this.viewEditorModel.doOperation(operation);}
onPropertyRemoved(){const activeNodeXpath=this.viewEditorModel.activeNodeXpath;this.viewEditorModel.activeNodeXpath=null;const operation={type:"remove",target:this.viewEditorModel.getFullTarget(activeNodeXpath),};this.viewEditorModel.doOperation(operation);}}
class SearchEditorSidebar extends Component{static template="web_studio.ViewEditor.SearchEditorSidebar";static props={openViewInForm:{type:Function,optional:true},openDefaultValues:{type:Function,optional:true},};static components={InteractiveEditorSidebar,ExistingFields,SearchComponents,Property,SidebarViewToolbox,SimpleElementEditor,};setup(){this.viewEditorModel=useState(this.env.viewEditorModel);const searchArchParser=new SearchEditorArchParser();this._getCurrentNode=memoize(()=>searchArchParser.parseNode(this.viewEditorModel.activeNode.arch));}
get currentNode(){const{activeNodeXpath,arch}=this.viewEditorModel;return this._getCurrentNode(`${activeNodeXpath}_${arch}`);}}
const searchEditor={ArchParser:SearchEditorArchParser,Controller:SearchEditorController,props(genericProps,editor,config){const archInfo=new editor.ArchParser().parse(genericProps.arch);return{...genericProps,archInfo};},Sidebar:SearchEditorSidebar,};registry.category("studio_editors").add("search",searchEditor);async function addSearchViewStructure(structure,{droppedData,targetInfo,addDialog}){switch(structure){case"group":case"separator":{return{node:{tag:structure,attrs:{name:randomName(`studio_${structure}`),},},};}
case"field":{if(!["groupBy","filter"].includes(targetInfo.type)){return;}else{const fieldName=JSON.parse(droppedData).fieldName;const fieldGet=this.env.viewEditorModel.fields[fieldName];const willBeGroupBy=targetInfo.type==="groupBy";const node={tag:"filter",attrs:{name:randomName(`studio_${willBeGroupBy ? "group" : "filter"}_by`),string:fieldGet.string,},};if(willBeGroupBy){node.attrs.context=`{'group_by': '${fieldName}'}`;if(targetInfo.infos&&JSON.parse(targetInfo.infos).create_group){node.attrs.create_group=true;}}else{node.attrs.date=fieldName;}
return{node,};}}
case"filter":{const filterData=await new Promise((resolve)=>{addDialog(FieldConfigurationDialog,{title:_t("New Filter"),size:"md",confirm:(data)=>resolve(data),cancel:()=>resolve(false),Component:FilterConfiguration,componentProps:{resModel:this.env.viewEditorModel.resModel},});});if(!filterData){return;}
const node={tag:"filter",attrs:{domain:filterData.domain,name:randomName("studio_filter"),string:filterData.filterLabel,},};return{node,};}}}
searchEditor.addViewStructure=addSearchViewStructure;const FILTER_TYPES=["date","datetime"];const GROUPABLE_TYPES=["many2one","many2many","char","boolean","selection","date","datetime","integer",];function fieldCanBeFilter(field){return FILTER_TYPES.includes(field.type)&&field.store;}
function fieldCanBeGroupable(field){return GROUPABLE_TYPES.includes(field.type)&&field.groupable;}
const disabledDropClass="o-web-studio-search--drop-disable";searchEditor.isValidHook=function isValidSearchHook({hook,element,viewEditorModel}){if(hook.closest(`.${disabledDropClass}`)){return false;}
return true;};searchEditor.prepareForDrag=function({element,viewEditorModel,ref}){const draggingStructure=element.dataset.structure;switch(draggingStructure){case"field":{const fieldName=JSON.parse(element.dataset.drop).fieldName;const field=viewEditorModel.fields[fieldName];if(!fieldCanBeFilter(field)){ref.el.querySelector(`.o-web-studio-search--filters`).classList.add(disabledDropClass);}
if(!fieldCanBeGroupable(field)){ref.el.querySelector(`.o-web-studio-search--groupbys`).classList.add(disabledDropClass);}
break;}
case"separator":case"filter":{const els=ref.el.querySelectorAll(".o-web-studio-search--fields,.o-web-studio-search--groupbys");els.forEach((el)=>el.classList.add("o-web-studio-search--drop-disable"));break;}}
return()=>{ref.el.querySelectorAll(".o-web-studio-search--drop-disable").forEach((el)=>el.classList.remove("o-web-studio-search--drop-disable"));};};return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/sidebar_safe_fields.js */
odoo.define('@web_studio/client_action/view_editor/editors/sidebar_safe_fields',[],function(require){'use strict';let __exports={};const SIDEBAR_SAFE_FIELDS=__exports.SIDEBAR_SAFE_FIELDS=["badge","selection_badge","handle","percentpie","radio","selection","image_url","ace","priority","date","datetime","remaining_days","email","phone","url","binary","image","pdf_viewer","boolean","state_selection","boolean_toggle","statusbar","float","float_time","integer","monetary","percentage","progressbar","text","boolean_favorite","boolean_icon","char","statinfo","html","text_emojis","CopyClipboardChar","CopyClipboardURL","char_emojis","many2many_tags","many2one","many2many","one2many","sms_widget","reference","daterange","google_address_autocomplete",];return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/utils.js */
odoo.define('@web_studio/client_action/view_editor/editors/utils',['@web/core/utils/arrays','@web/core/registry','@web_studio/client_action/view_editor/editors/sidebar_safe_fields','@odoo/owl'],function(require){'use strict';let __exports={};const{sortBy}=require("@web/core/utils/arrays");const{registry}=require("@web/core/registry");const{SIDEBAR_SAFE_FIELDS}=require("@web_studio/client_action/view_editor/editors/sidebar_safe_fields");const{useComponent,useEffect,useRef}=require("@odoo/owl");const hookPositionTolerance=__exports.hookPositionTolerance=50;__exports.cleanHooks=cleanHooks;function cleanHooks(el){for(const hookEl of el.querySelectorAll(".o_web_studio_nearest_hook")){hookEl.classList.remove("o_web_studio_nearest_hook");}}
__exports.getActiveHook=getActiveHook;function getActiveHook(el){return el.querySelector(".o_web_studio_nearest_hook");}
__exports.isToXpathEquivalentFromXpath=isToXpathEquivalentFromXpath;function isToXpathEquivalentFromXpath(position,toXpath,fromXpath){if(toXpath===fromXpath){return true;}
const toParts=toXpath.split("/");const fromParts=fromXpath.split("/");if(toParts.slice(0,-1).join("/")!==fromParts.slice(0,-1).join("/")){return false;}
const nodeIdxRegExp=/(\w+)(\[(\d+)\])?/;const toMatch=toParts[toParts.length-1].match(nodeIdxRegExp);const fromMatch=fromParts[fromParts.length-1].match(nodeIdxRegExp);if(fromMatch[1]!==toMatch[1]){return false;}
if(position==="after"&&parseInt(toMatch[3]||1)+1===parseInt(fromMatch[3]||1)){return true;}
return false;}
__exports.getHooks=getHooks;function getHooks(el){return[...el.querySelectorAll(".o_web_studio_hook")];}
__exports.randomName=randomName;function randomName(baseName){const random=Math.floor(Math.random()*10000).toString(32)+"_"+Number(new Date()).toString(32);return`${baseName}_${random}`;}
__exports.studioIsVisible=studioIsVisible;function studioIsVisible(props){return props.studioIsVisible!==undefined?props.studioIsVisible:true;}
__exports.cleanClickedElements=cleanClickedElements;function cleanClickedElements(mainEl){for(const el of mainEl.querySelectorAll(".o-web-studio-editor--element-clicked")){el.classList.remove("o-web-studio-editor--element-clicked");}}
__exports.useStudioRef=useStudioRef;function useStudioRef(refName="studioRef",onClick){const comp=useComponent();const ref=useRef(refName);useEffect((el)=>{if(el){el.setAttribute("data-studio-xpath",comp.props.studioXpath);}},()=>[ref.el]);if(onClick){const handler=onClick.bind(comp);useEffect((el)=>{if(el){el.addEventListener("click",handler,{capture:true});return()=>{el.removeEventListener("click",handler);};}},()=>[ref.el]);}}
__exports.makeModelErrorResilient=makeModelErrorResilient;function makeModelErrorResilient(ModelClass,activeActions={create:true}){function logError(debug){if(!debug){return;}
console.warn("The onchange triggered an error. It may indicate either a faulty call to onchange, or a faulty model python side");}
return class ResilientModel extends ModelClass{setup(){super.setup(...arguments);const orm=this.orm;const debug=this.env.debug;this.orm=Object.assign(Object.create(orm),{async call(model,method){if(method==="onchange"){if(activeActions.create){try{return await orm.call.call(orm,...arguments);}catch{logError(debug);}}
return{value:{}};}
return orm.call.call(orm,...arguments);},});}};}
__exports.getWowlFieldWidgets=getWowlFieldWidgets;function getWowlFieldWidgets(fieldType,currentKey="",blacklistedKeys=[],debug=false){const wowlFieldRegistry=registry.category("fields");const widgets=[];for(const[widgetKey,Component]of wowlFieldRegistry.getEntries()){if(widgetKey!==currentKey){if(!Component.supportedTypes||!Component.supportedTypes.includes(fieldType)){continue;}
if(widgetKey.includes(".")||blacklistedKeys.includes(widgetKey)){continue;}
if(!debug&&!SIDEBAR_SAFE_FIELDS.includes(widgetKey)){continue;}}
widgets.push([widgetKey,Component.displayName]);}
return sortBy(widgets,(el)=>el[1]||el[0]);}
__exports.xpathToLegacyXpathInfo=xpathToLegacyXpathInfo;function xpathToLegacyXpathInfo(xpath){const xpathInfo=[];const matches=xpath.matchAll(/\/?(\w+|\*)(\[(\d+)\])?/g);for(const m of matches){const info={tag:m[1],indice:parseInt(m[3]||1),};xpathInfo.push(info);}
return xpathInfo;}
__exports.fieldsToChoices=fieldsToChoices;function fieldsToChoices(fields,availableTypes,filterCallback){let values=Object.values(fields);if(filterCallback){values=values.filter(filterCallback);}
if(availableTypes){values=values.filter((f)=>availableTypes.includes(f.type));}
return values.map((field)=>({label:odoo.debug?`${field.string} (${field.name})`:field.string||field.name,value:field.name,}));}
__exports.getStudioNoFetchFields=getStudioNoFetchFields;function getStudioNoFetchFields(_fieldNodes){const fieldNames=[];const fieldNodes=[];Object.entries(_fieldNodes).filter(([fNode,field])=>field.attrs&&field.attrs.studio_no_fetch).forEach(([fNode,field])=>{fieldNames.push(field.name);fieldNodes.push(fNode);});return{fieldNames,fieldNodes,};}
__exports.useModelConfigFetchInvisible=useModelConfigFetchInvisible;function useModelConfigFetchInvisible(model){function fixActiveFields(activeFields){const stack=[activeFields];while(stack.length){const activeFields=stack.pop();for(const activeField of Object.values(activeFields)){if("related"in activeField){stack.push(activeField.related.activeFields);}
delete activeField.invisible;}}
return activeFields;}
const load=model.load;model.load=(...args)=>{fixActiveFields(model.config.activeFields);return load.call(model,...args);};}
__exports.getCurrencyField=getCurrencyField;function getCurrencyField(fieldsGet){const field=Object.entries(fieldsGet).find(([fName,fInfo])=>fInfo.type==="many2one"&&fInfo.relation==="res.currency");if(field){return field[0];}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/editors/xml_utils.js */
odoo.define('@web_studio/client_action/view_editor/editors/xml_utils',['@web/core/py_js/py','@web/views/view_compiler'],function(require){'use strict';let __exports={};const{evaluateExpr}=require("@web/core/py_js/py");const{isComponentNode,appendAttr}=require("@web/views/view_compiler");const nodeWeak=new WeakMap();__exports.countPreviousSiblings=countPreviousSiblings;function countPreviousSiblings(node){const countXpath=`count(preceding-sibling::${node.tagName}[not(@data-used-by)])`;return node.ownerDocument.evaluate(countXpath,node,null,XPathResult.NUMBER_TYPE).numberValue;}
__exports.computeXpath=computeXpath;function computeXpath(node,upperBoundSelector="form"){if(nodeWeak.has(node)){return nodeWeak.get(node);}
const tagName=node.tagName;const count=countPreviousSiblings(node)+1;let xpath=`${tagName}[${count}]`;const parent=node.parentElement;if(!node.matches(upperBoundSelector)){const parentXpath=computeXpath(parent,upperBoundSelector);xpath=`${parentXpath}/${xpath}`;}else{xpath=`/${xpath}`;}
nodeWeak.set(node,xpath);return xpath;}
__exports.getNodeAttributes=getNodeAttributes;function getNodeAttributes(node){const attrs={};for(const att of node.getAttributeNames()){if(att==="options"){attrs[att]=evaluateExpr(node.getAttribute(att));continue;}
attrs[att]=node.getAttribute(att);}
return attrs;}
function getXpathNodes(xpathResult){const nodes=[];let res;while((res=xpathResult.iterateNext())){nodes.push(res);}
return nodes;}
__exports.getNodesFromXpath=getNodesFromXpath;function getNodesFromXpath(xpath,xml){const owner="evaluate"in xml?xml:xml.ownerDocument;const xpathResult=owner.evaluate(xpath,xml,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE);return getXpathNodes(xpathResult);}
const parser=new DOMParser();const parseStringToXml=__exports.parseStringToXml=(str)=>{return parser.parseFromString(str,"text/xml");};const serializer=new XMLSerializer();const serializeXmlToString=__exports.serializeXmlToString=(xml)=>{return serializer.serializeToString(xml);};__exports.applyInvisible=applyInvisible;function applyInvisible(invisible,compiled,params){if(!invisible||invisible==="False"||invisible==="0"){return compiled;}
let isVisileExpr;if(invisible!=="True"&&invisible!=="1"){const recordExpr=params.recordExpr||"__comp__.props.record";isVisileExpr=`!__comp__.evaluateBooleanExpr(${JSON.stringify(
            invisible
        )},${recordExpr}.evalContextWithVirtualIds)`;if(isComponentNode(compiled)){compiled.setAttribute("studioIsVisible",isVisileExpr);}else{appendAttr(compiled,"class",`o_web_studio_show_invisible:!${isVisileExpr}`);}}else{if(isComponentNode(compiled)){compiled.setAttribute("studioIsVisible","false");}else{appendAttr(compiled,"class",`o_web_studio_show_invisible:true`);}}
const studioShowExpr=`__comp__.viewEditorModel.showInvisible`;isVisileExpr=isVisileExpr?`(${isVisileExpr} or ${studioShowExpr})`:studioShowExpr;if(compiled.hasAttribute("t-if")){const formerTif=compiled.getAttribute("t-if");isVisileExpr=`( ${formerTif} ) and ${isVisileExpr}`;}
compiled.setAttribute("t-if",isVisileExpr);return compiled;}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/action_button/action_button.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/action_button/action_button',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component,useState}=require("@odoo/owl");const AddButtonAction=__exports.AddButtonAction=class AddButtonAction extends Component{static props={};static template=`web_studio.AddButtonAction`;onClick(ev){const findHeader=this.env.viewEditorModel.xmlDoc.firstChild.querySelector(":scope > header");if(!findHeader){this.env.viewEditorModel.pushOperation({type:"statusbar",view_id:this.env.viewEditorModel.view.id,});}
this.env.viewEditorModel.doOperation({type:"add_header_button",});const buttonCount=ev.target.parentElement.querySelectorAll("button[data-studio-xpath]").length;this.env.setAutoClick({xpath:`/${this.env.viewEditorModel.viewType}[1]/header[1]/button[${buttonCount + 1}]`,});}}
const SelectionHeaderButtons=__exports.SelectionHeaderButtons=class SelectionHeaderButtons extends Component{static props={headerButtons:{type:Object},};static template=`web_studio.SelectionHeaderButtons`;static components={AddButtonAction,};setup(){this.viewEditorModel=useState(this.env.viewEditorModel);this.buttons=this.getButtons();}
makeTooltipButton(button){return JSON.stringify({button:{string:button.string,type:button.clickParams?.type,name:button.clickParams?.name,},debug:true,});}
getButtons(){if(this.viewEditorModel.showInvisible){return this.props.headerButtons.map((btn)=>{if(btn.invisible==="True"||btn.invisible==="1"){btn.className+=" o_web_studio_show_invisible";}
return btn;});}
return this.props.headerButtons.filter((btn)=>btn.invisible!=="True"&&btn.invisible!=="1");}
getClassName(button){return button.className.includes("btn-primary")?button.className:`btn-secondary ${button.className}`;}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/field_configuration/field_configuration.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/field_configuration/field_configuration',['@odoo/owl','@web/core/dialog/dialog','@web/core/model_field_selector/model_field_selector','@web_studio/client_action/utils','@web/core/utils/hooks','@web/core/l10n/translation','@web/core/domain_selector/domain_selector','@web_studio/client_action/view_editor/interactive_editor/field_configuration/selection_content_dialog','@web/core/record_selectors/record_selector'],function(require){'use strict';let __exports={};const{Component,useState,xml}=require("@odoo/owl");const{Dialog}=require("@web/core/dialog/dialog");const{ModelFieldSelector}=require("@web/core/model_field_selector/model_field_selector");const{useDialogConfirmation}=require("@web_studio/client_action/utils");const{useOwnedDialogs,useService}=require("@web/core/utils/hooks");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{DomainSelector}=require("@web/core/domain_selector/domain_selector");const{SelectionContentDialog}=require("@web_studio/client_action/view_editor/interactive_editor/field_configuration/selection_content_dialog");const{RecordSelector}=require("@web/core/record_selectors/record_selector");const SelectionValuesEditor=__exports.SelectionValuesEditor=class SelectionValuesEditor extends Component{static components={SelectionContentDialog,};static props={configurationModel:{type:Object},confirm:{type:Function},cancel:{type:Function},};static template="web_studio.SelectionValuesEditor";static Model=class SelectionValuesModel{constructor(){this.selection="[]";}
get isValid(){return true;}};get selection(){return JSON.parse(this.props.configurationModel.selection);}
onConfirm(choices){this.props.configurationModel.selection=JSON.stringify(choices);this.props.confirm();}}
const RelationalFieldConfigurator=__exports.RelationalFieldConfigurator=class RelationalFieldConfigurator extends Component{static template="web_studio.RelationalFieldConfigurator";static components={RecordSelector};static props={configurationModel:{type:Object},resModel:{type:String},fieldType:{type:String},};static Model=class RelationalFieldModel{constructor(){this.relationId=false;}
get isValid(){return!!this.relationId;}};setup(){this.state=useState(this.props.configurationModel);}
get valueSelectorProps(){if(this.props.fieldType==="one2many"){return{resModel:"ir.model.fields",domain:[["relation","=",this.props.resModel],["ttype","=","many2one"],["model_id.abstract","=",false],["store","=",true],],resId:this.state.relationId,update:(resId)=>{this.state.relationId=resId;},};}
return{resModel:"ir.model",domain:[["transient","=",false],["abstract","=",false],["model","not in",["knowledge.article"]],],resId:this.state.relationId,update:(resId)=>{this.state.relationId=resId;},};}}
class RelatedChainBuilderModel{static services=["field","dialog"];constructor({services,props}){this.services=services;this.relatedParams={};this.fieldInfo={resModel:props.resModel,fieldDef:null};this.resModel=props.resModel;}
get isValid(){return!!this.relatedParams.related;}
getRelatedFieldDescription(resModel,lastField){const fieldType=lastField.type;const relatedDescription={readonly:true,copy:false,string:lastField.string,type:fieldType,store:false,};if(["many2one","many2many","one2many"].includes(fieldType)){relatedDescription.relation=lastField.relation;}
if(["one2many","many2many"].includes(fieldType)){relatedDescription.relational_model=resModel;}
if(fieldType==="selection"){relatedDescription.selection=lastField.selection;}
return relatedDescription;}
async confirm(){const relatedDescription=this.getRelatedFieldDescription(this.fieldInfo.resModel,this.fieldInfo.fieldDef);Object.assign(this.relatedParams,relatedDescription);return true;}}
const RelatedChainBuilder=__exports.RelatedChainBuilder=class RelatedChainBuilder extends Component{static template=xml`<ModelFieldSelector resModel="props.resModel" path="fieldChain" readonly="false" filter.bind="filter" update.bind="updateChain" />`;static components={ModelFieldSelector};static props={resModel:{type:String},configurationModel:{type:Object},};static Model=RelatedChainBuilderModel;setup(){this.state=useState(this.props.configurationModel);this.relatedParams.related="";}
get relatedParams(){return this.state.relatedParams;}
get fieldChain(){return this.relatedParams.related;}
filter(fieldDef,path){return fieldDef.type!=="properties";}
async updateChain(path,fieldInfo){this.relatedParams.related=path;this.state.fieldInfo=fieldInfo;}}
function useConfiguratorModel(Model,props){const services=Object.fromEntries((Model.services||[]).map((servName)=>{let serv;if(servName==="dialog"){serv={add:useOwnedDialogs()};}else{serv=useService(servName);}
return[servName,serv];}));const model=new Model({services,props});return useState(model);}
const FieldConfigurationDialog=__exports.FieldConfigurationDialog=class FieldConfigurationDialog extends Component{static props={confirm:{type:Function},cancel:{type:Function},close:{type:Function},Component:{type:Function},componentProps:{type:Object,optional:true},fieldType:{type:String,optional:true},isDialog:{type:Boolean,optional:true},title:{type:String,optional:true},size:{type:String,optional:true},};static template="web_studio.FieldConfigurationDialog";static components={Dialog};setup(){const{confirm,cancel}=useDialogConfirmation({confirm:async()=>{let confirmValues=false;if(!this.configurationModel.isValid){return false;}
if(this.configurationModel.confirm){const res=await this.configurationModel.confirm();if(res||res===undefined){confirmValues=this.configurationModel;}}else{confirmValues=this.configurationModel;}
return this.props.confirm(confirmValues);},cancel:()=>this.props.cancel(),});this.confirm=confirm;this.cancel=cancel;this.configurationModel=useConfiguratorModel(this.Component.Model,this.props.componentProps);}
get title(){if(this.props.title){return this.props.title;}
if(this.props.fieldType){return _t("Field properties: %s",this.props.fieldType);}
return"";}
get Component(){return this.props.Component;}
get canConfirm(){return this.configurationModel.isValid;}}
const FilterConfiguration=__exports.FilterConfiguration=class FilterConfiguration extends Component{static components={DomainSelector};static template="web_studio.FilterConfiguration";static props={resModel:{type:String},configurationModel:{type:Object},};static Model=class FilterConfigurationModel{constructor(){this.filterLabel="";this.domain="[]";}
get isValid(){return!!this.filterLabel;}};setup(){this.state=useState(this.props.configurationModel);}
get domainSelectorProps(){return{resModel:this.props.resModel,readonly:false,domain:this.state.domain,update:(domainStr)=>{this.state.domain=domainStr;},isDebugMode:!!this.env.debug,};}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/field_configuration/selection_content_dialog.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/field_configuration/selection_content_dialog',['@web/core/dialog/dialog','@web/core/utils/sortable_owl','@odoo/owl'],function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{useSortable}=require("@web/core/utils/sortable_owl");const{Component,useRef,useState}=require("@odoo/owl");const SelectionContentDialog=__exports.SelectionContentDialog=class SelectionContentDialog extends Component{static components={Dialog,};static defaultProps={defaultChoices:[],};static props={defaultChoices:{type:Array,optional:true},onConfirm:{type:Function},close:{type:Function},};static template="web_studio.SelectionContentDialog";setup(){this.state=useState({choices:this.props.defaultChoices,});this.localState=useState({_newItem:[],editedItem:null,});const itemsList=useRef("itemsList");useSortable({enable:()=>!this.editedItem,handle:".o-draggable-handle",ref:itemsList,elements:".o-draggable",cursor:"move",onDrop:(params)=>this.resequenceItems(params),});this.oldValue=new WeakMap();}
getSelectionFromItem(item){if(item.id==="new"){return this.localState._newItem;}
return this.selection[item.id];}
get selection(){return this.state.choices;}
set selection(items){this.state.choices=items;}
selectionToItem(selection,params={}){return Object.assign({id:"new",key:selection[0],name:selection[0],label:selection[1],isDraggable:false,isRemovable:false,isInEdition:false,},params);}
get selectionToItems(){const inEdition=!!this.editedItem;return this.selection.map((sel,index)=>{return this.selectionToItem(sel,{id:index,key:inEdition?index:sel[0],isInEdition:this.editedItem?.id===this.selection.indexOf(sel)&&!this.shouldFullEdit,isDraggable:!inEdition,isRemovable:!inEdition,});});}
get newItem(){return this.selectionToItem(this.localState._newItem,{isInEdition:true,id:"new"});}
get editedItem(){return this.localState.editedItem;}
get shouldFullEdit(){return Boolean(this.env.debug);}
ensureUnique(item){const value=item[0];if(!value){return false;}
const otherElements=this.selection.filter((i)=>i!==item);if(otherElements.some((i)=>i[0]===value)){return false;}
return true;}
setItemValue(item,value){if(item.id!=="new"&&item.id!==this.editedItem.id){return;}
const isEditingLabel=item.id!=="new";item=this.getSelectionFromItem(item);item[0]=isEditingLabel?this.editedItem.name:value;item[1]=value;}
addItem(item){if(!this.ensureUnique(item)){return;}
this.selection.push(item);this.localState._newItem=[];}
removeItem(item){this.selection=this.selection.filter((i)=>i[0]!==item.name);}
editItem(item){const selItem=this.getSelectionFromItem(item);if(item.id==="new"){selItem[0]=selItem[0]?.trim();selItem[1]=selItem[1]?.trim();return this.addItem(selItem);}
if(this.editedItem?.id===item.id){const old=this.oldValue.get(selItem);if(old[0]!==selItem[0]){selItem[0]=selItem[0]?.trim();}
if(old[1]!==selItem[1]){selItem[1]=selItem[1]?.trim();}
if(!this.ensureUnique(selItem)){return;}
this.localState.editedItem=null;this.oldValue.delete(selItem);return;}
this.oldValue.set(selItem,[...selItem]);this.localState.editedItem=item;}
discardItemChanges(item){if(item.id==="new"){return this.setItemValue(item,"");}
const selItem=this.getSelectionFromItem(item);const oldValue=this.oldValue.get(selItem);selItem[0]=oldValue[0];selItem[1]=oldValue[1];this.localState.editedItem=null;}
resequenceItems(params){const{previous,next,element}=params;const itemId=parseInt(element.dataset.itemId);let items=this.selection;const item=items[itemId];items=items.filter((i)=>i!==item);let toIndex;if(previous){toIndex=parseInt(previous.dataset.itemId)+1;}else if(next){toIndex=parseInt(next.dataset.itemId);}
items.splice(toIndex,0,item);this.selection=items;}
async onConfirm(){if(this.newItem.name?.length){this.editItem(this.newItem);}
await this.props.onConfirm(this.selection);this.props.close();}
onKeyPressed(item,key){if(key==="Enter"){this.editItem(item);}}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/interactive_editor.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/interactive_editor',['@odoo/owl','@web/core/utils/ui','@web/core/utils/draggable','@web/core/utils/hooks','@web/core/l10n/translation','@web_studio/client_action/view_editor/editors/utils','@web/core/confirmation_dialog/confirmation_dialog','@web_studio/client_action/view_editor/interactive_editor/field_configuration/field_configuration','@web_studio/client_action/view_editor/editors/xml_utils','@web_studio/client_action/view_editor/default_view_sidebar/default_view_sidebar','@web/core/macro'],function(require){'use strict';let __exports={};const{Component,toRaw,useSubEnv}=require("@odoo/owl");const{closest,touching}=require("@web/core/utils/ui");const{useDraggable}=require("@web/core/utils/draggable");const{useOwnedDialogs,useService}=require("@web/core/utils/hooks");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{isToXpathEquivalentFromXpath,cleanHooks,getActiveHook,getCurrencyField,getHooks,hookPositionTolerance,randomName,}=require("@web_studio/client_action/view_editor/editors/utils");const{ConfirmationDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{FieldConfigurationDialog,SelectionValuesEditor,RelationalFieldConfigurator,RelatedChainBuilder,}=require("@web_studio/client_action/view_editor/interactive_editor/field_configuration/field_configuration");const{getNodesFromXpath,countPreviousSiblings,}=require("@web_studio/client_action/view_editor/editors/xml_utils");const{DefaultViewSidebar}=require("@web_studio/client_action/view_editor/default_view_sidebar/default_view_sidebar");const{waitUntil}=require("@web/core/macro");const NO_M2O_AVAILABLE=_t(`
    There are no many2one fields related to the current model.
    To create a one2many field on the current model, you must first create its many2one counterpart on the model you want to relate to.
`);function copyElementOnDrag(){let element;let copy;function clone(_element){element=_element;copy=element.cloneNode(true);}
function insert(){if(element){element.insertAdjacentElement("beforebegin",copy);}}
function clean(){if(copy){copy.remove();}
copy=null;element=null;}
return{clone,insert,clean};}
const InteractiveEditor=__exports.InteractiveEditor=class InteractiveEditor extends Component{static template="web_studio.InteractiveEditor";static components={};static props={editor:true,slots:{type:Object},editorContainerRef:{type:Object},rendererRef:{type:Object},};setup(){this.defaultSidebar=DefaultViewSidebar;this.action=useService("action");this.orm=useService("orm");this.addDialog=useOwnedDialogs();this.notification=useService("notification");const getNearestHook=this.getNearestHook.bind(this);const prepareForDrag=this.props.editor.prepareForDrag;const isValidHook=this.props.editor.isValidHook||(()=>true);this.addViewStructure=this.props.editor.addViewStructure;const styleNearestHook=this.props.editor.styleNearestHook||((ref,hook)=>{hook.classList.add("o_web_studio_nearest_hook");});function removeBootStrapClasses(element){const bootstrapClasses=Array.from(element.classList).filter((c)=>c.startsWith("position-")||c.startsWith("w-")||c.startsWith("h-"));if(!bootstrapClasses.length){return()=>{};}
element.classList.remove(...bootstrapClasses);return()=>{element.classList.add(...bootstrapClasses);};}
let cleanUps;const copyOnDrag=copyElementOnDrag();useDraggable({ref:this.props.editorContainerRef,elements:".o-draggable",onWillStartDrag:({element})=>{cleanUps=[];if(element.closest(".o_web_studio_component")){copyOnDrag.clone(element);}},onDragStart:({element})=>{cleanUps.push(removeBootStrapClasses(element));copyOnDrag.insert();if(prepareForDrag){cleanUps.push(prepareForDrag({element,viewEditorModel:this.viewEditorModel,ref:this.props.editorContainerRef,}));}},onDrag:({x,y,element})=>{cleanHooks(this.viewRef.el);element.classList.remove("o-draggable--drop-ready");const hook=getNearestHook(element,{x,y});if(!hook){return;}
if(!isValidHook({hook,element,viewEditorModel:this.viewEditorModel})){return;}
styleNearestHook(this.props.rendererRef,hook);element.classList.add("o-draggable--drop-ready");},onDrop:({element})=>{const targetHook=getActiveHook(this.viewRef.el);if(!targetHook){return;}
const{xpath,position,type,infos}=targetHook.dataset;const droppedData=element.dataset;const isNew=element.classList.contains("o_web_studio_component");const structure=isNew?droppedData.structure:"field";if(isNew){this.addStructure(structure,droppedData.drop,{xpath,position,type,infos,});}else{this.moveStructure(structure,droppedData,{xpath,position});}},onDragEnd:({element})=>{cleanHooks(this.viewRef.el);if(cleanUps){cleanUps.forEach((c)=>c());cleanUps=null;}
copyOnDrag.clean();},});this.applyAutoClick=async()=>{if(!this.autoClick){return;}
const{targetInfo,tag,attrs}=this.autoClick;let xpathToClick=targetInfo.xpath;if(tag){if(targetInfo.position!=="inside"){xpathToClick=xpathToClick.split("/").slice(0,-1).join("/");}
const attrForXpath=Object.entries(attrs).filter(([,value])=>!!value).map(([attName,value])=>`@${attName}='${value}'`).join(" and ");const nodeXpath=`${tag}[${attrForXpath}]`;const fullXpath=`${xpathToClick}/${nodeXpath}`;const nodes=getNodesFromXpath(fullXpath,toRaw(this.viewEditorModel).xmlDoc);this.autoClick=null;if(nodes.length!==1){return;}
const atPosition=countPreviousSiblings(nodes[0])+1;xpathToClick=`${xpathToClick}/${tag}[${atPosition}]`;}
let domEl;await waitUntil(()=>{domEl=this.props.rendererRef.el?.querySelector(`[data-studio-xpath='${xpathToClick}'], [studioxpath='${xpathToClick}']`);return domEl&&domEl.isConnected;}).catch(()=>true);if(domEl){domEl.click();}};useSubEnv({setAutoClick:(targetInfo,nodeDescr)=>this.setAutoClick(targetInfo,nodeDescr),});}
get viewEditorModel(){return this.env.viewEditorModel;}
get viewRef(){return this.viewEditorModel.viewRef;}
getNearestHook(draggedEl,{x,y}){const viewRefEl=this.viewRef.el;cleanHooks(viewRefEl);const mouseToleranceRect={x:x-hookPositionTolerance,y:y-hookPositionTolerance,width:hookPositionTolerance*2,height:hookPositionTolerance*2,};const touchingEls=touching(getHooks(viewRefEl),mouseToleranceRect);const closestHookEl=closest(touchingEls,{x,y});return closestHookEl;}
openViewInForm(){return this.action.doAction({type:"ir.actions.act_window",res_model:"ir.ui.view",res_id:this.env.viewEditorModel.mainView.id,views:[[false,"form"]],target:"current",},{clearBreadcrumbs:true});}
openDefaultValues(){const resModel=this.env.viewEditorModel.resModel;this.action.doAction({name:_t("Default Values"),type:"ir.actions.act_window",res_model:"ir.default",target:"current",views:[[false,"list"],[false,"form"],],domain:[["field_id.model","=",resModel]],},{clearBreadcrumbs:true});}
setAutoClick(targetInfo,nodeDescr){if(!targetInfo){this.autoClick=null;return;}
if(targetInfo&&!nodeDescr){this.autoClick={targetInfo,};return;}
let nameAttr=nodeDescr.attrs?.name;if(nodeDescr.tag==="field"&&!nameAttr){nameAttr=nodeDescr.field_description.name;}else if(!nameAttr){this.autoClick={targetInfo,};return;}
this.autoClick={targetInfo,tag:nodeDescr.tag,attrs:{name:nameAttr},};}
async addField(droppedData){const data=JSON.parse(droppedData);const isExistingField="fieldName"in data;let newNode;if(!isExistingField){newNode=await this.getNewFieldNode(data);}else{newNode={tag:"field",attrs:{name:data.fieldName},};const field=this.viewEditorModel.fields[data.fieldName];if(field.type==="monetary"){this.setCurrencyInfos(newNode.attrs);}
if(field.type==="binary"&&this.viewEditorModel.fields[data.fieldName+"_filename"]){newNode.attrs["filename"]=data.fieldName+"_filename";}}
if(!newNode){return;}
if(!isExistingField){this.viewEditorModel.setRenameableField(newNode.field_description?.name,true);}
if(this.viewEditorModel.viewType==="kanban"){newNode.attrs.display="full";}
if(this.viewEditorModel.viewType==="list"){newNode.attrs.optional="show";}
return{node:newNode,};}
async addStructure(structure,droppedData,targetInfo){let _operation;if(this.addViewStructure){_operation=await this.addViewStructure(structure,{droppedData,targetInfo,addDialog:this.addDialog.bind(this),});}
if(!_operation&&structure==="field"){_operation=await this.addField(droppedData);}
if(!_operation){return;}
const operation={target:_operation?.target||(targetInfo.xpath?this.viewEditorModel.getFullTarget(targetInfo.xpath):undefined),position:targetInfo.position,type:"add",..._operation,};this.setAutoClick(targetInfo,operation.node);return this.viewEditorModel.doOperation(operation);}
async getNewFieldNode(data){const string=_t("New %s",data.string);const newNode={field_description:{field_description:string,name:randomName(`x_studio_${data.fieldType}_field`),type:data.fieldType,model_name:this.viewEditorModel.resModel,special:data.special,},tag:"field",attrs:{widget:data.widget},};if(data.special==="lines"){return newNode;}
const fieldType=data.fieldType;if(fieldType==="selection"&&data.widget==="priority"){newNode.field_description.selection=[["0","Normal"],["1","Low"],["2","High"],["3","Very High"],];return newNode;}
if(["selection","one2many","many2one","many2many","related"].includes(fieldType)){if(fieldType==="one2many"){const count=await this.orm.searchCount("ir.model.fields",[["relation","=",this.viewEditorModel.resModel],["ttype","=","many2one"],["store","=",true],]);if(!count){this.addDialog(ConfirmationDialog,{title:_t("No related many2one fields found"),body:NO_M2O_AVAILABLE,confirm:async()=>{},});return;}}
const fieldParams=await this.openFieldConfiguration(fieldType);if(!fieldParams){return;}
if(fieldType==="selection"){newNode.field_description.selection=fieldParams.selection;}
if(fieldType==="one2many"){newNode.field_description.relation_field_id=fieldParams.relationId;}
if(fieldType==="many2many"||fieldType==="many2one"){newNode.field_description.relation_id=fieldParams.relationId;}
if(fieldType==="related"){Object.assign(newNode.field_description,fieldParams.relatedParams);if(!newNode.field_description.related){delete newNode.field_description.related;}}}
if(fieldType==="monetary"){this.setCurrencyInfos(newNode.field_description);}
if(fieldType==="integer"){newNode.field_description.default_value="0";}
return newNode;}
openFieldConfiguration(fieldType){let dialogProps;if(fieldType==="selection"){dialogProps={Component:SelectionValuesEditor,isDialog:true,};}else if(["one2many","many2many","many2one"].includes(fieldType)){dialogProps={Component:RelationalFieldConfigurator,componentProps:{fieldType,resModel:this.viewEditorModel.resModel},};}else if(fieldType==="related"){dialogProps={Component:RelatedChainBuilder,componentProps:{resModel:this.viewEditorModel.resModel,},};}
const fieldParams=new Promise((resolve,reject)=>{this.addDialog(FieldConfigurationDialog,{fieldType,confirm:async(params)=>{resolve(params);},cancel:()=>resolve(false),...dialogProps,});});return fieldParams;}
moveStructure(structure,droppedData,targetInfo){if(structure!=="field"){throw Error("Moving anything else than a field is not supported");}
if(isToXpathEquivalentFromXpath(targetInfo.position,targetInfo.xpath,droppedData.studioXpath)){return;}
const operation={type:"move",node:this.viewEditorModel.getFullTarget(droppedData.studioXpath),target:this.viewEditorModel.getFullTarget(targetInfo.xpath),position:targetInfo.position,};const subViewXpath=this.viewEditorModel.getSubviewXpath();if(subViewXpath){operation.node.subview_xpath=subViewXpath;}
if(this.viewEditorModel.activeNodeXpath===droppedData.studioXpath){this.setAutoClick(targetInfo,operation.node);}
this.viewEditorModel.doOperation(operation);}
setCurrencyInfos(object){const currencyField=getCurrencyField(this.viewEditorModel.fields);if(currencyField){object.currency_field=currencyField;object.currency_in_view=this.viewEditorModel.fieldsInArch.includes(currencyField);}}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/interactive_editor_sidebar.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/interactive_editor_sidebar',['@web/core/l10n/translation','@odoo/owl','@web/core/notebook/notebook','@web/core/utils/hooks','@web/core/ui/ui_service'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{onWillStart,useState,onWillUpdateProps,Component}=require("@odoo/owl");const{Notebook}=require("@web/core/notebook/notebook");const{useBus}=require("@web/core/utils/hooks");const{useActiveElement}=require("@web/core/ui/ui_service");const tabsDisplay={new:{class:"o_web_studio_new px-2",title:_t("Add"),},view:{class:"o_web_studio_view px-2",title:_t("View"),},properties:{class:"o_web_studio_properties px-2",title:_t("Properties"),},};const InteractiveEditorSidebar=__exports.InteractiveEditorSidebar=class InteractiveEditorSidebar extends Component{static components={Notebook};static template="web_studio.ViewEditor.InteractiveEditorSidebar";static props={slots:{type:Object},};setup(){this.editorModel=useState(this.env.viewEditorModel);this.tabsDisplay=tabsDisplay;useBus(this.editorModel.bus,"error",()=>this.render(true));useActiveElement("root");this._defaultTab=this.computeDefaultTab(this.props);this.editorModel.sidebarTab=this._defaultTab;onWillStart(()=>{this.editorModel.resetSidebar();});onWillUpdateProps(()=>{const editorModel=this.editorModel;if(editorModel.sidebarTab==="properties"&&!editorModel.activeNode){editorModel.resetSidebar();}});}
get icons(){return{new:"fa-plus",view:"fa-television",properties:"fa-server",};}
computeDefaultTab(props){const slots=props.slots;const defaults=Object.keys(slots).filter((s)=>slots[s].isDefault);if(defaults.length){return defaults[0];}
return"new"in slots?"new":"view";}
get defaultTab(){return this.editorModel.sidebarTab||this._defaultTab;}
onTabClicked(tab){if(tab!=="properties"){this.editorModel.resetSidebar(tab);}
this.editorModel.sidebarTab=tab;}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/properties/button_properties/button_properties.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/properties/button_properties/button_properties',['@odoo/owl','@web/core/checkbox/checkbox','@web/core/domain_selector_dialog/domain_selector_dialog','@web/core/l10n/translation','@web/core/network/rpc','@web/core/select_menu/select_menu','@web_studio/client_action/view_editor/property/property','@web/core/utils/hooks','@web/model/record','@web/views/fields/many2one/many2one_field','@web/views/fields/many2many_tags/many2many_tags_field','@web_studio/client_action/view_editor/interactive_editor/properties/class_attribute/class_attribute','@web_studio/client_action/view_editor/interactive_editor/properties/view_structure_properties/view_structure_properties','@web_studio/client_action/view_editor/interactive_editor/properties/button_properties/rainbow_effect','@web_studio/client_action/view_editor/view_editor_model','@web_studio/client_action/view_editor/view_editor_hook','@web_studio/client_action/view_editor/interactive_editor/properties/modifiers/modifiers_properties','@web_studio/approval/approval_hook'],function(require){'use strict';let __exports={};const{Component,onWillStart,onWillUpdateProps,useState}=require("@odoo/owl");const{CheckBox}=require("@web/core/checkbox/checkbox");const{DomainSelectorDialog}=require("@web/core/domain_selector_dialog/domain_selector_dialog");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{rpc}=require("@web/core/network/rpc");const{SelectMenu}=require("@web/core/select_menu/select_menu");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{useService}=require("@web/core/utils/hooks");const{Record}=require("@web/model/record");const{Many2OneField}=require("@web/views/fields/many2one/many2one_field");const{Many2ManyTagsField}=require("@web/views/fields/many2many_tags/many2many_tags_field");const{ClassAttribute}=require("@web_studio/client_action/view_editor/interactive_editor/properties/class_attribute/class_attribute");const{ViewStructureProperties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/view_structure_properties/view_structure_properties");const{RainbowEffect}=require("@web_studio/client_action/view_editor/interactive_editor/properties/button_properties/rainbow_effect");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");const{useSnackbarWrapper}=require("@web_studio/client_action/view_editor/view_editor_hook");const{ModifiersProperties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/modifiers/modifiers_properties");const{buildApprovalKey}=require("@web_studio/approval/approval_hook");const ButtonProperties=__exports.ButtonProperties=class ButtonProperties extends Component{static template="web_studio.ViewEditor.InteractiveEditorProperties.Button";static props={node:{type:Object},availableOptions:{type:Array,optional:true},};static components={CheckBox,ClassAttribute,Many2OneField,Many2ManyTagsField,RainbowEffect,Record,SelectMenu,Property,ViewStructureProperties,ModifiersProperties,};setup(){this.dialog=useService("dialog");this.orm=useService("orm");this.actionService=useService("action");this.state=useState({actionsList:[],});this.editNodeAttributes=useEditNodeAttributes();this.decoratedOrmCall=useSnackbarWrapper(this.orm.call.bind(this.orm));this.decoratedOrmWrite=useSnackbarWrapper(this.orm.write.bind(this.orm));this.domainResUsers=[["id","not in",[1]],["share","=",false],];const m2mFieldsToFetch={display_name:{type:"char"},};const approvalRecordDefinition={approval_group_id:{type:"many2one",relation:"res.groups",domain:[["share","=",false]],},approver_ids:{type:"many2many",relation:"res.users",related:{activeFields:m2mFieldsToFetch,fields:m2mFieldsToFetch},},users_to_notify:{type:"many2many",relation:"res.users",related:{activeFields:m2mFieldsToFetch,fields:m2mFieldsToFetch},},};this.recordProps={resModel:"studio.approval.rule",fields:approvalRecordDefinition,activeFields:approvalRecordDefinition,};this.env.viewEditorModel.activeNode.humanName=_t("Button");onWillStart(async()=>Promise.all([this.updateApprovalSpec(),this.loadActions()]));onWillUpdateProps((nextProps)=>{this.updateApprovalSpec(this.getApprovalParams(nextProps.node));});}
get availableOptions(){if(this.env.viewEditorModel.viewType!=="form"&&this.env.viewEditorModel.activeNode.arch.closest("header")){return[];}
return this.props.availableOptions;}
get currentActionValue(){if(this.state.actionsList?.[this.props.node.attrs.name]){return this.state.actionsList[this.props.node.attrs.name].xml_id;}
return this.props.node.attrs.name;}
get actionsForModel(){return Object.values(this.state.actionsList).map((a)=>({label:odoo.debug?`${a.name} (${a.xml_id})`:a.name,value:a.xml_id,}));}
get types(){return[{label:_t("Run a Server Action"),value:"action"},{label:_t("Call a method"),value:"object"},];}
async loadActions(){if(this.props.node.attrs.type!=="action"){return;}
this.state.actionsList=await rpc("/web_studio/get_actions_for_model",{model:this.env.viewEditorModel.resModel,});}
isValid(fieldName,record){if(["approver_ids","approval_group_id"].includes(fieldName)){const evalContext=record.evalContext;return evalContext.approver_ids.length||evalContext.approval_group_id;}
return true;}
onChangeAttribute(value,name){return this.editNodeAttributes({[name]:value});}
async onChangeApprovalRecord(record,changes,id){await this.decoratedOrmWrite("studio.approval.rule",[id],changes);this.updateApprovalSpec();}
get showApprovals(){return this.env.viewEditorModel.viewType==="form";}
get showRainbowMan(){const attrs=this.props.node.attrs;return attrs.class!=="oe_stat_button"&&attrs.type==="object";}
async createApprovalRule(){const params=this.getApprovalParams();if(this.state.approvalSpec?.rules.length){const orders=this.state.approvalSpec.rules.map((id)=>parseInt(this.state.allRules[id]["notification_order"]));params.push(Math.min(Math.max(...orders)+1,9).toString());}
await this.decoratedOrmCall("studio.approval.rule","create_rule",params);this.updateApprovalSpec();}
getApprovalParams(node=this.props.node){let method,action=false;if(node.attrs.type==="object"){method=node.attrs.name;}else{action=node.attrs.name;}
return[this.env.viewEditorModel.resModel,method,action];}
async getApprovalSpec(approvalParams){const approvalParamsObject={model:approvalParams[0],method:approvalParams[1],action_id:approvalParams[2],};const approvals=await this.env.services["web_studio.get_approval_spec_batched"](approvalParamsObject);return approvals;}
async onApprovalArchive(id){await this.decoratedOrmWrite("studio.approval.rule",[id],{active:false,});this.updateApprovalSpec();}
async onApprovalEdit(name,id,value){const isMethod=this.props.node.attrs.type==="object";await rpc("/web_studio/edit_approval",{model:this.env.viewEditorModel.resModel,method:isMethod?this.props.node.attrs.name:false,action:isMethod?false:this.props.node.attrs.name,operations:[[name,id,value]],});this.updateApprovalSpec();}
onApprovalSelectDomain(id){const rule=this.state.allRules[id];const domain=rule.domain;this.dialog.add(DomainSelectorDialog,{resModel:this.env.viewEditorModel.resModel,domain:JSON.stringify(domain||[]),isDebugMode:!!this.env.debug,onConfirm:async(domain)=>{await this.decoratedOrmWrite("studio.approval.rule",[id],{domain,});this.updateApprovalSpec();},});}
async onChangeNotificationOrder(ev,id){await this.decoratedOrmWrite("studio.approval.rule",[id],{notification_order:ev.target.value,});}
async updateApprovalSpec(params=this.getApprovalParams()){this.env.viewEditorModel.env.bus.trigger("approval-update");const approvalSpec=await this.getApprovalSpec(params);this.state.allRules=approvalSpec.all_rules;const approvalKey=buildApprovalKey(false,params[1]||false,params[2]||false);this.state.approvalSpec=approvalSpec[params[0]][approvalKey]||{rules:[],entries:[],};}
async openKanbanApprovalRules(){const[resModel,method,action]=this.getApprovalParams();return this.actionService.doActionButton({context:{studio:true,},type:"object",name:"open_kanban_rules",resModel:"studio.approval.rule",resIds:[],args:JSON.stringify([resModel,method,action]),stackPosition:"replaceCurrentAction",});}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/properties/button_properties/new_button_box_dialog.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/properties/button_properties/new_button_box_dialog',['@odoo/owl','@web/core/dialog/dialog','@web/views/fields/relational_utils','@web/core/l10n/translation','@web/core/utils/hooks','@web_studio/client_action/components/font_awesome_icon_selector/font_awesome_icon_selector'],function(require){'use strict';let __exports={};const{Component,useState}=require("@odoo/owl");const{Dialog}=require("@web/core/dialog/dialog");const{Many2XAutocomplete}=require("@web/views/fields/relational_utils");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{useService}=require("@web/core/utils/hooks");const{FontAwesomeIconSelector}=require("@web_studio/client_action/components/font_awesome_icon_selector/font_awesome_icon_selector");const NewButtonBoxDialog=__exports.NewButtonBoxDialog=class NewButtonBoxDialog extends Component{static template="web_studio.NewButtonBoxDialog";static components={Dialog,FontAwesomeIconSelector,Many2XAutocomplete,};static props={isAddingButtonBox:{type:Boolean},model:{type:Object},close:{type:Function},};setup(){this.orm=useService("orm");this.notification=useService("notification");this.state=useState({icon:"fa fa-diamond",field:undefined,});this.text=undefined;}
async update(selection){if(!selection[0].display_name){const resId=selection[0].id;const fields=["display_name"];const record=await this.orm.read("ir.model.fields",[resId],fields);selection[0].display_name=record[0].display_name;}
this.state.field=selection[0];}
getDomain(){return[["relation","=",this.props.model.resModel],["ttype","in",["many2one","many2many"]],["store","=",true],];}
onConfirm(){if(!this.state.field?.id){return this.notification.add(_t("Select a related field."));}
if(this.props.isAddingButtonBox){this.props.model.pushOperation({type:"buttonbox"});}
this.props.model.doOperation({type:"add",target:{tag:"div",attrs:{class:"oe_button_box",},},position:"inside",node:{tag:"button",field:this.state.field.id,string:this.text||_t("New button"),attrs:{class:"oe_stat_button",icon:this.state.icon.slice(3),},},});this.props.close();}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/properties/button_properties/rainbow_effect.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/properties/button_properties/rainbow_effect',['@odoo/owl','@web/core/user','@web/core/file_input/file_input','@web/core/select_menu/select_menu','@web_studio/client_action/view_editor/property/property','@web/core/l10n/translation','@web/core/py_js/py'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{user}=require("@web/core/user");const{FileInput}=require("@web/core/file_input/file_input");const{SelectMenu}=require("@web/core/select_menu/select_menu");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{evaluateExpr}=require("@web/core/py_js/py");const RainbowEffect=__exports.RainbowEffect=class RainbowEffect extends Component{static template="web_studio.ViewEditorSidebar.RainbowEffect";static props={effect:{type:true,optional:true},onChange:{type:Function},};static components={FileInput,SelectMenu,Property,};setup(){this.user=user;}
get choices(){return[{label:_t("Fast"),value:"fast"},{label:_t("Medium"),value:"medium"},{label:_t("Slow"),value:"slow"},{label:_t("None"),value:"no"},];}
get rainbowEffect(){const effect=this.props.effect;if(effect===undefined){return null;}
if(effect==="True"){return{};}
return evaluateExpr(effect);}
onRainbowEffectChange(name,value){const effect=this.rainbowEffect;if(!value||!value.length){delete effect[name];}else{effect[name]=value;}
this.props.onChange(effect,"effect");}
toggleRainbowMan(){const effect=this.rainbowEffect;const newValue=effect?"False":"{}";this.props.onChange(newValue,"effect");}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/properties/class_attribute/class_attribute.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/properties/class_attribute/class_attribute',['@odoo/owl','@web/core/l10n/translation','@web_studio/client_action/view_editor/property/property'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{Property}=require("@web_studio/client_action/view_editor/property/property");const ClassAttribute=__exports.ClassAttribute=class ClassAttribute extends Component{static template="web_studio.ViewEditor.ClassAttribute";static components={Property,};static props={value:{type:String,optional:true},onChange:{type:Function},};get tooltip(){return _t("Use Bootstrap or any other custom classes to customize the style and the display of the element.");}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/properties/field_properties/field_properties.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/properties/field_properties/field_properties',['@odoo/owl','@web/core/l10n/translation','@web/core/confirmation_dialog/confirmation_dialog','@web/core/network/rpc','@web/core/user','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/field_configuration/selection_content_dialog','@web_studio/client_action/view_editor/interactive_editor/properties/type_widget_properties/type_widget_properties','@web_studio/client_action/view_editor/interactive_editor/properties/view_structure_properties/view_structure_properties','@web/core/utils/hooks','@web_studio/client_action/view_editor/interactive_editor/properties/class_attribute/class_attribute','@web_studio/client_action/view_editor/interactive_editor/properties/modifiers/modifiers_properties','@web_studio/client_action/view_editor/view_editor_model'],function(require){'use strict';let __exports={};const{Component,onWillStart,onWillUpdateProps,useState,toRaw}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{ConfirmationDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{rpc}=require("@web/core/network/rpc");const{user}=require("@web/core/user");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{SelectionContentDialog}=require("@web_studio/client_action/view_editor/interactive_editor/field_configuration/selection_content_dialog");const{TypeWidgetProperties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/type_widget_properties/type_widget_properties");const{ViewStructureProperties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/view_structure_properties/view_structure_properties");const{useService}=require("@web/core/utils/hooks");const{ClassAttribute}=require("@web_studio/client_action/view_editor/interactive_editor/properties/class_attribute/class_attribute");const{ModifiersProperties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/modifiers/modifiers_properties");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");class TechnicalName extends Component{static props={node:{type:Object},};static template="web_studio.ViewEditor.InteractiveEditorProperties.Field.TechnicalName";static components={Property};setup(){this.renameField=(value)=>this.env.viewEditorModel.renameField(this.props.node.attrs.name,`x_studio_${value}`,{autoUnique:false,});}
get canEdit(){return(this.env.debug&&this.env.viewEditorModel.isFieldRenameable(this.props.node.attrs.name));}
get fieldName(){const fName=this.props.node.attrs.name;if(this.canEdit){return fName.split("x_studio_")[1];}
return fName;}}
const FieldProperties=__exports.FieldProperties=class FieldProperties extends Component{static template="web_studio.ViewEditor.InteractiveEditorProperties.Field";static props={node:{type:Object},availableOptions:{type:Array,optional:true},};static components={ClassAttribute,Property,TechnicalName,TypeWidgetProperties,ViewStructureProperties,ModifiersProperties,};setup(){this.dialog=useService("dialog");this.multiCompany=user.allowedCompanies.length>1;this.activeCompany=user.activeCompany;this.state=useState({});this.editNodeAttributes=useEditNodeAttributes();onWillStart(async()=>{if(this._canShowDefaultValue(this.props.node)){this.state.defaultValue=await this.getDefaultValue(this.props.node);}});onWillUpdateProps(async(nextProps)=>{if(this._canShowDefaultValue(nextProps.node)){this.state.defaultValue=await this.getDefaultValue(nextProps.node);}});}
get viewEditorModel(){return this.env.viewEditorModel;}
async onChangeFieldString(value){if(this.viewEditorModel.isFieldRenameable(this.props.node.field.name)&&value){return this.viewEditorModel.renameField(this.props.node.attrs.name,value,{label:value,});}else{const operation={new_attrs:{string:value},type:"attributes",position:"attributes",target:this.viewEditorModel.getFullTarget(this.viewEditorModel.activeNodeXpath),};operation.node=operation.target;return this.viewEditorModel.doOperation(operation);}}
onChangeAttribute(value,name){return this.editNodeAttributes({[name]:value});}
async onChangeDefaultValue(value){await rpc("/web_studio/set_default_value",{model_name:this.env.viewEditorModel.resModel,field_name:this.props.node.field.name,value,company_id:user.activeCompany.id,});this.state.defaultValue=value;}
getBoldValue(){const classList=this.props.node.arch.classList;return(classList.contains("fw-bold")||classList.contains("fw-bolder")||this.props.node.attrs.bold);}
async getDefaultValue(node){const defaultValueObj=await rpc("/web_studio/get_default_value",{model_name:this.env.viewEditorModel.resModel,field_name:node.field.name,company_id:user.activeCompany.id,});return defaultValueObj.default_value;}
get optionalVisibilityChoices(){return{choices:[{label:_t("Show by default"),value:"show"},{label:_t("Hide by default"),value:"hide"},],};}
getDefaultValuePropertyProps(){if(!this._canShowDefaultValue(this.props.node)){return null;}
const{field,attrs}=this.props.node;const props={childProps:{},inputAttributes:{},};if(field.selection){props.childProps.choices=this.props.node.field.selection.map(([value,label])=>({label,value,}));}
const fieldType=field.type;const widget=attrs.widget;props.type=fieldType;if(widget==="statusbar"){props.type="selection";}
return props;}
_canShowDefaultValue(node){return!["image","many2many","one2many","many2one","binary"].includes(node.field.type);}
get canEditSelectionChoices(){return this.props.node.field.manual&&this.props.node.field.type==="selection";}
isAttributeSupported(name){return this.props.availableOptions?.includes(name);}
editSelectionChoices(){const field=this.props.node.field;this.dialog.add(SelectionContentDialog,{defaultChoices:toRaw(field).selection.map((s)=>[...s]),onConfirm:async(choices)=>{const result=await rpc("/web_studio/edit_field",{model_name:this.env.viewEditorModel.resModel,field_name:field.name,values:{selection:JSON.stringify(choices)},force_edit:false,});let reflectChanges=!result;if(result&&result.records_linked){reflectChanges=false;await new Promise((resolve)=>{this.dialog.add(ConfirmationDialog,{body:result.message||_t("Are you sure you want to remove the selection values?"),confirm:async()=>{await rpc("/web_studio/edit_field",{model_name:this.env.viewEditorModel.resModel,field_name:field.name,values:{selection:JSON.stringify(choices)},force_edit:true,});reflectChanges=true;resolve();},cancel:()=>resolve(),});});}
if(reflectChanges){field.selection=choices;}},});}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/properties/limit_group_visibility/limit_group_visibility.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/properties/limit_group_visibility/limit_group_visibility',['@odoo/owl','@web_studio/client_action/view_editor/view_editor_model','@web/core/record_selectors/multi_record_selector'],function(require){'use strict';let __exports={};const{Component,onWillRender}=require("@odoo/owl");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");const{MultiRecordSelector}=require("@web/core/record_selectors/multi_record_selector");const LimitGroupVisibility=__exports.LimitGroupVisibility=class LimitGroupVisibility extends Component{static template="web_studio.ViewEditor.LimitGroupVisibility";static components={MultiRecordSelector,};static props={node:{type:Object},};setup(){this.editNodeAttributes=useEditNodeAttributes();onWillRender(()=>{const groups=JSON.parse(this.props.node.attrs.studio_groups||"[]");this.allowGroups=[];this.forbidGroups=[];this.currentGroups=[];for(const group of groups){const groupId=group.id;this.currentGroups.push(groupId);if(group.forbid){this.forbidGroups.push(groupId);}else{this.allowGroups.push(groupId);}}})}
handleNodeGroupsChange(allow,forbid){allow=new Set(allow||this.allowGroups);forbid=new Set(forbid||this.forbidGroups);if(!allow.isDisjointFrom(forbid)){throw new Error("Cannot allow and forbid at the same time");}
const resIds=[];for(const g of allow){resIds.push(g);}
for(const g of forbid){resIds.push(`!${g}`)}
return this.editNodeAttributes({groups:resIds});}
onChangeAttribute(value,name){return this.editNodeAttributes({[name]:value});}
get allowGroupsProps(){return{resModel:"res.groups",domain:[["id","not in",this.currentGroups]],resIds:this.allowGroups,update:(resIds)=>this.handleNodeGroupsChange(resIds,null),};}
get forbidGroupsProps(){return{resModel:"res.groups",domain:[["id","not in",this.currentGroups]],resIds:this.forbidGroups,update:(resIds)=>this.handleNodeGroupsChange(null,resIds),};}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/properties/modifiers/modifiers_properties.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/properties/modifiers/modifiers_properties',['@odoo/owl','@web/core/checkbox/checkbox','@web/core/utils/hooks','@web/core/expression_editor_dialog/expression_editor_dialog'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{CheckBox}=require("@web/core/checkbox/checkbox");const{useOwnedDialogs}=require("@web/core/utils/hooks");const{ExpressionEditorDialog}=require("@web/core/expression_editor_dialog/expression_editor_dialog");const ModifiersProperties=__exports.ModifiersProperties=class ModifiersProperties extends Component{static template="web_studio.ViewEditor.InteractiveEditorProperties.Modifiers";static components={CheckBox};static props={node:{type:Object},availableOptions:{type:Array},};setup(){this.addDialog=useOwnedDialogs();}
isAttributeSupported(name){return this.props.availableOptions?.includes(name);}
onChangeModifier(name,value){const isTypeBoolean=typeof value==="boolean";const encodesBoolean=isTypeBoolean||this.isBooleanExpression(value);const isTruthy=encodesBoolean?this.isBoolTrue(value):!!value;const newAttrs={};const oldAttrs={...this.props.node.attrs};const changingInvisible=name==="invisible";const isInList=this.env.viewEditorModel.viewType==="list";if(encodesBoolean){if(changingInvisible&&isInList){if(isTruthy){newAttrs["column_invisible"]="True";}else{newAttrs["column_invisible"]="False";newAttrs["invisible"]="False";}}else{newAttrs[name]=isTruthy?"True":"False";}}else{newAttrs[name]=value;if(changingInvisible&&isInList&&"column_invisible"in oldAttrs){newAttrs["column_invisible"]="False";}}
if(this.env.viewEditorModel.viewType==="form"&&name==="readonly"){newAttrs.force_save=isTruthy?"1":"0";}
const operation={new_attrs:newAttrs,type:"attributes",position:"attributes",target:this.env.viewEditorModel.getFullTarget(this.env.viewEditorModel.activeNodeXpath),};this.env.viewEditorModel.doOperation(operation);}
isIndeterminate(value){return value&&!this.isBooleanExpression(value);}
isBooleanExpression(expression){return["1","0","True","true","False","false"].includes(expression);}
isBoolTrue(value){if(typeof value==="boolean"){return value;}
return["1","True","true"].includes(value);}
valueAsBoolean(expression){if(!expression){return false;}
if(this.isBooleanExpression(expression)){return this.isBoolTrue(expression);}
return true;}
onConditionalButtonClicked(name,value){if(typeof value!=="string"||value===""){value="False";}
const{fields,resModel}=this.env.viewEditorModel;this.addDialog(ExpressionEditorDialog,{resModel,fields,expression:value,onConfirm:(expression)=>this.onChangeModifier(name,expression),});}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/properties/properties.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/properties/properties',['@odoo/owl','@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox'],function(require){'use strict';let __exports={};const{Component,useState,xml}=require("@odoo/owl");const{SidebarPropertiesToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox");class DefaultProperties extends Component{static props={node:{type:Object},};static template=xml`
        <SidebarPropertiesToolbox/>
    `;static components={SidebarPropertiesToolbox};}
const Properties=__exports.Properties=class Properties extends Component{static template="web_studio.ViewEditor.InteractiveEditorProperties";static props={propertiesComponents:{type:Object},};static components={DefaultProperties};setup(){this.viewEditorModel=useState(this.env.viewEditorModel);}
get iconClass(){let icon=this.env.viewEditorModel.editorInfo.editor.Sidebar.viewStructures?.[this.nodeType]?.class;if(!icon&&this.nodeType==="field"){icon=`o_web_studio_field_${this.node.field.type}`;}
return icon||`o_web_studio_field_${this.nodeType}`;}
get node(){return this.viewEditorModel.activeNode;}
get propertiesComponent(){return this.props.propertiesComponents[this.nodeType]||{};}
get nodeType(){return this.node?.arch.tagName;}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox',['@odoo/owl','@web/core/utils/hooks','@web/core/confirmation_dialog/confirmation_dialog','@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{useService}=require("@web/core/utils/hooks");const{ConfirmationDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const SidebarPropertiesToolbox=__exports.SidebarPropertiesToolbox=class SidebarPropertiesToolbox extends Component{static props={};static template="web_studio.ViewEditor.InteractiveEditorProperties.Toolbox";setup(){this.orm=useService("orm");this.action=useService("action");this.dialog=useService("dialog");}
get node(){return this.env.viewEditorModel.activeNode;}
get nodeType(){return this.node.arch.tagName;}
onRemoveFromView(){this.dialog.add(ConfirmationDialog,{body:_t("Are you sure you want to remove this %s from the view?",this.node.humanName.toLowerCase()),confirm:()=>{return this.removeNodeFromArch();},cancel:()=>{},});}
async openFormAction(){const resId=await this.orm.searchRead("ir.model.fields",[["model","=",this.env.viewEditorModel.resModel],["name","=",this.node.field.name],],["id"]);return this.action.doAction({type:"ir.actions.act_window",res_model:"ir.model.fields",res_id:resId[0].id,views:[[false,"form"]],target:"current",},{clearBreadcrumbs:true});}
removeNodeFromArch(xpath){const target=this.env.viewEditorModel.getFullTarget(xpath||this.node.xpath);const operation={type:"remove",target,};this.env.viewEditorModel.resetSidebar();return this.env.viewEditorModel.doOperation(operation);}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/properties/type_widget_properties/type_specific_and_computed_properties.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/properties/type_widget_properties/type_specific_and_computed_properties',['@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const EDITABLE_FIELD_ATTRIBUTES={context:{name:"context",label:_t("Context"),type:"string",},domain:{name:"domain",label:_t("Domain"),type:"domain",getValue({attrs,field}){return{domain:attrs.domain,relation:field.relation,};},},aggregate:{name:"aggregate",label:_t("Aggregate"),type:"selection",choices:[{value:"sum",label:_t("Sum")},{value:"avg",label:_t("Average")},{value:"none",label:_t("No aggregation")},],getValue({attrs}){return attrs.sum?"sum":attrs.avg?"avg":"none";},},placeholder:{name:"placeholder",label:_t("Placeholder"),type:"string",help:_t("Displays a textual hint that helps the user when the field is empty."),},};const FIELD_TYPE_ATTRIBUTES=__exports.FIELD_TYPE_ATTRIBUTES={char:{common:[EDITABLE_FIELD_ATTRIBUTES.placeholder],},date:{common:[EDITABLE_FIELD_ATTRIBUTES.placeholder],},datetime:{common:[EDITABLE_FIELD_ATTRIBUTES.placeholder],},float:{list:[EDITABLE_FIELD_ATTRIBUTES.aggregate],},html:{common:[EDITABLE_FIELD_ATTRIBUTES.placeholder],},integer:{list:[EDITABLE_FIELD_ATTRIBUTES.aggregate],},many2many:{common:[EDITABLE_FIELD_ATTRIBUTES.domain,EDITABLE_FIELD_ATTRIBUTES.context,EDITABLE_FIELD_ATTRIBUTES.placeholder,],},many2one:{common:[EDITABLE_FIELD_ATTRIBUTES.domain,EDITABLE_FIELD_ATTRIBUTES.context,EDITABLE_FIELD_ATTRIBUTES.placeholder,],},monetary:{list:[EDITABLE_FIELD_ATTRIBUTES.aggregate],},one2many:{common:[EDITABLE_FIELD_ATTRIBUTES.placeholder],},selection:{common:[EDITABLE_FIELD_ATTRIBUTES.placeholder],},text:{common:[EDITABLE_FIELD_ATTRIBUTES.placeholder],},};const COMPUTED_DISPLAY_OPTIONS=__exports.COMPUTED_DISPLAY_OPTIONS={collaborative_trigger:{superOption:"collaborative",getInvisible:(value)=>!value,},no_quick_create:{superOption:"no_create",getValue:(value)=>value,getReadonly:(value)=>value,},no_create_edit:{superOption:"no_create",getValue:(value)=>value,getReadonly:(value)=>value,},decimals:{superOption:"human_readable",getInvisible:(value)=>!value,},zoom_delay:{superOption:"zoom",getInvisible:(value)=>!value,},placeholder_field:{superOption:"placeholder",},edit_max_value:{superOption:"editable",getInvisible:(value)=>!value,},no_edit_color:{superOption:"color_field",getInvisible:(value)=>!value,},};return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/properties/type_widget_properties/type_widget_properties.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/properties/type_widget_properties/type_widget_properties',['@odoo/owl','@web/core/network/rpc','@web/core/registry','@web/core/utils/hooks','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/editors/utils','@web_studio/client_action/view_editor/interactive_editor/properties/type_widget_properties/type_specific_and_computed_properties'],function(require){'use strict';let __exports={};const{Component,onWillStart,onWillUpdateProps,useState}=require("@odoo/owl");const{rpc}=require("@web/core/network/rpc");const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{fieldsToChoices,getWowlFieldWidgets,}=require("@web_studio/client_action/view_editor/editors/utils");const{FIELD_TYPE_ATTRIBUTES,COMPUTED_DISPLAY_OPTIONS,}=require("@web_studio/client_action/view_editor/interactive_editor/properties/type_widget_properties/type_specific_and_computed_properties");const TypeWidgetProperties=__exports.TypeWidgetProperties=class TypeWidgetProperties extends Component{static template="web_studio.ViewEditor.InteractiveEditorProperties.Field.TypeWidgetProperties";static components={Property};static props={node:{type:Object},onChangeAttribute:{type:Function},};setup(){this.orm=useService("orm");this.fieldService=useService("field");this.attributes=useState({field:[],selection:[],boolean:[],domain:[],number:[],string:[],digits:[],});onWillStart(async()=>{await this.computeAttributesList(this.props);});onWillUpdateProps(async(nextProps)=>{await this.computeAttributesList(nextProps);});}
async computeAttributesList(props){this.attributesForCurrentTypeAndWidget=this.getAttributesForCurrentTypeAndWidget(props);await this.groupAttributesPerType(props);}
async groupAttributesPerType(props){this.attributes.field=await this.getAttributesOfTypeField(props);this.attributes.selection=this.getWidgetAttributes("selection",props);this.attributes.boolean=this.getWidgetAttributes("boolean",props);this.attributes.domain=this.getWidgetAttributes("domain",props);this.attributes.number=this.getWidgetAttributes("number",props);this.attributes.string=this.getWidgetAttributes("string",props);this.attributes.digits=this.getWidgetAttributes("digits",props);}
async getAttributesOfTypeField(props){const fieldAttributes=this.getWidgetAttributes("field",props);if(fieldAttributes.length){const fields=Object.entries(this.env.viewEditorModel.fields).map(([key,value])=>{return{...value,name:value.name||key,};});await Promise.all(fieldAttributes.map(async(attribute)=>{const choices=await this.getFieldChoices(attribute,fields);if(this.props.node.field?.type==="monetary"&&attribute.name==="currency_field"){attribute.isRequired=true;}
attribute.choices=choices;this.getOptionObj(attribute.name).choices=choices;}));return fieldAttributes;}
return[];}
getSupportedOptionsAndAttributes(props){const widgetName=this.isField?props.node.attrs?.widget||props.node.field?.type:props.node.attrs.name;const itemsRegistry=registry.category(this.isField?"fields":"view_widgets").content;const widgetDescription=itemsRegistry[this.env.viewEditorModel.viewType+"."+widgetName]||itemsRegistry[widgetName];return[...(widgetDescription?.[1].supportedAttributes||[]).map((e)=>({...e,isAttribute:true,})),...(widgetDescription?.[1].supportedOptions||[]),];}
get widgetChoices(){const widgets=getWowlFieldWidgets(this.props.node.field.type,this.props.node.attrs.widget,[],this.env.debug);return{choices:widgets.map(([value,label])=>{label=label?label:"";return{label:`${label} (${value})`.trim(),value,};}),};}
_getAttributesForCurrentTypeAndWidget(props){if(!props.node.field){return JSON.parse(JSON.stringify(this.getSupportedOptionsAndAttributes(props)));}
this.isField=true;const fieldType=props.node.field.type;const{viewType}=this.env.viewEditorModel;const fieldCommonViewsProperties=FIELD_TYPE_ATTRIBUTES[fieldType]?.common||[];const fieldSpecificViewProperties=FIELD_TYPE_ATTRIBUTES[fieldType]?.[viewType]||[];return[...fieldCommonViewsProperties.map((e)=>({...e,isAttribute:true})),...fieldSpecificViewProperties.map((e)=>({...e,isAttribute:true})),...JSON.parse(JSON.stringify(this.getSupportedOptionsAndAttributes(props))),];}
getAttributesForCurrentTypeAndWidget(props){const _attributes=this._getAttributesForCurrentTypeAndWidget(props);_attributes.forEach((property)=>{if(COMPUTED_DISPLAY_OPTIONS[property.name]){const dependentOption=COMPUTED_DISPLAY_OPTIONS[property.name];const superOption=_attributes.find((o)=>o.name===dependentOption.superOption);property.isSubOption=true;if(!superOption.subOptions){superOption.subOptions=[];}
if(!superOption.subOptions.includes(property.name)){superOption.subOptions.push(property.name);}}});return _attributes;}
getOptionObj(optionName){return this.attributesForCurrentTypeAndWidget.find((o)=>o.name===optionName);}
isAttributeReadonly(attribute){if("isReadonly"in attribute){return attribute.isReadonly;}
if(this.props.node.field?.type==="monetary"&&attribute.name==="currency_field"){return!this.props.node.field.manual;}}
getWidgetAttributes(type,props){return this.attributesForCurrentTypeAndWidget.filter((attribute)=>attribute.type===type).map((attribute)=>{if(attribute.isAttribute){return this.getPropertyFromAttributes(attribute,props);}
return this.getPropertyFromOptions(attribute,props);}).filter((attribute)=>attribute!==undefined);}
async getFieldChoices(attribute,fields){let availableFields=fields;if(attribute.isRelationalField&&this.props.node.field.relation!==this.env.viewEditorModel.resModel){const newFields=await this.fieldService.loadFields(this.props.node.field.relation);availableFields=Object.entries(newFields).map(([key,value])=>{return{...value,name:value.name||key,};});}
if(attribute.name==="fold_field"){if(this.env.viewEditorModel.activeNode.field.type==="selection"){attribute.isInvisible=true;return[];}
const fields=await this.orm.call(this.env.viewEditorModel.activeNode.field.relation,"fields_get");availableFields=Object.values(fields);}else if(attribute.name==="currency_field"){availableFields=availableFields.filter((f)=>f.relation==="res.currency");}
return fieldsToChoices(availableFields,attribute.availableTypes,(f)=>f.name!==this.env.viewEditorModel.activeNode.attrs.name);}
getPropertyFromAttributes(property,props){let value;value=props.node.attrs[property.name];if(property.getValue){const attrs=props.node.attrs||{};const field=props.node.field||{};value=property.getValue({attrs,field});}
if(value===undefined&&property.default){value=property.default;}
return{...property,value,};}
getPropertyFromOptions(property,props){let value;if(COMPUTED_DISPLAY_OPTIONS[property.name]){const dependentOption=COMPUTED_DISPLAY_OPTIONS[property.name];const superOption=this.getOptionObj(dependentOption.superOption);const superValue=this.getPropertyFromOptions(superOption,props).value;if(dependentOption.getReadonly){property.isReadonly=dependentOption.getReadonly(superValue);}
if(dependentOption.getValue){property.value=dependentOption.getValue(superValue);if(property.isReadonly){return property;}}
if(dependentOption.getInvisible){property.isInvisible=dependentOption.getInvisible(superValue);}}
value=props.node.attrs.options?.[property.name];if(property.type==="string"){value=JSON.stringify(value);}
if(property.type==="boolean"&&value!==undefined){value=!!value;}
if(value===undefined&&property.default){value=property.default;}
if(property.name==="currency_field"&&!value){value=props.node.field.currency_field;}
return{...property,value,};}
getSelectValue(value){return typeof value==="object"?JSON.stringify(value):value;}
async onChangeCurrency(value){const proms=[];if(this.props.node.field.manual){proms.push(rpc("/web_studio/set_currency",{model_name:this.env.viewEditorModel.resModel,field_name:this.props.node.field.name,value,}));}else{proms.push(Promise.resolve(false));}
if(this.env.viewEditorModel.fieldsInArch.includes(value)){const[currencyChanged]=await Promise.all(proms);if(currencyChanged){this.env.viewEditorModel.fields[this.props.node.field.name]["currency_field"]=value;this.attributes.field=this.attributes.field.map((e)=>{if(e.name==="currency_field"){e.value=value;}
return e;});}
return;}
const currencyNode={tag:"field",attrs:{name:value},};const operation={node:currencyNode,target:this.env.viewEditorModel.getFullTarget(this.env.viewEditorModel.activeNodeXpath),position:"after",type:"add",};proms.push(this.env.viewEditorModel.doOperation(operation));const[currencyChanged]=await Promise.all(proms);if(currencyChanged){this.env.viewEditorModel.fields[this.props.node.field.name]["currency_field"]=value;}}
onChangeWidget(value){return this.props.onChangeAttribute(value,"widget");}
async onChangeProperty(value,name){if(["show_seconds","show_time"].includes(name)&&!value&&this.props.node.field.type==="datetime"&&!this.props.node.attrs.widget){this.onChangeWidget("datetime");}else if(name==="currency_field"&&this.props.node.field.type==="monetary"){await this.onChangeCurrency(value);if(!this.props.node.attrs.options?.[name]){return;}
value="";}
const currentProperty=this.getOptionObj(name);if(currentProperty.isAttribute){return this.props.onChangeAttribute(value,name);}
const options={...this.props.node.attrs.options};if(value||currentProperty.type==="boolean"){if(currentProperty.type==="digits"){value=Number(value);if(!Number.isInteger(value)||value<0||value>20){return;}
options[name]=[value*2,value];}else if(["[","{"].includes(value[0])||!isNaN(value)){options[name]=JSON.parse(value);}else if(currentProperty.type==="number"){options[name]=Number(value);}else{options[name]=value;}}else{delete options[name];}
this.props.onChangeAttribute(JSON.stringify(options),"options");}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/properties/view_structure_properties/view_structure_properties.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/properties/view_structure_properties/view_structure_properties',['@web_studio/client_action/view_editor/interactive_editor/properties/limit_group_visibility/limit_group_visibility','@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox','@odoo/owl'],function(require){'use strict';let __exports={};const{LimitGroupVisibility}=require("@web_studio/client_action/view_editor/interactive_editor/properties/limit_group_visibility/limit_group_visibility");const{SidebarPropertiesToolbox}=require("@web_studio/client_action/view_editor/interactive_editor/properties/sidebar_properties_toolbox/sidebar_properties_toolbox");const{Component,useState}=require("@odoo/owl");const ViewStructureProperties=__exports.ViewStructureProperties=class ViewStructureProperties extends Component{static components={LimitGroupVisibility,SidebarPropertiesToolbox};static template="web_studio.ViewStructureProperties";static props={slots:{type:Object},};setup(){this.viewEditorModel=useState(this.env.viewEditorModel);}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/properties/widget_properties/widget_properties.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/properties/widget_properties/widget_properties',['@odoo/owl','@web_studio/client_action/view_editor/property/property','@web_studio/client_action/view_editor/interactive_editor/properties/class_attribute/class_attribute','@web_studio/client_action/view_editor/interactive_editor/properties/type_widget_properties/type_widget_properties','@web_studio/client_action/view_editor/interactive_editor/properties/view_structure_properties/view_structure_properties','@web_studio/client_action/view_editor/view_editor_model'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{Property}=require("@web_studio/client_action/view_editor/property/property");const{ClassAttribute}=require("@web_studio/client_action/view_editor/interactive_editor/properties/class_attribute/class_attribute");const{TypeWidgetProperties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/type_widget_properties/type_widget_properties");const{ViewStructureProperties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/view_structure_properties/view_structure_properties");const{useEditNodeAttributes}=require("@web_studio/client_action/view_editor/view_editor_model");const WidgetProperties=__exports.WidgetProperties=class WidgetProperties extends Component{static template="web_studio.ViewEditor.InteractiveEditorProperties.Widget";static components={ClassAttribute,Property,TypeWidgetProperties,ViewStructureProperties,};static props={node:{type:Object},};setup(){this.editNodeAttributes=useEditNodeAttributes();}
onChangeAttribute(value,name){return this.editNodeAttributes({[name]:value});}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox.js */
odoo.define('@web_studio/client_action/view_editor/interactive_editor/sidebar_view_toolbox/sidebar_view_toolbox',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const SidebarViewToolbox=__exports.SidebarViewToolbox=class SidebarViewToolbox extends Component{static template="web_studio.ViewEditor.ViewToolbox";static props={canEditXml:{type:Boolean,optional:true},onMore:{type:Function,optional:true},openDefaultValues:{type:Function,optional:true},canEditDefaultValues:{type:Boolean,optional:true},};}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/operations_utils.js */
odoo.define('@web_studio/client_action/view_editor/operations_utils',[],function(require){'use strict';let __exports={};__exports.viewGroupByOperation=viewGroupByOperation;function viewGroupByOperation(viewType,type,newValue,oldValue=undefined){const operation_type=newValue?"add":"remove";const operation={target:{view_type:viewType,field_names:[operation_type==="add"?newValue:oldValue],operation_type,field_type:type,},type:"graph_pivot_groupbys_fields",};if(oldValue&&newValue){operation.target.operation_type="replace";operation.target.old_field_names=oldValue;}
return operation;}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/property/property.js */
odoo.define('@web_studio/client_action/view_editor/property/property',['@odoo/owl','@web/core/checkbox/checkbox','@web/core/domain_selector_dialog/domain_selector_dialog','@web/core/select_menu/select_menu','@web/core/utils/hooks'],function(require){'use strict';let __exports={};const{Component,useEffect,useRef}=require("@odoo/owl");const{CheckBox}=require("@web/core/checkbox/checkbox");const{DomainSelectorDialog}=require("@web/core/domain_selector_dialog/domain_selector_dialog");const{SelectMenu}=require("@web/core/select_menu/select_menu");const{useService}=require("@web/core/utils/hooks");const Property=__exports.Property=class Property extends Component{static template="web_studio.Property";static components={CheckBox,SelectMenu,DomainSelectorDialog};static defaultProps={childProps:{},class:"",};static props={name:{type:String},type:{type:String},value:{optional:true},onChange:{type:Function,optional:true},childProps:{type:Object,optional:true},class:{type:String,optional:true},isReadonly:{type:Boolean,optional:true},slots:{type:Object,optional:true,},tooltip:{type:String,optional:true},inputAttributes:{type:Object,optional:true},autofocus:{type:Boolean,optional:true},};setup(){this.dialog=useService("dialog");this.rootRef=useRef("root");useEffect((el)=>{if(!this.props.autofocus||!el){return;}
if(this.props.type==="selection"){el.querySelector(".o_select_menu_toggler").click();}else{el.querySelector("input").focus();}},()=>[this.rootRef.el,this.env.viewEditorModel.activeNodeXpath]);}
get className(){const propsClass=this.props.class?this.props.class:"";return`o_web_studio_property_${this.props.name} ${propsClass}`;}
onDomainClicked(){this.dialog.add(DomainSelectorDialog,{resModel:this.props.childProps.relation,domain:this.props.value||"[]",isDebugMode:!!this.env.debug,onConfirm:(domain)=>this.props.onChange(domain,this.props.name),});}
onViewOptionChange(value){this.props.onChange(value,this.props.name);}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/studio_view.js */
odoo.define('@web_studio/client_action/view_editor/studio_view',['@web/search/with_search/with_search','@web_studio/client_action/view_editor/editors/utils','@odoo/owl','@web/core/utils/hooks','@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{WithSearch}=require("@web/search/with_search/with_search");const{cleanClickedElements}=require("@web_studio/client_action/view_editor/editors/utils");const{Component,onError,onMounted,toRaw,useRef,xml,useSubEnv,useEffect}=require("@odoo/owl");const{useService}=require("@web/core/utils/hooks");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const StudioView=__exports.StudioView=class StudioView extends Component{static components={WithSearch};static template=xml`
        <div t-att-style="style" class="w-100" t-ref="viewRenderer">
            <WithSearch t-props="withSearchProps" t-slot-scope="search">
                <t t-component="viewEditorModel.editorInfo.editor.Controller" t-props="Object.assign(controllerProps, search)" />
            </WithSearch>
        </div>
    `;static props={autoClick:{type:Function,optional:true},"*":true};setup(){this.notification=useService("notification");this.style=this.props.setOverlay?"pointer-events: none;":"";this.withSearchProps={resModel:this.props.resModel,SearchModel:this.props.SearchModel,context:this.props.context,domain:this.props.domain,globalState:this.props.globalState,searchViewArch:this.props.searchViewArch,searchViewFields:this.props.searchViewFields,irFilters:this.props.searchViewIrFilters,display:this.props.display,defaultGroupBy:this.props.defaultGroupBy,};this.viewEditorModel=this.env.viewEditorModel;this.viewRenderer=useRef("viewRenderer");this.controllerProps={...this.viewEditorModel.controllerProps};if(this.viewEditorModel.initialState.activeNodeXpath){onMounted(()=>{const initialActiveNodeXpath=this.viewEditorModel.initialState.activeNodeXpath;this.viewEditorModel.initialState.activeNodeXpath=null;this.viewEditorModel.activeNodeXpath=initialActiveNodeXpath;});}
useEffect((xpath)=>{if(xpath){this.updateActiveNode({xpath,resetSidebarOnNotFound:true});}},()=>[this.viewEditorModel.activeNodeXpath]);const rawModel=toRaw(this.viewEditorModel);useEffect(()=>{rawModel.isInEdition=false;},()=>[rawModel.isInEdition]);onError((error)=>{if(rawModel.isInEdition){this.notification.add(_t("The requested change caused an error in the view. It could be because a field was deleted, but still used somewhere else."),{type:"danger",});this.viewEditorModel.resetSidebar("view");this.viewEditorModel._operations.undo(false);}else{throw error;}});const config={...this.env.config,onNodeClicked:(xpath)=>{if(this.updateActiveNode({xpath})){this.viewEditorModel.activeNodeXpath=xpath;}},};if(this.props.autoClick){onMounted(()=>this.props.autoClick());}
useSubEnv({config,__beforeLeave__:null,__getGlobalState__:null,__getLocalState__:null,__getContext__:null,__getOrderBy__:null,});}
updateActiveNode({xpath,resetSidebarOnNotFound=false}){const vem=this.env.viewEditorModel;cleanClickedElements(this.viewRenderer.el);const el=this.viewRenderer.el.querySelector(`[data-studio-xpath="${xpath}"], [studioxpath="${xpath}"]`);if(!el){if(resetSidebarOnNotFound){vem.resetSidebar();}
return false;}
if(vem.editorInfo.editor.styleClickedElement){vem.editorInfo.editor.styleClickedElement(this.viewRenderer,{xpath});return true;}
const clickable=el.closest(".o-web-studio-editor--element-clickable");if(clickable){clickable.classList.add("o-web-studio-editor--element-clicked");}
return true;}}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/view_editor.js */
odoo.define('@web_studio/client_action/view_editor/view_editor',['@odoo/owl','@web/core/utils/hooks','@web/core/registry','@web_studio/client_action/view_editor/studio_view','@web_studio/client_action/view_editor/interactive_editor/interactive_editor','@web_studio/client_action/view_editor/view_editor_hook','@web/webclient/actions/action_service','@web/views/view','@web_studio/client_action/xml_resource_editor/xml_resource_editor','@web/search/action_hook','@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{Component,onWillUpdateProps,useState,useSubEnv,useRef,markRaw}=require("@odoo/owl");const{useBus,useService}=require("@web/core/utils/hooks");const{registry}=require("@web/core/registry");const{StudioView}=require("@web_studio/client_action/view_editor/studio_view");const{InteractiveEditor}=require("@web_studio/client_action/view_editor/interactive_editor/interactive_editor");const{useViewEditorModel}=require("@web_studio/client_action/view_editor/view_editor_hook");const{standardActionServiceProps}=require("@web/webclient/actions/action_service");const{getDefaultConfig}=require("@web/views/view");const{XmlResourceEditor}=require("@web_studio/client_action/xml_resource_editor/xml_resource_editor");const{useSetupAction}=require("@web/search/action_hook");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);class ViewXmlEditor extends XmlResourceEditor{static props={...XmlResourceEditor.props,studioViewArch:{type:String}};setup(){super.setup();this.viewEditorModel=this.env.viewEditorModel;useBus(this.viewEditorModel.bus,"error",()=>this.render(true));this.studioViewState=useState({arch:this.props.studioViewArch});onWillUpdateProps((nextProps)=>{if(nextProps.studioViewArch!==this.props.studioViewArch){const studioResource=this.getStudioResource(this.state.resourcesOptions);if(studioResource){studioResource.value.arch=nextProps.studioViewArch;}}});}
getStudioResource(resourcesOptions){return resourcesOptions.find((opt)=>opt.value.id===this.viewEditorModel.studioViewId);}}
const ViewEditor=__exports.ViewEditor=class ViewEditor extends Component{static props={...standardActionServiceProps};static components={StudioView,InteractiveEditor,ViewXmlEditor};static template="web_studio.ViewEditor";static displayName=_t("View Editor");setup(){this.studio=useService("studio");this.orm=useService("orm");useSubEnv({config:getDefaultConfig()});this.rootRef=useRef("root");this.rendererRef=useRef("viewRenderer");const initialState={};const breadcrumbs=this.env.editionFlow.breadcrumbs;if(breadcrumbs.length){initialState.showInvisible=breadcrumbs[0].initialState.showInvisible;initialState.activeNodeXpath=breadcrumbs.at(-1).initialState.activeNodeXpath;}
this.viewEditorModel=useViewEditorModel(this.rendererRef,{initialState});useSetupAction({getLocalState:()=>{const breadcrumbs=this.viewEditorModel.breadcrumbs;breadcrumbs[0].initialState=markRaw({showInvisible:this.viewEditorModel.showInvisible,});const last=breadcrumbs.at(-1);last.initialState=markRaw({...(last.initialState||{}),activeNodeXpath:this.viewEditorModel.activeNodeXpath,});},});}
get interactiveEditorKey(){const{viewType,breadcrumbs}=this.viewEditorModel;let key=viewType;if(breadcrumbs.length>1){key+=`_${breadcrumbs.length}`;}
return key;}
onSaveXml({resourceId,oldCode,newCode}){this.viewEditorModel.doOperation({type:"replace_arch",viewId:resourceId,oldArch:oldCode,newArch:newCode,});}
onXmlEditorClose(){this.viewEditorModel.switchMode();}}
registry.category("actions").add("web_studio.view_editor",ViewEditor);return __exports;});;

/* /web_studio/static/src/client_action/view_editor/view_editor_hook.js */
odoo.define('@web_studio/client_action/view_editor/view_editor_hook',['@odoo/owl','@web/core/utils/hooks','@web_studio/studio_service','@web_studio/client_action/editor/edition_flow','@web_studio/client_action/view_editor/view_editor_model','@web_studio/client_action/view_editor/view_editor_snackbar'],function(require){'use strict';let __exports={};const{onWillDestroy,onWillStart,status,useComponent,useEnv,useState,useSubEnv,}=require("@odoo/owl");const{useOwnedDialogs,useService}=require("@web/core/utils/hooks");const{viewTypeToString}=require("@web_studio/studio_service");const{useEditorBreadcrumbs,useEditorMenuItem,}=require("@web_studio/client_action/editor/edition_flow");const{ViewEditorModel}=require("@web_studio/client_action/view_editor/view_editor_model");const{ViewEditorSnackbar}=require("@web_studio/client_action/view_editor/view_editor_snackbar");__exports.useViewEditorModel=useViewEditorModel;function useViewEditorModel(viewRef,{initialState}){const env=useEnv();const services=Object.fromEntries(["orm","ui","notification"].map((sName)=>{return[sName,useService(sName)];}));services.studio={...env.services.studio};services.dialog={add:useOwnedDialogs()};const editionFlow=useState(env.editionFlow);useEditorBreadcrumbs({name:viewTypeToString(services.studio.editedViewType)});const viewEditorModel=new ViewEditorModel({env,services,editionFlow,viewRef,initialState,});useSubEnv({viewEditorModel});const{_snackBar,_operations}=viewEditorModel;useEditorMenuItem({component:ViewEditorSnackbar,props:{operations:_operations,saveIndicator:_snackBar},});const component=useComponent();onWillStart(async()=>{return new Promise((resolve,reject)=>{viewEditorModel.load().then(resolve).catch((error)=>{if(status(component)!=="destroyed"){reject(error);}});});});onWillDestroy(()=>{viewEditorModel.isInEdition=false;});return useState(viewEditorModel);}
__exports.useSnackbarWrapper=useSnackbarWrapper;function useSnackbarWrapper(fn){const env=useEnv();return env.viewEditorModel._decorateFunction(fn);}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/view_editor_model.js */
odoo.define('@web_studio/client_action/view_editor/view_editor_model',['@web/core/network/rpc','@web/core/registry','@web/search/search_model','@web/search/utils/misc','@web_studio/client_action/view_editor/editors/xml_utils','@odoo/owl','@web/core/user','@web/core/utils/xml','@web_studio/studio_service','@web_studio/client_action/view_editor/editors/utils','@web_studio/client_action/utils','@web/views/view_compiler','@web/core/l10n/translation','@web_studio/client_action/editor/edition_flow','@web/core/utils/concurrency','@web/core/confirmation_dialog/confirmation_dialog'],function(require){'use strict';let __exports={};const{rpc,rpcBus}=require("@web/core/network/rpc");const{registry}=require("@web/core/registry");const{SearchModel}=require("@web/search/search_model");const{GROUPABLE_TYPES}=require("@web/search/utils/misc");const{computeXpath,getNodesFromXpath,getNodeAttributes,parseStringToXml,serializeXmlToString,}=require("@web_studio/client_action/view_editor/editors/xml_utils");const{EventBus,markRaw,useEnv,reactive,toRaw}=require("@odoo/owl");const{user}=require("@web/core/user");const{parseXML}=require("@web/core/utils/xml");const{viewTypeToString}=require("@web_studio/studio_service");const{xpathToLegacyXpathInfo,cleanClickedElements,}=require("@web_studio/client_action/view_editor/editors/utils");const{Reactive,getFieldsInArch,memoizeOnce}=require("@web_studio/client_action/utils");const{getModifier,resetViewCompilerCache}=require("@web/views/view_compiler");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{EditorOperations,SnackbarIndicator}=require("@web_studio/client_action/editor/edition_flow");const{Race}=require("@web/core/utils/concurrency");const{AlertDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const editorsRegistry=registry.category("studio_editors");const viewRegistry=registry.category("views");class EditorOperationsWithSnackbar extends EditorOperations{constructor(params){super(...arguments);this.snackBar=params.snackBar;this.race=markRaw(new Race());}
_wrapPromise(prom){const _prom=super._wrapPromise(prom);this.snackBar.add(this.race.add(_prom));return _prom;}}
function getSubarchPosition(mainArch,xpathToField,archTag){const xpathToArch=`${xpathToField}/${archTag}[not(@studio_subview_inlined)]`;const nodes=getNodesFromXpath(xpathToArch,parseStringToXml(mainArch));let hasArch=false;let position=1;for(const node of nodes){if(getModifier(node,"invisible")!=="True"&&getModifier(node,"invisible")!=="1"){hasArch=true;break;}
position++;}
return{hasArch,position};}
function getSubArch(mainArch,xpathToField,archTag,position){const xpathToView=`${archTag}[${position}]`;const xpathToArch=`${xpathToField}/${xpathToView}`;const nodes=getNodesFromXpath(xpathToArch,parseStringToXml(mainArch));if(nodes.length!==1){throw new Error(`Single sub-view arch not found for xpath: ${xpathToArch}`);}
return serializeXmlToString(nodes[0]);}
function buildKey(...args){return args.join("_");}
const ViewEditorModel=__exports.ViewEditorModel=class ViewEditorModel extends Reactive{constructor({env,services,editionFlow,viewRef,initialState={}}){super();this.initialState=initialState;this._isInEdition=false;this.mode="interactive";this.env=env;this.bus=markRaw(new EventBus());this._services=markRaw(services);this._studio=services.studio;this._snackBar=new SnackbarIndicator();this._operations=new EditorOperationsWithSnackbar({do:this._handleOperations.bind(this),onDone:this._handleDone.bind(this),onError:this._handleError.bind(this),snackBar:this._snackBar,});this._decorateCall=async(callback,...args)=>{this._services.ui.block();const prom=callback(...args);this._snackBar.add(prom);try{return await prom;}finally{this._services.ui.unblock();}};this._decorateFunction=(callback)=>async(...args)=>this._decorateCall(callback,...args);this._decoratedRpc=this._decorateFunction(rpc);this._editionFlow=editionFlow;this.GROUPABLE_TYPES=[...GROUPABLE_TYPES];this.MEASURABLE_TYPES=["integer","float","monetary"];this._activeNodeXpath=undefined;this.lastActiveNodeXpath=undefined;this._getEditor=memoizeOnce(()=>{const viewType=this.viewType;const view=viewRegistry.contains(viewType)?viewRegistry.get(viewType):null;const editor=editorsRegistry.contains(viewType)?editorsRegistry.get(viewType):null;return{getProps:editor?editor.props:view.props,editor:this.mode==="interactive"?editor||view:view||editor,};});this._getControllerProps=memoizeOnce(function(){let{resId,resIds}=this.isEditingSubview?this._subviewInfo:this._studio.editedControllerState||{};resIds=resIds||[];resId=resId||resIds[0];const arch=parseXML(this.arch);if(this.mode!=="interactive"){arch.querySelectorAll(`[studio_no_fetch="1"]`).forEach((n)=>n.remove());}
const rootArchNode=this.xmlDoc.firstElementChild;const controllerClasses=Array.from(new Set(["o_view_controller",`o_${this.viewType}_view`,...(rootArchNode.getAttribute("class")||"").split(" "),])).filter((c)=>c);let controllerProps={info:{},relatedModels:{...toRaw(this.viewDescriptions.relatedModels)},useSampleModel:["graph","pivot"].includes(this.viewType),searchMenuTypes:[],className:controllerClasses.join(" "),resId,resIds,resModel:this.resModel,arch,fields:{...toRaw(this.fields)},};if(["list","list","form"].includes(this.viewType)&&this.mode==="interactive"&&this._subviewInfo){controllerProps.parentRecord=this._subviewInfo.parentRecord;}
const{editor,getProps}=this.editorInfo;controllerProps=getProps?getProps(controllerProps,editor,this.env.config):controllerProps;return markRaw(controllerProps);});this.__getDefaultStudioViewProps=memoizeOnce(()=>{const editedAction=this._studio.editedAction;let globalState;if(this._views.search&&!this.isEditingSubview){globalState=editedAction.globalState;}
const context=this._subviewInfo?this._subviewInfo.context:editedAction.context;const searchModel=this.editorInfo.editor.SearchModel||SearchModel;let defaultGroupBy=[];if(!this.isEditingSubview){defaultGroupBy=this.xmlDoc.firstElementChild.hasAttribute("default_group_by")?this.xmlDoc.firstElementChild.getAttribute("default_group_by").split(","):[];}
return{context:{...context,studio:1},domain:editedAction.domain,resModel:this.resModel,SearchModel:searchModel,setOverlay:!["form","list","list","kanban","search"].includes(this.viewType)||this.mode!=="interactive",display:{controlPanel:false,searchPanel:false},globalState,defaultGroupBy,};});this._getActiveNode=memoizeOnce(()=>{if(!this.activeNodeXpath){return undefined;}
const node=getNodesFromXpath(this.activeNodeXpath,this.xmlDoc)[0];if(!node){return null;}
const isField=node.tagName==="field";const attrs=getNodeAttributes(node);const humanName=this.editorInfo.editor.Sidebar.viewStructures?.[node.tagName]?.name||node.tagName;let field;if(isField){field=reactive(this.fields[attrs.name]);Object.defineProperty(field,"label",{get(){return field.string;},configurable:true,});}
return reactive({arch:node,attrs,humanName,xpath:this.activeNodeXpath,field,});});this._getUnprocessedXmlDoc=memoizeOnce((arch)=>parseStringToXml(arch));this.breadcrumbs=editionFlow.breadcrumbs;this._editionFlow=editionFlow;this._views={};this.studioViewArch="";this.viewDescriptions={relatedModels:{},fields:[],};this.viewRef=viewRef;this.showInvisible=initialState.showInvisible||false;this._currentSidebarTab=undefined;this._getFieldsAllowedRename=memoizeOnce(()=>new Set());}
static sanitizeString(string){string=string.normalize("NFD");string=string.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"_").replace(/^-+|-+$/g,"");return string;}
get editorInfo(){return this._getEditor(buildKey(this.viewType,this.mode));}
get controllerProps(){const key=buildKey(this.arch,this.viewType,this.mode,this.resModel,this.breadcrumbs.length>1?this.breadcrumbs.length:1);return this._getControllerProps(key);}
get studioViewProps(){const key=buildKey(this.viewType,this.resModel,this.mode,this.isEditingSubview,this.isEditingSubview?false:this.arch);return this.__getDefaultStudioViewProps(key);}
get xmlDoc(){return this._getUnprocessedXmlDoc(this.arch);}
get isEditingSubview(){return this.breadcrumbs.length>1;}
set isInEdition(value){value=!!value;if(this.isInEdition===value){return;}
this._isInEdition=value;if(value){this._services.ui.block();}else{this._services.ui.unblock();}}
get isInEdition(){return this._isInEdition;}
get mainView(){return this._views?this._views[this.mainViewType]:undefined;}
get mainArch(){return this.mainView?this.mainView.arch:"";}
get mainViewType(){return this._studio.editedViewType;}
get mainResModel(){return this._studio.editedAction.res_model;}
get arch(){return this.isEditingSubview?this._subviewInfo.getArch(this.mainArch):this.mainArch;}
get viewType(){return this.isEditingSubview?this._subviewInfo.viewType:this.mainViewType;}
get view(){return this._views[this.viewType];}
get resModel(){return this.isEditingSubview?this._subviewInfo.resModel:this.mainResModel;}
get fields(){return this.viewDescriptions.relatedModels[this.resModel].fields;}
get activeNode(){return this._getActiveNode(buildKey(this.activeNodeXpath,this.arch));}
get studioViewKey(){return buildKey(this.arch,JSON.stringify(this.fields));}
get fieldsInArch(){return getFieldsInArch(this.xmlDoc);}
get isChatterAllowed(){return!this.isEditingSubview&&this._isChatterAllowed;}
get activeNodeXpath(){return this._activeNodeXpath;}
set activeNodeXpath(value){this._activeNodeXpath=value;if(value){this.lastActiveNodeXpath=value;}}
get sidebarTab(){if(this.activeNodeXpath){return"properties";}
return this._currentSidebarTab;}
set sidebarTab(newTab){this._currentSidebarTab=newTab;}
async editX2ManyView({viewType,fieldName,record,xpath,fieldContext}){const staticList=record.data[fieldName];const resIds=staticList.records.map((r)=>r.resId).filter((id)=>!!id);const resModel=staticList.resModel;const archTag=viewType;const currentFullXpath=this.getSubviewXpath();let xpathToField=xpath;if(currentFullXpath){const xpathWithoutView=xpath.split("/").slice(2);xpathToField=`${currentFullXpath}/${xpathWithoutView.join("/")}`;}
const{hasArch,position}=getSubarchPosition(this.mainArch,xpathToField,archTag);if(!hasArch){const subViewRef=fieldContext[`${archTag}_view_ref`]||null;this.studioViewArch=await this._createInlineView({subViewType:viewType,fullXpath:xpathToField,subViewRef,resModel,fieldName,});const viewDescriptions=await this._editionFlow.loadViews();this.viewDescriptions=viewDescriptions;Object.assign(this._views,viewDescriptions.views);this._operations.clear(false);}
await this._decorateCall(()=>this.fieldsGet(resModel));const context=Object.fromEntries(Object.entries(fieldContext).filter(([key,val])=>!key.startsWith("default_")&&!key.endsWith("_view_ref")));const x2ManyEditionInfo={name:_t("Subview %(viewType)s",{viewType:viewTypeToString(viewType)}),context,resModel,resId:resIds[0],resIds,viewType,parentRecord:record,xpath:`${xpath}/${archTag}[${position}]`,fieldName,getArch:memoizeOnce((mainArch)=>getSubArch(mainArch,xpathToField,archTag,position)),};this._editionFlow.pushBreadcrumb(x2ManyEditionInfo);}
async fieldsGet(resModel){this.fieldsGetCache=this.fieldsGetCache||new Set();if(!this.fieldsGetCache.has(resModel)){const fg=await this._services.orm.call(resModel,"fields_get");this.fieldsGetCache.add(resModel);Object.assign(this.viewDescriptions.relatedModels[resModel].fields,fg);}}
async load(){const proms=[this._editionFlow.loadViews({forceSearch:true})];if(this.viewType==="form"){proms.push(this._studio.IrModelInfo.read(this.mainResModel));}
const[viewDescriptions,modelInfo]=await Promise.all(proms);this._isChatterAllowed=modelInfo?.is_mail_thread||modelInfo?.state==="manual";this.viewDescriptions=viewDescriptions||{relatedModels:{},fields:[],};Object.assign(this._views,viewDescriptions.views);const{mainViewId,viewId,arch}=await this._getStudioViewArch();this.studioViewArch=arch;this.studioViewId=viewId;if(!this.mainView.id){rpcBus.trigger("CLEAR-CACHES");this.mainView.id=mainViewId;}}
getSubviewXpath(){if(!this.isEditingSubview){return null;}
const temp=[`/${this.mainViewType}[1]`];this.breadcrumbs.slice(1).forEach(({data})=>{const withoutView=data.xpath.split("/").slice(2);temp.push(...withoutView);});return temp.join("/");}
getFullTarget(xpath,{isXpathFullAbsolute=true}={}){const nodes=getNodesFromXpath(xpath,this.xmlDoc);if(nodes.length!==1){throw new Error("Xpath resolved to nothing or multiple nodes");}
const element=nodes[0];const attrs={};["name","id","class","for"].forEach((attrName)=>{if(element.hasAttribute(attrName)){attrs[attrName]=element.getAttribute(attrName);}});let xpath_info;if(isXpathFullAbsolute){xpath_info=xpathToLegacyXpathInfo(xpath);}else{const fullAbsolute=computeXpath(element,this.viewType);xpath_info=xpathToLegacyXpathInfo(fullAbsolute);}
const target={tag:element.tagName,attrs,xpath_info,};const subViewXpath=this.getSubviewXpath();if(subViewXpath){target.subview_xpath=subViewXpath;const subViewTargetInfo=xpathToLegacyXpathInfo(subViewXpath);xpath_info.splice(0,1,subViewTargetInfo[subViewTargetInfo.length-1]);}
return target;}
async doOperation(operation,write=true){return this._operations.do(operation,!write);}
pushOperation(operation){return this._operations.pushOp(operation);}
resetSidebar(tab=null){this.sidebarTab=tab;this.activeNodeXpath=undefined;const resetEl=this.viewRef.el;if(resetEl){cleanClickedElements(resetEl);}}
switchMode(){resetViewCompilerCache();this.mode=this.mode==="interactive"?"xml":"interactive";}
setRenameableField(fieldName,add=true){if(add){this._fieldsAllowedRename.add(fieldName);}else{this._fieldsAllowedRename.delete(fieldName);}}
isFieldRenameable(fieldName){return this._fieldsAllowedRename.has(fieldName);}
async renameField(fieldName,newName,{label,autoUnique=true}={}){newName=ViewEditorModel.sanitizeString(newName);if(!newName.startsWith("x_studio_")){newName=`x_studio_${newName}`;}
const existingFields=this.fields;if(autoUnique){const baseName=newName;let index=1;while(newName in existingFields){newName=baseName+"_"+index;index++;}}
if(!autoUnique&&newName in existingFields){this._services.dialog.add(AlertDialog,{body:_t("A field with the same name already exists."),});return;}
this.isInEdition=true;const prom=rpc("/web_studio/rename_field",{studio_view_id:this.studioViewId,studio_view_arch:this.studioViewArch,model:this.resModel,old_name:fieldName,new_name:newName,new_label:label,});this._snackBar.add(prom);try{await prom;}catch(e){this.isInEdition=false;throw e;}
const strOperations=JSON.stringify(this._operations.operations);const chars="[^\\w\\u007F-\\uFFFF]";const re=new RegExp(`(${chars}|^)${fieldName}(${chars}|$)`,"g");this._operations.clear();this.setRenameableField(fieldName,false);this.setRenameableField(newName,true);this._operations.doMulti(JSON.parse(strOperations.replace(re,`$1${newName}$2`)));}
async _createInlineView({subViewType,fullXpath,subViewRef,resModel,fieldName}){const context={...user.context,lang:false,studio:true};if(subViewRef){context[`${subViewType}_view_ref`]=subViewRef;}
const studioViewArch=await this._decoratedRpc("/web_studio/create_inline_view",{model:resModel,view_id:this.mainView.id,field_name:fieldName,subview_type:subViewType,subview_xpath:fullXpath,context,});rpcBus.trigger("CLEAR-CACHES");return studioViewArch;}
async _editView(operations){const context={...user.context,...(this._studio.editedAction.context||{}),lang:false,studio:true,};return rpc("/web_studio/edit_view",{view_id:this.mainView.id,studio_view_arch:this.studioViewArch,operations:operations,model:this.resModel,context,});}
async _editViewArch(viewId,viewArch){const context={...user.context,...(this._studio.editedAction.context||{}),lang:false,studio:true,};const result=await rpc("/web_studio/edit_view_arch",{view_id:viewId,view_arch:viewArch,context,});return result;}
async _handleOperations({mode,operations,lastOp}){this.isInEdition=true;if(lastOp.type!=="replace_arch"){operations=operations.filter((op)=>op.type!=="replace_arch");return this._editView(operations);}else{const viewId=lastOp.viewId;let{newArch,oldArch}=lastOp;if(mode==="undo"){const _newArch=newArch;newArch=oldArch;oldArch=_newArch;}
return this._editViewArch(viewId,newArch);}}
async restoreDefaultView(viewId){const result=await this._editionFlow.restoreDefaultView(viewId,this.mainViewType);if(result){this.viewDescriptions.relatedModels=result.models;this._views[this.mainViewType].arch=result.views[this.mainViewType].arch;this._operations.clear();}}
_handleDone({mode,pending,pendingUndone,result}){rpcBus.trigger("CLEAR-CACHES");if(this.mainViewType==="kanban"){resetViewCompilerCache();}
if(result){this.viewDescriptions.relatedModels=result.models;const oldArch=this._views[this.mainViewType].arch;const newArch=result.views[this.mainViewType].arch;this._views[this.mainViewType].arch=newArch;if(oldArch===newArch){this.isInEdition=false;}
if(!this.studioViewId&&result.studio_view_id){this.studioViewId=result.studio_view_id;}}
const isUndoing=mode==="undo";const pendingOps=isUndoing?pendingUndone:pending;const lastOperation=pendingOps[pendingOps.length-1];if(lastOperation&&lastOperation.type==="replace_arch"){if(lastOperation.viewId===this.studioViewId){this.studioViewArch=isUndoing?lastOperation.oldArch:lastOperation.newArch;this._operations.clear();const ops=isUndoing?this._operations.undone:this._operations.operations;ops.push(lastOperation);}}}
async _handleError({mode,pending,error}){this.isInEdition=false;this._services.notification.add(_t("This operation caused an error, probably because a xpath was broken"),{type:"danger",});Promise.resolve().then(()=>{throw error;});this.resetSidebar("view");this.bus.trigger("error");}
async _getStudioViewArch(){const result=await rpc("/web_studio/get_studio_view_arch",{model:this.resModel,view_type:this.viewType,view_id:this.mainView.id,context:{...user.context,lang:false},});return{arch:result.studio_view_arch,viewId:result.studio_view_id,mainViewId:result.main_view_id,};}
get _subviewInfo(){if(!this.isEditingSubview){return null;}
const length=this.breadcrumbs.length;return this.breadcrumbs[length-1].data;}
get _fieldsAllowedRename(){return this._getFieldsAllowedRename(this.breadcrumbs.length>1?this.breadcrumbs.length:1);}}
__exports.useEditNodeAttributes=useEditNodeAttributes;function useEditNodeAttributes({isRoot=false}={}){const vem=useEnv().viewEditorModel;function editNodeAttributes(newAttributes){let target;let node;if(isRoot){target=vem.getFullTarget(`/${vem.viewType}`);target.isSubviewAttr=true;}else{target=vem.getFullTarget(vem.activeNodeXpath);const{arch,attrs}=vem.activeNode;node={tag:arch.tagName,attrs,};}
const operation={new_attrs:newAttributes,type:"attributes",position:"attributes",target,};if(node){operation.node=node;}
return vem.doOperation(operation);}
return editNodeAttributes;}
return __exports;});;

/* /web_studio/static/src/client_action/view_editor/view_editor_snackbar.js */
odoo.define('@web_studio/client_action/view_editor/view_editor_snackbar',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const ViewEditorSnackbar=__exports.ViewEditorSnackbar=class ViewEditorSnackbar extends Component{static template="web_studio.ViewEditor.Snackbar";static props={operations:Object,saveIndicator:Object,};}
return __exports;});;

/* /web_studio/static/src/client_action/xml_resource_editor/xml_resource_editor.js */
odoo.define('@web_studio/client_action/xml_resource_editor/xml_resource_editor',['@odoo/owl','@web/core/l10n/translation','@web/core/code_editor/code_editor','@web/core/network/rpc','@web/core/resizable_panel/resizable_panel','@web/core/select_menu/select_menu'],function(require){'use strict';let __exports={};const{Component,onWillStart,onWillUpdateProps,toRaw,useState}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{CodeEditor}=require("@web/core/code_editor/code_editor");const{rpc}=require("@web/core/network/rpc");const{ResizablePanel}=require("@web/core/resizable_panel/resizable_panel");const{SelectMenu}=require("@web/core/select_menu/select_menu");class ViewSelector extends SelectMenu{static template="web_studio.ViewSelector";static choiceItemTemplate="web_studio.ViewSelector.ChoiceItemRecursive";static props={...SelectMenu.props,choices:{optional:true,type:Array,element:{type:Object,shape:{value:true,label:{type:String},resource:{optional:true},},},},};getMainViews(){return this.state.displayedOptions.filter((opt)=>opt.resource.isMainResource);}
getInherited(choice){const inheritedChoices=this.state.displayedOptions.filter((opt)=>(opt.resource.inherit_id||[])[0]===choice.resource.id);if(inheritedChoices.length){inheritedChoices.forEach((opt)=>(opt.resource.relatedChoice=choice.resource.id));}
return inheritedChoices;}
getComposedBy(choice){const resource=choice.resource;if(!resource.called_xml_ids){return[];}
const composedChoices=this.state.displayedOptions.filter((opt)=>resource.called_xml_ids.includes(opt.resource.xml_id)||resource.called_xml_ids.includes(opt.resource.key));if(composedChoices.length){composedChoices.forEach((opt)=>(opt.resource.relatedChoice=resource.id));}
return composedChoices;}
sliceDisplayedOptions(){const childChoices=this.state.choices.filter((c)=>c.resource.relatedChoice);childChoices.forEach((c)=>this.addRelatedChoice(c.resource.relatedChoice));super.sliceDisplayedOptions();}
addRelatedChoice(parentId){if(this.state.choices.findIndex((c)=>c.resource.id===parentId)===-1){const parent=this.props.choices.find((c)=>c.resource.id===parentId);if(!parent.resource.isMainResource){this.addRelatedChoice(parent.resource.relatedChoice);}
this.state.choices.push(parent);}}}
const XmlResourceEditor=__exports.XmlResourceEditor=class XmlResourceEditor extends Component{static template="web_studio.XmlResourceEditor";static components={ResizablePanel,CodeEditor,SelectMenu:ViewSelector};static props={onClose:{type:Function},onCodeChange:{type:Function,optional:true},onSave:{type:Function,optional:true},mainResourceId:{type:true},defaultResourceId:{type:true,optional:true},getDefaultResource:{optional:true,type:Function},canSave:{type:Boolean,optional:true},minWidth:{type:Number,optional:true},reloadSources:{type:Number,optional:true},displayAlerts:{type:Boolean,optional:true},onResourceChange:{type:Function,optional:true},};static defaultProps={canSave:true,minWidth:400,reloadSources:1,displayAlerts:true,onResourceChange:()=>{},getDefaultResource:()=>{},};setup(){this.state=useState({resourcesOptions:[],currentResourceId:null,_codeChanges:null,});this.codeEditorKey=this.props.reloadSources;onWillStart(()=>this.loadResources(this.props.mainResourceId));onWillUpdateProps(async(nextProps)=>{const resourceChanged=nextProps.mainResourceId!==this.props.mainResourceId;const shouldReload=resourceChanged||this.codeEditorKey!==nextProps.reloadSources;const nextResourceId=nextProps.mainResourceId!==this.props.mainResourceId?nextProps.mainResourceId:this.state.currentResourceId;if(resourceChanged){this.cursorPosition=undefined;}
if(shouldReload){this.state._codeChanges=null;await this.loadResources(nextProps.mainResourceId);this.state.currentResourceId=nextResourceId;}
this.codeEditorKey=nextProps.reloadSources;});this.alerts=useState({"built-in-file":{message:_t("Editing a built-in file through this editor is not advised, as it will prevent it from being updated during future App upgrades."),display:true,},});}
get minWidth(){return this.props.minWidth;}
get arch(){const currentResourceId=this.state.currentResourceId;if(!currentResourceId){return"";}
return this.tempCode||this.getResourceFromId(currentResourceId).arch;}
get tempCode(){if(!this.state.currentResourceId){return"";}
return this.state._codeChanges&&this.state._codeChanges[this.state.currentResourceId];}
set tempCode(value){if(!this.state.currentResourceId){return;}
this.state._codeChanges=this.state._codeChanges||{};this.state._codeChanges[this.state.currentResourceId]=value;}
getResourceFromId(resourceId){const opt=this.state.resourcesOptions.find((opt)=>opt.value===resourceId)||{};return opt.resource;}
onFormat(){this.tempCode=window.vkbeautify.xml(this.tempCode||this.arch,4);}
hideAlert(alertKey){this.alerts[alertKey].display=false;}
onCloseClick(){this.props.onClose();}
onCodeChange(code,cursorPosition){this.cursorPosition=cursorPosition;this.tempCode=code;if("onCodeChange"in this.props){this.props.onCodeChange({...toRaw(this.state._codeChanges)});}}
onSaveClick(){if(!this.tempCode){return;}
const resource=this.getResourceFromId(this.state.currentResourceId);this.props.onSave({resourceId:resource.id,newCode:this.tempCode,oldCode:resource.oldArch,});}
onResourceChange(resourceId){this.state.currentResourceId=resourceId;this.cursorPosition=undefined;this.props.onResourceChange(this.getResourceFromId(this.state.currentResourceId));}
async loadResources(resourceId){const resources=await rpc("/web_studio/get_xml_editor_resources",{key:resourceId,});const resourcesOptions=resources.views.map((res)=>({label:`${res.name} (${res.xml_id})`,value:res.id,resource:{...res,oldArch:res.arch,isMainResource:res.key===resourceId||res.id===resourceId||res.xml_id===resourceId,},}));this.state.resourcesOptions=resourcesOptions;if(resourcesOptions.length>=1){let defaultResource=this.props.getDefaultResource(resourcesOptions,resources.main_view_key);if(!defaultResource&&(this.props.defaultResourceId||resources.main_view_key)){const defaultId=this.props.defaultResourceId||resources.main_view_key;defaultResource=resourcesOptions.find((opt)=>opt.resource.id===defaultId||opt.resource.xml_id===defaultId||opt.resource.key===defaultId);}
defaultResource=defaultResource||resourcesOptions[0];this.state.currentResourceId=defaultResource.value;}
return resourcesOptions;}}
return __exports;});;

/* /web_studio/static/src/views/kanban_report/new_report_dialog.js */
odoo.define('@web_studio/views/kanban_report/new_report_dialog',['@odoo/owl','@web/core/dialog/dialog','@web/core/l10n/translation','@web/core/network/rpc','@web/core/user'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{Dialog}=require("@web/core/dialog/dialog");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio",...args);const{rpc}=require("@web/core/network/rpc");const{user}=require("@web/core/user");const NewReportDialog=__exports.NewReportDialog=class NewReportDialog extends Component{static template="web_studio.NewReportDialog";static components={Dialog};static props=["resModel","onReportCreated","close"];setup(){this.layouts=[{name:"web.external_layout",label:_t("External"),description:_t("Business header/footer"),},{name:"web.internal_layout",label:_t("Internal"),description:_t("Minimal header/footer"),},{name:"web.basic_layout",label:_t("Blank"),description:_t("No header/footer"),},];}
async createNewReport(layout){const report=await rpc("/web_studio/create_new_report",{model_name:this.props.resModel,layout,context:user.context,});this.props.onReportCreated(report);this.props.close();}}
return __exports;});;

/* /web_studio/static/src/views/kanban_report/report_kanban_view.js */
odoo.define('@web_studio/views/kanban_report/report_kanban_view',['@web/core/registry','@web/core/utils/hooks','@web/views/kanban/kanban_view','@web/views/kanban/kanban_controller','@web_studio/views/kanban_report/new_report_dialog'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{kanbanView}=require("@web/views/kanban/kanban_view");const{KanbanController}=require("@web/views/kanban/kanban_controller");const{NewReportDialog}=require("@web_studio/views/kanban_report/new_report_dialog");class StudioReportKanbanController extends KanbanController{setup(){super.setup();this.actionService=useService("action");this.dialogService=useService("dialog");this.orm=useService("orm");}
createRecord(){this.dialogService.add(NewReportDialog,{resModel:this.props.context.default_model,onReportCreated:(report)=>{this.openRecord({data:report,resId:report.id});},});}
openRecord(record){return this.actionService.doAction("web_studio.action_edit_report",{report:{data:record.data,res_id:record.resId,},});}}
const studioReportKanbanView={...kanbanView,Controller:StudioReportKanbanController,};registry.category("views").add("studio_report_kanban",studioReportKanbanView);return __exports;});;

/* /web_studio_ai_fields/static/src/client_action/view_editor/interactive_editor/field_configuration/ai_field_configuration_dialog.js */
odoo.define('@web_studio_ai_fields/client_action/view_editor/interactive_editor/field_configuration/ai_field_configuration_dialog',['@ai/ai_prompt/ai_prompt','@web/core/dialog/dialog','@web/core/l10n/translation','@web/core/popover/popover_hook','@web/core/record_selectors/record_selector','@web/core/select_menu/select_menu','@web/core/utils/hooks','@web/views/fields/dynamic_placeholder_popover','@web_studio/client_action/view_editor/editors/utils','@web_studio/client_action/view_editor/interactive_editor/field_configuration/selection_content_dialog','@odoo/owl'],function(require){'use strict';let __exports={};const{AiPrompt}=require("@ai/ai_prompt/ai_prompt");const{Dialog}=require("@web/core/dialog/dialog");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio_ai_fields",...args);const{usePopover}=require("@web/core/popover/popover_hook");const{RecordSelector}=require("@web/core/record_selectors/record_selector");const{SelectMenu}=require("@web/core/select_menu/select_menu");const{useService}=require("@web/core/utils/hooks");const{DynamicPlaceholderPopover}=require("@web/views/fields/dynamic_placeholder_popover");const{randomName}=require("@web_studio/client_action/view_editor/editors/utils");const{SelectionContentDialog}=require("@web_studio/client_action/view_editor/interactive_editor/field_configuration/selection_content_dialog");const{Component,useState}=require("@odoo/owl");const AiFieldConfigurationDialog=__exports.AiFieldConfigurationDialog=class AiFieldConfigurationDialog extends Component{static template="web_studio_ai_fields.AiFieldConfigurationDialog";static components={AiPrompt,Dialog,RecordSelector,SelectMenu};static props={cancel:{type:Function},close:{type:Function},confirm:{type:Function},propertiesModel:{type:String},title:{type:String,optional:true},};setup(){this.popover=usePopover(DynamicPlaceholderPopover);this.dialog=useService("dialog");this.orm=useService("orm");this.state=useState({fieldType:"char",prompt:"",relationId:false,relationName:false,selection:[],showMissingRelationWarning:false,});}
get choices(){return Object.entries(this.fields).map(([key,field])=>({value:key,...field}));}
get fields(){return{char:{type:"char",label:_t("Text"),description:_t("New AI Text"),widget:"ai_char",},text:{type:"text",label:_t("Multiline Text"),description:_t("New AI Multiline Text"),widget:"ai_text",},html:{type:"html",label:_t("HTML"),description:_t("New AI HTML"),widget:"ai_html",},int:{type:"integer",label:_t("Integer"),description:_t("New AI Integer"),widget:"ai_integer",},float:{type:"float",label:_t("Decimal"),description:_t("New AI Decimal"),widget:"ai_float",},monetary:{type:"monetary",label:_t("Monetary"),description:_t("New AI Monetary"),widget:"ai_monetary",},date:{type:"date",label:_t("Date"),description:_t("New AI Date"),widget:"ai_date",},datetime:{type:"datetime",label:_t("Datetime"),description:_t("New AI Datetime"),widget:"ai_datetime",},bool:{type:"boolean",label:_t("Checkbox"),description:_t("New AI CheckBox"),widget:"ai_boolean",},selection:{type:"selection",label:_t("Selection"),description:_t("New AI Selection"),widget:"ai_selection",},m2o:{type:"many2one",label:_t("Many2one"),description:_t("New AI Many2One"),widget:"ai_many2one",},m2m:{type:"many2many",label:_t("Tags"),description:_t("New AI Tags"),widget:"ai_many2many_tags",icon:"tags",},};}
get relation(){return this.state.relationName||undefined;}
get relationSelectorProps(){return{resModel:"ir.model",domain:[["transient","=",false],["abstract","=",false],],resId:this.state.relationId,update:async(resId)=>{this.state.relationId=resId;this.state.relationName=resId&&(await this.getRelationName(resId));if(resId){this.state.showMissingRelationWarning=false;}},};}
get selectedField(){return this.fields[this.state.fieldType];}
editSelection(){this.dialog.add(SelectionContentDialog,{defaultChoices:this.state.selection,onConfirm:(selection)=>(this.state.selection=selection),});}
async getRelationName(resId){const[{model}]=await this.orm.read("ir.model",[resId],["model"]);return model;}
async onConfirm(){if(["m2o","m2m"].includes(this.state.fieldType)&&!this.state.relationId){this.state.showMissingRelationWarning=true;return;}
const newNode={field_description:{field_description:this.selectedField.description,model_name:this.props.propertiesModel,name:randomName(`x_studio_${this.selectedField.type}_field`),type:this.selectedField.type,ai:true,system_prompt:this.state.prompt,},tag:"field",attrs:{widget:this.selectedField.widget},};if(this.state.fieldType==="selection"){newNode.field_description.selection=this.state.selection;}
if(["m2o","m2m"].includes(this.state.fieldType)){newNode.field_description.relation_id=this.state.relationId;}
this.props.confirm(newNode);this.props.close();}}
return __exports;});;

/* /web_studio_ai_fields/static/src/client_action/view_editor/interactive_editor/interactive_editor.js */
odoo.define('@web_studio_ai_fields/client_action/view_editor/interactive_editor/interactive_editor',['@web/core/l10n/translation','@web/core/utils/patch','@web_studio/client_action/view_editor/editors/components/view_fields','@web_studio/client_action/view_editor/interactive_editor/interactive_editor','@web_studio_ai_fields/client_action/view_editor/interactive_editor/field_configuration/ai_field_configuration_dialog'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_studio_ai_fields",...args);const{patch}=require("@web/core/utils/patch");const{NewFields}=require("@web_studio/client_action/view_editor/editors/components/view_fields");const{InteractiveEditor}=require("@web_studio/client_action/view_editor/interactive_editor/interactive_editor");const{AiFieldConfigurationDialog}=require("@web_studio_ai_fields/client_action/view_editor/interactive_editor/field_configuration/ai_field_configuration_dialog");patch(NewFields.prototype,{get newFieldsComponents(){return[...super.newFieldsComponents,{classType:"ai",type:"AI",string:_t("AI Field"),name:"ai",dropData:JSON.stringify({ai:true}),},];},});patch(InteractiveEditor.prototype,{async getNewFieldNode(data){if(!data.ai){return super.getNewFieldNode(data);}
return await new Promise((resolve)=>{this.addDialog(AiFieldConfigurationDialog,{cancel:()=>{},confirm:(nodeData)=>resolve(nodeData),propertiesModel:this.env.viewEditorModel.resModel,});});},});return __exports;});;

/* /web_studio_ai_fields/static/src/client_action/view_editor/interactive_editor/properties/field_properties/field_properties.js */
odoo.define('@web_studio_ai_fields/client_action/view_editor/interactive_editor/properties/field_properties/field_properties',['@ai/ai_prompt/ai_prompt','@web/core/network/rpc','@web/core/utils/patch','@web_studio/client_action/view_editor/interactive_editor/properties/field_properties/field_properties'],function(require){'use strict';let __exports={};const{AiPrompt,AiPromptDialog}=require("@ai/ai_prompt/ai_prompt");const{rpc}=require("@web/core/network/rpc");const{patch}=require("@web/core/utils/patch");const{FieldProperties}=require("@web_studio/client_action/view_editor/interactive_editor/properties/field_properties/field_properties");Object.assign(FieldProperties.components,{AiPrompt});const aiWidgetForFieldType={char:"ai_char",text:"ai_text",html:"ai_html",integer:"ai_integer",float:"ai_float",monetary:"ai_monetary",date:"ai_date",datetime:"ai_datetime",boolean:"ai_boolean",selection:"ai_selection",many2one:"ai_many2one",many2many:"ai_many2many_tags",};patch(FieldProperties.prototype,{get isAi(){return!!this.props.node.field.ai||this.props.node.field.ai==="";},async onChangeAi(value){const field=this.props.node.field;await rpc("/web_studio/edit_field",{model_name:this.env.viewEditorModel.resModel,field_name:this.props.node.field.name,values:{ai:value},});field.ai=value&&"";this.onChangeAttribute(value?aiWidgetForFieldType[field.type]:"","widget");},async updateSystemPrompt(value){const field=this.props.node.field;await rpc("/web_studio/edit_field",{model_name:this.env.viewEditorModel.resModel,field_name:this.props.node.field.name,values:{system_prompt:value},});field.ai=value;},onSystemPromptClick(){if(!this.props.node.field.manual){return;}
this.dialog.add(AiPromptDialog,{aiPromptProps:{comodel:this.comodel,domain:this.props.node.attrs.domain||"",model:this.env.viewEditorModel.resModel,prompt:this.props.node.field.ai||"",readonly:false,aiFieldPath:this.props.node.field.name,},confirm:(newPrompt)=>this.updateSystemPrompt(newPrompt),});},get comodel(){if(["many2one","many2many"].includes(this.props.node.field.type)){return this.props.node.field.relation;}
return undefined;},});return __exports;});;

/* /website_studio/static/src/editor_tabs.js */
odoo.define('@website_studio/editor_tabs',['@odoo/owl','@web/core/l10n/translation','@web/core/registry'],function(require){'use strict';let __exports={};const{markup}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"website_studio",...args);const{registry}=require("@web/core/registry");const MODEL_PAGE_HELP=_t(markup(`
    <p class="o_view_nocontent_empty_folder">
        Create a new model page
    </p>
    <p>
        Publish everything on your websites
        then customize the pages
        using the power of the Website app
    </p>
`));registry.category("web_studio.editor_tabs").add("website",{name:_t("Model Pages"),action:(env)=>{const{editedAction}=env.services.studio;const context={default_model:editedAction.res_model,search_default_model:editedAction.res_model,default_page_type:"listing",default_website_published:true,default_use_menu:true,default_auto_single_page:true,form_view_ref:"website_studio.website_controller_page_form_dialog","website_studio.create_page":true,}
return{type:"ir.actions.act_window",res_model:"website.controller.page",name:_t("Model Pages"),views:[[false,"kanban"],[false,"list"],[false,"form"]],context,help:MODEL_PAGE_HELP,}},});return __exports;});

                    /*******************************************
                    *  Templates                               *
                    *******************************************/

                    odoo.define("web_studio.studio_assets.bundle.xml", ["@web/core/templates"], function(require) {
                        "use strict";
                        const { checkPrimaryTemplateParents, registerTemplate, registerTemplateExtension } = require("@web/core/templates");
                        /* web_studio.studio_assets */
                        registerTemplate("web.GraphView.Buttons", `/web/static/src/views/graph/graph_controller.xml`, `<t t-name="web.GraphView.Buttons" xml:space="preserve">
        <div class="btn-group" role="toolbar" aria-label="Main actions">
            <ReportViewMeasures measures="model.metaData.measures" activeMeasures="[model.metaData.measure]" onMeasureSelected.bind="this.onMeasureSelected"/>
        </div>
        <div class="btn-group" role="toolbar" aria-label="Change graph">
            <button class="btn btn-secondary fa fa-bar-chart o_graph_button" data-tooltip="Bar Chart" aria-label="Bar Chart" data-mode="bar" t-on-click="() =&gt; this.onModeSelected('bar')" t-att-class="{ active: model.metaData.mode === 'bar' }"/>
            <button class="btn btn-secondary fa fa-line-chart o_graph_button" data-tooltip="Line Chart" aria-label="Line Chart" data-mode="line" t-on-click="() =&gt; this.onModeSelected('line')" t-att-class="{ active: model.metaData.mode === 'line' }"/>
            <button class="btn btn-secondary fa fa-pie-chart o_graph_button" data-tooltip="Pie Chart" aria-label="Pie Chart" data-mode="pie" t-on-click="() =&gt; this.onModeSelected('pie')" t-att-class="{ active: model.metaData.mode === 'pie' }"/>
        </div>
        <div t-if="model.metaData.mode === 'bar'" class="btn-group" role="toolbar" aria-label="Change graph">
            <button class="btn btn-secondary fa fa-database o_graph_button" data-tooltip="Stacked" aria-label="Stacked" t-on-click="toggleStacked" t-att-class="{ active: model.metaData.stacked }"/>
        </div>
        <div t-if="model.metaData.mode === 'line'" class="btn-group" role="toolbar" aria-label="Change graph">
            <button class="btn btn-secondary fa fa-database o_graph_button" data-tooltip="Stacked" aria-label="Stacked" t-on-click="toggleStacked" t-att-class="{ active: model.metaData.stacked }"/>
            <button class="btn btn-secondary fa fa-signal o_graph_button" data-tooltip="Cumulative" aria-label="Cumulative" t-on-click="toggleCumulated" t-att-class="{ active: model.metaData.cumulated }"/>
        </div>
        <div t-if="model.metaData.mode !== 'pie'" class="btn-group" role="toolbar" aria-label="Sort graph" name="toggleOrderToolbar">
            <button class="btn btn-secondary fa fa-sort-amount-desc o_graph_button" data-tooltip="Descending" aria-label="Descending" t-on-click="() =&gt; this.toggleOrder('DESC')" t-att-class="{ active: model.metaData.order === 'DESC' }"/>
            <button class="btn btn-secondary fa fa-sort-amount-asc o_graph_button" data-tooltip="Ascending" aria-label="Ascending" t-on-click="() =&gt; this.toggleOrder('ASC')" t-att-class="{ active: model.metaData.order === 'ASC' }"/>
        </div>
    </t>

    `);
registerTemplate("web.GraphView", `/web/static/src/views/graph/graph_controller.xml`, `<t t-name="web.GraphView" xml:space="preserve">
        <div t-att-class="props.className" t-ref="root">
            <Layout className="model.useSampleModel ? 'o_view_sample_data' : ''" display="props.display">
                <t t-set-slot="control-panel-additional-actions">
                    <CogMenu/>
                </t>
                <t t-set-slot="layout-actions">
                    <SearchBar toggler="searchBarToggler"/>
                </t>
                <t t-set-slot="control-panel-navigation-additional">
                    <t t-component="searchBarToggler.component" t-props="searchBarToggler.props"/>
                </t>
                <t t-if="model.isReady and model.data">
					<t t-if="!model.hasData() or model.useSampleModel and props.info.noContentHelp">
						<ActionHelper noContentHelp="props.noContentHelp" showRibbon="model.useSampleModel"/>
                    </t>
                    <t t-component="props.Renderer" model="model" buttonTemplate="props.buttonTemplate"/>
                </t>
                <t t-elif="model.isReady" t-call="web.NoContentHelper">
                    <t t-set="title">Invalid data</t>
                    <t t-set="description">Pie chart cannot mix positive and negative numbers. Try to change your domain to only display positive results</t>
                </t>
            </Layout>
        </div>
    </t>

`);
registerTemplate("web.GraphRenderer.CustomTooltip", `/web/static/src/views/graph/graph_renderer.xml`, `<t t-name="web.GraphRenderer.CustomTooltip" xml:space="preserve">
        <div class="o_graph_custom_tooltip popover show px-2 py-1 pe-none mw-100 position-absolute">
            <table class="overflow-hidden m-0">
                <thead>
                    <tr>
                        <th class="o_measure align-baseline border-0" t-esc="measure"/>
                    </tr>
                </thead>
                <tbody>
                    <tr t-foreach="tooltipItems" t-as="tooltipItem" t-key="tooltipItem_index">
                        <td>
                            <span class="o_square badge p-2 rounded-0 align-middle me-2" t-attf-style="background-color: {{ tooltipItem.boxColor }}"> </span>
                            <small class="o_label d-inline-block text-truncate align-middle smaller" t-attf-style="max-width: {{ maxWidth }}" t-esc="tooltipItem.label"/>
                        </td>
                        <td class="o_value ps-2 text-end fw-bolder">
                            <small class="smaller">
                                <t t-out="tooltipItem.value"/>
                                <t t-if="mode === 'pie' and tooltipItem.percentage">
                                    (<t t-esc="tooltipItem.percentage"/>%)
                                </t>
                            </small>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </t>

    `);
registerTemplate("web.GraphRenderer", `/web/static/src/views/graph/graph_renderer.xml`, `<t t-name="web.GraphRenderer" xml:space="preserve">
        <div t-att-class="'o_graph_renderer o_renderer h-100 d-flex flex-column border-top ' + props.class" t-ref="root">
            <t t-if="model.data.exceeds">
                <div class="alert alert-info text-center o_graph_alert m-3 mb-2" role="status">
                    There are too many data. The graph only shows a sample. Use the filters to refine the scope.
                    <a class="o_graph_load_all_btn" href="#" t-on-click="() =&gt; this.loadAll()">
                        Load everything anyway.
                    </a>
                </div>
            </t>
            <div class="d-flex d-print-none gap-1 flex-shrink-0 mt-2 mx-3 mb-3 overflow-x-auto">
                <t t-call="{{ props.buttonTemplate }}"/>
            </div>
            <div t-if="model.hasData()" class="o_graph_canvas_container flex-grow-1 position-relative px-3 pb-3" t-ref="container">
                <canvas t-custom-click="(ev, isMiddleClick) =&gt; this.onGraphClicked(ev, isMiddleClick)" t-ref="canvas"/>
            </div>
        </div>
    </t>

`);
registerTemplate("web.PivotView.Buttons", `/web/static/src/views/pivot/pivot_controller.xml`, `<t t-name="web.PivotView.Buttons" xml:space="preserve">
        <div class="o_pivot_buttons d-flex d-print-none gap-1 mt-2 mx-3 mb-3">
            <div class="btn-group" role="toolbar" aria-label="Main actions">
                <ReportViewMeasures measures="model.metaData.measures" activeMeasures="model.metaData.activeMeasures" onMeasureSelected.bind="this.onMeasureSelected"/>
            </div>
            <div class="btn-group" role="toolbar" aria-label="Pivot settings">
                <t t-set="noDataDisplayed" t-value="!model.hasData() || !model.metaData.activeMeasures.length"/>
                <button class="btn btn-secondary fa fa-exchange o_pivot_flip_button" t-on-click="onFlipButtonClicked" data-tooltip="Flip axis" aria-label="Flip axis" t-attf-disabled="{{noDataDisplayed ? 'disabled' : false}}"/>
                <button class="btn btn-secondary fa fa-arrows o_pivot_expand_button" t-on-click="onExpandButtonClicked" data-tooltip="Expand all" aria-label="Expand all" t-attf-disabled="{{noDataDisplayed ? 'disabled' : false}}"/>
                <button class="btn btn-secondary fa fa-download o_pivot_download" t-on-click="onDownloadButtonClicked" data-tooltip="Download xlsx" aria-label="Download xlsx" t-attf-disabled="{{noDataDisplayed ? 'disabled' : false}}"/>
            </div>
        </div>
    </t>

    `);
registerTemplate("web.PivotView", `/web/static/src/views/pivot/pivot_controller.xml`, `<t t-name="web.PivotView" xml:space="preserve">
        <div t-att-class="props.className" t-ref="root">
            <Layout className="model.useSampleModel ? 'o_view_sample_data' : ''" display="props.display">
                <t t-set-slot="control-panel-additional-actions">
                    <CogMenu/>
                </t>
                <t t-set-slot="layout-actions">
                    <SearchBar toggler="searchBarToggler"/>
                </t>
                <t t-set-slot="control-panel-navigation-additional">
                    <t t-component="searchBarToggler.component" t-props="searchBarToggler.props"/>
                </t>
				<t t-if="model.isReady and displayNoContent">
    				<ActionHelper noContentHelp="props.info.noContentHelp" showRibbon="model.useSampleModel"/>
                </t>
                <t t-if="model.isReady" t-component="props.Renderer" model="model" buttonTemplate="props.buttonTemplate"/>
            </Layout>
        </div>
    </t>

`);
registerTemplate("web.PivotRenderer", `/web/static/src/views/pivot/pivot_renderer.xml`, `<t t-name="web.PivotRenderer" xml:space="preserve">
        <div>
            <t t-call="{{ props.buttonTemplate }}"/>
            <div t-if="model.hasData() and model.metaData.activeMeasures.length" t-att-class="env.isSmall ? 'table-responsive' : ''" class="o_pivot mx-3">
                <table class="table-hover table table-sm table-bordered table-borderless" t-att-class="{ o_enable_linking: !model.metaData.disableLinking }" t-ref="table">
                    <thead>
                        <tr t-foreach="table.headers" t-as="row" t-key="'header_' + row_index" class="border-top-0">
                            <t t-foreach="row" t-as="cell" t-key="'header_row_' + cell_index">
                                <t t-if="cell.measure" t-call="web.PivotMeasure"/>
                                <t t-elif="cell.isLeaf !== undefined">
                                    <t t-call="web.PivotHeader.title">
                                        <t t-set="isXAxis" t-value="true"/>
                                        <t t-set="isInHead" t-value="true"/>
                                    </t>
                                </t>
                                <th t-else="" t-att-colspan="cell.width" t-att-rowspan="cell.height" class="border-0 bg-100 fw-normal" t-att-class="{ 'border-0': cell_index != 0 }"/>
                            </t>
                        </tr>
                    </thead>
                    <tbody>
                        <tr t-foreach="table.rows" t-as="row" t-key="'row_' + row_index">
                            <t t-call="web.PivotHeader.title">
                                <t t-set="cell" t-value="row"/>
                                <t t-set="isXAxis" t-value="false"/>
                                <t t-set="isInHead" t-value="false"/>
                            </t>
                            <t t-foreach="row.subGroupMeasurements" t-as="cell" t-key="'row_cell_' + cell_index">
                                <td class="o_pivot_cell_value bg-100" t-att-class="{                                         o_empty: cell.value === undefined,                                         'cursor-pointer': cell.value !== undefined and !model.metaData.disableLinking,                                         'fw-bold': cell.isBold,                                     }" t-custom-click.synthetic="(ev, isMiddleClick) =&gt; this.onOpenView(cell, isMiddleClick)" t-on-mouseover="onMouseEnter" t-on-mouseout="onMouseLeave">
                                    <t t-if="cell.value !== undefined">
                                        <div t-if="model.metaData.measures[cell.measure].type === 'boolean'" class="o_value">
                                            <CheckBox disabled="true" value="cell.value"/>
                                        </div>
                                        <div t-else="" class="o_value">
                                            <t t-set="formattedValue" t-value="getFormattedValue(cell)"/>
                                            <span t-att-data-tooltip="formattedValue.help">
                                                <t t-esc="formattedValue.value"/>
                                                <sup t-if="formattedValue.currencies" class="p-1 fw-bolder text-info" t-on-mouseover.stop="(ev) =&gt; this.openMultiCurrencyPopover(ev, formattedValue.rawValue, formattedValue.currencies)" t-on-touchstart.stop="(ev) =&gt; this.openMultiCurrencyPopover(ev, formattedValue.rawValue, formattedValue.currencies)">?</sup>
                                            </span>
                                        </div>
                                    </t>
                                </td>
                            </t>
                        </tr>
                    </tbody>
                </table>
            </div>
            <PivotDropdown state="dropdown.state" manual="true">
                <t t-set-slot="content">
                    <t t-call="web.PivotHeader.menu"/>
                </t>
            </PivotDropdown>
        </div>
    </t>

    `);
registerTemplate("web.PivotHeader.menu", `/web/static/src/views/pivot/pivot_renderer.xml`, `<t t-name="web.PivotHeader.menu" xml:space="preserve">
        <t t-set="currentGroup" t-value="null"/>
        <t t-foreach="groupByItems" t-as="item" t-key="item.id">
            <t t-if="currentGroup !== null and currentGroup !== item.groupNumber">
                <div class="dropdown-divider" role="separator"/>
            </t>
            <t t-if="item.fieldType === 'properties'">
                <PropertiesGroupByItem item="item" onGroup.bind="onGroupBySelected"/>
            </t>
            <t t-elif="item.options">
                <Dropdown>
                    <button class="o_menu_item" t-esc="item.description"/>
                    <t t-set-slot="content">
                        <t t-set="subGroup" t-value="null"/>
                        <t t-foreach="item.options" t-as="option" t-key="option.id">
                            <t t-if="subGroup !== null and subGroup !== option.groupNumber">
                                <div class="dropdown-divider" role="separator"/>
                            </t>
                            <DropdownItem class="'o_item_option'" t-esc="option.description" onSelected="() =&gt; this.onGroupBySelected({ itemId: item.id, optionId: option.id})"/>
                            <t t-set="subGroup" t-value="option.groupNumber"/>
                        </t>
                    </t>
                </Dropdown>
            </t>
            <t t-else="">
                <DropdownItem class="'o_menu_item'" t-esc="item.description" onSelected="() =&gt; this.onGroupBySelected({ itemId: item.id })"/>
            </t>
            <t t-set="currentGroup" t-value="item.groupNumber"/>
        </t>
        <t t-if="!hideCustomGroupBy and fields.length">
            <div t-if="groupByItems.length" role="separator" class="dropdown-divider"/>
            <CustomGroupByItem fields="fields" onAddCustomGroup.bind="onAddCustomGroupBy"/>
        </t>
    </t>

    `);
registerTemplate("web.PivotHeader.title", `/web/static/src/views/pivot/pivot_renderer.xml`, `<t t-name="web.PivotHeader.title" xml:space="preserve">
        <t t-set="padding" t-value="5 + cell.indent * 30"/>
        <th class="bg-view text-nowrap cursor-pointer fw-normal user-select-none" t-att-colspan="isXAxis ? cell.width : undefined" t-att-rowspan="isXAxis ? cell.height : undefined" t-att-class="{                 o_pivot_header_cell_closed: cell.isLeaf,                 o_pivot_header_cell_opened: !cell.isLeaf,                 'border-top': isInHead,             }" t-attf-style="{{                 isXAxis                     ? undefined                     : l10n.direction === 'ltr'                         ? 'padding-left: ' + padding + 'px;'                         : 'padding-right: ' + padding + 'px;'             }}" t-att-data-tooltip="cell.label" t-attf-data-tooltip-position="{{ l10n.direction === 'ltr' ? 'right' : 'left' }}" t-on-pointerdown.capture.stop.synthetic="" t-on-click.stop.synthetic="(ev) =&gt; this.onHeaderClick(ev, cell, isXAxis)">
            <i t-attf-class="fa fa-{{ cell.isLeaf ? 'plus-square' : 'minus-square-o' }} me-1"/>
            <span t-esc="cell.title"/>
        </th>
    </t>

    `);
registerTemplate("web.PivotMeasure", `/web/static/src/views/pivot/pivot_renderer.xml`, `<t t-name="web.PivotMeasure" xml:space="preserve">
        <th class="bg-view text-muted text-center text-nowrap fw-normal o_pivot_measure_row cursor-pointer user-select-none" t-att-colspan="cell.width" t-att-rowspan="cell.height" t-att-class="{                 o_pivot_sort_order_asc: cell.order === 'asc',                 o_pivot_sort_order_desc: cell.order === 'desc',             }" t-on-click.prevent="() =&gt; this.onMeasureClick(cell)" t-on-mouseover="onMouseEnter" t-on-mouseout="onMouseLeave">
            <t t-esc="cell.title"/>
            <i t-if="cell.order === 'asc' || cell.order ==='desc'" t-attf-class="fa fa-caret-{{ cell.order === 'asc' ? 'up' : 'down' }} ms-1"/>
        </th>
    </t>

`);
registerTemplate("mail.ActivityCell", `/mail/static/src/views/web/activity/activity_cell.xml`, `<t t-name="mail.ActivityCell" xml:space="preserve">
        <div class="h-100 cursor-pointer p-1 d-flex flex-column justify-content-between" t-on-click="onClick">
            <div class="d-flex position-relative" t-ref="content">
                <div class="position-absolute text-truncate px-2 w-100" t-out="displayedSummaries"/>
            </div>
            <div class="d-flex justify-content-between align-items-center mt-4 px-2">
                <div class="o-mail-ActivityCell-deadline" t-out="reportingDateFormatted"/>
                <div class="d-flex justify-content-end">
                    <div t-if="props.userAssignedIds" class="d-flex justify-content-start">
                        <Avatar t-if="props.userAssignedIds.length &gt; 0" resModel="'res.users'" resId="props.userAssignedIds[0]" displayName="''" noSpacing="true"/>
                        <Avatar t-if="props.userAssignedIds.length &gt; 1" resModel="'res.users'" resId="props.userAssignedIds[1]" displayName="''" noSpacing="true"/>
                        <t t-set="nAdditionalAssignee" t-value="props.userAssignedIds.length - 2"/>
                        <span t-if="nAdditionalAssignee &gt; 0">+<t t-out="nAdditionalAssignee"/></span>
                    </div>
                    <div t-else=""/>
                    <div t-if="props.attachmentsInfo and ongoingActivityCount == 0" class="d-flex w-100 justify-content-center gap-1 px-2">
                        <a t-attf-href="/web/content/#{props.attachmentsInfo.most_recent_id}?download=true" t-on-click.stop="" t-out="props.attachmentsInfo.most_recent_name" class="d-inline-block text-truncate" style="max-width: 120px;"/>
                        <div t-if="props.attachmentsInfo.count &gt; 1" class="text-nowrap">
                            +<t t-out="props.attachmentsInfo.count - 1"/>
                        </div>
                    </div>
                    <div t-if="totalActivityCount &gt; 1" class="o-mail-ActivityCell-counter badge bg-light rounded-pill border-0 m-1 me-0">
                        <t t-if="totalActivityCount == ongoingActivityCount or ongoingActivityCount == 0" t-out="totalActivityCount"/>
                        <t t-else="">
                            <t t-out="ongoingActivityCount"/> / <t t-out="totalActivityCount"/>
                        </t>
                    </div>
                    <div t-else=""/>
                </div>
            </div>
        </div>
    </t>

`);
registerTemplate("mail.ActivityController", `/mail/static/src/views/web/activity/activity_controller.xml`, `<t t-name="mail.ActivityController" xml:space="preserve">
        <div t-att-class="props.className + (ui.isSmall ? ' o_action_delegate_scroll': '')">
            <Layout display="props.display">
                <t t-set-slot="control-panel-additional-actions">
                    <CogMenu/>
                </t>
                <t t-set-slot="layout-actions">
                    <SearchBar/>
                </t>
                <t t-component="props.Renderer" t-props="rendererProps"/>
            </Layout>
        </div>
    </t>
`);
registerTemplate("mail.ActivityRecord", `/mail/static/src/views/web/activity/activity_record.xml`, `<t t-name="mail.ActivityRecord" xml:space="preserve">
    <td class="o_activity_record p-2 cursor-pointer" t-custom-click="(ev, newWindow) =&gt; this.props.openRecord(this.props.record, { newWindow })">
        <t t-call="{{ recordTemplate }}" t-call-context="this.getRenderingContext()"/>
    </td>
</t>

`);
registerTemplate("mail.ActivityViewHeader", `/mail/static/src/views/web/activity/activity_renderer.xml`, `<t t-name="mail.ActivityViewHeader" xml:space="preserve">
    <thead>
        <tr>
            <th/>
            <th t-foreach="activeColumns" t-as="type" t-key="type.id" class="o_activity_type_cell p-3" t-attf-class="{{ activeFilter.activityTypeId === type.id ? 'o_activity_filter_' + activeFilter.progressValue.active : '' }}" t-attf-width="{{100/activeColumns.length}}%">
                <div>
                    <span t-esc="type.name"/>
                    <span t-if="type.template_ids.length &gt; 0" class="dropdown float-end">
                        <i class="oi oi-ellipsis-v oi-fw" data-bs-toggle="dropdown"/>
                        <div class="dropdown-menu">
                            <t t-foreach="type.template_ids" t-as="template" t-key="template.id">
                                <div data-tooltip="This action will send an email." class="o_template_element o_send_mail_template cursor-pointer" t-on-click="() =&gt; props.onSendMailTemplate(template.id, type.id)">
                                    <i class="fa fa-envelope fa-fw"/> <t t-esc="template.name"/>
                                </div>
                            </t>
                        </div>
                    </span>
                </div>
                <div class="o_activity_counter d-flex align-items-center justify-content-between mb-3 h-0 mt24">
                    <t t-set="group" t-value="getGroupInfo(type)"/>
                    <ColumnProgress t-if="group.data.count" group="group.data" aggregate="group.aggregate" aggregateOn="group.aggregateOn" progressBar="group.data.progressBar" onBarClicked.bind="group.data.filterProgressValue"/>
                </div>
            </th>
            <th class="align-middle" style="width: 32px; min-width: 32px">
                <div class="o_optional_columns_dropdown text-center border-top-0">
                    <Dropdown position="'bottom-end'">
                        <button class="btn p-0" tabindex="-1">
                            <i class="o_optional_columns_dropdown_toggle oi oi-fw oi-settings-adjust"/>
                        </button>

                        <t t-set-slot="content">
                            <t t-foreach="props.activityTypes" t-as="type" t-key="type_index">
                                <DropdownItem closingMode="'none'" onSelected="() =&gt; this.toggleDisplayColumn(type.id)">
                                    <CheckBox onChange="() =&gt; this.toggleDisplayColumn(type.id)" value="storageActiveColumns[type.id]" name="type.name">
                                        <t t-esc="type.name"/>
                                    </CheckBox>
                                </DropdownItem>
                            </t>
                        </t>
                    </Dropdown>
                </div>
            </th>
        </tr>
    </thead>
</t>

`);
registerTemplate("mail.ActivityViewBody", `/mail/static/src/views/web/activity/activity_renderer.xml`, `<t t-name="mail.ActivityViewBody" xml:space="preserve">
    <tbody>
        <t t-foreach="props.activityResIds" t-as="resId" t-key="resId">
            <t t-call="mail.ActivityViewRow"/>
        </t>
    </tbody>
</t>

`);
registerTemplate("mail.ActivityViewRow", `/mail/static/src/views/web/activity/activity_renderer.xml`, `<t t-name="mail.ActivityViewRow" xml:space="preserve">
    <t t-set="record" t-value="getRecord(resId)"/>
    <t t-if="record">
        <tr class="o_data_row h-100" t-attf-class="{{ activeFilter.resIds.has(resId) ? 'o_activity_filter_' + activeFilter.progressValue.active : '' }}">
                <ActivityRecord archInfo="props.archInfo" record="record" openRecord="props.openRecord"/>
                <t t-foreach="activeColumns" t-as="type" t-key="type.id">
                    <t t-call="mail.ActivityViewCell"/>
                </t>
            <td/>
        </tr>
    </t>
</t>

`);
registerTemplate("mail.ActivityViewCell", `/mail/static/src/views/web/activity/activity_renderer.xml`, `<t t-name="mail.ActivityViewCell" xml:space="preserve">
    <t t-set="activityGroup" t-value="props.groupedActivities[resId] and props.groupedActivities[resId][type.id] or {count: 0, ids: [], state: false}"/>
    <t t-set="isCellHidden" t-value="!activeFilter.resIds.has(resId) and activeFilter.activityTypeId === type.id"/>
    <td t-if="activityGroup.state and !isCellHidden" t-attf-class="o_activity_summary_cell p-0 h-100 {{activityGroup.state}} {{ activeFilter.resIds.has(resId) ? 'o_activity_filter_' + activeFilter.progressValue.active : '' }}">
        <ActivityCell activityIds="activityGroup.ids" activityTypeId="type.id" attachmentsInfo="activityGroup.attachments_info" reportingDate="activityGroup.reporting_date" countByState="activityGroup.count_by_state" summaries="activityGroup.summaries" reloadFunc="props.onReloadData" resId="record.resId" resModel="record.resModel" userAssignedIds="activityGroup.user_assigned_ids"/>
    </td>
    <td t-else="" class="o_activity_summary_cell o_activity_empty_cell cursor-pointer" t-attf-class="{{ activeFilter.resIds.has(resId) ? 'o_activity_filter_' + activeFilter.progressValue.active : '' }}" t-on-click.prevent.stop="() =&gt; props.onEmptyCell(resId, type.id)">
        <i data-tooltip="Create" class="text-center fa fa-plus mt-2 align-items-center justify-content-center h-100"/>
    </td>
</t>

`);
registerTemplate("mail.ActivityViewFooter", `/mail/static/src/views/web/activity/activity_renderer.xml`, `<t t-name="mail.ActivityViewFooter" xml:space="preserve">
    <tfoot class="o_activity_view_table_footer">
        <tr class="o_data_row">
            <td class="p-3" colspan="100">
                <span class="btn btn-link o_record_selector cursor-pointer" t-on-click.prevent.stop="props.scheduleActivity">
                    <i class="fa fa-plus pe-2"/> Schedule activity
                </span>
            </td>
        </tr>
    </tfoot>
</t>

`);
registerTemplate("mail.ActivityRenderer", `/mail/static/src/views/web/activity/activity_renderer.xml`, `<div t-name="mail.ActivityRenderer" class="o_activity_view h-100" xml:space="preserve">
    <t t-if="!props.activityTypes.length" t-call="web.NoContentHelper"/>
    <table t-else="" class="table table-bordered mb-5 bg-view o_activity_view_table" t-attf-style="max-width: {{activeColumns.length &gt; 4 ? 100 : 20 * (activeColumns.length + 1) }}%; min-width: 600px;">
        <t t-call="mail.ActivityViewHeader"/>
        <t t-call="mail.ActivityViewBody"/>
        <t t-call="mail.ActivityViewFooter"/>
    </table>
</div>

`);
registerTemplate("stock.ForecastedGraphRenderer", `/stock/static/src/stock_forecasted/forecasted_graph.xml`, `<t t-name="stock.ForecastedGraphRenderer" t-inherit="web.GraphRenderer" t-inherit-mode="primary" xml:space="preserve">
        <xpath expr="//canvas[@t-ref='canvas']" position="attributes">
            <attribute name="height">300</attribute>
        </xpath>
    </t>
`);
registerTemplate("project.BurndownChartView.Buttons", `/project/static/src/views/burndown_chart/burndown_chart_view.xml`, `<t t-name="project.BurndownChartView.Buttons" t-inherit="web.GraphView.Buttons" t-inherit-mode="primary" xml:space="preserve">
        <xpath expr="//button[@data-mode='pie']" position="replace">
        </xpath>
        <xpath expr="//div[@role='toolbar'][@name='toggleOrderToolbar']" position="replace">
        </xpath>
    </t>

`);
registerTemplateExtension("web.PivotRenderer", `/web_enterprise/static/src/views/pivot/pivot_renderer.xml`, `<t t-inherit="web.PivotRenderer" t-inherit-mode="extension" xml:space="preserve">
        <xpath expr="//div[hasclass('o_pivot')]" position="attributes">
            <attribute name="t-ref">root</attribute>
        </xpath>
    </t>

`);
registerTemplate("web_map.MapView", `/web_map/static/src/map_view/map_controller.xml`, `<t t-name="web_map.MapView" xml:space="preserve">
        <div t-att-class="props.className">
            <Layout className="model.useSampleModel ? 'o_view_sample_data' : ''" display="props.display">
                <t t-set-slot="control-panel-additional-actions">
                    <CogMenu/>
                </t>
                <t t-set-slot="layout-buttons">
                    <t t-call="{{ props.buttonTemplate }}"/>
                </t>
                <t t-set-slot="layout-actions">
                    <SearchBar toggler="searchBarToggler"/>
                </t>
                <t t-set-slot="control-panel-navigation-additional">
                    <t t-component="searchBarToggler.component" t-props="searchBarToggler.props"/>
                </t>
                <t t-component="props.Renderer" t-props="rendererProps"/>
            </Layout>
        </div>
    </t>

    `);
registerTemplate("web_map.MapView.Buttons", `/web_map/static/src/map_view/map_controller.xml`, `<t t-name="web_map.MapView.Buttons" xml:space="preserve">

    </t>

`);
registerTemplate("web_map.MapRenderer", `/web_map/static/src/map_view/map_renderer.xml`, `<t t-name="web_map.MapRenderer" xml:space="preserve">
        <t t-if="env.isSmall">
            <div class="row g-0 o-sm-pin-list-container" t-att-class="{ 'h-100': expendedPinList }">
                <t t-call="{{ subTemplates.PinListContainer }}"/>
            </div>
        </t>
        <div class="o-map-renderer row g-0" t-att-class="{ 'd-none': expendedPinList }">
            <t t-if="!env.isSmall">
                <t t-call="{{ subTemplates.PinListContainer }}"/>
            </t>
            <div class="h-100 col col-md-10">
                <t t-if="props.model.data.routingError">
                    <t t-call="{{ subTemplates.RountingUnavailable }}"/>
                </t>
                <t t-elif="props.model.data.fetchingCoordinates">
                    <t t-call="{{ subTemplates.FetchingCoordinates }}"/>
                </t>
                <t t-elif="props.model.metaData.routing and !props.model.data.useMapBoxAPI">
                    <t t-call="{{ subTemplates.NoMapToken }}"/>
                </t>
                <div class="o-map-renderer--container h-100" t-ref="mapContainer"/>
            </div>
        </div>
    </t>

    `);
registerTemplate("web_map.MapRenderer.FetchingCoordinates", `/web_map/static/src/map_view/map_renderer.xml`, `<t t-name="web_map.MapRenderer.FetchingCoordinates" xml:space="preserve">
        <div class="alert alert-info col col-md-10 px-5 mb-0 text-center position-absolute o-map-renderer--alert" role="status">
            <i class="fa fa-spin fa-circle-o-notch"/> Locating new addresses...
        </div>
    </t>

    `);
registerTemplate("web_map.MapRenderer.NoMapToken", `/web_map/static/src/map_view/map_renderer.xml`, `<t t-name="web_map.MapRenderer.NoMapToken" xml:space="preserve">

        <div class="alert alert-info alert-dismissible col col-md-10 px-5 mb-0 text-center position-absolute o-map-renderer--alert" role="status">
            To get routing on your map, you first need to set up your MapBox token. It's free.
            <a href="/odoo/action-base_setup.action_general_configuration" class="ml8">
                <i class="oi oi-arrow-right"/>
                Set up token
            </a>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"/>
        </div>
    </t>

    `);
registerTemplate("web_map.MapRenderer.PinListContainer", `/web_map/static/src/map_view/map_renderer.xml`, `<t t-name="web_map.MapRenderer.PinListContainer" xml:space="preserve">
        <div class="o-map-renderer--pin-list-container col-12 col-md-2 bg-view border-start cursor-default h-100">
            <div class="o-map-view--buttons">
                <a class="btn btn-primary" t-att-href="googleMapUrl" target="_blank" data-hotkey="m">View in Google Maps</a>
            </div>
            <t t-if="!props.model.metaData.hideTitle">
                <header class="o-map-renderer--pin-list-header o_pin_list_header text-uppercase px-0 py-md-2 d-flex align-items-baseline" t-on-click="togglePinList">
                    <i class="fa fa-list me-2 text-primary"/>
                    <span class="fs-6 fw-bold text-truncate" t-out="props.model.metaData.panelTitle"/>
                    <i t-if="env.isSmall" class="fa float-end ms-auto" t-att-class="{                         'fa-caret-down': expendedPinList,                         'fa-caret-left': !expendedPinList                     }"/>
                </header>
            </t>
            <t t-if="canDisplayPinList and props.model.data.isGrouped">
                <t t-foreach="props.model.data.recordGroups" t-as="groupId" t-key="groupId">
                    <div class="o-map-renderer--pin-list-group mb-1">
                        <t t-set="group" t-value="props.model.data.recordGroups[groupId]"/>
                        <div class="o-map-renderer--pin-list-group-header d-flex align-items-baseline" t-on-click="() =&gt; this.toggleGroup(groupId)">
                            <i t-attf-class="fa fa-caret-{{ state.closedGroupIds.includes(groupId) ? 'right' : 'down' }}"/>
                            <span class="ms-1" t-att-style="'color:' + getGroupColor(groupId)">
                                <t t-call="web_map.pinSVG">
                                    <t t-set="numbering" t-value="props.model.metaData.numbering"/>
                                </t>
                            </span>
                            <t t-if="group.name" t-esc="group.name"/>
                            <t t-else="">Undefined</t>
                        </div>
                        <t t-if="!state.closedGroupIds.includes(groupId)">
                            <t t-call="{{ subTemplates.PinList }}">
                                <t t-set="records" t-value="group.records"/>
                            </t>
                        </t>
                    </div>
                </t>
            </t>
            <t t-elif="canDisplayPinList">
                <t t-call="{{ subTemplates.PinList }}">
                    <t t-set="records" t-value="props.model.data.records"/>
                </t>
            </t>
        </div>
    </t>

    `);
registerTemplate("web_map.MapRenderer.PinList", `/web_map/static/src/map_view/map_renderer.xml`, `<t t-name="web_map.MapRenderer.PinList" xml:space="preserve">
        <t t-tag="props.model.metaData.numbering ? 'ol' : 'ul'" t-att-class="{'o-map-renderer--pin-located': !props.model.metaData.numbering}" class="o-map-renderer--pin-list-details ps-0 pb-0 o-map-renderer--handle" t-ref="pinList">
            <t t-call="{{ subTemplates.PinListItems }}"/>
        </t>
    </t>

    `);
registerTemplate("web_map.MapRenderer.PinListItems", `/web_map/static/src/map_view/map_renderer.xml`, `<t t-name="web_map.MapRenderer.PinListItems" xml:space="preserve">
        <t t-foreach="records" t-as="record" t-key="record.id">
            <t t-set="latitude" t-value="record.partner and record.partner.partner_latitude"/>
            <t t-set="longitude" t-value="record.partner and record.partner.partner_longitude"/>
            <li t-att-data-id="record.id" t-if="latitude and longitude" t-on-click.prevent="() =&gt; this.centerAndOpenPin(record)" class="cursor-pointer d-flex align-items-center justify-content-between o-map-renderer--pin-located py-1">
                <span class="text-truncate flex-grow-1"> <t t-if="props.model.metaData.numbering" t-esc="record_index + 1 + '.'"/> <t t-esc="record.display_name"/> </span>
                <span class="o_row_handle oi oi-draggable" t-if="this.props.model.canResequence" t-on-click.stop=""/>
            </li>
        </t>
    </t>

    `);
registerTemplate("web_map.MapRenderer.RountingUnavailable", `/web_map/static/src/map_view/map_renderer.xml`, `<t t-name="web_map.MapRenderer.RountingUnavailable" xml:space="preserve">
        <div class="alert alert-warning alert-dismissible col col-md-10 px-5 mb-0 text-center position-absolute o-map-renderer--alert" role="status">
            <strong>Unsuccessful routing request: </strong>
            <t t-esc="props.model.data.routingError"/>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"/>
        </div>
    </t>

    `);
registerTemplate("web_map.marker", `/web_map/static/src/map_view/map_renderer.xml`, `<t t-name="web_map.marker" xml:space="preserve">
        <div t-att-style="color and ('color:' + color)">
            <t t-call="web_map.pinSVG"/>
            <t t-if="numbering" t-call="web_map.markerNumber"/>
            <t t-elif="isMulti" t-call="web_map.markerBadge"/>
        </div>
    </t>

    `);
registerTemplate("web_map.markerBadge", `/web_map/static/src/map_view/map_renderer.xml`, `<t t-name="web_map.markerBadge" xml:space="preserve">
        <div class="badge text-bg-danger rounded-pill o-map-renderer--marker-badge d-flex justify-content-center" t-att-style="color and \`background-color: \${color} !important\`">
            <t t-esc="count"/>
        </div>
    </t>

    `);
registerTemplate("web_map.markerNumber", `/web_map/static/src/map_view/map_renderer.xml`, `<t t-name="web_map.markerNumber" xml:space="preserve">
        <p class="o-map-renderer--marker-number position-relative text-center">
            <t t-esc="number"/>
            <t t-if="count gt 1">
                <t t-call="web_map.markerBadge"/>
            </t>
        </p>
    </t>

    `);
registerTemplate("web_map.markerPopup", `/web_map/static/src/map_view/map_renderer.xml`, `<t t-name="web_map.markerPopup" xml:space="preserve">
        <div>
            <table class="o-map-renderer--popup-table align-top">
                <thead>
                    <tr>
                        <th colspan="2"/>
                        <th/>
                        <th/>
                    </tr>
                </thead>
                <tbody>
                    <tr t-foreach="data" t-as="field" t-key="field.id">
                        <td class="o-map-renderer--popup-table-content-name fw-bold text-nowrap align-baseline">
                            <t t-esc="field.string"/>
                        </td>
                        <td class="o-map-renderer--popup-table-space"/>
                        <td class="o-map-renderer--popup-table-content-value align-baseline">
                            <t t-esc="field.value"/>
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="o-map-renderer--popup-buttons d-flex align-item-end justify-content-start mt8">
                <t t-if="hasFormView">
                    <button class="btn btn-primary o-map-renderer--popup-buttons-open">
                        Open
                    </button>
                </t>
                <div class="o-map-renderer--popup-buttons-divider d-inline-block h-auto"/>
                <a class="btn btn-primary" role="button" t-att-href="url" target="_blank">
                    Navigate to
                </a>
            </div>
        </div>
    </t>

    `);
registerTemplate("web_map.pinSVG", `/web_map/static/src/map_view/map_renderer.xml`, `<t t-name="web_map.pinSVG" xml:space="preserve">
        <t t-if="numbering">
            <t t-call="web_map.pinNoCircleSVG"/>
        </t>
        <t t-else="">
            <t t-call="web_map.pinCircleSVG"/>
        </t>
    </t>

    `);
registerTemplate("web_map.pinCircleSVG", `/web_map/static/src/map_view/map_renderer.xml`, `<t t-name="web_map.pinCircleSVG" xml:space="preserve">
        <svg xmlns="http://www.w3.org/2000/svg" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 60 78.6" style="enable-background:new 0 0 60 78.6;" xml:space="preserve">
            <style type="text/css">
                .st0{opacity:0.3;enable-background:new;}
                .st1{fill:currentColor;stroke:#1A1919;stroke-width:3;stroke-miterlimit:10;}
            </style>
            <g>
                <g id="Layer_2_1_">
                    <g id="Layer_1-2">
                        <path class="st0" d="M32.5,4C17.3,4,5,16.3,5,31.5c0,18.2,23.4,44.6,24.4,45.7c1.5,1.7,4.1,1.8,5.8,0.3c0.1-0.1,0.2-0.2,0.3-0.3                             c1-1.1,24.4-27.4,24.4-45.7C60,16.3,47.7,4,32.5,4z M32.5,42.4c-6.3,0-11.4-5.1-11.4-11.5s5.1-11.5,11.5-11.5S44,24.6,44,31v0                             C43.9,37.3,38.8,42.4,32.5,42.4z"/>
                        <path class="st1" d="M28.8,1.8c-14.9,0-27,12.1-27.1,27.1c0,18.5,24.2,45.7,25.3,46.9c0.9,1,2.4,1.1,3.4,0.2                             c0.1-0.1,0.1-0.1,0.2-0.2c1-1.1,25.3-28.3,25.3-46.9C55.9,13.9,43.7,1.8,28.8,1.8z M28.8,40.3c-6.3,0-11.5-5.1-11.5-11.4                             s5.1-11.5,11.4-11.5s11.5,5.1,11.5,11.4v0C40.2,35.2,35.1,40.3,28.8,40.3z"/>
                    </g>
                </g>
            </g>
        </svg>
    </t>

    `);
registerTemplate("web_map.pinNoCircleSVG", `/web_map/static/src/map_view/map_renderer.xml`, `<t t-name="web_map.pinNoCircleSVG" xml:space="preserve">
        <svg xmlns="http://www.w3.org/2000/svg" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 61 78.9" style="enable-background:new 0 0 61 78.9;" xml:space="preserve">
            <style type="text/css">
                .st0{opacity:0.3;enable-background:new;}
                .st1{fill:currentColor;stroke:#1A1919;stroke-width:3;stroke-miterlimit:10;}
            </style>
            <g>
                <g id="Layer_2_1_">
                    <g id="Layer_1-2">
                        <path class="st0" d="M33.5,4C18.3,4,6,16.3,6,31.5c0,18.2,23.4,44.6,24.4,45.7c1.5,1.7,4.1,1.8,5.8,0.3c0.1-0.1,0.2-0.2,0.3-0.3                             c1-1.1,24.4-27.4,24.4-45.7C61,16.3,48.7,4,33.5,4z"/>
                        <path class="st1" d="M28.7,1.7c-14.9,0-27,12.1-27.1,27.1c0,18.5,24.2,45.7,25.3,46.9c0.9,1,2.4,1.1,3.4,0.2                             c0.1-0.1,0.1-0.1,0.2-0.2c1-1.1,25.3-28.3,25.3-46.9C55.8,13.8,43.6,1.7,28.7,1.7z"/>
                    </g>
                </g>
            </g>
        </svg>
    </t>

`);
registerTemplate("web_gantt.GanttConnector", `/web_gantt/static/src/gantt_connector.xml`, `<t t-name="web_gantt.GanttConnector" xml:space="preserve">
        <t t-set="xmlAttributes" t-value="{ version: '1.1', xmlns: 'http://www.w3.org/2000/svg' }"/>
        <svg t-if="sourcePoint and targetPoint" t-ref="root" t-att-data-connector-id="id" class="o_gantt_connector position-absolute start-0 top-0 w-100 h-100" t-att-class="{ o_connector_highlighted: highlighted }" pointer-events="none" t-att="xmlAttributes">
            <t t-set="strokeColor" t-value="style.stroke.color"/>
            <t t-set="outlineStrokeColor" t-value="style.outlineStroke.color"/>

            <defs>
                <marker t-att-id="id" markerHeight="6" markerWidth="6" markerUnits="strokeWidth" orient="auto" refX="9" refY="6" stroke-linejoin="round" viewBox="0 0 12 12">
                    <t t-call="web_gantt.ConnectorStrokeHead">
                        <t t-set="color" t-value="strokeColor"/>
                        <t t-set="width" t-value="style.stroke.width"/>
                    </t>
                </marker>
            </defs>

            <t t-call="web_gantt.ConnectorStroke">
                <t t-set="class" t-value="'o_connector_stroke_hover_ease'"/>
                <t t-set="color" t-value="transparent"/>
                <t t-set="width" t-value="style.stroke.width + style.hoverEaseWidth + style.outlineStroke.width"/>
            </t>
            <t t-if="style.outlineStroke.width gt 0">
                <t t-call="web_gantt.ConnectorStroke">
                    <t t-set="class" t-value="'o_connector_stroke_outline'"/>
                    <t t-set="color" t-value="outlineStrokeColor"/>
                    <t t-set="width" t-value="style.stroke.width + style.outlineStroke.width"/>
                </t>
            </t>
            <t t-call="web_gantt.ConnectorStroke">
                <t t-set="class" t-value="'o_connector_stroke'"/>
                <t t-set="color" t-value="strokeColor"/>
                <t t-set="markerEnd" t-value="id"/>
                <t t-set="width" t-value="style.stroke.width"/>
            </t>

            <t t-if="displayButtons">
                <svg class="o_connector_stroke_buttons" width="48" height="16" pointer-events="all" viewBox="0 0 1536 512" t-att="xmlAttributes">
                    <rect fill="transparent" x="0" y="0" width="1536" height="512"/>
                    <g class="o_connector_stroke_button o_connector_stroke_remove_button" t-on-click.stop="onRemoveButtonClick">
                        <rect fill="white" x="532" y="20" width="472" height="472" rx="236" ry="236"/>
                        <g transform="rotate(45,768,256)" pointer-events="none">
                            <rect x="740" y="100" fill="rgb(221, 60, 79)" width="56" height="312"/>
                            <rect x="612" y="228" fill="rgb(221, 60, 79)" width="312" height="56"/>
                        </g>
                    </g>
                </svg>
            </t>
        </svg>
    </t>

    `);
registerTemplate("web_gantt.ConnectorStroke", `/web_gantt/static/src/gantt_connector.xml`, `<t t-name="web_gantt.ConnectorStroke" xml:space="preserve">
        <path fill="none" t-att-stroke="color" t-att-stroke-width="width" t-att-class="class" t-att-marker-end="markerEnd ? \`url(#\${markerEnd})\` : false" t-att-pointer-events="isNew ? 'none' : 'stroke'" t-att-stroke-dasharray="isDashed ? '10 5' : ''"/>
    </t>

    `);
registerTemplate("web_gantt.ConnectorStrokeHead", `/web_gantt/static/src/gantt_connector.xml`, `<t t-name="web_gantt.ConnectorStrokeHead" xml:space="preserve">
        <path d="M2,2 L10,6 L2,10 L6,6 L2,2" class="o_connector_stroke_head" t-att-fill="color" t-att-stroke="color" t-att="xmlAttributes"/>
    </t>

`);
registerTemplate("web_gantt.GanttController", `/web_gantt/static/src/gantt_controller.xml`, `<t t-name="web_gantt.GanttController" xml:space="preserve">
        <div t-att-class="className" t-ref="root">
            <Layout className="model.useSampleModel ? 'o_view_sample_data' : ''" display="props.display">
                <t t-set-slot="control-panel-create-button">
                    <button t-if="model.metaData.canCreate" class="o_gantt_button_add btn btn-primary" data-hotkey="r" t-on-click="onNewClicked">
                        New
                    </button>
                </t>
                <t t-set-slot="control-panel-additional-actions">
                    <CogMenu/>
                </t>
                <t t-set-slot="layout-buttons">
                    <t t-call="{{ props.buttonTemplate }}"/>
                </t>
                <t t-set-slot="layout-actions">
                    <SearchBar toggler="searchBarToggler"/>
                </t>
                <t t-set-slot="control-panel-navigation-additional">
                    <t t-component="searchBarToggler.component" t-props="searchBarToggler.props"/>
                </t>
                <t t-set-slot="default" t-slot-scope="layout">
                    <t t-if="showNoContentHelp">
						<ActionHelper noContentHelp="props.info.noContentHelp"/>
                    </t>
                    <t t-component="props.Renderer" class="model.useSampleModel ? 'o_sample_data_disabled' : ''" model="model" arch="props.arch" create.bind="create" openDialog.bind="openDialog" scrollPosition="props.scrollPosition" multiCreateValues="props.multiCreateValues" contentRef="layout.contentRef" context="props.context"/>
                </t>
            </Layout>
        </div>
    </t>

    `);
registerTemplate("web_gantt.GanttView.Buttons", `/web_gantt/static/src/gantt_controller.xml`, `<t t-name="web_gantt.GanttView.Buttons" xml:space="preserve"/>

`);
registerTemplate("web_gantt.GanttMultiSelectionButtons", `/web_gantt/static/src/gantt_multi_selection_buttons.xml`, `<t t-name="web_gantt.GanttMultiSelectionButtons" t-inherit="web.MultiSelectionButtons" t-inherit-mode="primary" xml:space="preserve">
        <button t-ref="addButton" position="after">
            <button t-if="this.props.reactive.onPlan" class="btn btn-secondary" data-tooltip="Plan" t-on-click="() =&gt; this.props.reactive.onPlan()">
                Plan
            </button>
        </button>
    </t>

`);
registerTemplate("web_gantt.GanttPopover", `/web_gantt/static/src/gantt_popover.xml`, `<t t-name="web_gantt.GanttPopover" xml:space="preserve">
        <div t-ref="root" class="o_gantt_popover">
            <div t-if="displayPopoverHeader" class="popover-header d-flex justify-content-between py-2 pe-2">
                <h4 class="p-0 pt-1">
                    <t t-esc="props.title"/>
                </h4>
                <span class="ms-4 mt-1 me-2 cursor-pointer" t-on-click.stop="props.close">
                    <i class="fa fa-close"/>
                </span>
            </div>
            <div class="popover-body">
                <t t-if="templates.body">
                    <t t-call="{{ templates.body }}" t-call-context="renderingContext"/>
                </t>
                <t t-else="">
                    <Record t-props="recordProps" t-slot-scope="data">
                        <t t-component="props.KanbanRecord" t-props="kanbanRecordProps" record="data.record"/>
                    </Record>
                </t>
            </div>
            <div class="popover-footer d-flex justify-content-between">
                <div t-if="(props.displayGenericButtons and props.buttons) or templates.footer" class="p-3 pt-0 d-flex gap-1">
                    <t t-if="props.displayGenericButtons and props.buttons">
                        <t t-foreach="props.buttons" t-as="button" t-key="button_index">
                            <button t-att-class="button.class" t-on-click="() =&gt; this.onClick(button)" t-esc="button.text"/>
                        </t>
                    </t>
                    <t t-if="templates.footer">
                        <t t-call="{{ templates.footer }}" t-call-context="renderingContext"/>
                    </t>
                </div>
                <span t-if="!displayPopoverHeader" class="p-3 pt-0 mt-1 ms-auto cursor-pointer" t-on-click.stop="props.close">
                    <i class="fa fa-close"/>
                </span>
            </div>
        </div>
    </t>

`);
registerTemplate("web_gantt.GanttPopoverInDialog", `/web_gantt/static/src/gantt_popover_in_dialog.xml`, `<t t-name="web_gantt.GanttPopoverInDialog" xml:space="preserve">
      <Dialog title="props.dialogTitle" footer="false">
          <t t-component="props.component" t-props="componentProps"/>
      </Dialog>
    </t>
`);
registerTemplate("web_gantt.GanttRenderer", `/web_gantt/static/src/gantt_renderer.xml`, `<t t-name="web_gantt.GanttRenderer" xml:space="preserve">
        <GanttRendererControls t-props="this.controlsProps">
            <t t-set-slot="multi_selection_buttons">
                <MultiSelectionButtons reactive="this.multiSelectionButtonsReactive"/>
            </t>
        </GanttRendererControls>
        <div t-ref="grid" class="o_gantt_renderer o_renderer bg-view" t-att-class="{ o_has_row_headers: hasRowHeaders, 'pe-auto': isDragging }" t-att-style="getGridStyle()" t-on-pointermove="throttledComputeHoverParams" t-on-pointerleave="onPointerLeave">
            <t t-call="{{ constructor.headerTemplate }}"/>
            <t t-if="hasRowHeaders">
                <div class="o_gantt_row_headers o_gantt_row_sidebar o_gantt_grid_rows position-sticky start-0 bg-view">
                    <t t-foreach="rowsToRender" t-as="row" t-key="row.id">
                        <t t-call="{{ constructor.rowHeaderTemplate }}"/>
                    </t>
                </div>
            </t>
            <div t-ref="cellContainer" class="o_gantt_cells o_gantt_grid_rows o_gantt_grid_columns position-relative">
                <t t-foreach="rowsToRender" t-as="row" t-key="row.id">
                    <t t-call="{{ constructor.rowContentTemplate }}"/>
                </t>
                <t t-foreach="pillsToRender" t-as="pill" t-key="pill.id">
                    <t t-set="row" t-value="getRowFromPill(pill)"/>
                    <t t-if="row.isGroup">
                        <t t-call="{{ constructor.groupPillTemplate }}"/>
                    </t>
                    <t t-else="">
                        <t t-call="{{ constructor.pillTemplate }}"/>
                    </t>
                </t>
                <t t-if="shouldRenderConnectors()">
                    <t t-foreach="connectorsToRender" t-as="connector" t-key="connector.id">
                        <GanttConnector reactive="connector" onRemoveButtonClick="() =&gt; this.onRemoveButtonClick(connector.id)" onConnectorHover="() =&gt; this.onConnectorHover()"/>
                    </t>
                </t>
                <GanttTimeDisplayBadge reactive="timeDisplayBadgeReactiveStart"/>
                <GanttTimeDisplayBadge reactive="timeDisplayBadgeReactiveStop"/>
            </div>
            <t t-if="totalRow">
                <t t-call="{{ constructor.totalRowTemplate }}"/>
            </t>
        </div>
    </t>

    `);
registerTemplate("web_gantt.GanttRenderer.Header", `/web_gantt/static/src/gantt_renderer.xml`, `<t t-name="web_gantt.GanttRenderer.Header" xml:space="preserve">
        <t t-if="hasRowHeaders">
            <b class="o_gantt_title d-flex align-items-center justify-content-center bg-100 position-sticky start-0 p-2 border-end" t-esc="model.metaData.string"/>
        </t>
        <div class="o_gantt_header_groups o_gantt_grid_columns bg-100 position-sticky">
            <t t-foreach="columnsGroups" t-as="columnGroup" t-key="columnGroup_index">
                <div class="o_gantt_header_title position-sticky d-flex align-items-center ps-2 overflow-hidden bg-100" t-att-style="getGroupHeaderStyle({column: columnGroup.grid.column})" t-att-title="!columnGroup.isFolded and model.metaData.scale.groupHeaderTitle(columnGroup.start, env)">
                    <t t-if="!columnGroup.isFolded" t-esc="model.metaData.scale.groupHeaderFormatter(columnGroup.start, env)"/>
                </div>
            </t>
        </div>
        <div class="o_gantt_header_columns o_gantt_grid_columns bg-view position-sticky">
            <t t-foreach="columns" t-as="column" t-key="column.index">
                <div class="o_gantt_header_cell d-flex align-items-center justify-content-center py-2" t-att-class="{                         o_gantt_today: column.isToday,                         'bg-100': !column.isToday,                         o_gantt_foldable: column.isFoldable,                         o_gantt_foldable_stop: column.isFoldable === 'stop',                         o_gantt_header_folded: column.isFolded,                     }" t-att-data-column-index="column.index" t-att-style="getGridPosition({column: column.grid.column})" t-on-click="() =&gt; column.isFoldable and this.toggleFoldableColumn(column, !column.isFolded)" t-att-title="!column.isFolded and model.metaData.scale.colHeaderTitle(column.start, env)">
                    <t t-if="column.isFolded">
                        <div class="o_gantt_header_cell_title gap-1">
                            <i class="fa fa-caret-left"/><i class="fa fa-caret-right"/>
                        </div>
                    </t>
                    <t t-else="">
                        <div class="o_gantt_fold_icons gap-1">
                            <i class="fa fa-caret-right"/><i class="fa fa-caret-left"/>
                        </div>
                        <div class="o_gantt_header_cell_title" t-if="'colHeaderFormatter' in model.metaData.scale">
                            <t t-esc="model.metaData.scale.colHeaderFormatter(column.start, env)"/>
                        </div>
                        <small t-else="" class="o_gantt_header_cell_title text-center">
                            <t t-if="is24HourFormat">
                                <t t-esc="column.start.toFormat('H')"/>
                            </t>
                            <t t-else="">
                                <t t-esc="column.start.toFormat('h')"/>
                                <div class="d-xl-inline-block" t-esc="column.start.toFormat('a').toLowerCase()"/>
                            </t>
                        </small>
                    </t>
                </div>
            </t>
        </div>
    </t>

    `);
registerTemplate("web_gantt.GanttRenderer.ConnectorCreator", `/web_gantt/static/src/gantt_renderer.xml`, `<t t-name="web_gantt.GanttRenderer.ConnectorCreator" xml:space="preserve">
        <div class="o_connector_creator_wrapper position-absolute w-100" t-attf-class="o_connector_creator_wrapper_{{ alignment.vertical }} {{ '_color' in pill ? 'o_gantt_color_' + pill._color : '' }}">
            <div class="o_connector_creator position-absolute" t-attf-class="o_connector_creator_{{ alignment.vertical }} o_connector_creator_{{ alignment.horizontal }}">
                <div class="o_connector_creator_bullet position-absolute z-n1 rounded-circle"/>
            </div>
        </div>
    </t>

    `);
registerTemplate("web_gantt.GanttRenderer.RowHeader", `/web_gantt/static/src/gantt_renderer.xml`, `<t t-name="web_gantt.GanttRenderer.RowHeader" xml:space="preserve">
        <div class="o_gantt_row_header o_gantt_row_sidebar position-sticky border-end start-0 bg-view align-items-center" t-att-class="{                 o_sample_data_disabled: isDisabled(row),                 o_gantt_row_sidebar_empty: !row.name,                 o_gantt_group: row.isGroup,                 o_gantt_hoverable: isHoverable(row),                 o_mobile_progress_bar: row.progressBar and isTouchDevice,                 o_group_open: !model.isClosed(row.id),             }" t-att-style="getGridPosition({ row: row.grid.row })" t-att-data-row-id="row.id" t-on-click.synthetic="() =&gt; row.isGroup ? this.model.toggleRow(row.id) : this.focusFirstPill(row.id)">
            <div class="o_gantt_row_title d-flex align-items-center h-100 w-100 pe-1" t-att-class="{ 'fw-bold': row.isGroup }" t-att-style="getRowTitleStyle(row)" t-att-title="row.name or ''">
                <i t-if="row.isGroup" t-attf-class="o_group_caret fa fa-fw me-1 fa-caret-{{ model.isClosed(row.id) ? 'right' : 'down' }}"/>
                <span t-if="row.thumbnailUrl and row.resId" class="o_gantt_row_thumbnail_wrapper" t-att-class="{ 'me-1' : row.isGroup }">
                    <img t-att-src="row.thumbnailUrl" class="o_gantt_row_thumbnail o_avatar rounded"/>
                </span>
                <span class="text-truncate w-0 flex-grow-1">
                    <t t-esc="row.name"/>
                </span>
            </div>
            <t t-if="row.progressBar">
                <GanttRowProgressBar t-props="getProgressBarProps(row)"/>
            </t>
        </div>
    </t>

    `);
registerTemplate("web_gantt.GanttRenderer.RowContent", `/web_gantt/static/src/gantt_renderer.xml`, `<t t-name="web_gantt.GanttRenderer.RowContent" xml:space="preserve">

        <t t-foreach="columns" t-as="column" t-key="column.index">
            <t t-set="col" t-value="column.grid.column[0]"/>
            <div class="o_gantt_cell" t-att-class="ganttCellAttClass(row, column)" t-attf-style="{{ getGridPosition({ column: column.grid.column, row: row.grid.row }) }};{{ row.cellColors[column.index] || '' }}" t-att-data-row-id="row.id" t-att-data-col="col" t-on-click.synthetic="(ev) =&gt; row.isGroup and !column.isFolded ? this.model.toggleRow(row.id) : this.onCellClicked(row.id, column, row.grid.row)"/>
        </t>
    </t>

    `);
registerTemplate("web_gantt.GanttRenderer.Pill", `/web_gantt/static/src/gantt_renderer.xml`, `<t t-name="web_gantt.GanttRenderer.Pill" xml:space="preserve">
        <t t-set="renderConnectors" t-value="shouldRenderRecordConnectors(pill.record)"/>
        <div class="o_gantt_pill_wrapper" t-att-class="{                 o_sample_data_disabled: isDisabled(row),                 o_draggable: !pill.disableDrag,                 o_undraggable: pill.disableDrag,                 o_resizable: !pill.disableStartResize or !pill.disableStopResize,                 'position-relative': renderConnectors             }" t-att-style="getGridPosition(pill.grid)" t-att-data-pill-id="pill.id">
            <t t-if="renderConnectors" t-call="{{ constructor.connectorCreatorTemplate }}">
                <t t-set="alignment" t-value="getConnectorCreatorAlignment('top')"/>
            </t>
            <div class="o_gantt_pill position-relative h-100 d-flex align-items-center rounded-2" t-att-class="pill.className" t-on-click.synthetic="(ev) =&gt; this.onPillClicked(ev, pill)">
                <span t-if="pill._progress" class="position-absolute h-100 o_gantt_progress" t-attf-style="width:{{ pill._progress }}%;"/>
                <span class="o_gantt_pill_title text-truncate mx-1"><t t-esc="pill.displayName"/></span>
                <div t-if="pill.disableDrag" class="o_gantt_lock fa fa-lock ms-auto me-2"/>
            </div>
            <t t-if="renderConnectors" t-call="{{ constructor.connectorCreatorTemplate }}">
                <t t-set="alignment" t-value="getConnectorCreatorAlignment('bottom')"/>
            </t>
        </div>
    </t>

    `);
registerTemplate("web_gantt.GanttRenderer.GroupPill", `/web_gantt/static/src/gantt_renderer.xml`, `<t t-name="web_gantt.GanttRenderer.GroupPill" xml:space="preserve">
        <div class="o_gantt_pill_wrapper o_gantt_group_pill align-items-center" t-att-class="{                 o_sample_data_disabled: isDisabled(row),                 o_group_open: !model.isClosed(row.id),             }" t-att-style="getGridPosition(pill.grid)">
            <div class="o_gantt_pill o_gantt_consolidated_pill position-relative overflow-visible" t-att-class="pill.className" t-att-title="pill.displayName">
                <span t-if="pill._progress" class="position-absolute h-100 o_gantt_progress" t-attf-style="width:{{ pill._progress }}%;"/>
            </div>
            <span class="o_gantt_pill_title bg-view text-truncate px-1 z-1" t-esc="pill.displayName"/>
        </div>
    </t>

    `);
registerTemplate("web_gantt.GanttRenderer.TotalRow", `/web_gantt/static/src/gantt_renderer.xml`, `<t t-name="web_gantt.GanttRenderer.TotalRow" xml:space="preserve">
        <t t-if="hasRowHeaders">
            <div class="o_gantt_row_total o_gantt_row_sidebar border-end position-sticky start-0 bg-view d-flex justify-content-end" t-att-class="{ o_sample_data_disabled: isDisabled() }">
                <h4 class="o_gantt_row_title d-flex align-items-center pe-3 my-0 fw-bold" t-att-title="totalRow.name" t-esc="totalRow.name"/>
            </div>
        </t>
        <div class="o_gantt_row_total o_gantt_grid_columns bg-view">
            <t t-foreach="columns" t-as="column" t-key="column.index">
                <div class="o_gantt_cell" t-att-class="{ o_gantt_today: column.isToday, o_sample_data_disabled: isDisabled(), o_gantt_cell_folded: column.isFolded }" t-att-style="getGridPosition({ column: column.grid.column, row: [1, 2] })" t-on-click="() =&gt; column.isFolded and this.toggleFoldableColumn(column, false)"/>
            </t>
            <t t-foreach="totalRow.pills" t-as="pill" t-key="pill.id">
                <div class="o_gantt_pill_wrapper position-relative p-0 h-100 d-flex align-items-end" t-att-class="{ o_sample_data_disabled: isDisabled() }" t-att-style="getGridPosition({ column: pill.grid.column, row: [1, 2] })">
                    <div class="o_gantt_pill o_gantt_consolidated_pill w-100 d-flex align-items-end justify-content-center" t-att-title="pill.displayName" t-attf-style="height: {{ totalRow.factor * pill.aggregateValue }}%;">
                        <span class="o_gantt_consolidated_pill_title bg-view text-truncate px-1 mb-1" t-att-class="{ 'o_gantt_consolidated_pill_small': this.isPillSmall(pill) }" t-esc="pill.displayName"/>
                    </div>
                </div>
            </t>
        </div>
    </t>

`);
registerTemplate("web_gantt.GanttRendererControls", `/web_gantt/static/src/gantt_renderer_controls.xml`, `<t t-name="web_gantt.GanttRendererControls" xml:space="preserve">
        <div class="o_gantt_renderer_controls d-inline-flex d-print-none flex-wrap column-gap-1 align-items-center w-100 bg-view border-bottom sticky-top start-0" t-att-class="{ 'px-3': !env.isSmall, 'py-1': env.isSmall }">
            <t t-call="{{ constructor.rangeMenuTemplate }}"/>
            <hr t-if="env.isSmall" class="my-0 w-100"/>
            <button class="o_gantt_button_today btn btn-secondary" t-att-class="{ 'ms-3': env.isSmall }" title="Focus Today" data-hotkey="t" t-on-click="onTodayClicked">
                Today
            </button>
            <t t-if="env.isSmall">
                <div class="flex-grow-1 w-0"/>
                <Dropdown>
                    <button class="btn btn-secondary me-3" aria-label="Toolbar menu">
                        <i class="fa fa-cog"/>
                    </button>
                    <t t-set-slot="content">
                        <t t-call="{{ constructor.toolbarContentTemplate }}"/>
                    </t>
                </Dropdown>
            </t>
            <t t-else="" t-call="{{ constructor.toolbarContentTemplate }}"/>
            <div t-if="displayRescheduleMethods">
                <Dropdown>
                    <button id="reschedule-method" class="btn btn-secondary o-dropdown-caret">
                        <t t-esc="model.metaData.rescheduleMethods[state.rescheduleMethod]"/>
                    </button>
                    <t t-set-slot="content">
                        <t t-foreach="Object.keys(model.metaData.rescheduleMethods)" t-as="method" t-key="method">
                            <DropdownItem class="{ active: method === state.rescheduleMethod }" onSelected.bind="() =&gt; this.selectRescheduleMethod(method)">
                                <t t-esc="model.metaData.rescheduleMethods[method]"/>
                            </DropdownItem>
                        </t>
                    </t>
                </Dropdown>
            </div>
            <t t-slot="multi_selection_buttons"/>
        </div>
    </t>

    `);
registerTemplate("web_gantt.GanttRendererControls.ToolbarContent", `/web_gantt/static/src/gantt_renderer_controls.xml`, `<t t-name="web_gantt.GanttRendererControls.ToolbarContent" xml:space="preserve">
        <t t-if="!env.isSmall">
            <div class="btn-toolbar gap-1" role="toolbar" name="ganttToolbar">
                <button class="btn btn-secondary fa" t-att-class="{ 'fa-compress': model.displayParams.displayMode === 'sparse', 'fa-expand': model.displayParams.displayMode === 'dense'  }" t-att-title="model.displayParams.displayMode === 'dense' ? 'Activate sparse mode' : 'Activate dense mode'" t-on-click="model.toggleDisplayMode.bind(model)">
                </button>
                <div class="btn-group" t-att-class="{ invisible: !props.displayExpandCollapseButtons }" name="expandCollapseButtons">
                    <t t-if="model.rowsAreExpanded">
                        <button class="o_gantt_button_collapse_rows btn btn-secondary" title="Collapse rows" t-on-click="model.collapseRows.bind(model)">
                            <i class="fa fa-caret-down"/>
                        </button>
                    </t>
                    <t t-else="">
                        <button class="o_gantt_button_expand_rows btn btn-secondary" title="Expand rows" t-on-click="model.expandRows.bind(model)">
                            <i class="fa fa-caret-right"/>
                        </button>
                    </t>
                </div>
            </div>
        </t>
        <t t-else="">
            <DropdownItem onSelected="model.toggleDisplayMode.bind(model)">
                <t t-if="model.displayParams.displayMode === 'dense'">
                    <i class="fa fa-fw fa-expand"/>
                    <span class="ms-1">Activate sparse mode</span>
                </t>
                <t t-else="">
                    <i class="fa fa-fw fa-compress"/>
                    <span class="ms-1">Activate dense mode</span>
                </t>
            </DropdownItem>
            <t t-if="props.displayExpandCollapseButtons">
                <div class="dropdown-divider" role="separator"/>
                <t t-if="model.rowsAreExpanded">
                    <DropdownItem onSelected="model.collapseRows.bind(model)">
                        <i class="fa fa-fw fa-caret-square-o-down"/>
                        <span class="ms-1">Collapse rows</span>
                    </DropdownItem>
                </t>
                <t t-else="">
                    <DropdownItem onSelected="model.expandRows.bind(model)">
                        <i class="fa fa-fw fa-caret-square-o-right"/>
                        <span class="ms-1">Expand rows</span>
                    </DropdownItem>
                </t>
            </t>
        </t>
    </t>

    `);
registerTemplate("web_gantt.GanttRendererControls.RangeMenu", `/web_gantt/static/src/gantt_renderer_controls.xml`, `<t t-name="web_gantt.GanttRendererControls.RangeMenu" xml:space="preserve">
        <div class="btn-group" t-att-class="{ 'ms-3': env.isSmall }">
            <button class="btn btn-secondary" data-hotkey="p" t-on-click="() =&gt; this.selectRange('previous')">
                <i class="oi oi-arrow-left"/>
            </button>
            <button class="btn btn-secondary" data-hotkey="n" t-on-click="() =&gt; this.selectRange('next')">
                <i class="oi oi-arrow-right"/>
            </button>
        </div>
        <GanttScaleSelector t-props="this.getGanttScaleSelectorProps()"/>
    </t>

`);
registerTemplate("web_gantt.GanttRowProgressBar", `/web_gantt/static/src/gantt_row_progress_bar.xml`, `<t t-name="web_gantt.GanttRowProgressBar" xml:space="preserve">
        <span class="o_gantt_progress_bar position-relative h-100 pe-none" t-att-class="\`o_gantt_group_\${status || 'none'}\`">
            <t t-if="props.progressBar.max_value gt 0">
                <span class="bg-opacity-25 position-absolute top-0 end-0 h-100" t-att-class="status and \`bg-\${status}\`" t-attf-style="width:{{ Math.min(props.progressBar.ratio, 100) }}%;"/>
                <span t-if="show" class="position-absolute top-0 end-0 h-100 d-flex align-items-center px-1" t-att-class="status ? \`text-bg-\${status}\` : 'bg-view'">
                    <span class="o_gantt_group_hours" t-esc="\`\${props.progressBar.value_formatted} / \${props.progressBar.max_value_formatted}\`"/>
                </span>
            </t>
            <t t-elif="show">
                <span class="o_gantt_group_hours position-absolute top-0 end-0 h-100 d-flex align-items-center px-1 pe-auto bg-view" t-attf-title="{{ props.progressBar.warning }}">
                    <t t-esc="props.progressBar.value_formatted"/>
                    <t t-if="props.progressBar.warning">
                        <i class="fa fa-exclamation-triangle"/>
                    </t>
                </span>
            </t>
        </span>
    </t>
`);
registerTemplate("web_gantt.GanttScaleSelector", `/web_gantt/static/src/gantt_scale_selector.xml`, `<t t-name="web_gantt.GanttScaleSelector" t-inherit="web.ViewScaleSelector" xml:space="preserve">
        <xpath expr="div" position="attributes">
            <attribute name="class">o_gantt_scale_selector</attribute>
        </xpath>
        <xpath expr="//Dropdown" position="attributes">
            <attribute name="state">this.dropdownState</attribute>
            <attribute name="menuClass">'o_gantt_scale_selector_menu'</attribute>
        </xpath>
        <xpath expr="//DropdownItem" position="replace">
            <t t-if="scale.key === 'custom'">
                <div class="dropdown-divider"/>
                <DropdownItem class="{ 'o_scale_button_custom': true, 'active': this.props.currentScale === 'custom' }" closingMode="'none'">
                    <div class="d-flex align-items-center gap-1">
                        <label>From </label>
                        <span class="o_gantt_picker o_input cursor-pointer px-1" t-ref="start-picker" t-on-click="() =&gt; this.startPicker.open()">
                            <t t-esc="this.getFormattedDate(this.pickerValues.startDate)"/>
                        </span>
                        <label>to </label>
                        <span class="o_gantt_picker o_input cursor-pointer px-1" t-ref="stop-picker" t-on-click="() =&gt; this.stopPicker.open()">
                            <t t-esc="this.getFormattedDate(this.pickerValues.stopDate)"/>
                        </span>
                        <button class="btn btn-sm btn-primary ms-1" t-on-click="() =&gt; this.onApply()">Apply</button>
                    </div>
                </DropdownItem>
            </t>
            <t t-else="">$0</t>
        </xpath>
    </t>

`);
registerTemplate("web_gantt.GanttTimeDisplayBadge", `/web_gantt/static/src/gantt_time_display_badge.xml`, `<t t-name="web_gantt.GanttTimeDisplayBadge" xml:space="preserve">
        <span t-if="props.reactive.position" class="o_gantt_pill_time_display_badge badge rounded-pill bg-view position-fixed" t-attf-class="{{props.reactive.class}}" t-att-style="positionStyle" t-esc="props.reactive.text"/>
    </t>

`);
registerTemplate("web_cohort.CohortView.Buttons", `/web_cohort/static/src/cohort_controller.xml`, `<t t-name="web_cohort.CohortView.Buttons" xml:space="preserve">
    </t>

    `);
registerTemplate("web_cohort.CohortView", `/web_cohort/static/src/cohort_controller.xml`, `<t t-name="web_cohort.CohortView" xml:space="preserve">
        <div t-att-class="props.className" t-ref="root">
            <Layout className="model.useSampleModel ? 'o_view_sample_data' : ''" display="props.display">
                <t t-set-slot="layout-buttons">
                    <t t-call="{{ props.buttonTemplate }}"/>
                </t>
                <t t-set-slot="control-panel-additional-actions">
                    <CogMenu/>
                </t>
                <t t-set-slot="layout-actions">
                    <SearchBar/>
                </t>
                <t t-set="displayNoContent" t-value="                     props.info.noContentHelp !== false and (                         !model.hasData() or model.useSampleModel                     )"/>
                <t t-if="displayNoContent">
					<t t-if="props.info.noContentHelp">
						<ActionHelper noContentHelp="props.info.noContentHelp" showRibbon="model.useSampleModel"/>
                    </t>
                    <t t-else="" t-call="web.NoContentHelper"/>
                </t>
                <t t-component="props.Renderer" class="'o_renderer'" model="model" onRowClicked="(row, middleClick) =&gt; this.onRowClicked(row, middleClick)"/>
            </Layout>
        </div>
    </t>

`);
registerTemplate("web_cohort.CohortRenderer", `/web_cohort/static/src/cohort_renderer.xml`, `<t t-name="web_cohort.CohortRenderer" xml:space="preserve">
        <div class="o_cohort_renderer" t-att-class="props.class">
            <div class="d-flex gap-1 px-3 py-2">
                <div class="btn-group" role="toolbar" aria-label="Main actions">
                    <ReportViewMeasures measures="model.metaData.measures" activeMeasures="[model.metaData.measure]" onMeasureSelected.bind="this.onMeasureSelected"/>
                </div>
                    <div class="btn-group">
                    <ViewScaleSelector scales="scales" currentScale="model.metaData.interval" setScale.bind="setScale"/>
                </div>
                    <div class="btn-group">
                    <button class="btn btn-secondary fa fa-download o_cohort_download_button" title="Download as Excel file" t-att-disabled="!model.hasData() or model.useSampleModel" t-on-click="downloadExcel"/>
                </div>
            </div>
            <t t-set="data" t-value="model.data"/>
            <div t-if="data.rows.length" class="table-responsive">
                <table class="o_data_table table table-bordered text-center mb-0">
                    <thead>
                        <tr>
                            <th rowspan="2" class="text-center align-middle">
                                <t t-esc="model.metaData.dateStartString"/>
                            </th>
                            <th rowspan="2" class="text-center align-middle">
                                <t t-esc="model.metaData.measures[model.metaData.measure].string"/>
                            </th>
                            <th colspan="16" class="text-center align-middle">
                                <t t-esc="model.metaData.dateStopString"/> - By <t t-esc="model.intervals[model.metaData.interval]"/>
                            </th>
                        </tr>
                        <tr>
                            <th t-foreach="range(data.rows[0].columns.length)" t-as="intervalNumber" t-key="intervalNumber" class="text-center align-middle">
                                <t t-if="model.metaData.timeline === 'backward'">
                                    <t t-esc="intervalNumber - (data.rows[0].columns.length - 1)"/>
                                </t>
                                <t t-else="">
                                    +<t t-esc="intervalNumber"/>
                                </t>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr t-foreach="data.rows" t-as="row" t-key="row.date" class="o_cohort_row_clickable" t-custom-click.stop="(ev, isMiddleClick) =&gt; props.onRowClicked(row, isMiddleClick)">
                            <td class="o_cohort_value text-center align-middle p-0">
                                <t t-esc="row.date"/>
                            </td>
                            <td class="o_cohort_value text-center align-middle p-0">
                                <t t-esc="getFormattedValue(row.value)"/>
                            </td>
                            <td t-foreach="row.columns" t-as="col" t-key="col.period" class="text-center align-middle p-0">
                                <t t-set="count" t-value="mode === 'churn' ? (col.churn_value === '-' ? '' : col.churn_value) : (col.value === '-' ? '' : col.value)"/>
                                <t t-set="measure" t-value="model.metaData.measures[model.metaData.measure].string"/>
                                <div class="o_cohort_highlight m-1 rounded p-1" t-att-title="getCellTitle(col.period, measure, count)" t-attf-style="background-color: rgba(0, 160, 157, {{col.percentage/100.0}}); color: {{col.percentage gt 50 and '#FFFFFF' or 'inherit'}}" t-att-class="{o_cohort_value: col.value !== '-'}">
                                    <t t-esc="formatPercentage(col.percentage / 100.0)"/>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                    <tfoot class="fw-bold">
                        <tr>
                            <td class="text-center align-middle">Average</td>
                            <td class="text-center align-middle">
                                <t t-esc="getFormattedValue(data.avg.avg_value)"/>
                            </td>
                            <td t-foreach="data.avg.columns_avg" t-as="col" t-key="col_index" class="text-center align-middle">
                                <t t-if="data.avg.columns_avg[col]['count']">
                                    <t t-esc="formatPercentage(data.avg.columns_avg[col]['percentage'] / (data.avg.columns_avg[col]['count'] * 100.0))"/>
                                </t>
                            </td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </t>

`);
registerTemplate("documents.DocumentsActivityController", `/documents/static/src/views/activity/documents_activity_controller.xml`, `<t t-name="documents.DocumentsActivityController" t-inherit="mail.ActivityController" t-inherit-mode="primary" xml:space="preserve">
        <xpath expr="//div" position="attributes">
            <attribute name="t-ref">root</attribute>
        </xpath>
        <xpath expr="//CogMenu" position="replace"/>
    </t>
`);
registerTemplate("documents.DocumentsActivityRenderer", `/documents/static/src/views/activity/documents_activity_renderer.xml`, `<t t-name="documents.DocumentsActivityRenderer" xml:space="preserve">
        <div class="o_activity_view o_documents_view h-100 w-100 d-flex" t-ref="root">
            <div class="flex-grow-1 overflow-auto d-flex">
                <t t-if="!props.activityTypes.length" t-call="web.NoContentHelper"/>
                <table t-else="" class="table table-bordered mb-5 bg-view o_activity_view_table flex-grow-1">
                    <t t-call="mail.ActivityViewHeader"/>
                    <t t-call="mail.ActivityViewBody"/>
                    <t t-call="mail.ActivityViewFooter"/>
                </table>
                <DocumentsFileViewer parentRoot="root" t-props="getDocumentsAttachmentViewerProps()"/>
                <DocumentsRightPanel nbViewItems="getNbViewItems()"/>
            </div>
        </div>
    </t>
`);
registerTemplate("web_hierarchy.HierarchyCard", `/web_hierarchy/static/src/hierarchy_card.xml`, `<t t-name="web_hierarchy.HierarchyCard" xml:space="preserve">
        <div class="o_hierarchy_node_container d-flex flex-column" t-att-class="classNames" t-att-data-node-id="props.node.id">
            <div class="o_hierarchy_node_button_container w-100 d-flex justify-content-end">
                <button t-if="props.node.canShowParentNode" name="hierarchy_search_parent_node" class="btn p-0" t-on-click.synthetic="onClickArrowUp">
                    <i class="fa fa-chevron-up"/>
                </button>
            </div>
            <div class="o_hierarchy_node w-100 h-100 d-flex flex-column justify-content-between border" t-att-class="{                     'border-bottom-0': props.node.nodes.length or props.node.canShowChildNodes,                 }" t-att-data-node-id="props.node.id" t-custom-click.synthetic="onGlobalClick">
                <div class="o_hierarchy_node_content">
                    <Record resModel="props.node.model.resModel" resId="props.node.resId" fields="props.node.model.fields" activeFields="props.node.model.activeFields" values="props.node.data" t-slot-scope="data">
                        <t t-call="{{ templates['hierarchy-box'] }}" t-call-context="getRenderingContext(data)"/>
                    </Record>
                </div>
                <button t-if="props.node.nodes.length or props.node.canShowChildNodes" name="hierarchy_search_subsidiaries" class="o_hierarchy_node_button btn rounded-0 d-grid" t-att-class="{                             'btn-primary': !props.node.nodes.length,                             'btn-secondary': props.node.nodes.length &gt; 0,                         }" t-on-click.synthetic="onClickArrowDown">
                    <t t-if="!props.node.nodes.length">
                        <span style="grid-column: 2;">
                            Unfold
                        </span>
                        <span class="text-end" style="grid-column: 3;">
                            <t t-out="props.node.childResIds.length"/>
                            <i class="fa ps-1" t-att-class="props.archInfo.icon"/>
                        </span>
                    </t>
                    <t t-else="">
                        <span style="grid-column: 2;">
                            Fold
                        </span>
                    </t>
                </button>
            </div>
        </div>
    </t>

`);
registerTemplate("web_hierarchy.HierarchyButtons", `/web_hierarchy/static/src/hierarchy_controller.xml`, `<t t-name="web_hierarchy.HierarchyButtons" xml:space="preserve">
        <div class="d-flex o_grid_buttons">
            <div class="me-2" t-if="props.archInfo.activeActions.create and (!props.archInfo.createInline or displayNoContent)">
                <button class="btn btn-primary o_hierarchy_button_add" type="button" t-on-click="props.createRecord">
                    New
                </button>
            </div>
        </div>
    </t>
    `);
registerTemplate("web_hierarchy.HierarchyView", `/web_hierarchy/static/src/hierarchy_controller.xml`, `<t t-name="web_hierarchy.HierarchyView" xml:space="preserve">
        <div t-attf-class="o_hierarchy_view {{ isMobile ? 'o_action_delegate_scroll' : '' }} {{ props.className }}" t-ref="root">
            <Layout className="(model.useSampleModel ? 'o_view_sample_data' : '') + ' d-flex'" display="props.display">
                <t t-set-slot="control-panel-additional-actions">
                    <CogMenu/>
                </t>
                <t t-set-slot="layout-buttons">
                    <t t-call="{{ props.buttonTemplate }}"/>
                </t>
                <t t-set-slot="layout-actions">
                    <SearchBar toggler="searchBarToggler"/>
                </t>
                <t t-set-slot="control-panel-navigation-additional">
                    <t t-component="searchBarToggler.component" t-props="searchBarToggler.props"/>
                </t>
                <t t-set-slot="default" t-slot-scope="layout">
                <t t-if="displayNoContent">
					<ActionHelper noContentHelp="props.info.noContentHelp"/>
                </t>
                    <t t-component="props.Renderer" model="model" openRecord.bind="openRecord" archInfo="props.archInfo"/>
                </t>
            </Layout>
        </div>
    </t>
`);
registerTemplate("web_hierarchy.HierarchyRenderer", `/web_hierarchy/static/src/hierarchy_renderer.xml`, `<t t-name="web_hierarchy.HierarchyRenderer" xml:space="preserve">
        <div class="o_hierarchy_renderer w-100 d-flex justify-content-center" t-ref="renderer">
            <div class="o_hierarchy_container d-flex flex-column w-100 w-lg-75 h-100 p-2">
                <t t-foreach="rows" t-as="row" t-key="row_index">
                    <t t-set="previousRow" t-value="!row_first ? rows[row_index - 1] : null"/>
                    <t t-if="!row_first">
                        <div t-if="row.parentNode and previousRow.nodes.length &gt; 1" class="o_hierarchy_parent_node_container d-flex justify-content-center">
                            <span t-esc="row.parentNode.data.display_name || row.parentNode.data.name"/>
                        </div>
                        <div class="o_hierarchy_separator d-flex">
                            <div class="o_hierarchy_line_part o_hierarchy_line_left"/>
                            <div class="o_hierarchy_line_part o_hierarchy_line_right"/>
                        </div>
                    </t>
                    <div class="o_hierarchy_row row justify-content-center flex-wrap row-cols-2 row-cols-lg-5 g-2 g-lg-3" t-att-class="{ 'pb-4': row_last }" t-att-data-parent-node-id="row.parentNode?.id" t-att-data-row-id="row_index">
                        <t t-foreach="row.nodes" t-as="node" t-key="node.id">
                            <HierarchyCard node="node" openRecord="props.openRecord" archInfo="props.archInfo"/>
                        </t>
                    </div>
                </t>
            </div>
        </div>
    </t>

`);
registerTemplate("esg.carbonEmissionGraphView", `/esg/static/src/views/esg_carbon_emission_graph/esg_carbon_emission_graph_controller.xml`, `<t t-name="esg.carbonEmissionGraphView" t-inherit="web.GraphView" t-inherit-mode="primary" xml:space="preserve">
        <ActionHelper position="replace">
            <t t-if="!model.hasData() or model.useSampleModel and props.info.noContentHelp">
                <t t-call="esg.noContentHelper">
                    <t t-set="reportName" t-value="title"/>
                    <t t-set="accountantInstalled" t-value="accountantInstalled"/>
                </t>
            </t>
        </ActionHelper>
    </t>
`);
registerTemplate("esg.carbonEmissionPivotView", `/esg/static/src/views/esg_carbon_emission_pivot/esg_carbon_emission_pivot_controller.xml`, `<t t-name="esg.carbonEmissionPivotView" t-inherit="web.PivotView" t-inherit-mode="primary" xml:space="preserve">
        <ActionHelper position="replace">
            <t t-if="!model.hasData() or model.useSampleModel and props.info.noContentHelp">
                <t t-call="esg.noContentHelper">
                    <t t-set="reportName" t-value="title"/>
                    <t t-set="accountantInstalled" t-value="accountantInstalled"/>
                </t>
            </t>
        </ActionHelper>
    </t>
`);
registerTemplate("web_grid.FloatToggleGridCell", `/web_grid/static/src/components/float_toggle_grid_cell.xml`, `<t t-name="web_grid.FloatToggleGridCell" t-inherit="web_grid.Cell" xml:space="preserve">
        <xpath expr="//input" position="replace">
            <button t-if="state.edit" class="o_field_float_toggle" t-on-click="onChange" t-on-keydown="onKeyDown" t-ref="toggleButton">
                <t t-out="formattedValue"/>
            </button>
        </xpath>
    </t>
`);
registerTemplate("web_grid.Cell", `/web_grid/static/src/components/grid_cell.xml`, `<t t-name="web_grid.Cell" xml:space="preserve">
        <div t-if="props.reactive.cell" t-attf-class="{{ props.classNames }} o_grid_cell o_grid_highlightable position-relative d-flex justify-content-center align-items-center w-100 h-100 text-800" t-on-click.synthetic="onCellClick" t-ref="root">
            <button class="o_grid_search_btn btn btn-sm position-absolute start-0 px-1 opacity-50 opacity-100-hover" t-on-click.synthetic="() =&gt; this.magnifierGlassHook.onMagnifierGlassClick()">
                <i class="fa fa-search"/>
            </button>
            <div t-if="state.cell" class="d-flex w-100 h-100 justify-content-center align-items-center">
                <input t-if="state.edit" t-att-inputmode="inputMode" type="text" class="o_input h-100" t-ref="numpadDecimal"/>
                <span t-else="" class="z-1" t-out="formattedValue"/>
            </div>
        </div>
    </t>
`);
registerTemplate("web_grid.GridComponent", `/web_grid/static/src/components/grid_component/grid_component.xml`, `<t t-name="web_grid.GridComponent" xml:space="preserve">
        <t t-component="gridComponent" t-props="gridComponentProps"/>
    </t>

`);
registerTemplate("web_grid.GridRow", `/web_grid/static/src/components/grid_row/grid_row.xml`, `<t t-name="web_grid.GridRow" xml:space="preserve">
        <div t-att-name="props.name" t-att-class="props.classNames" t-att-style="props.style">
            <span t-if="value" t-esc="value"/>
            <span t-else="" class="o_grid_no_data text-300">None</span>
        </div>
    </t>

`);
registerTemplate("web_grid.Many2OneGridRow", `/web_grid/static/src/components/many2one_grid_row/many2one_grid_row.xml`, `<t t-name="web_grid.Many2OneGridRow" xml:space="preserve">
        <div t-att-name="props.name" t-att-class="props.classNames" t-att-style="props.style">
            <t t-if="!props.canOpen and resId">
                <span>
                    <span t-esc="displayName" t-att-class="{'me-2': props.row.isAdditionalRow}"/>
                    <t t-foreach="extraLines" t-as="extraLine" t-key="extraLine_index">
                        <br/>
                        <span t-esc="extraLine"/>
                    </t>
                </span>
            </t>
            <t t-elif="resId">
                <a t-attf-class="o_form_uri" t-att-href="\`/odoo/\${urlRelation}/\${resId}\`" t-on-click.prevent="onClick">
                    <span t-esc="displayName" t-att-class="{'me-2': props.row.isAdditionalRow}"/>
                    <t t-foreach="extraLines" t-as="extraLine" t-key="extraLine_index">
                        <br/>
                        <span t-esc="extraLine"/>
                    </t>
                </a>
            </t>
            <span t-else="" class="o_grid_no_data text-300">None</span>
        </div>
    </t>

`);
registerTemplate("web_grid.Buttons", `/web_grid/static/src/views/grid_controller.xml`, `<t t-name="web_grid.Buttons" xml:space="preserve">
        <div class="d-flex o_grid_buttons">
            <div class="me-2" t-if="displayAddALine">
                <button class="btn btn-primary o_grid_button_add" type="button" t-on-click="() =&gt; this.createRecord()">
                    Add a Line
                </button>
            </div>
            <t t-call="web_grid.CustomButtons" t-if="props.archInfo.buttons.length"/>
        </div>
    </t>
    `);
registerTemplate("web_grid.CustomButtons", `/web_grid/static/src/views/grid_controller.xml`, `<t t-name="web_grid.CustomButtons" xml:space="preserve">
        <div class="o_grid_custom_buttons me-2">
            <t t-foreach="props.archInfo.buttons" t-as="button" t-key="button.id">
                <ViewButton t-if="!button.invisible" className="button.className" clickParams="button.clickParams" defaultRank="button.defaultRank" icon="button.icon" string="button.string" title="button.title" record="model.record"/>
            </t>
        </div>
    </t>
    `);
registerTemplate("web_grid.GridView", `/web_grid/static/src/views/grid_controller.xml`, `<t t-name="web_grid.GridView" xml:space="preserve">
        <div t-attf-class="o_grid_view {{ isMobile ? 'o_action_delegate_scroll' : '' }} {{props.className}}" t-ref="root">
            <Layout className="(model.useSampleModel ? 'o_view_sample_data' : '')" display="props.display">
                <t t-set-slot="control-panel-additional-actions">
                    <CogMenu/>
                </t>
                <t t-set-slot="layout-buttons">
                    <t t-call="{{ props.buttonTemplate }}"/>
                </t>
                <t t-set-slot="layout-actions">
                    <SearchBar toggler="searchBarToggler"/>
                </t>
                <t t-set-slot="control-panel-navigation-additional">
                    <t t-component="searchBarToggler.component" t-props="searchBarToggler.props"/>
                </t>
                <t t-set-slot="default" t-slot-scope="layout">
                    <t t-if="displayNoContent">
                        <ActionHelper noContentHelp="props.info.noContentHelp"/>
                    </t>
                    <t t-if="hasDisplayableData">
                        <t t-component="props.Renderer" options="options" model="model" sections="model.sectionsArray" columns="columns" rows="model.itemsArray" sectionField="model.sectionField" rowFields="model.rowFields" measureField="props.archInfo.measureField" isEditable="isEditable" createInline="props.archInfo.activeActions.create and props.archInfo.createInline and !displayNoContent" createRecord.bind="createRecord" widgetPerFieldName="props.archInfo.widgetPerFieldName" openAction="props.archInfo.openAction" contentRef="layout.contentRef" ranges="model.ranges" state="state" toggleWeekendVisibility.bind="toggleWeekendVisibility"/>
                    </t>
                </t>
            </Layout>
        </div>
    </t>
`);
registerTemplate("web_grid.Renderer", `/web_grid/static/src/views/grid_renderer.xml`, `<t t-name="web_grid.Renderer" xml:space="preserve">
        <div class="o_grid_renderer position-relative z-0" t-ref="renderer">
            <div class="o_grid_grid d-grid gap-0 border-bottom bg-100" t-attf-style="grid-template-rows: {{ gridTemplateRows }}; grid-template-columns: {{ gridTemplateColumns }}" t-on-mouseover.stop="onMouseOver" t-on-mouseout.stop="onMouseOut">
                <t t-call="web_grid.Header"/>
                <t t-foreach="virtualRows" t-as="row" t-key="row.id">
                    <t t-if="row.isSection">
                        <t t-call="web_grid.Section"/>
                    </t>
                    <t t-else="">
                        <t t-call="web_grid.Row"/>
                        <t t-if="displayAddLine">
                            <t t-call="web_grid.AddLine"/>
                        </t>
                    </t>
                </t>
                <t t-if="props.createInline and !props.model.hasData()" t-call="web_grid.AddLine"/>
                <t t-call="web_grid.Footer"/>
                <t t-if="props.options.hasBarChartTotal" t-call="web_grid.barChart"/>
                <GridComponent t-props="hoveredCellProps"/>
                <GridComponent t-props="editCellProps"/>
            </div>
        </div>
    </t>
    `);
registerTemplate("web_grid.Header", `/web_grid/static/src/views/grid_renderer.xml`, `<t t-name="web_grid.Header" xml:space="preserve">
        <div class="o_grid_column_title o_grid_navigation_wrap position-md-sticky top-0 start-0 d-flex align-items-center gap-2 px-3 border-bottom bg-100 overflow-visible" t-attf-style="grid-row: {{rowsGap}}; grid-column: {{columnsGap}};">
            <t t-call="web_grid.NavigationButtons"/>
        </div>
        <div t-foreach="props.columns" t-as="column" t-key="column.id" class="o_grid_column_title position-relative position-md-sticky top-0 d-flex align-items-center justify-content-center px-3 py-2 border-bottom text-bg-100" t-att-class="{                 'fw-bolder': column.isToday,                 'fw-bold' : !column.isToday,                 'text-opacity-25' : getUnavailableClass(column) === 'o_grid_unavailable'              }" t-att-data-grid-row="rowsGap" t-att-data-grid-column="column_index + 1 + columnsGap" t-attf-style="grid-row: {{rowsGap}}; grid-column: {{column_index + 1 + columnsGap}};">
            <div class="position-absolute top-0 start-0 w-100 h-100" t-att-class="{                     'o_grid_cell_overlay_today bg-info': column.isToday,                     'o_grid_cell_overlay bg-700' : !column.isToday,                  }" t-attf-class="{{getUnavailableClass(column)}}"/>
            <span class="z-1 text-center" t-out="column.title"/>
        </div>
        <div t-if="!props.options.hideLineTotal" class="o_grid_column_title o_grid_row_total position-md-sticky top-0 end-0 d-flex align-items-center justify-content-center text-bg-200 px-3 py-2 border-bottom fw-bold text-center" t-attf-style="grid-row: {{rowsGap}}; grid-column: {{props.columns.length + 1 + columnsGap}};">
            <span class="z-1" t-out="measureLabel"/>
        </div>
    </t>
    `);
registerTemplate("web_grid.Section", `/web_grid/static/src/views/grid_renderer.xml`, `<t t-name="web_grid.Section" xml:space="preserve">
        <t t-set="section" t-value="row"/>
        <t t-set="rowPosition" t-value="getRowPosition(section)"/>
        <t name="section" t-if="!section.isFake and (props.sections.length &gt; 1 or section.value)">
            <div class="o_grid_section o_grid_section_title o_grid_highlightable d-flex align-items-center ps-3 border-top bg-200 fw-bold" t-att-class="{                     'position-md-sticky start-0': !props.model.useSampleModel,                  }" t-att-data-grid-row="rowPosition" t-att-data-grid-column="columnsGap" t-attf-style="grid-row: {{rowPosition}}; grid-column: {{columnsGap}};">
            <div class="o_grid_cell_overlay position-absolute top-0 start-0 w-100 h-100 bg-700"/>
                <GridComponent classNames="'z-1 text-truncate'" name="props.sectionField.name" model="props.model" row="section" t-props="getFieldAdditionalProps(props.sectionField.name)"/>
            </div>
            <div t-foreach="props.columns" t-as="column" t-key="column.id" t-attf-class="o_grid_section o_grid_highlightable position-relative d-flex align-items-center justify-content-center fw-bold {{ getCellColorClass(column, section) }}" t-att-class="getSectionColumnsClasses(column, section)" t-att-data-row="section.id" t-att-data-column="column.id" t-att-data-grid-row="rowPosition" t-att-data-grid-column="column_index + 1 + columnsGap" t-attf-style="grid-row: {{rowPosition}}; grid-column: {{column_index + 1 + columnsGap}};">
                <div class="position-absolute top-0 start-0 w-100 h-100" t-att-class="{                        'o_grid_cell_overlay_today bg-info bg-opacity-25' : column.isToday,                        'o_grid_cell_overlay bg-700' : !column.isToday,                     }" t-attf-class="{{getUnavailableClass(column)}}"/>
                <div class="o_grid_cell_readonly position-relative d-flex justify-content-center align-items-center w-100 h-100">
                    <span class="z-1" t-att-class="getSectionCellsClasses(column, section)" t-out="formatValue(section.cells[column.id].value)"/>
                </div>
            </div>
            <t t-set="grandTotal" t-value="section.getGrandTotal(props.state.isWeekendVisible)"/>
            <div t-if="!props.options.hideLineTotal" class="o_grid_section o_grid_row_total o_grid_highlightable position-relative position-md-sticky end-0 z-1 d-flex align-items-center justify-content-center px-3 py-1 border-top fw-bold" t-att-class="getSectionTotalRowClass(section, grandTotal)" t-att-data-grid-row="rowPosition" t-att-data-grid-column="props.columns.length + 1 + columnsGap" t-attf-style="grid-row: {{rowPosition}}; grid-column: {{props.columns.length + 1 + columnsGap}};">
                <div class="o_grid_cell_overlay_total position-absolute top-0 start-0 w-100 h-100 bg-900"/>
                <div class="position-relative d-flex align-items-center">
                    <span t-out="formatValue(grandTotal)"/>
                </div>
            </div>
        </t>
    </t>
    `);
registerTemplate("web_grid.Row", `/web_grid/static/src/views/grid_renderer.xml`, `<t t-name="web_grid.Row" xml:space="preserve">
        <t t-set="rowPosition" t-value="getRowPosition(row)"/>
        <t t-set="isEven" t-value="rowPosition % 2 !== 0"/>
        <div name="row" class="o_grid_row o_grid_row_title o_grid_highlightable position-relative d-flex flex-column flex-md-row justify-content-center justify-content-md-start align-items-md-center px-3 py-1" t-att-class="{                 'position-md-sticky start-0': !props.model.useSampleModel,                 'bg-view': isEven,                 'bg-100': !isEven,                 'fst-italic': row.isAdditionalRow,                 'text-opacity-25' : getUnavailableClass(row) === 'o_grid_unavailable'              }" t-att-data-grid-row="rowPosition" t-att-data-grid-column="columnsGap" t-attf-style="grid-row: {{rowPosition}}; grid-column: {{columnsGap}};">
            <div class="o_grid_cell_overlay position-absolute top-0 start-0 w-100 h-100 bg-700"/>
            <t t-set="rowFields" t-value="props.model.rowFields.map(field =&gt; field.name)"/>
            <t t-foreach="props.rowFields" t-as="rowField" t-key="rowField_index">
                <t t-set="fieldName" t-value="rowField.name"/>
                <GridComponent t-if="row.initialRecordValues[fieldName] or rowField_index === 0" classNames="\`d-flex z-1 text-truncate o_grid_field_\${fieldName.replace('_id','')}\${isMobile ? '' : ' text-nowrap'}\${row.isAdditionalRow ? ' pe-1' : ''}\`" name="fieldName" value="row.initialRecordValues[fieldName]" model="props.model" row="row" t-props="getFieldAdditionalProps(fieldName)"/>
                <span t-if="!rowField_last and row.initialRecordValues[props.rowFields[rowField_index + 1].name]" class="o_grid_row_data_separator d-none d-md-inline px-2 text-300">
                |
                </span>
            </t>
        </div>
        <div t-foreach="props.columns" t-as="column" t-key="column.id" class="o_grid_row o_grid_highlightable position-relative d-flex align-items-center justify-content-center" t-att-class="getCellsClasses(column, row, section, isEven)" t-att-data-row="row.id" t-att-data-column="column.id" t-att-data-grid-row="rowPosition" t-att-data-grid-column="column_index + 1 + columnsGap" t-attf-style="grid-row: {{rowPosition}}; grid-column: {{column_index + 1 + columnsGap}};" t-on-click.prevent.synthetic="onCellClick">
            <div class="position-absolute top-0 start-0 w-100 h-100" t-att-class="{                     'o_grid_cell_overlay_today bg-info bg-opacity-25' : column.isToday,                     'o_grid_cell_overlay bg-700' : !column.isToday,                  }" t-attf-class="{{getUnavailableClass(column)}}"/>
            <div class="o_grid_cell_readonly position-relative d-flex justify-content-center align-items-center w-100 h-100">
                <span t-att-class="getCellsTextClasses(column, row)" t-esc="formatValue(row.cells[column.id].value)"/>
            </div>
        </div>
        <t t-set="grandTotal" t-value="row.getGrandTotal(props.state.isWeekendVisible)"/>
        <div t-if="!props.options.hideLineTotal" class="o_grid_row o_grid_row_total o_grid_highlightable position-relative position-md-sticky end-0 d-flex align-items-center justify-content-center px-3 py-1" t-att-class="getTotalCellsTextClasses(row, grandTotal)" t-att-data-grid-row="rowPosition" t-att-data-grid-column="props.columns.length + 1 + columnsGap" t-attf-style="grid-row: {{rowPosition}}; grid-column: {{props.columns.length + 1 + columnsGap}};">
            <div class="o_grid_cell_overlay_total position-absolute top-0 start-0 w-100 h-100 bg-900"/>
            <span class="z-1" t-out="formatValue(grandTotal)"/>

        </div>
    </t>
    `);
registerTemplate("web_grid.AddLine", `/web_grid/static/src/views/grid_renderer.xml`, `<t t-name="web_grid.AddLine" xml:space="preserve">
        <t t-set="rowPosition" t-value="getRowPosition(row or undefined, true)"/>
        <t t-set="isEven" t-value="rowPosition % 2 !== 0"/>
        <div t-if="props.createInline" class="o_grid_row o_grid_add_line o_grid_add_line_first_cell position-md-sticky start-0 d-flex align-items-center z-1 ps-3" t-att-class="{                 'bg-view': isEven,                 'bg-100': !isEven,              }" t-attf-style="grid-row: {{rowPosition}}; grid-column: {{columnsGap}};">
            <a class="btn btn-link o_text_overflow" t-on-click="() =&gt; this.onCreateInlineClick(row?.section)" data-hotkey="i">
               <i class="fa fa-plus-circle fs-4 me-1"/>Add a line
            </a>
        </div>
        <div t-foreach="props.columns" t-as="column" t-key="column.id" class="o_grid_row o_grid_add_line position-relative" t-att-class="{                    'o_grid_cell_today' : column.isToday,                    'bg-view': isEven,                 }" t-att-data-grid-row="rowPosition" t-att-data-grid-column="column_index + 1 + columnsGap" t-attf-style="grid-row: {{rowPosition}}; grid-column: {{column_index + 1 + columnsGap}};">
            <div class="position-absolute top-0 start-0 w-100 h-100" t-att-class="{                     'o_grid_cell_overlay_today bg-info bg-opacity-25' : column.isToday,                     'o_grid_cell_overlay bg-700' : !column.isToday,                  }" t-attf-class="{{getUnavailableClass(column)}}"/>
        </div>
        <div class="o_grid_add_line position-md-sticky end-0 text-bg-200" t-attf-style="grid-row: {{rowPosition}}; grid-column: {{props.columns.length + 1 + columnsGap}};"/>
    </t>
    `);
registerTemplate("web_grid.Footer", `/web_grid/static/src/views/grid_renderer.xml`, `<t t-name="web_grid.Footer" xml:space="preserve">
        <t t-if="!props.options.hideColumnTotal">
            <t t-set="rowPosition" t-value="getTotalRowPosition()"/>
            <t t-set="isEven" t-value="rowPosition % 2 !== 0"/>
            <div class="" t-att-class="{                     'bg-view': isEven,                     'bg-100': !isEven,                     'z-1 position-md-sticky start-0': !props.model.useSampleModel,                  }" t-attf-style="grid-row: {{rowPosition}}; grid-column: {{columnsGap}};"/>
            <t t-set="grandTotal" t-value="0"/>
            <div t-foreach="props.columns" t-as="column" t-key="column.id" class="o_grid_row o_grid_column_total o_grid_highlightable position-relative" t-att-class="{                     'bg-view': isEven and column.grandTotal &gt;= 0,                     'text-danger': column.grandTotal lt 0,                  }" t-att-data-grid-row="rowPosition" t-att-data-grid-column="column_index + 1 + columnsGap" t-attf-style="grid-row: {{rowPosition}}; grid-column: {{column_index + 1 + columnsGap}};">
                <div class="position-absolute top-0 start-0 w-100 h-100" t-att-class="{                         'o_grid_cell_overlay_today bg-info bg-opacity-25' : column.isToday,                         'o_grid_cell_overlay bg-700' : !column.isToday,                      }" t-attf-class="{{getUnavailableClass(column)}}"/>
                <t t-set="grandTotal" t-value="grandTotal + column.grandTotal"/>
                <div class="h-100 d-flex justify-content-center align-items-center" t-if="column.grandTotal !== 0">
                    <div class="o_grid_bar_chart_total_title">
                        <span class="fs-5 fw-bolder" t-att-class="{                                 'text-danger' : getUnavailableClass(column) === 'o_grid_unavailable' and column.grandTotal gt 0                               }">
                            <t t-esc="formatValue(column.grandTotal)"/>
                        </span>
                    </div>
                </div>
            </div>
            <div t-if="!props.options.hideLineTotal" t-att-data-grid-row="rowPosition" t-att-data-grid-column="props.columns.length + 1 + columnsGap" t-attf-class="o_grid_highlightable position-md-sticky end-0 d-flex align-items-center justify-content-center text-black fw-bold {{ getFooterTotalCellClasses(grandTotal) }}" t-attf-style="grid-row: {{rowPosition}}; grid-column: {{props.columns.length + 1 + columnsGap}};">
                <span>
                    <t t-esc="formatValue(grandTotal)"/>
                </span>
            </div>
        </t>
    </t>
    `);
registerTemplate("web_grid.barChart", `/web_grid/static/src/views/grid_renderer.xml`, `<t t-name="web_grid.barChart" xml:space="preserve">
        <t t-if="!props.options.hideColumnTotal">
            <t t-set="rowPosition" t-value="getTotalRowPosition()"/>
            <t t-set="isEven" t-value="(rowPosition + 1) % 2 !== 0"/>
            <div class="o_grid_row_barChart" t-att-class="{                     'bg-view': isEven,                     'bg-100': !isEven,                     'z-1 position-md-sticky start-0': !props.model.useSampleModel,                  }" t-attf-style="grid-row: {{rowPosition + 1}}; grid-column: {{columnsGap}};"/>
            <t t-set="grandTotal" t-value="0"/>
            <div t-foreach="props.columns" t-as="column" t-key="column.id" class="o_grid_row o_grid_column_total o_grid_highlightable o_grid_bar_chart_container" t-att-class="{'bg-view': isEven}" t-att-data-grid-row="rowPosition + 1" t-att-data-grid-column="column_index + 1 + columnsGap" t-attf-style="grid-row: {{rowPosition + 1}}; grid-column: {{column_index + 1 + columnsGap}};">
                <t t-set="grandTotal" t-value="grandTotal + column.grandTotal"/>
                <div class="h-100 position-relative" t-if="column.grandTotal !== 0">
                    <div class="o_grid_bar_chart_total_pill position-absolute w-100 border-top border-primary border-2 bg-primary bg-opacity-50" t-if="props.options.hasBarChartTotal" t-att-style="getColumnBarChartHeightStyle(column)">
                    </div>
                </div>
            </div>
            <div t-if="!props.options.hideLineTotal" class="o_grid_row o_grid_column_total o_grid_row_total o_grid_highlightable position-md-sticky end-0 bg-200" t-att-data-grid-row="rowPosition + 1" t-att-data-grid-column="props.columns.length + 1 + columnsGap" t-attf-style="grid-row: {{rowPosition + 1}}; grid-column: {{props.columns.length + 1 + columnsGap}};">
                <div class="h-100 position-relative" t-if="grandTotal !== 0"/>
            </div>
        </t>
    </t>
    `);
registerTemplate("web_grid.NavigationButtons", `/web_grid/static/src/views/grid_renderer.xml`, `<t t-name="web_grid.NavigationButtons" xml:space="preserve">
        <div class="o_grid_navigation_buttons position-md-sticky d-flex gap-2" t-if="props.model.columnFieldIsDate">
            <button class="btn btn-secondary" data-hotkey="t" type="button" t-on-click="onTodayButtonClick">
                Today
            </button>
            <div class="btn-group">
                <button class="btn btn-secondary" type="button" t-on-click="onPreviousButtonClick" data-hotkey="p">
                    <span aria-label="Previous" class="oi oi-arrow-left" role="img" title="Previous"/>
                </button>
                <ViewScaleSelector t-if="rangesArray.length" scales="props.ranges" currentScale="props.state.activeRangeName" setScale.bind="onRangeClick" isWeekendVisible="props.state.isWeekendVisible" toggleWeekendVisibility="props.toggleWeekendVisibility"/>
                <button type="button" class="btn btn-secondary" t-on-click="onNextButtonClick" data-hotkey="n">
                    <span aria-label="Next" class="oi oi-arrow-right" role="img" title="Next"/>
                </button>
            </div>
        </div>
    </t>
`);
registerTemplateExtension("web.GraphView.Buttons", `/spreadsheet_edition/static/src/assets/graph_view/graph_view.xml`, `<t t-inherit="web.GraphView.Buttons" t-inherit-mode="extension" xml:space="preserve">
        <xpath expr="//div[hasclass('btn-group')][1]" position="after">
            <t t-if="canInsertChart and !env.isSmall">
                <div class="btn-group" role="toolbar" aria-label="Insert in Spreadsheet">
                    <button class="btn btn-secondary o_graph_insert_spreadsheet" t-att-disabled="!model.hasData() or model.useSampleModel" t-on-click="onInsertInSpreadsheet">
                        Insert in Spreadsheet
                    </button>
                </div>
            </t>
        </xpath>
    </t>
`);
registerTemplateExtension("web.PivotView.Buttons", `/spreadsheet_edition/static/src/bundle/pivot/pivot.xml`, `<t t-name="spreadsheet_edition.PivotView.buttons" t-inherit="web.PivotView.Buttons" t-inherit-mode="extension" xml:space="preserve">
        <xpath expr="//button[hasclass('o_pivot_flip_button')]" position="before">
            <div t-att-data-tooltip="getInsertButtonTooltip()" t-if="canInsertPivot and env.isSmall">
                <button class="btn btn-secondary fa fa-file-text-o o_pivot_add_spreadsheet h-100 rounded-end-0" t-att-disabled="isInsertButtonDisabled()" title="Insert in Spreadsheet" aria-label="Insert in Spreadsheet" t-on-click="onInsertInSpreadsheet"/>
            </div>
        </xpath>
        <xpath expr="//div[hasclass('btn-group')][1]" position="after">
            <t t-if="canInsertPivot and !env.isSmall">
                <div class="btn-group" role="toolbar" aria-label="Insert in Spreadsheet" t-att-data-tooltip="getInsertButtonTooltip()">
                    <button class="btn btn-secondary o_pivot_add_spreadsheet" t-att-disabled="isInsertButtonDisabled()" t-on-click="onInsertInSpreadsheet">
                        Insert in Spreadsheet
                    </button>
                </div>
            </t>
        </xpath>
    </t>
`);
registerTemplate("project_enterprise.ProjectTaskMapRenderer", `/project_enterprise/static/src/views/project_task_map/project_task_map_renderer.xml`, `<t t-name="project_enterprise.ProjectTaskMapRenderer" t-inherit="web_map.MapRenderer" t-inherit-mode="primary" xml:space="preserve">
        <xpath expr="//t[@t-elif='props.model.metaData.routing and !props.model.data.useMapBoxAPI']" position="attributes">
            <attribute name="t-elif" add="and isProjectManager" separator=" "/>
        </xpath>
    </t>
    `);
registerTemplate("project_enterprise.ProjectTaskMapRenderer.PinListItems", `/project_enterprise/static/src/views/project_task_map/project_task_map_renderer.xml`, `<t t-name="project_enterprise.ProjectTaskMapRenderer.PinListItems" t-inherit="web_map.MapRenderer.PinListItems" t-inherit-mode="primary" xml:space="preserve">
        <xpath expr="//li[@t-if='latitude and longitude']" position="attributes">
            <attribute name="t-attf-class">#{record.planned_date_begin ? '' : 'text-muted'}</attribute>
        </xpath>
        <xpath expr="//t[@t-foreach='records']" position="before">
            <p t-if="!records.length" class="fst-italic text-muted">View customer locations for your tasks</p>
        </xpath>
    </t>
`);
registerTemplate("project_enterprise.MilestonesPopover", `/project_enterprise/static/src/views/project_task_common/milestones_popover.xml`, `<t t-name="project_enterprise.MilestonesPopover" xml:space="preserve">
        <div class="popover-body">
            <ul class="mb-0 list-unstyled">
                <li t-foreach="Object.values(props.projects)" t-as="project" t-key="project.id">
                    <t t-if="props.displayProjectName">
                        <div><u><t t-out="project.name"/></u></div>
                    </t>
                    <em t-if="project.isStartDate">Project start</em>
                    <em t-if="project.isDeadline">Project due</em>
                    <ul class="mb-0 list-unstyled">
                        <li t-foreach="project.milestones" t-as="milestone" t-key="milestone_index">
                            <t t-if="milestone.is_deadline_exceeded">
                                <i t-attf-class="fa fa-square-o fa-fw text-start o_unreached_milestones"/>
                            </t>
                            <t t-else="">
                                <i class="fa fa-fw text-start" t-attf-class="{{milestone.is_reached ? 'fa-check-square-o o_milestones_reached' : 'fa-square-o'}}"/>
                            </t>
                            <strong><t t-out="milestone.name"/></strong>
                            <span t-if="props.displayMilestoneDates"><br/><t t-out="getDeadline(milestone)"/></span>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </t>

`);
registerTemplate("project_enterprise.TaskGanttRenderer.Header", `/project_enterprise/static/src/views/project_task_common/task_gantt_renderer.xml`, `<t t-name="project_enterprise.TaskGanttRenderer.Header" t-inherit="web_gantt.GanttRenderer.Header" xml:space="preserve">
        <xpath expr="//t[@t-foreach='columns']/div" position="inside">
            <t t-set="columnInfo" t-value="columnMilestones[column.index]"/>
            <t t-if="columnInfo.edge &amp;&amp; columnInfo.edge.hasStartDate">
                <div class="o_project_edge_startdate_circle" t-on-mouseenter="(ev) =&gt; this.onMilestoneMouseEnter(ev, columnInfo.edge.projects)" t-on-mouseleave="onMilestoneMouseLeave"/>
            </t>
            <t t-if="columnInfo.hasMilestone">
                <div class="o_project_milestone_diamond" t-att-class="{                          'o_unreached_milestones': columnInfo.hasDeadLineExceeded,                          'edge_slot': column_last,                          'o_project_deadline_milestone': columnInfo.hasDeadline,                          'o_project_startdate_milestone': !columnInfo.hasDeadline &amp;&amp; columnInfo.hasStartDate,                      }" t-on-mouseenter="(ev) =&gt; this.onMilestoneMouseEnter(ev, columnInfo.projects)" t-on-mouseleave="onMilestoneMouseLeave">
                    <i class="fa fa-check o_milestones_reached" t-att-class="{ 'edge_slot': column_last }" t-if="columnInfo.allReached"/>
                </div>
            </t>
            <t t-elif="columnInfo.hasDeadline || columnInfo.hasStartDate">
                <div t-att-class="{                          'o_project_deadline_circle': columnInfo.hasDeadline,                          'o_project_startdate_circle': !columnInfo.hasDeadline &amp;&amp; columnInfo.hasStartDate,                      }" t-on-mouseenter="(ev) =&gt; this.onMilestoneMouseEnter(ev, columnInfo.projects)" t-on-mouseleave="onMilestoneMouseLeave"/>
            </t>
        </xpath>
    </t>

    `);
registerTemplate("project_enterprise.TaskGanttRenderer.ColoredCellBorder", `/project_enterprise/static/src/views/project_task_common/task_gantt_renderer.xml`, `<t t-name="project_enterprise.TaskGanttRenderer.ColoredCellBorder" xml:space="preserve">
        <t t-set="columnInfo" t-value="columnMilestones[column.index]"/>
        <t t-if="columnInfo.edge &amp;&amp; columnInfo.edge.hasStartDate">
            <div class="o_edge_startdate_pin" t-att-style="coloredCellBorderStyle"/>
        </t>
        <t t-if="columnInfo.hasMilestone">
            <div class="o_project_milestone" t-att-style="coloredCellBorderStyle" t-att-class="{ 'o_unreached_milestones': columnInfo.hasDeadLineExceeded }"/>
        </t>
        <t t-elif="columnInfo.hasDeadline">
            <div class="o_project_milestone o_unreached_milestones" t-att-style="coloredCellBorderStyle"/>
        </t>
        <t t-elif="columnInfo.hasStartDate">
            <div class="o_project_milestone o_startdate_pin" t-att-style="coloredCellBorderStyle"/>
        </t>
    </t>

    `);
registerTemplate("project_enterprise.TaskGanttRenderer.RowContent", `/project_enterprise/static/src/views/project_task_common/task_gantt_renderer.xml`, `<t t-name="project_enterprise.TaskGanttRenderer.RowContent" t-inherit="web_gantt.GanttRenderer.RowContent" xml:space="preserve">
        <xpath expr="//div[hasclass('o_gantt_cell')]" position="after">
            <t t-call="project_enterprise.TaskGanttRenderer.ColoredCellBorder">
                <t t-set="coloredCellBorderStyle" t-value="getGridPosition({ column: column.grid.column, row: row.grid.row })"/>
            </t>
        </xpath>
    </t>

     `);
registerTemplate("project_enterprise.TaskGanttRenderer.TotalRow", `/project_enterprise/static/src/views/project_task_common/task_gantt_renderer.xml`, `<t t-name="project_enterprise.TaskGanttRenderer.TotalRow" t-inherit="web_gantt.GanttRenderer.TotalRow" xml:space="preserve">
        <xpath expr="//div[hasclass('o_gantt_cell')]" position="after">
            <t t-call="project_enterprise.TaskGanttRenderer.ColoredCellBorder">
                <t t-set="coloredCellBorderStyle" t-value="getGridPosition({ column: column.grid.column })"/>
            </t>
        </xpath>
    </t>

    `);
registerTemplate("project_enterprise.TaskGanttRenderer.Pill", `/project_enterprise/static/src/views/project_task_common/task_gantt_renderer.xml`, `<t t-name="project_enterprise.TaskGanttRenderer.Pill" t-inherit="web_gantt.GanttRenderer.Pill" xml:space="preserve">
        <xpath expr="//div[hasclass('o_gantt_lock')]" position="before">
            <div t-if="!renderConnectors" class="o_gantt_forbidden fa fa-ban ms-auto me-2"/>
        </xpath>
    </t>

`);
registerTemplate("project_enterprise.TaskGanttController", `/project_enterprise/static/src/views/task_gantt/task_gantt_controller.xml`, `<t t-name="project_enterprise.TaskGanttController" t-inherit="web_gantt.GanttController" t-inherit-mode="primary" xml:space="preserve">
        <button class="o_gantt_button_add btn btn-primary" position="replace">
            <ProjectTaskTemplateDropdown projectId="props.context.default_project_id" onCreate="() =&gt; this.onNewClicked()" newButtonClasses="'o_gantt_button_add btn btn-primary'" hotkey="r" context="props.context" getAdditionalContext.bind="getAdditionalContext"/>
        </button>
    </t>
`);
registerTemplate("project_enterprise.TaskGanttRenderer.RowHeader", `/project_enterprise/static/src/views/task_gantt/task_gantt_renderer.xml`, `<t t-name="project_enterprise.TaskGanttRenderer.RowHeader" t-inherit="web_gantt.GanttRenderer.RowHeader" xml:space="preserve">
        <xpath expr="//t[@t-esc='row.name']" position="replace">
            <Avatar t-if="hasAvatar(row)" t-props="getAvatarProps(row)"/>
            <t t-else="" t-esc="row.name"/>
        </xpath>
    </t>

`);
registerTemplate("project_enterprise.ProjectGanttController", `/project_enterprise/static/src/views/project_gantt/project_gantt_controller.xml`, `<t t-name="project_enterprise.ProjectGanttController" t-inherit="web_gantt.GanttController" t-inherit-mode="primary" xml:space="preserve">
        <button class="o_gantt_button_add btn btn-primary" position="replace">
            <ProjectTemplateDropdown t-if="model.metaData.canCreate" onCreate="() =&gt; this.onNewClicked()" newButtonClasses="'o_gantt_button_add btn btn-primary'" hotkey="r" context="props.context" getAdditionalContext.bind="getAdditionalContext"/> 
        </button>
    </t>
`);
registerTemplate("project_enterprise.ProjectGanttRenderer.RowHeader", `/project_enterprise/static/src/views/project_gantt/project_gantt_renderer.xml`, `<t t-name="project_enterprise.ProjectGanttRenderer.RowHeader" t-inherit="web_gantt.GanttRenderer.RowHeader" owl="1" xml:space="preserve">
        <xpath expr="//t[@t-esc='row.name']" position="replace">
            <Avatar t-if="hasAvatar(row)" t-props="getAvatarProps(row)"/>
            <t t-else="" t-esc="row.name"/>
        </xpath>
    </t>

`);
registerTemplate("hr.GanttEmployeeAvatar", `/hr_gantt/static/src/hr_gantt_employee_avatar.xml`, `<t t-name="hr.GanttEmployeeAvatar" t-inherit="mail.Avatar" xml:space="preserve">
        <xpath expr="//div[hasclass('o-mail-Avatar')]" position="attributes">
            <attribute name="class" add="o_field_many2one_avatar" separator=" "/>
        </xpath>
        <xpath expr="//div[hasclass('o-mail-Avatar')]/img" position="attributes">
            <attribute name="t-on-click.stop.prevent">openCard</attribute>
            <attribute name="t-att-data-tooltip">props.displayName</attribute>
        </xpath>
    </t>

`);
registerTemplate("hr.HrGanttRenderer.RowHeader", `/hr_gantt/static/src/hr_gantt_renderer.xml`, `<t t-name="hr.HrGanttRenderer.RowHeader" t-inherit="web_gantt.GanttRenderer.RowHeader" xml:space="preserve">
        <xpath expr="//t[@t-esc='row.name']" position="replace">
            <Avatar t-if="hasAvatar(row)" t-props="getAvatarProps(row)"/>
            <t t-else="" t-esc="row.name"/>
        </xpath>
    </t>

`);
registerTemplate("hr_attendance.AttendanceGanttController", `/hr_attendance_gantt/static/src/attendance_gantt/attendance_gantt_view.xml`, `<t t-name="hr_attendance.AttendanceGanttController" t-inherit="web_gantt.GanttController" t-inherit-mode="primary" xml:space="preserve">
        <t t-if="showNoContentHelp" position="replace">
        </t>
        <t model="model" position="after">
            <t t-if="showNoContentHelp">
                <t t-if="props.info.noContentHelp">
                    <AttendanceActionHelper noContentHelp="props.info.noContentHelp"/>
                </t>
                <t t-else="" t-call="web.NoContentHelper"/>
            </t>
        </t>
    </t>
`);
registerTemplate("hr_attendance.AttendanceGanttRowProgressBar", `/hr_attendance_gantt/static/src/attendance_gantt/attendance_row_progress_bar.xml`, `<t t-name="hr_attendance.AttendanceGanttRowProgressBar" xml:space="preserve">
        <span class="o_gantt_progress_bar position-relative h-100 pe-none" t-att-class="\`o_gantt_group_\${status || 'none'}\`">

            <t t-if="props.progressBar.is_fully_flexible_hours">
                <span t-if="show" class="position-absolute top-0 end-0 h-100 d-flex align-items-center px-1 o_gantt_group_hours" t-esc="props.progressBar.value_formatted" style="background-color: #fff; padding: 0 5px;"/>
            </t>
            <t t-else="">
                <span class="bg-opacity-25 position-absolute top-0 end-0 h-100" t-att-class="status and \`bg-\${status}\`" t-attf-style="width:{{ Math.min(props.progressBar.ratio, 100) }}%;"/>
                <span t-if="show" class="position-absolute top-0 end-0 h-100 d-flex align-items-center px-1" t-att-class="status ? \`text-bg-\${status}\` : 'bg-view'">
                    <span class="o_gantt_group_hours" t-esc="\`\${props.progressBar.value_formatted} / \${props.progressBar.max_value_formatted}\`"/>
                </span>
            </t>
        </span>
    </t>
`);
registerTemplate("hr_org_chart.HrEmployeeHierarchyCard", `/hr_org_chart/static/src/views/hr_employee_hierarchy/hr_employee_hierarchy_card.xml`, `<t t-name="hr_org_chart.HrEmployeeHierarchyCard" t-inherit="web_hierarchy.HierarchyCard" xml:space="preserve">
        <xpath expr="//button[@name='hierarchy_search_subsidiaries']" position="attributes">
            <attribute name="class" separator=" " remove="d-grid"/>
            <attribute name="class" separator=" " remove="rounded-0"/>
        </xpath>
        <xpath expr="//button[@name='hierarchy_search_subsidiaries']" position="inside">
            <t t-out="props.node.childResIds.length"/> people
        </xpath>
        <xpath expr="//button[@name='hierarchy_search_subsidiaries']/t[@t-if]" position="replace">
            <t t-if="!props.node.nodes.length">
                <i class="fa fa-fw fa-caret-right"/>
            </t>
        </xpath>
        <xpath expr="//button[@name='hierarchy_search_subsidiaries']/t[@t-else]" position="replace">
            <t t-else="">
                <i class="fa fa-fw fa-caret-down"/>
            </t>
        </xpath>
    </t>

`);
registerTemplate("hr_org_chart.HrEmployeeHierarchyRenderer", `/hr_org_chart/static/src/views/hr_employee_hierarchy/hr_employee_hierarchy_renderer.xml`, `<t t-name="hr_org_chart.HrEmployeeHierarchyRenderer" t-inherit="web_hierarchy.HierarchyRenderer" xml:space="preserve">
        <xpath expr="//div[hasclass('o_hierarchy_parent_node_container')]/span" position="replace">
            <Avatar resModel="row.parentNode.model.resModel" resId="row.parentNode.resId" displayName="row.parentNode.data.display_name || row.parentNode.data.name"/>
        </xpath>
    </t>

`);
registerTemplate("stock_enterprise.markerPopup", `/stock_enterprise/static/src/map_view/map_renderer.xml`, `<t t-name="stock_enterprise.markerPopup" t-inherit="web_map.markerPopup" t-inherit-mode="primary" xml:space="preserve">
        <xpath expr="//table" position="replace">
            <div class="overflow-y-scroll" style="max-height: 300px;">
                <t t-foreach="data" t-as="record" t-key="record.id">
                    <t t-set="fields" t-value="record.fields"/>
                    <table class="o-map-renderer--popup-table align-top">
                        <thead>
                            <tr>
                                <th colspan="2"/>
                                <th/>
                                <th/>
                            </tr>
                        </thead>
                        <tbody>
                            <tr t-foreach="fields" t-as="field" t-key="field.id">
                                <td class="o-map-renderer--popup-table-content-name fw-bold text-nowrap align-baseline">
                                    <t t-esc="field.string"/>
                                </td>
                                <td class="o-map-renderer--popup-table-space"/>
                                <td class="o-map-renderer--popup-table-content-value align-baseline">
                                    <t t-esc="field.value"/>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <hr t-if="record_index !== data.length - 1"/>
                </t>
            </div>
        </xpath>
    </t>
`);
checkPrimaryTemplateParents(["web.MultiSelectionButtons", "web.ViewScaleSelector", "mail.Avatar"]);
                    });
