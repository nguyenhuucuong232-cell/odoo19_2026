<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Custom Layout SGC - Không kế thừa external_layout -->
    <template id="report_saleorder_document_sgc">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <div class="article" style="font-family: Arial, sans-serif; font-size: 11pt;">
                    
                    <!-- CSS Inline -->
                    <style>
                        body { margin: 0; padding: 0; }
                        .page {
                            padding: 20mm 15mm;
                            page-break-after: always;
                        }
                        .sgc-header {
                            border-bottom: 2px solid #00539F;
                            padding-bottom: 10px;
                            margin-bottom: 15px;
                        }
                        .company-info {
                            font-size: 9pt;
                            line-height: 1.5;
                            color: #333;
                        }
                        .logo-box {
                            border: 3px solid #00539F;
                            padding: 10px 20px;
                            text-align: center;
                            display: inline-block;
                            margin-left: 20px;
                        }
                        .title-section {
                            text-align: center;
                            margin: 20px 0;
                        }
                        .title-main {
                            color: #00539F;
                            font-size: 20pt;
                            font-weight: bold;
                            margin: 0;
                        }
                        .title-sub {
                            color: #000;
                            font-size: 14pt;
                            font-weight: bold;
                            margin: 5px 0;
                        }
                        .info-block {
                            font-size: 10pt;
                            margin: 15px 0;
                        }
                        .main-table {
                            width: 100%;
                            border-collapse: collapse;
                            margin: 15px 0;
                            font-size: 10pt;
                        }
                        .main-table th {
                            background-color: #FFFF00;
                            border: 1px solid #000;
                            padding: 8px 5px;
                            text-align: center;
                            font-weight: bold;
                        }
                        .main-table td {
                            border: 1px solid #000;
                            padding: 6px 8px;
                        }
                        .total-row {
                            background-color: #F0F0F0;
                            font-weight: bold;
                        }
                        .grand-total-row {
                            background-color: #FFFF99;
                            font-weight: bold;
                            font-size: 11pt;
                        }
                        .footer-info {
                            margin-top: 30px;
                            padding-top: 10px;
                            border-top: 1px solid #00539F;
                            font-size: 9pt;
                        }
                        .signature-area {
                            margin-top: 40px;
                        }
                    </style>

                    <div class="page">
                        <!-- ==================== HEADER ==================== -->
                        <div class="sgc-header">
                            <table style="width: 100%; border: 0;">
                                <tr>
                                    <td style="width: 65%; vertical-align: top; border: 0;">
                                        <div style="color: #00539F; font-size: 11pt; font-weight: bold;">
                                            CÔNG TY CỔ PHẦN DỊCH VỤ CÔNG NGHỆ SÀI GÒN
                                        </div>
                                        <div class="company-info">
                                            <strong>Trụ sở:</strong> Tầng 14, 104 Tows, 412 Nguyễn Thị Minh Khai, P. Đào Cư, TP.HCM<br/>
                                            <strong>VP Hà Nội:</strong> 08-DQ2, 125 Phố Linh, Phường Đại Mỗ, TP Hà Nội<br/>
                                            <strong>VP/GPTKN:</strong> 65/17 Nguyễn Thị Kinh, P. Thảo Ấn, TP.HCM<br/>
                                            <strong>Email:</strong> info@hsevn.com.vn │ <strong>Website:</strong> https://hsevn.com.vn<br/>
                                            <strong>Hotline:</strong> 19001713
                                        </div>
                                    </td>
                                    <td style="width: 35%; text-align: right; vertical-align: top; border: 0;">
                                        <div class="logo-box">
                                            <div style="color: #00539F; font-size: 32pt; font-weight: bold; line-height: 1;">SGC</div>
                                            <div style="color: #00539F; font-size: 11pt; font-weight: bold;">HSE Consulting</div>
                                            <div style="color: #666; font-size: 8pt;">Health, Safety &amp; Environmental services</div>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <!-- ==================== TIÊU ĐỀ ==================== -->
                        <div class="title-section">
                            <h2 class="title-main">BẢNG BÁO GIÁ</h2>
                            <h3 class="title-sub">
                                QUAN TRẮC MÔI TRƯỜNG LAO ĐỘNG NĂM <t t-esc="doc.date_order.year if doc.date_order else '2025'"/>
                            </h3>
                        </div>

                        <!-- ==================== THÔNG TIN KHÁCH HÀNG ==================== -->
                        <table style="width: 100%; border: 0; margin-bottom: 15px;">
                            <tr>
                                <td style="width: 60%; vertical-align: top; border: 0;">
                                    <div class="info-block">
                                        <strong>Khách hàng:</strong> <span style="color: #00539F; font-weight: bold;" t-field="doc.partner_id.name"/><br/>
                                        <strong>Địa chỉ:</strong> 
                                        <span t-field="doc.partner_id.street"/>
                                        <t t-if="doc.partner_id.street2">, <span t-field="doc.partner_id.street2"/></t><br/>
                                        <t t-if="doc.partner_id.city">
                                            <span t-field="doc.partner_id.city"/>
                                            <t t-if="doc.partner_id.country_id">, <span t-field="doc.partner_id.country_id.name"/></t>
                                            <br/>
                                        </t>
                                        <t t-if="doc.partner_id.vat">
                                            <strong>Mã số thuế:</strong> <span t-field="doc.partner_id.vat"/><br/>
                                        </t>
                                        <strong>Người liên hệ:</strong> 
                                        <t t-set="contacts" t-value="doc.partner_id.child_ids.filtered(lambda c: c.type == 'contact')[:1]"/>
                                        <t t-if="contacts">
                                            <span t-field="contacts[0].name"/>
                                        </t>
                                        <t t-else="">
                                            <span t-field="doc.partner_id.name"/>
                                        </t>
                                        <br/>
                                        <strong>Điện thoại:</strong> <span t-if="doc.partner_id.phone" t-field="doc.partner_id.phone"/> │ 
                                        <strong>Mail:</strong> <span t-field="doc.partner_id.email"/>
                                    </div>
                                </td>
                                <td style="width: 40%; vertical-align: top; text-align: right; border: 0;">
                                    <div class="info-block">
                                        <strong>Ngày:</strong> <span t-field="doc.date_order" t-options='{"format": "dd/MM/yyyy"}'/><br/>
                                        <strong>Số BG:</strong> <span style="color: #00539F; font-weight: bold;" t-field="doc.name"/><br/>
                                        <t t-if="doc.validity_date">
                                            <strong>Hết hạn:</strong> <span t-field="doc.validity_date" t-options='{"format": "dd/MM/yyyy"}'/>
                                        </t>
                                    </div>
                                </td>
                            </tr>
                        </table>

                        <!-- ==================== GIỚI THIỆU ==================== -->
                        <p style="font-style: italic; text-align: justify; margin: 15px 0; font-size: 10pt;">
                            Trân trọng cảm ơn Quý khách hàng đã quan tâm đến các dịch vụ của chúng tôi. 
                            Chúng tôi thân kính gửi đến Quý khách báo giá các dịch vụ về quan trắc, phân tích mẫu, lập báo cáo và các chi phí 
                            khác có liên quan đến việc thực hiện hợp đồng này. Chúng tôi cam kết đảm bảo chất lượng dịch vụ với mức giá hợp lý nhất trên thị trường.
                        </p>

                        <!-- ==================== BẢNG CHI TIẾT ==================== -->
                        <table class="main-table">
                            <thead>
                                <tr>
                                    <th style="width: 5%;">STT</th>
                                    <th style="width: 40%;">Chỉ tiêu</th>
                                    <th style="width: 12%;">Đơn vị tính</th>
                                    <th style="width: 10%;">Số lượng</th>
                                    <th style="width: 15%;">Đơn giá</th>
                                    <th style="width: 18%;">Thành tiền (VNĐ)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-set="stt" t-value="1"/>
                                <t t-foreach="doc.order_line" t-as="line">
                                    
                                    <!-- Section -->
                                    <t t-if="line.display_type == 'line_section'">
                                        <tr style="background-color: #E0E0E0;">
                                            <td colspan="6" style="font-weight: bold; padding: 8px; text-align: left;">
                                                <span t-field="line.name"/>
                                            </td>
                                        </tr>
                                    </t>
                                    
                                    <!-- Note -->
                                    <t t-elif="line.display_type == 'line_note'">
                                        <tr>
                                            <td colspan="6" style="font-style: italic; padding: 5px 10px; text-align: left;">
                                                <span t-field="line.name"/>
                                            </td>
                                        </tr>
                                    </t>
                                    
                                    <!-- Product line -->
                                    <t t-else="">
                                        <tr>
                                            <td style="text-align: center;">
                                                <t t-esc="stt"/>
                                                <t t-set="stt" t-value="stt + 1"/>
                                            </td>
                                            <td style="text-align: left;">
                                                <span t-field="line.name"/>
                                            </td>
                                            <td style="text-align: center;">
                                                <span t-field="line.product_uom.name"/>
                                            </td>
                                            <td style="text-align: center;">
                                                <t t-esc="int(line.product_uom_qty)"/>
                                            </td>
                                            <td style="text-align: right;">
                                                <t t-esc="'{:,.0f}'.format(line.price_unit)"/>
                                            </td>
                                            <td style="text-align: right;">
                                                <t t-esc="'{:,.0f}'.format(line.price_subtotal)"/>
                                            </td>
                                        </tr>
                                    </t>
                                </t>

                                <!-- TỔNG TIỀN -->
                                <tr class="total-row">
                                    <td colspan="5" style="text-align: right; padding: 8px;">Tổng tiền</td>
                                    <td style="text-align: right; padding: 8px;">
                                        <t t-esc="'{:,.0f}'.format(doc.amount_untaxed)"/>
                                    </td>
                                </tr>
                                
                                <!-- THUẾ GTGT 8% -->
                                <tr class="total-row">
                                    <td colspan="5" style="text-align: right; padding: 8px;">Thuế GTGT 8%</td>
                                    <td style="text-align: right; padding: 8px;">
                                        <t t-esc="'{:,.0f}'.format(doc.amount_tax)"/>
                                    </td>
                                </tr>
                                
                                <!-- TỔNG CHI PHÍ -->
                                <tr class="grand-total-row">
                                    <td colspan="5" style="text-align: right; padding: 10px; font-size: 12pt;">
                                        <strong>TỔNG CHI PHÍ</strong>
                                    </td>
                                    <td style="text-align: right; padding: 10px; font-size: 12pt;">
                                        <strong><t t-esc="'{:,.0f}'.format(doc.amount_total)"/></strong>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- ==================== GHI CHÚ ==================== -->
                        <div style="margin-top: 20px; font-size: 10pt;">
                            <strong>Ghi chú:</strong> <span style="font-style: italic;">Muốn chắn nhận nằm mười một nghiệp bất toàn động</span>
                            <ul style="margin: 5px 0 0 20px; line-height: 1.6;">
                                <li>Thời gian dự kiến lấy mẫu: trong vòng 10 ngày kể từ ngày ký kết hợp đồng và nhận thanh toán đợt 1.</li>
                                <li>Thời gian dự kiến trả kết quả: trong vòng 20 ngày kể từ ngày kết thúc công tác quan trắc hiện trường.</li>
                            </ul>
                        </div>

                        <!-- ==================== CHI CHÚ ==================== -->
                        <div style="margin-top: 15px; font-size: 10pt;">
                            <strong>*Chi chú:</strong>
                            <ul style="margin: 5px 0 0 20px; line-height: 1.6;">
                                <li>Báo giá trên đã bao gồm toàn bộ chi phí quan trắc, phân tích mẫu, lập báo cáo và các chi phí khác có liên quan đến việc thực hiện hợp đồng này. Thuế suất có thể thay đổi theo quy định tài chính điểm dân bản hóa đơn.</li>
                                <li>Giá trên đã bao gồm thuế VAT 8%. Hóa đơn GTGT sẽ phát hành sau khi hoàn thành dịch vụ và ký biên bản nghiệm thu.</li>
                            </ul>
                        </div>

                        <!-- ==================== PHƯƠNG THỨC THANH TOÁN ==================== -->
                        <div style="margin-top: 15px; font-size: 10pt; page-break-inside: avoid;">
                            <strong>Phương thức và điều kiện thanh toán:</strong>
                            <ul style="margin: 5px 0 0 20px; line-height: 1.6;">
                                <li>Hình thức thanh toán: Chuyển khoản hoặc tiền mặt.</li>
                                <li><strong>Lần thanh toán đợt 1 (70% GTGT):</strong> Thanh toán sau khi ký hợp đồng và trước khi công tác quan trắc hiện trường.</li>
                                <li><strong>Lần thanh toán đợt 2 (30% GTGT):</strong> Thanh toán sau khi hoàn thành dịch vụ, ký biên bản nghiệm thu và bàn giao hồ sơ báo cáo.</li>
                            </ul>
                        </div>

                        <!-- ==================== CHỮ KÝ ==================== -->
                        <table class="signature-area" style="width: 100%; border: 0;">
                            <tr>
                                <td style="width: 50%; text-align: center; border: 0;">
                                    <strong style="font-size: 11pt;">KHÁCH HÀNG</strong><br/>
                                    <span style="font-style: italic; font-size: 9pt;">(Ký, ghi rõ họ tên)</span>
                                </td>
                                <td style="width: 50%; text-align: center; border: 0;">
                                    <strong style="font-size: 11pt;">ĐẠI DIỆN SGC</strong><br/>
                                    <span style="font-style: italic; font-size: 9pt;">(Ký, đóng dấu)</span>
                                </td>
                            </tr>
                        </table>

                        <!-- ==================== FOOTER ==================== -->
                        <div class="footer-info">
                            <table style="width: 100%; border: 0; font-size: 9pt;">
                                <tr>
                                    <td style="width: 50%; border: 0;">
                                        <strong>QL Dự Án:</strong> <span t-field="doc.user_id.name"/><br/>
                                        <strong>ĐT:</strong> 
                                        <t t-if="doc.user_id.phone">
                                            <span t-field="doc.user_id.phone"/>
                                        </t>
                                        <t t-else="">+84 984 907 170</t>
                                         │ <strong>Mail:</strong> <span t-field="doc.user_id.email"/>
                                    </td>
                                    <td style="width: 50%; text-align: right; border: 0;">
                                        <span>Báo giá mẫu số: <strong style="color: #00539F;" t-field="doc.name"/></span><br/>
                                        <span style="font-size: 8pt;">Trang 1 / 2</span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    
                </div>
            </t>
        </t>
    </template>

    <!-- Report Action -->
    <record id="action_report_saleorder_sgc" model="ir.actions.report">
        <field name="name">Báo giá SGC</field>
        <field name="model">sale.order</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">sgc_management_core.report_saleorder_document_sgc</field>
        <field name="report_file">sgc_management_core.report_saleorder_document_sgc</field>
        <field name="print_report_name">'Bao_gia_%s_%s' % (object.partner_id.name[:20], object.name)</field>
        <field name="binding_model_id" ref="sale.model_sale_order"/>
        <field name="binding_type">report</field>
        <field name="paperformat_id" ref="base.paperformat_euro"/>
    </record>

</odoo>
